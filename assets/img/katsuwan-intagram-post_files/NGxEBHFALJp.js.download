;/*FB_PKG_DELIM*/

__d("ACTSanitizerApiLazyLoader",["JSResourceForInteraction","MAWMpsGating"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=512*1024,j=1024*1024;function a(){h==null&&(h=k());var a=h;void a.then(function(a){a=a.getWasmMemorySize();a!=null&&a>=(d("MAWMpsGating").isMpsEnabled()?j:i)&&(h=k())});return a}function k(){return c("JSResourceForInteraction")("ACTSanitizerApiWasm").__setRef("ACTSanitizerApiLazyLoader").load().then(function(a){return a.ACTSanitizerWasm()})}g.loadACTSanitizerApi=a}),98);
__d("ArmadilloReceiveWriteDbFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5720");b=d("FalcoLoggerInternal").create("armadillo_receive_write_db_failure",a);e=b;g["default"]=e}),98);
__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={add:(a=c("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:a("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:a("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:a("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:a("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:a("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.addEventListener("message",function(b){var c;((c=b.data)==null?void 0:c.type)==="BroadcastChannelHandshake-syn"&&a.postMessage({nonce:b.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function e(a,e){var f=d("Random").random(),g=0;return new(h||(h=b("Promise")))(function(b,d){var h=!1,i=function b(){if(g===6){h=!0;a.removeEventListener("message",j);try{throw c("FBLogger")("messenger_web").mustfixThrow("[LS] BC handshake failed, failing, likely worker failure%s",e!=null?" for"+e:"")}catch(a){d(a)}return}if(h)return;a.postMessage({nonce:f,type:"BroadcastChannelHandshake-syn"});c("setTimeout")(b,100*Math.pow(2,g++))},j=function c(d){var e;((e=d.data)==null?void 0:e.type)==="BroadcastChannelHandshake-syn-ack"&&((e=d.data)==null?void 0:e.nonce)===f&&(b(),h=!0,a.removeEventListener("message",c))};a.addEventListener("message",j);i()})}g.listen=a;g.checkAlive=e}),98);
__d("CometTaskFrameworkTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UNKNOWN","BACKGROUND","CURRENT_THREAD","LS_WORKER","MAW_WORKER","TEST"]);c="comet_task_framework";f.ExecutionContext=a;f.TASK_FRAMEWORK_PREFIX=c}),66);
__d("InstamadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={33:(a=c("JSResourceForInteraction"))("IGDUnsendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),46:a("IGDSendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_edit_message:a("IGDEditMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_react_message:a("IGDSendRemoveReactionTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_media_message:a("IGDSendMediaMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_xma_receiver_fetch:a("IGDSendXmaReceiverFetchTaskHandler").__setRef("InstamadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("CometTaskHandlers",["ArmadilloTaskHandlers","InstamadilloTaskHandlers"],(function(a,b,c,d,e,f,g){"use strict";a=babelHelpers["extends"]({},d("ArmadilloTaskHandlers").TASK_HANDLERS_RESOURCES,d("InstamadilloTaskHandlers").TASK_HANDLERS_RESOURCES);g.TASK_HANDLERS_RESOURCES=a}),98);
__d("WorkerBootstrap",["HasteSupportData","ServerJSDefine"],(function(a,b,c,d,e,f,g){"use strict";function h(a){Object.keys(a).forEach(function(b){c("ServerJSDefine").handleDefine(b,[],a[b],-1,null)})}function a(a,c){var f,g;a.hsdp&&d("HasteSupportData").handle(a.hsdp);var i=(f=(g=a.jsmods)!=null?g:a.dynamicModules)!=null?f:{};h(i);var j=b.call(null,c);a.rds!=null&&a.rds.length>0&&e.call(null,a.rds,function(){});if(typeof j==="function"||j!==null)try{for(var k=arguments.length,l=new Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];j.apply(void 0,l)}catch(a){}}function f(a){a=a;if(typeof a==="function"||a!==null)try{a()}catch(a){}}g.initDynamicModules=h;g.start=a;g.startServerJS=f}),98);
__d("CurrentSharedWorker",["HasteSupportData","QPLUserFlow","SharedWorkerStatusLock","WorkerBootstrap","emptyFunction","err","justknobx","qpl","structuredClone"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=[],j=new Set(),k=[],l=!1,m=!1,n=null,o=!1,p=c("qpl")._(931609794,"2369");c("QPLUserFlow").start(p);var q=d("SharedWorkerStatusLock").getStatusLock();c("QPLUserFlow").addPoint(p,"status_lock");c("QPLUserFlow").addAnnotations(p,{string:{id:self.worker_id}});self.setTimeout(function(){if(!o){try{var a;(a=j.values().next().value)==null?void 0:a.postMessage({type:"self-terminate",response:{from:"bundle",workerID:self.worker_id}})}catch(a){c("QPLUserFlow").endFailure(p,"timeout_termination_error"),x(a)}self.close()}},3e5);function r(){m=!0,n=null,h!==null&&(c("QPLUserFlow").addPoint(p,"process_message_buffer"),c("QPLUserFlow").addAnnotations(p,{"int":{message_buffer_size:i.length}}),i.forEach(function(a){return a()}),i=[]),c("QPLUserFlow").endSuccess(p)}function s(a,f){var g=a.data;if(typeof g==="object"&&(g==null?void 0:g.type)==="execute-worker"){var k=!l;try{if(!l&&g.args instanceof Array){var t=g.args[0],u=t.hsdp,v=t.jsmods,w=t.dynamicModules;t=t.rds;c("QPLUserFlow").addPoint(p,"first_init");u!=null&&d("HasteSupportData").handle(u);d("WorkerBootstrap").initDynamicModules((v=(u=v)!=null?u:w)!=null?v:{});t!=null&&t.length>0&&e.call(null,t,function(){});q.init({requestWorkerIdStatusLockToo:c("justknobx")._("4202")});c("QPLUserFlow").addPoint(p,"status_lock_init");l=!0;n!=null&&(n(),r())}u=b.call(b,"SiteData");j.size>1&&f.postMessage({type:"execute-worker-imports",response:{}});f.postMessage({type:"execute-worker-ack",response:{firstInit:k,workerRevision:u.client_revision,spinMode:u.spin,spinTime:u.__spin_t}});o=!0}catch(a){c("QPLUserFlow").endFailure(p,"worker_init_error"),q.release(),f.postMessage({type:"execute-worker-ack",response:{firstInit:k,error:a.message}}),self.close()}}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-get-rev")try{w=b.call(b,"SiteData");f.postMessage({type:"sw-get-rev",response:{workerRevision:w.client_revision,spinMode:w.spin,spinTime:w.__spin_t}})}catch(a){f.postMessage({type:"sw-get-rev",response:{error:a.message}})}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-shutdown"){v=Array.isArray(g.args)?g.args[0]:null;typeof v==="object"&&(v==null?void 0:v.upgrade)===!0?y("requested-upgrade"):typeof v==="object"&&typeof (v==null?void 0:v.reason)==="string"?y(v==null?void 0:v.reason):y()}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-uptime-tracking"){u=typeof (g==null?void 0:g.args)==="object"?(t=g.args)==null?void 0:t.trackerID:null;f.postMessage({type:"sw-uptime-tracking",response:{trackerID:u}})}else typeof g==="object"&&(g==null?void 0:g.type)==="ww-hrp-init"?f.postMessage({type:"ww-hrp-init",response:{}}):typeof g==="object"&&(g==null?void 0:g.type)==="ww-connection-ack"?f.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id,hrpStatus:"processed"}}):h!==null&&m?h(g):i.push(function(){return s(a,f)})}function a(a){var b=h==null;h=(a=a)!=null?a:c("emptyFunction");b&&m&&(i.forEach(function(a){return a()}),i=[])}function t(a,b){j.forEach(function(c){try{c.postMessage(a,b)}catch(b){c.postMessage(a)}})}function f(a){if(l){c("QPLUserFlow").addPoint(p,"init_complete_handler_ran");a();r();return}c("QPLUserFlow").addPoint(p,"init_complete_handler_attached");n=a}["log","error","info","debug","warn"].forEach(function(a){if(self.console[a]==null)throw c("err")('"'+a+'" is not a valid console method.');var b=self.console[a];self.console[a]=function(){for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];b.apply(void 0,e);var g=!1;try{c("structuredClone")!=null&&c("structuredClone")(e),g=!0}catch(a){}if(!g){t({type:"console",response:{method:"error",args:["DataCloneError: Failed to forward console message from web worker due to args not being serializable."]}});return}t({type:"console",response:{method:a,args:e}})}});try{c("QPLUserFlow").addPoint(p,"bootstrap_start");var u=self.shared_worker_bootstrap_buffer==null?void 0:self.shared_worker_bootstrap_buffer(y);if(u!=null){var v=u.ports,w=u.messages;c("QPLUserFlow").addAnnotations(p,{"int":{bootstrap_ports_num:v.length}});v==null?void 0:v.forEach(function(a){try{a.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id,hrpStatus:"processed"}}),a.addEventListener("message",function(b){return s(b,a)}),j.add(a)}catch(a){c("QPLUserFlow").addPoint(p,"connection_fail"),x(a)}});w==null?void 0:w.forEach(function(a){try{s(a.e,a.port)}catch(b){c("QPLUserFlow").addPoint(p,"message_processing_fail");c("QPLUserFlow").addAnnotations(p,{string:{failed_msg_type:(a=(a=a.e.data)==null?void 0:a.type)!=null?a:"unknown"}});x(b)}c("QPLUserFlow").addAnnotations(p,{"int":{msg_num:w.length},string_array:{msgs:w.map(function(a){return(a=a.e.data)==null?void 0:a.type})}})})}else c("QPLUserFlow").addPoint(p,"bootstrap_buffer_empty")}catch(a){x(a),c("QPLUserFlow").endFailure(p,"uncaught_bootstrap_error")}function x(a){try{t({type:"sw-uncaught-error",e:{message:a.message,lineno:a.lineno,colno:a.colno,filename:a.filename,error:a.error}})}catch(b){c("QPLUserFlow").addPoint(p,"sending_error_failed");c("QPLUserFlow").addAnnotations(p,{string:{error:String((a=b.message)!=null?a:b)}})}}self.addEventListener("error",function(a){if(j.size===0){k.push(a);return}x(a)});self.addEventListener("connect",function(a){var b=a.ports[0];b.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id,hrpStatus:"processed"}});b.addEventListener("message",function(a){return s(a,b)});b.start();j.add(b);k.length>0&&(k.forEach(x),k.splice(0,k.length))});function y(a){q.release(),t({type:"sw-shutdown",response:{reason:a,workerID:self.worker_id,isInitialized:o}}),self.close()}g.setMessageHandler=a;g.postMessage=t;g.onInitComplete=f;g.shutdownWorker=y}),98);
__d("CurrentSharedWorkerAdapter",["CurrentSharedWorker","FBLogger"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.addEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(function(a){return b({data:a})});break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.removeEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(null);break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.postMessage=function(a,b){d("CurrentSharedWorker").postMessage(a,b)};return a}();g.CurrentSharedWorkerAdapter=a}),98);
__d("CurrentWorkerMessagePort",["err","ifRequired"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){if(h==null)if("SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope){var a;h=(a=c("ifRequired")("SharedWorkerBootstrapExperimental",function(a){return new a.CurrentSharedWorkerExperimentalAdapter()},function(){return null}))!=null?a:c("ifRequired")("CurrentSharedWorkerAdapter",function(a){return new a.CurrentSharedWorkerAdapter()},function(){return null})}else if("DedicatedWorkerGlobalScope"in self&&self instanceof self.DedicatedWorkerGlobalScope)h=self;else throw new Error("CurrentWorkerAdapter: Unsupported worker type");if(h==null)throw c("err")("CurrentWorkerAdapter: None of shared worker adapters are available");return h}g.getMessagePort=a}),98);
__d("EBMinosDBDev",["FBLogger","MAWWormOdsLogger","Promise","QPLFlow","WALogger","Worm","WormEAR","WormIDbDriver","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error performing makeEBMinosDevDB: ",""]);i=function(){return a};return a}var j={secure_minos_thread_message_encryption_keys:{indexes:{"[roster_hash+act_thread_id]":{fields:["roster_hash","act_thread_id"],unique:!1}},primaryKey:"mek_id_blob",secure:!0}},k,l=1e4;function a(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=d("QPLFlow").startQPLFlow(b,{annotations:{string:{operationType:"initEBMinosDevDbSchema"}},timeoutInMs:l});try{c=new(d("WormEAR").WormEAR)(j,c);a=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,"ebMinosDev",j,c,d("MAWWormOdsLogger").wormOdsWorkerLogger,{}),b);k=a;yield a.init({eventFlow:e});e.endSuccess();return a}catch(a){e.endFail("error");d("WALogger").ERROR(i(),a);throw a}});return m.apply(this,arguments)}function n(){if(k==null)throw c("FBLogger")("messenger_web").mustfixThrow("EBMinosDevDb is not initialized");return k}function e(){var a=Object.keys(j);return n().runInTransaction(a,"readonly",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var d={};yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c.stores[a].readAll());d[a]=b});return function(b){return a.apply(this,arguments)}}()));return d});return function(a){return c.apply(this,arguments)}}(),"EBMinosDevDb - Dump")["catch"](function(){return{}})}g.ebdbDescriptor=j;g.makeEBMinosDevDB=a;g.getEBMinosDevDb=n;g.getDbDump=e}),98);
__d("EBWorkerEBSMStateUtils",["EBLS","I64","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state))}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(a=a)!=null?a:yield d("EBLS").getLSStorage();a=(yield i(a));return a==null?"clientStateRow is null":"clientStateRow:\n        backupId: "+(h||(h=d("I64"))).to_string(a.backupId)+",\n        backupTenancy: "+(a.backupTenancy==null?"null":(h||(h=d("I64"))).to_string(a.backupTenancy))+",\n        authLevel: "+(h||(h=d("I64"))).to_string(a.authorityLevel)+"\n        deviceId: "+(a.deviceId==null?"null":(h||(h=d("I64"))).to_string(a.deviceId))});return j.apply(this,arguments)}g.getEBSMWorkerStateRow=i;g.getEBSMWorkerState=a}),98);
__d("EBWorkerAddDeviceWithKeys",["EBLS","EBSMAPI","EBWorkerAddDeviceUtils","EBWorkerEBDBApiDeferred","EBWorkerEBSMStateUtils","EBWorkerODSEntityName.enum","ExecutionEnvironment","MessengerWebInitData","ODS","ReQL","WALogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy successful but ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy successful"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy done: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy failed, error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy eb state tables start"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key get auto restore param failed: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key get auto restore param end"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key get auto restore param start"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key calling EBAPI"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key got add device param, param is ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key not run, device already exist"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key got client state row"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key start"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] Add device with key: session id is null from MessengerWebInitData"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key returned early - not in worker or gk not passed"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key triggered"]);y=function(){return a};return a}function a(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(y());if(!(i||(i=c("ExecutionEnvironment"))).isInWorker||!c("gkx")("11709")){d("WALogger").LOG(x());return}var b=d("MessengerWebInitData").sessionId;if(b==null){d("WALogger").ERROR(w());return}var e=a;d("WALogger").LOG(v());(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_KEYS,e+".start");var f=a===c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_WORKER,g=(yield d("EBLS").getLSStorage()),j=(yield d("EBWorkerEBSMStateUtils").getEBSMWorkerStateRow(g));d("WALogger").LOG(u());if(j!=null&&!f){d("WALogger").LOG(t());F(e);return}f=(yield f&&j!=null?A(g,j,e):j==null?C(g,e):null);d("WALogger").LOG(s(),f!=null?"not null":"null");if(f!=null){d("WALogger").LOG(r());F(e);return c("EBSMAPI").addDeviceWithEBKeys(babelHelpers["extends"]({},f,{db:g,isInWorker:!0,newDeviceRegistrationId:b,source:a,trackAddingDevice:function(a){void d("EBWorkerEBDBApiDeferred").addNewDevice(a)}}))}});return z.apply(this,arguments)}function A(a,b,c){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(q());var e=b==null?void 0:b.deviceId;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs)).then(function(a){return a!=null}));if(a&&e!=null){d("WALogger").LOG(p());return{backupId:b.backupId,previousDeviceId:e}}d("WALogger").ERROR(o(),a?"epoch not found":"device id is null");E(c);return null});return B.apply(this,arguments)}function C(a,b){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(n());yield c("EBSMAPI").fetchBackupIds(a);var e=(yield d("EBWorkerAddDeviceUtils").copyEBStateTablesFromMainthreadToWorker(["secure_encrypted_backups_epochs","secure_encrypted_backups_client_state"],a)["catch"](function(a){d("WALogger").ERROR(m(),a);E(b);return null}));d("WALogger").LOG(l(),e);if(e==="success"){d("WALogger").LOG(k());a=(yield d("EBWorkerEBSMStateUtils").getEBSMWorkerStateRow(a));var f=a==null?void 0:a.deviceId;if(a==null||f==null){d("WALogger").ERROR(j(),a==null?"client state row is null":"device id is null");return null}return{backupId:a.backupId,previousDeviceId:f}}else if(e==="fail"){E(b);return null}else{F(b,e);return null}});return D.apply(this,arguments)}function E(a){(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_KEYS,a+".fail")}function F(a,b){(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_KEYS,a+".success"+(b!=null?"."+b:""))}g.addDeviceWithKeysInWorker=a}),98);
__d("IGDAWAdminWriteICDCMsgTxn",["Promise","cr:10743","cr:2327"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2327"))!=null?c:b("cr:10743");function a(a,c,d){return i?i.writeICDCAdminMsg(a,c,d):(h||(h=b("Promise"))).resolve()}g.writeICDCAdminMsg=a}),98);
__d("IGDAWAdminWriteUserDeviceMsgTxn",["Promise","cr:10744","cr:2693"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2693"))!=null?c:b("cr:10744");function a(a,c,d,e,f,g){return i?i.writeUserDeviceAdminMsg(a,c,d,e,f,g):(h||(h=b("Promise"))).resolve()}g.writeUserDeviceAdminMsg=a}),98);
__d("IGDAWDbAddDeviceChangeAlertsTxn",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.put(b)});return g.apply(this,arguments)}f.addDeviceChangeAlertsTxn=a}),66);
__d("IGDAWDbUpdateDeviceChangeAlertsTxn",["I64","MAWUnsafeCoerce","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.upsert([b.deviceChangeAlertsId],b)});return i.apply(this,arguments)}function c(a){return d("MAWUnsafeCoerce").unsafeCoerce((h||(h=d("I64"))).of_float(a))}g.updateDeviceChangeAlertsTxn=a;g.convertDeviceChangeAlertsId=c}),98);
__d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["IGDAWDbUpdateDeviceChangeAlertsTxn","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.e2ee_deviceChangeAlerts.index("deviceJid")).getKeyRange(c).filter(function(a){return!a.loggedOut})));yield (h||(h=b("Promise"))).all(c.map(function(b){return d("IGDAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))}))});return i.apply(this,arguments)}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("IGDDbThreadTxns",["I64","Promise","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){return new Map(yield a.runInTransaction(function(a){return(i||(i=b("Promise"))).all(c.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c;b=d("WAJids").extractUserId(b);return[b,yield (c=d("ReQL")).toArrayAsync(c.mergeJoin(c.fromTableAscending(a.participants.index("contactIdThreadKey"),[]).getKeyRange((h||(h=d("I64"))).of_string(b)),d("ReQL").fromTableAscending(a.threads)).map(function(a){a[0];a=a[1];return a}))]});return function(a){return c.apply(this,arguments)}}()))},"readonly",void 0,void 0,f.id+":24"))});return j.apply(this,arguments)}g.getAllThreadsForUsers=a}),98);
__d("IGDHandleICDCErrorInstruction",["IGDAWAdminWriteICDCMsgTxn","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.shouldShowAdminMessages,i=e.threads;if(!g)return;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all(i.map(function(b){return d("IGDAWAdminWriteICDCMsgTxn").writeICDCAdminMsg(a,b,c.notificationTs)})),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.ICDC,key:"icdc"})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleICDCError=a}),98);
__d("MAWAdminMsgHelpers",["MAWCreateParticipantAdminMsg","MAWExternalId","MAWRemoveParticipantAdminMsg","WAAckLevel","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h="Facebook User";function a(a){return a==null||a===""?h:a}function b(a){return a!=null?d("WAJids").userIdFromJid(a):h}function c(a,b,c,e){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWCreateParticipantAdminMsg").createParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),serverTs:e,ts:e,type:"Admin"}}function e(a,b,c,e){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWRemoveParticipantAdminMsg").removeParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),serverTs:e,ts:e,type:"Admin"}}function f(a,b,c,e){var f,g=d("WAGlobals").getMyUserJid();c=c==="@me"?g:c;if(c===g)f={adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserPromotedParticipant"};else if(c==null)f=b===g?{adminMsgContent:[],adminType:"currentUserGotPromoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotPromoted"};else{c=d("WAJids").userIdFromJid(c);f=b===g?{adminMsgContent:[c],adminType:"participantPromotedYou"}:{adminMsgContent:[c,d("WAJids").userIdFromJid(b)],adminType:"participantPromotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:f,serverTs:e,ts:e,type:"Admin"}}function i(a,b,c,e){var f,g=d("WAGlobals").getMyUserJid();c=c==="@me"?g:c;if(c===g)f=b===g?{adminMsgContent:[],adminType:"currentUserSelfDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserDemotedParticipant"};else if(c==null)f=b===g?{adminMsgContent:[],adminType:"currentUserGotDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotDemoted"};else{var h=d("WAJids").userIdFromJid(c);f=b===g?{adminMsgContent:[h],adminType:"participantDemotedYou"}:{adminMsgContent:[h,d("WAJids").userIdFromJid(b)],adminType:c===b?"participantSelfDemoted":"participantDemotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:f,serverTs:e,ts:e,type:"Admin"}}function j(a,b,c,e){var f=[],g=b.subject.content;if(g==null)return;b.subject.user===d("WAGlobals").getMyUserJid()?(b="currentUserNamedGroup",f.push(g)):c==null?(b="unkonwnUserNamedGroup",f.push(g)):(b="participantNamedGroup",f.push(c,g));return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:f,adminType:b},serverTs:e,ts:e,type:"Admin"}}function k(a,b,c,e){var f,g=[];if(c===d("WAGlobals").getMyUserJid())switch(b){case"all_member_add":f="currentUserSetAddModeAllMembers";break;case"admin_add":f="currentUserSetAddModeAdminOnly";break}else if(c!=null){g.push(d("WAJids").userIdFromJid(c));switch(b){case"all_member_add":f="participantSetAddModeAllMembers";break;case"admin_add":f="participantSetAddModeAdminOnly";break}}else switch(b){case"all_member_add":f="serverSetAddModeAllMembers";break;case"admin_add":f="serverSetAddModeAdminOnly";break}if(f==null)return;return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:g,adminType:f},serverTs:e,ts:e,type:"Admin"}}g.UNKNOWN_USER=h;g.maybeUnknownParticipantName=a;g.createAdminMsgContactId=b;g.createParticipantAddAdminMessage=c;g.createParticipantRemoveAdminMsg=e;g.createParticipantPromoteAdminMsg=f;g.createParticipantDemoteAdminMsg=i;g.createGroupNameChangeAdminMsg=j;g.createMemberAddModeChangeAdminMsg=k}),98);
__d("MAWCreateParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantAddedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantAddedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantAddedYouAndMoreThanOneUsers"}}}function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"currentUserAddedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserAddedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserAddedMoreThanTwoParticipant"}}}function j(a,b,c,d){switch(a){case 1:return{adminMsgContent:[b,c],adminType:"participantAddedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantAddedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantAddedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e));return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e))}g.createParticipantAdminMessage=a}),98);
__d("MAWRemoveParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantRemovedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantRemovedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantRemovedYouAndMoreThanOneUsers"}}}function i(a,b,c,d){switch(a){case 1:return d?{adminMsgContent:[],adminType:"currentUserLeftGroup"}:{adminMsgContent:[b],adminType:"currentUserRemovedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserRemovedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserRemovedMoreThanTwoParticipant"}}}function j(a,b,c,d,e){switch(a){case 1:return e?{adminMsgContent:[b],adminType:"participantLeftGroup"}:{adminMsgContent:[b,c],adminType:"participantRemovedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantRemovedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantRemovedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===d("WAGlobals").getMyUserJid());return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===a)}g.removeParticipantAdminMessage=a}),98);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAckLevel","MAWAdminMsgHelpers","MAWDbMsgTxns","MAWDexieTable","MAWExternalId","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";e={add:"add",remove:"remove",update:"update"};function h(a,b){switch(a){case"add":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE;case"remove":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE;case"update":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE}}function a(a,b,e,f,g){return d("MAWDbMsgTxns").getIsThreadEmpty(a,e.jid).then(function(i){if(i)return d("MAWDexieTable").dexieResolve();i=b===d("MAWUserJidWrapper").getMyUserJid();var j=h(f,i);i=i?[]:[d("WAJids").userIdFromJid(b)];i=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:i,adminType:j,version:1},e.jid,d("MAWExternalId").generateExternalId(),g);return d("MAWWriteMsgTxns").writeMsg(a,i,e,"MAWAdminWriteUsersConnectedMsgTxn::writeUserDeviceAdminMsg").then(c("emptyFunction"))})}function b(a,b,e,f){var g=d("MAWAdminMsgHelpers").UNKNOWN_USER,h=b===d("MAWUserJidWrapper").getMyUserJid();b={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:h?d("WAJids").AUTHOR_ME:b,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE,authorName:g},threadJid:e.jid,ts:(h=f)!=null?h:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(a,b,e,"MAWAdminWriteUsersConnectedMsgTxn::writeICDCAlert").then(c("emptyFunction"))}g.DeviceChange=e;g.getUserDeviceAdminType=h;g.writeUserDeviceAdminMsg=a;g.writeICDCAlert=b}),98);
__d("MAWDbDeviceChangeAlerts",[],(function(a,b,c,d,e,f){"use strict";b="add";c="keyChange";d="remove";function a(a){return a}f.ADD=b;f.KEY_CHANGE=c;f.REMOVE=d;f.unsafeCoerceToDeviceChangeAlertsID=a}),66);
__d("IGDHandleIdentityAddedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbAddDeviceChangeAlertsTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.contactId,k=e.isMe,l=e.shouldShowAdminMessages,m=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=j(a,c,k,g),f=e.promise;e=e.showSelfAlerts;var n=l?m.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,k,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(n));(e||l)&&d("MAWODSProxy").odsBumpEntityKey({entity:k?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":47")});return i.apply(this,arguments)}function j(a,c,e,f){var g=!1,i=(h||(h=b("Promise"))).resolve();if(e&&c.model!=null&&c.platform!=null&&c.notificationTs!=null){g=!0;e=c.instruction==="identityChanged"?d("MAWDbDeviceChangeAlerts").KEY_CHANGE:d("MAWDbDeviceChangeAlerts").ADD;i=d("IGDAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:e,deviceJid:c.device,identity:c.identity,isArchived:!f,isConfirmed:!1,isNotified:!1,model:c.model,platform:c.platform,ts:c.notificationTs})}return{promise:i,showSelfAlerts:g}}g.handleIdentityAdded=a;g.addDeviceChangeAlerts=j}),98);
__d("IGDHandleIdentityChangedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDHandleIdentityAddedInstruction","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAJids","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=d("IGDHandleIdentityAddedInstruction").addDeviceChangeAlerts(a,c,i,g),f=e.promise;e=e.showSelfAlerts;var l=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,d("WAJids").extractUserId(c.jid),i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(l));(e||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":31")});return i.apply(this,arguments)}g.handleIdentityChanged=a}),98);
__d("IGDHandleIdentityRemovedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.contactId,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=i?d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,c.device):(h||(h=b("Promise"))).resolve(),f=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,g,i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([e].concat(f));(i||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleIdentityRemoved=a}),98);
__d("MAWGetReStoreDBError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.message=b;c.name="MAWGetReStoreDBError";return c}return b}(babelHelpers.wrapNativeSuper(Error));f["default"]=a}),66);
__d("MAWReStoreDbSetup",["FBLogger","MAWGetReStoreDBError","asyncToGeneratorRuntime","cr:10742","cr:2924","cr:3535","cr:4561"],(function(a,b,c,d,e,f,g){"use strict";var h;h=(h=(h=b("cr:3535"))!=null?h:b("cr:10742"))!=null?h:b("cr:2924");if(h!=null&&b("cr:4561")!=null){var i=h;h=babelHelpers["extends"]({},h,{createDB:function(){return i.createDB(void 0,[b("cr:4561")])}})}var j=(h=h)==null?void 0:h.createDB,k;function a(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield k);a==null?void 0:a.closeDb==null?void 0:a.closeDb();k=null});return l.apply(this,arguments)}function d(){if(j==null)throw c("FBLogger")("messenger_web").mustfixThrow("Unexpected invocation of OneDB");k==null&&(k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield j());yield a.runInTransaction(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){}),"readwrite",void 0,void 0,f.id+":54");return a}catch(a){throw new(c("MAWGetReStoreDBError"))("Failed to get ReStore DB: "+a)}})());return k}function e(){return j!=null}g.closeDB=a;g.getDB=d;g.shouldUseReStoreDb=e}),98);
__d("MAWReStoreDb",["FBLogger","MAWIndexedDb","MAWReStoreDbSetup","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("3577"))try{var a=(yield d("MAWReStoreDbSetup").getDB());return a}catch(a){throw c("FBLogger")("igd_web").blameToPreviousFrame().catching(a).mustfixThrow("Failed to get ReStore DB: %s",arguments[0])}h==null&&(d("MAWIndexedDb").willSetupDB()?h=d("MAWIndexedDb").getDB().then(function(){return d("MAWReStoreDbSetup").getDB()}):h=d("MAWReStoreDbSetup").getDB());return h});return i.apply(this,arguments)}function e(){return d("MAWReStoreDbSetup").shouldUseReStoreDb()}g.getDB=a;g.shouldUseReStoreDb=e}),98);
__d("IGDAWProtocolQueueInstructions",["FBLogger","IGDDbThreadTxns","IGDHandleICDCErrorInstruction","IGDHandleIdentityAddedInstruction","IGDHandleIdentityChangedInstruction","IGDHandleIdentityRemovedInstruction","MAWDbAppMeta","MAWReStoreDb","Promise","WAAssertUnreachable","WAGlobals","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB(f.id+":33")),e=(yield j(b,a)),g=e[0],h=g.allowSecurityAlertForContact;g=g.allowSecurityAlertForSelf;e=e[1];var i=[];for(a of a){var k=a.jid,m=d("WAJids").extractUserId(k);k=k===d("WAGlobals").getMyUserJid();var n=l({allowSecurityAlertForContact:h,isICDCError:a.instruction==="icdcError",isMe:k});n={allowSecurityAlertForSelf:g,contactId:m,isMe:k,shouldShowAdminMessages:n,threads:(k=e.get(m))!=null?k:[]};try{yield o(b,a,n),i.push(a.stanzaQueueId)}catch(a){c("FBLogger")("igd_web").warn("Failed to handle instruction. The error is %s",a)}}return{followUpParams:void 0,toAck:i}});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new Set(b.map(function(a){return a.jid})),e=(yield m(a)),f=e.allowSecurityAlertForContact&&b.some(function(a){return a.jid!==d("WAGlobals").getMyUserJid()});b=b.some(function(a){return a.instruction==="icdcError"});f=f||b;b=f?yield d("IGDDbThreadTxns").getAllThreadsForUsers(a,Array.from(c)):new Map();return[e,b]});return k.apply(this,arguments)}function l(a){var b=a.allowSecurityAlertForContact,c=a.isICDCError;a=a.isMe;return!a&&(b||c)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf),a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert)]));var c=a[0];a=a[1];return{allowSecurityAlertForContact:(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1,allowSecurityAlertForSelf:(a=c==null?void 0:c.value.allowSecurityAlertForSelf)!=null?a:!0}});return n.apply(this,arguments)}function o(a,b,e){switch(b.instruction){case"identityChanged":return d("IGDHandleIdentityChangedInstruction").handleIdentityChanged(a,b,e);case"identityAdded":return d("IGDHandleIdentityAddedInstruction").handleIdentityAdded(a,b,e);case"identityRemoved":return d("IGDHandleIdentityRemovedInstruction").handleIdentityRemoved(a,b,e);case"icdcError":return d("IGDHandleICDCErrorInstruction").handleICDCError(a,b,e);default:throw c("WAAssertUnreachable")(b)}}g.handleInstructions=a;g.getShouldShowAdminMessages=l}),98);
__d("WAQPLProxy",["WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);i=function(){return a};return a}function a(a,b,e,f,g){g===void 0&&(g=!0);if(j==null){d("WALogger").ERROR(i(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.start(a,b,e,f,g)}function b(a,b){if(j==null){d("WALogger").ERROR(h(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.resume(a,b)}var j=null;function e(a){j=a}g.waQPLProxyStart=a;g.waQPLProxyStartResume=b;g.provideProxyImplementationForWAQPLProxy=e}),98);
__d("WAParseMessageTransport",["WALogger","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["There are unknown fields in the integral"]);h=function(){return a};return a}function i(a){return{version:"v3",type:"error",error:a}}function j(a,b){return a!=null&&(b.dsm==null||b.dsm.destinationJid==null||b.dsm.destinationJid!==a)}function a(a,b){var c=a.payload,e=a.protocol;if(c==null&&e==null)return i("There is no payload and protocol in the message transport");else if(e==null)return i("There is no protocol part in the message transport");var f=e.integral;if(f==null)return i("There is no integral part in the message transport");else if(f.padding==null)return i("There is no padding in the message transport");else if(j(b,f))return i("The recipient does not match the device sent message recipient");else if(d("decodeProtobuf").getUnknownFields(f)!=null){d("WALogger").ERROR(h());return babelHelpers["extends"]({},i("There are unknown fields in the integral"),{futureProof:c==null?void 0:c.futureProof})}if(c!=null){b=c.applicationPayload;return b==null?i("There is no applicationPayload payload in the message transport"):{type:"applicationPayload",applicationPayload:b,skdm:l(e.ancillary),icdc:m(e.ancillary)}}f=l(e.ancillary);if(f!=null)return{type:"skdm",skdm:f,icdc:m(e.ancillary)};return k(a)===!0?{type:"empty",version:"v3"}:{type:"unknown"}}function k(a){var b;if(a.payload!=null)return!1;if(a.protocol==null)return!0;a=a.protocol;var c=new Set(["$$unknownFieldCount","padding"]);b=Object.keys((b=a.integral)!=null?b:{}).filter(function(a){return!c.has(a)});a=Object.keys((a=a.ancillary)!=null?a:{}).filter(function(a){return!c.has(a)});return a.length===0&&b.length===0}function l(a){return a==null?null:a.skdm}function m(a){return a==null?null:a.icdc}g.parseMessageTransport=a}),98);
__d("WAStanzaRootTag",[],(function(a,b,c,d,e,f){"use strict";a="notification";b="receipt";c="message";d="call";e="chatstate";var g="presence",h="appdata",i="failure",j="stream:error",k="ib",l="iq",m="error",n="success",o="xmlstreamend",p={NOTIFICATION:a,RECEIPT:b,MESSAGE:c,CHATSTATE:e,PRESENCE:g,APPDATA:h,CALL:d,IQ:l,IB:k,STREAM_ERROR:j,FAILURE:i,SUCCESS:n,ERROR:m,XML_STREAM_END:o};f.NOTIFICATION=a;f.RECEIPT=b;f.MESSAGE=c;f.CALL=d;f.CHATSTATE=e;f.PRESENCE=g;f.APPDATA=h;f.FAILURE=i;f.STREAM_ERROR=j;f.IB=k;f.IQ=l;f.ERROR=m;f.SUCCESS=n;f.XML_STREAM_END=o;f.STANZA_ROOT_TAG=p}),66);
__d("XmaEventsE2eeFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1399");b=d("FalcoLoggerInternal").create("xma_events_e2ee",a);e=b;g["default"]=e}),98);
__d("MAWSharedCOPLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["COP"]);g["default"]=a}),98);
__d("WADexiePersistedQueueApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{ack:k,clear:m,"delete":l,index:i,keys:n,read:h,write:j}}function h(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();(b==null?void 0:b.order)==="desc"&&(a=a.reverse());(b==null?void 0:b.filter)!=null&&(a=a.filter(b.filter));(b==null?void 0:b.limit)!=null&&(a=a.limit(b.limit));return a.toArray()},"read")}function i(a,b){return{equals:function(c){return{read:function(e){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.where(b).equals(c.length===1?c[0]:c);(e==null?void 0:e.order)==="desc"&&(a=a.reverse());(e==null?void 0:e.filter)!=null&&(a=a.filter(e.filter));(e==null?void 0:e.limit)!=null&&(a=a.limit(e.limit));return a.toArray()},"index-equal")}}},keys:function(){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);return a.uniqueKeys()},"index-keys")},read:function(c){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);(c==null?void 0:c.order)==="desc"&&(a=a.reverse());(c==null?void 0:c.filter)!=null&&(a=a.filter(c.filter));(c==null?void 0:c.limit)!=null&&(a=a.limit(c.limit));return a.toArray()},"index-read")}}}function j(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkAdd(b).then(function(){})},"write")}function k(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"ack")}function l(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"delete")}function m(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.clear().then(function(){})},"clear")}function n(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();return a.primaryKeys()},"keys")}g.dexieApiForPersistedQueue=a;g.persistedQueueRead=h;g.persistedQueueIndex=i;g.persistedQueueWrite=j;g.persistedQueueAck=k;g.persistedQueueDelete=l;g.persistedQueueClear=m;g.persistedQueueKeys=n}),98);
__d("MAWDbStaleQueue",["MAWODSProxy","MAWSharedCOPLogger","WADexiePersistedQueueApi","WAGetPlatformFromStanzaId","WAOdsEnums","WAPersistedQueue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping: ",", error: ",". Source: ",""]);h=function(){return a};return a}var i=null;function j(){if(i)return i;var a=d("WAPersistedQueue").initPersistedQueue("staleQueue",d("WADexiePersistedQueueApi").dexieApiForPersistedQueue());i=a;return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.type==="message"?a.subtype!=null?d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.stanzaId):d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.message.details.externalId):null;c("MAWSharedCOPLogger").EXPECTED_ERROR(h(),a.type,b,e);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.POISON_QUEUE_ENTTITY,key:""+a.type});e=j();if(a.type!=="message")return;return e.addAndCommit([{exception:b,stanza:a}])});return k.apply(this,arguments)}e=function(){return j().read({limit:1}).then(function(a){return a.length===0})};f=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=500);a=j().read({limit:a});a=(yield a.then(function(a){return a.flatMap(function(a){return a})}));return a});return function(b){return a.apply(this,arguments)}}();g.mawAddStaleStanza=a;g.isEmpty=e;g.read=f}),98);
__d("MAWIsQuotaExceededError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.name==="QuotaExceededError"||a.inner&&a.inner.name==="QuotaExceededError"};f.isQuotaExceededError=a}),66);
__d("MAWMessageReceiveReliabilityLogger",["WAHashStringToNumber","WAQPLProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(1056840931,"814"),i=c("qpl")._(521477947,"2395"),j=60*1e3;function a(a){a.forEach(function(a){d("WAQPLProxy").waQPLProxyStart(a.incomingType==="wa"?h:i,{bool:{rrv2:!0},"int":{msgId:d("WAHashStringToNumber").hashStringToNumber(a.stanzaId)},string:{incomingType:a.incomingType,jid:a.jid,msgType:a.type}},d("WAHashStringToNumber").hashStringToNumber(a.stanzaId),j)})}b=5*60*1e3;g.logRRStart=a;g.RECEIVE_RELIABILITY_TIMEOUT=b}),98);
__d("MAWSharedRestoreUnavailableMessages",["LSMEBTaskCreationSource","MAWBridgeEventTransmitter","WAGlobals","WAJids","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=1e4,i=new Map();function j(a){if(i.has(a.externalId))return;i.set(a.externalId,!0);c("setTimeout")(function(){var b=a.chat;d("MAWBridgeEventTransmitter").issuePointQueryOutsideTxn(a.externalId,d("WAJids").threadIdForChatJid(b),void 0,c("LSMEBTaskCreationSource").EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES,b)},h)}function a(a){a.forEach(function(a){if(a.type!=="message")return;if(a.subtype!=null){if(a.subtype==="unavailable"||a.subtype==="ciphertext"){var b=d("WAJids").extractUserJid(a.from);j({author:d("WAGlobals").getMyUserJid()===b?"@me":b,chat:a.jid,externalId:a.stanzaId})}}else(a.message.decrypted.type==="IncomingCiphertextMsg"||a.message.decrypted.type==="UnavailableMsg")&&j(a.message.decrypted.id)})}g.restoreUnavailableMessages=a}),98);
__d("MAWSharedCOPHandleBatch",["MAWDbStaleQueue","MAWIsQuotaExceededError","MAWMessageReceiveReliabilityLogger","MAWSharedCOPLogger","MAWSharedRestoreUnavailableMessages","WALogger","WAProtocolQueue","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Linear COP v2"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," stanzas. Config:",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received more than 1 entry, despite having limit === 1"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed processing "," items"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ackProtocols] Cannot ack from MAWConsumer: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Runtime error while processing stanzas batch. ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Quota exceeded while processing stanzas batch. ",""]);n=function(){return a};return a}function o(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e=(yield e(a).then(function(a){return[a,null,!1]})["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a)){c("MAWSharedCOPLogger").ERROR(n(),a);return[[],null,!0]}c("MAWSharedCOPLogger").ERROR(m(),a);return[[],a instanceof Error?a:c("err")(""+a),!1]}));var f=e[0],g=e[1];e=e[2];if(e)return{entriesLeft:[],exhausted:!0,handled:0};yield d("WAProtocolQueue").protocolQueue().ack(f)["catch"](function(a){return c("MAWSharedCOPLogger").ERROR(l(),a)});if(f.length>=a.length)return{entriesLeft:[],exhausted:!1,handled:f.length};c("MAWSharedCOPLogger").WARN(k(),a.length-f.length);if(b===1){a.length>1&&c("MAWSharedCOPLogger").ERROR(j());if(a.length===0)return{entriesLeft:[],exhausted:!1,handled:0};e=a[0];g=(b=g==null?void 0:g.toString())!=null?b:"not-processed";yield d("WAProtocolQueue").protocolQueue()["delete"]([e.stanzaQueueId]);yield d("MAWDbStaleQueue").mawAddStaleStanza(e,g);return{entriesLeft:[],exhausted:!1,handled:1}}var h=new Map(a.map(function(a){return[a.stanzaQueueId,a]}));f.forEach(function(a){return h["delete"](a)});return{entriesLeft:Array.from(h.values()),error:!0,exhausted:!1,handled:f.length}});return p.apply(this,arguments)}function q(a){var b=[];for(a of a)a.type==="message"&&b.push(a);d("MAWMessageReceiveReliabilityLogger").logRRStart(b)}function a(a,b,c,d){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){a=(yield a(b));q(a);b.order==="desc"&&(a=a.toReversed());if(a.length===0)return{exhausted:!0,handled:0};f==null?void 0:f.publish({type:"maw-infra-batch"});c("MAWSharedCOPLogger").LOG(i(),a.length,b);d("MAWSharedRestoreUnavailableMessages").restoreUnavailableMessages(a);f=(yield o(a,b.limit,e));if(f.error==null)return{exhausted:f.exhausted,handled:f.handled};d("WALogger").LOG(h());a=0;for(b of f.entriesLeft){var g=(yield o([b],1,e));a+=g.handled;if(g.exhausted)return{exhausted:!0,handled:a+f.handled}}return{exhausted:!1,handled:a+f.handled}});return r.apply(this,arguments)}g.copHandleBatch=a}),98);
__d("MawCopScheduler",["WorkerScheduler","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("cop",{concurrency:1,maxConcurrency:1,maxThrottleMs:1e5,timeToStuckMs:c("gkx")("10466")?1e5:3e4}));return h}g.copScheduler=a}),98);
__d("MAWSharedOfflineResumeUINotifier",["MAWBridge","MAWQplProxy","MAWSharedProtocolQueueConst","WAOfflineUtils","WATagsLogger","WAThrottle","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose([' -> Unable to send "Offline Complete" event ',""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([' -> "Offline Complete" bridge event sent']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAW UI: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Set thread metadata: ",", ",""]);k=function(){return a};return a}var l=1e3/3,m=d("WATagsLogger").TAGS(["ProtocolQueue","MAWConsumer"]);a=function(){function a(){var a=this;this.$1={};this.$2={};this.$3=0;this.$4="wa";this.$5=!1;this.$6=0;this.$7=0;this.$8=0;this.$9=0;this.$10=null;this.$16=d("WAThrottle").throttle(function(){if(a.$5)return;a.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing)},l);this.$12=d("WAThrottle").throttle(function(){a.$4==="wa"&&a.$5===!1&&a.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Processing)},l)}var b=a.prototype;b.subscribeToWAEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"offline-start":b.$10=d("MAWQplProxy").performanceAbsoluteNow();b.$6=a.offlineStats.count;b.$8=a.offlineStats.message;b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing,b.$10);b.$5=!1;b.$4="wa";break;case"offline-processed":break;case"offline-entity":b.$7++;b.$12();break;case"offline-end":b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Complete);b.$4="maw";break;case"connection-lost":b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Failed);break;default:a}})};b.subscribeToMawEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"maw-infra-start":b.$10==null&&(b.$10=d("MAWQplProxy").performanceAbsoluteNow());b.$13();break;case"maw-infra-end":a.success?b.notifyUICurrentProcessingSucceeded():b.$14();b.$10=null;break}})};b.subscribeToMessageEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"new-message":if(a.commonMessageBase.offline==null)return;b.addWAMessage();break}})};b.addWAMessage=function(){this.$9++,this.$12()};b.$13=function(){this.$3=0,this.$5=!1,this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing)};b.setThreadMetadata=function(a){var b=a.reduce(function(a,b){a[b.from]=b.t;return a},{});a=a.reduce(function(a,b){b=b.from;a[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing};return a},{});m.DEV(k(),JSON.stringify(b),JSON.stringify(a));this.$1=b;this.$2=a};b.notifyUIChatReady=function(a){this.$2[a]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete},this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing)};b.updateChatState=function(a){var b=this;Object.entries(a).forEach(function(a){var c=a[0];a=a[1];if(b.$1[c]!=null){var e=b.$1[c];a>=e&&(b.$2[c]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete})}});this.$16()};b.addMAWEntity=function(a){this.$3+=a,this.$16()};b.notifyUICurrentProcessingSucceeded=function(){var a=this;Object.keys(this.$2).forEach(function(b){a.$2[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete}});this.$5=!0;this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete);this.$1={};this.$2={}};b.$14=function(){var a=this;Object.keys(this.$2).forEach(function(b){a.$2[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete}});this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed);this.$1={};this.$2={}};b.maybeNotifyUI=function(){this.$16()};b.$11=function(a,b){d("MAWBridge").getBridge().fireAndForget("event","offlineSnapshot",{downloaded:{count:this.$7,message:this.$9},expected:{count:this.$6,message:this.$8},status:a,timestamp:b!=null?b:d("MAWQplProxy").performanceAbsoluteNow()})};b.$15=function(a){var b=d("MAWQplProxy").performanceAbsoluteNow();b={chatJidStatus:this.$2,startTime:this.$10!=null?this.$10:null,status:a,timestamp:b,totalExpectedCount:this.$6,totalProcessedCount:this.$3};m.LOG(j(),JSON.stringify(b));a===d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete?c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","offlineConsumerProgress",b),function(){m.LOG(i())},function(a){m.ERROR(h(),a)}):d("MAWBridge").getBridge().fireAndForget("event","offlineConsumerProgress",b)};return a}();b=new a();g.ConsumerUINotifier=a;g.offlineResumeUINotifier=b}),98);
__d("MAWDbXMA",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return a}function c(a){return(h||(h=d("I64"))).to_float(a)}g.convertNumbersToXMAIds=a;g.convertNumberToXMAId=b;g.convertXMAId64ToXMAId=c}),98);
__d("MAWExpiredXMACleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ExpiredXMACleaner: Adding timestamps backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}var j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.XMA))}function b(a){if(j==null){var b="Trying to add new addNewExpiredXMACleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("FBLogger")("messenger_web").mustfixThrow(b)}else d("WALogger").DEV(h(),a),j.update(a)}function e(){return j}function f(){j=null}g.startExpiredXMACleaner=a;g.addNewExpiredXMACleanerTimestamp=b;g.getExpiredXMACleaner_FOR_TESTING_ONLY=e;g.resetExpiredXMACleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWBridgeSearchMsg",["MAWCurrentUser","MAWVault","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b=!0);var c=a,e=d("MAWCurrentUser").getID(),f=a.author,g=a.externalId,h=a.msgId,i=a.threadJid;if(i==null)return null;var j=c.content;c=c.sortOrderMs;i={chatJid:i,externalId:g,msg:{msgId:h,sender:d("WAJids").authorToUserId(f,e),ts:a.canonicalTs},sortOrderMs:c};g=j;return babelHelpers["extends"]({},i,{msg:babelHelpers["extends"]({},i.msg,{content:g!=null?d("MAWVault").isVaulted(g)?b?g:d("MAWVault").unvault(g):b?d("MAWVault").vault(g):g:void 0})})}b="message_content_search";c="non_message_content_search";g.createBridgeSearchMsg=a;g.MESSAGE_CONTENT_SEARCH=b;g.NON_MESSAGE_CONTENT_SEARCH=c}),98);
__d("WAFtsTokenizerBaseNormalizer",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this,c=[];this.$1=new Map();a.forEach(function(a){var d=a[0];a=a[1];b.$1.set(d,a);c.push(d)});this.$2=new RegExp(c.join("|"),"g")}var b=a.prototype;b.normalize=function(a){var b=this;a===void 0&&(a="");return a.replace(this.$2,function(a){var c=b.$1.get(a);return c!=null?c:a})};return a}();f["default"]=a}),66);
__d("WAFtsTokenizerPostLowercaseNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0131","i"],["\u0629","\u0647"],["\u0640",""],["\u0649","\u064a"],["\u0671","\u0627"],["\u06a4","\u0641"],["\u06a9","\u0643"],["\u06ba","\u0646"],["\u06be","\u0647"],["\u06c3","\u06c2"],["\u06cc","\u064a"],["\u06d2","\u064a"],["\u06d5","\u0647"],["\u06f0","\u0660"],["\u06f1","\u0661"],["\u06f2","\u0662"],["\u06f3","\u0663"],["\u06f4","\u0664"],["\u06f5","\u0665"],["\u06f6","\u0666"],["\u06f7","\u0667"],["\u06f8","\u0668"],["\u06f9","\u0669"],["\u08bb","\u0641"],["\u08bc","\u0642"],["\u08bd","\u0646"],["\u200c",""],["\u0966","0"],["\u0967","1"],["\u0968","2"],["\u0969","3"],["\u096a","4"],["\u096b","5"],["\u096c","6"],["\u096d","7"],["\u096e","8"],["\u096f","9"],["\u0901","\u0902"],["\u0903",""],["\u093c",""],["\u09e6","0"],["\u09e7","1"],["\u09e8","2"],["\u09e9","3"],["\u09ea","4"],["\u09eb","5"],["\u09ec","6"],["\u09ed","7"],["\u09ee","8"],["\u09ef","9"],["\u0a66","0"],["\u0a67","1"],["\u0a68","2"],["\u0a69","3"],["\u0a6a","4"],["\u0a6b","5"],["\u0a6c","6"],["\u0a6d","7"],["\u0a6e","8"],["\u0a6f","9"],["\u0c66","0"],["\u0c67","1"],["\u0c68","2"],["\u0c69","3"],["\u0c6a","4"],["\u0c6b","5"],["\u0c6c","6"],["\u0c6d","7"],["\u0c6e","8"],["\u0c6f","9"],["\u0ae6","0"],["\u0ae7","1"],["\u0ae8","2"],["\u0ae9","3"],["\u0aea","4"],["\u0aeb","5"],["\u0aec","6"],["\u0aed","7"],["\u0aee","8"],["\u0aef","9"],["\u0ce6","0"],["\u0ce7","1"],["\u0ce8","2"],["\u0ce9","3"],["\u0cea","4"],["\u0ceb","5"],["\u0cec","6"],["\u0ced","7"],["\u0cee","8"],["\u0cef","9"],["\u0d66","0"],["\u0d67","1"],["\u0d68","2"],["\u0d69","3"],["\u0d6a","4"],["\u0d6b","5"],["\u0d6c","6"],["\u0d6d","7"],["\u0d6e","8"],["\u0d6f","9"],["\u0142","l"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsTokenizerPreNFKDNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0675","\u0674\u0627"],["\u0676","\u0674\u0648"],["\u0677","\u0674\u06c7"],["\u0678","\u0674\u0649"],["\u0905\u0946","\u0904"],["\u0905\u093e","\u0906"],["\u0930\u094d\u0907","\u0908"],["\u0909\u0941","\u090a"],["\u090f\u0945","\u090d"],["\u090f\u0946","\u090e"],["\u090f\u0947","\u0910"],["\u0905\u0949","\u0911"],["\u0906\u0945","\u0911"],["\u0905\u094a","\u0912"],["\u0906\u0946","\u0912"],["\u0905\u094b","\u0913"],["\u0906\u0947","\u0913"],["\u0905\u094c","\u0914"],["\u0906\u0948","\u0914"],["\u0905\u0945","\u0972"],["\u0905\u093a","\u0973"],["\u0905\u093b","\u0974"],["\u0906\u093a","\u0974"],["\u0905\u094f","\u0975"],["\u0905\u0956","\u0976"],["\u0905\u0957","\u0977"],["\u0985\u09be","\u0986"],["\u098b\u09c3","\u09e0"],["\u098c\u09e2","\u09e1"],["\u0a05\u0a3e","\u0a06"],["\u0a72\u0a3f","\u0a07"],["\u0a72\u0a40","\u0a08"],["\u0a73\u0a41","\u0a09"],["\u0a73\u0a42","\u0a0a"],["\u0a72\u0a47","\u0a0f"],["\u0a05\u0a48","\u0a10"],["\u0a73\u0a4b","\u0a13"],["\u0a05\u0a4c","\u0a14"],["\u0a85\u0abe","\u0a86"],["\u0a85\u0ac5","\u0a8d"],["\u0a85\u0ac7","\u0a8f"],["\u0a85\u0ac8","\u0a90"],["\u0a85\u0ac9","\u0a91"],["\u0a85\u0acb","\u0a93"],["\u0a85\u0abe\u0ac5","\u0a93"],["\u0a85\u0acc","\u0a94"],["\u0a85\u0abe\u0ac8","\u0a94"],["\u0ac5\u0abe","\u0ac9"],["\u0b05\u0b3e","\u0b06"],["\u0b0f\u0b57","\u0b10"],["\u0b13\u0b57","\u0b14"],["\u0bb8\u0bcd\u0bb0\u0bc0","\u0bb6\u0bcd\u0bb0\u0bc0"],["\u0c12\u0c55","\u0c13"],["\u0c12\u0c4c","\u0c14"],["\u0c3f\u0c55","\u0c40"],["\u0c46\u0c55","\u0c47"],["\u0c4a\u0c55","\u0c4b"],["\u0c89\u0cbe","\u0c8a"],["\u0c92\u0ccc","\u0c94"],["\u0c8b\u0cbe","\u0ce0"],["\u0d07\u0d57","\u0d08"],["\u0d09\u0d57","\u0d0a"],["\u0d0e\u0d46","\u0d10"],["\u0d12\u0d3e","\u0d13"],["\u0d12\u0d57","\u0d14"],["\u0d23\u0d4d\u200d","\u0d7a"],["\u0d28\u0d4d\u200d","\u0d7b"],["\u0d30\u0d4d\u200d","\u0d7c"],["\u0d32\u0d4d\u200d","\u0d7d"],["\u0d33\u0d4d\u200d","\u0d7e"],["\u0d85\u0dcf","\u0d86"],["\u0d85\u0dd0","\u0d87"],["\u0d85\u0dd1","\u0d88"],["\u0d8b\u0ddf","\u0d8c"],["\u0d8d\u0dd8","\u0d8e"],["\u0d8f\u0ddf","\u0d90"],["\u0d91\u0dca","\u0d92"],["\u0d91\u0dd9","\u0d93"],["\u0d94\u0ddf","\u0d96"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsMultiLangTokenizer",["WAFtsTokenizerPostLowercaseNormalizer","WAFtsTokenizerPreNFKDNormalizer"],(function(a,b,c,d,e,f,g){"use strict";var h={NFC_CHARACTER:/(?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3030\u3038-\u303B\u303D\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u3297\u3299\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFF66-\uFF6F\uFF71-\uFF9D]|\uD81B[\uDFF0\uDFF1]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/g,NFC_WORD:/((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E01-\u0E3A\u0E40-\u0E5B])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u02EA\u02EB\u3105-\u312F\u31A0-\u31BF])+/g},i=/(?![\u0902\u094D])(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])+/g,j=/(?:[!-#%-\/:-@\[-`\{-~\xA1\xA7\xA8\xAB\xAC\xAF\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u200D\u2010-\u2027\u2030-\u205E\u207A-\u207E\u208A-\u208E\u2118\u2140-\u2144\u214B\u2190-\u2194\u219A\u219B\u21A0\u21A3\u21A6\u21AE\u21CE\u21CF\u21D2\u21D4\u21F4-\u22FF\u2308-\u230B\u2320\u2321\u2329\u232A\u237C\u239B-\u23B3\u23DC-\u23E1\u25B7\u25C1\u25F8-\u25FF\u266F\u2768-\u2775\u27C0-\u27FF\u2900-\u2AFF\u2B30-\u2B44\u2B47-\u2B4C\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u309B\u309C\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBC1\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE2\uFFE3\uFFE9-\uFFEC]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDEF0\uDEF1]|\uD83C[\uDFFB-\uDFFF])/g,k=/(^|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)[\"\'\xAB\xBB\u2018-\u201F\u2039\u203A\u2E42\u300C-\u300F\u301D-\u301F\uFE41-\uFE44\uFF02\uFF07\uFF62\uFF63]((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)($|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))/g,l=/(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F])+/g,m=/(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BF\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)+/g;function n(a){return a.replace(k,function(a,b,c,d,e){return" "+c+d+" "+c+" "+d+" "})}function o(a){return a.split(l)}function p(a){return a.replace(j,"")}function q(a){return a.replace(i,"")}function r(a){return a.normalize("NFC").replace(h.NFC_CHARACTER,function(a){return" "+a+" "})}function s(a){return a.normalize("NFC").replace(h.NFC_WORD,function(a){return" "+a+" "})}function t(a){return a.replace(m,function(a){return" "+a+" "})}a=function(){function a(){}var b=a.prototype;b.tokenize=function(a){a===void 0&&(a="");a=n(a);a=t(r(s(a)));a=o(a);a=a.map(function(a){a=a;a=p(a);if(!a.length)return a;else a.match(h.NFC_CHARACTER)?a=a.normalize("NFC"):a.match(h.NFC_WORD)?a=a.normalize("NFC"):(a=q(c("WAFtsTokenizerPreNFKDNormalizer").normalize(a).normalize("NFKD")),a=a.toLocaleLowerCase("en-US"),a=c("WAFtsTokenizerPostLowercaseNormalizer").normalize(a));return a});return new Set(a.filter(function(a){return!!a&&!!a.trim()&&!a.match(l)}))};return a}();g["default"]=a}),98);
__d("MAWFTSIsMessageValidForSearch",["MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0}function a(a){var b=a.msgContent,c=a.sortOrderMs,e=a.type;b=b==null?void 0:b.content;if(b==null||c==null)return null;if(e!==d("MAWMsgType").MSG_TYPE.TEXT&&e!==d("MAWMsgType").MSG_TYPE.XMA)return null;return h(a)?null:{content:b,sortOrderMs:c}}g.verifyMessageValidity=a}),98);
__d("MpsMessageToSearchBridge",["MpsMessageToBridgeWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.toplevelProtobuf);if(a.expiryTimestampMs!=null)return;a=(a=b.deserialize().encryptedTransportMessage())==null?void 0:(a=a.consumerMessage())==null?void 0:(a=a.payload)==null?void 0:(a=a.content)==null?void 0:(a=a.messageText)==null?void 0:a.text;return a==null?null:{chatJid:b.getChatJid(),externalId:b.getExternalId(),msg:{content:a,sender:b.message.senderId,ts:b.getUnixTs()},sortOrderMs:b.message.timestampMs}}g.messageToSearchBridge=a}),98);
__d("MAWDbGroupInviteTxns",["MAWDexieTable","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.groupInvites.put(b).then(function(){return b})}function b(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]])["delete"]()}function h(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).equals([b,c]).first()}function c(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]]).toArray()}function e(a,b){return b.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE?b.invitedParticipantUserJid==null?d("MAWDexieTable").dexieResolve():h(a,b.threadJid,b.invitedParticipantUserJid):d("MAWDexieTable").dexieResolve()}g.putGroupInvite=a;g.deleteGroupInvitesByThreadAndInvitedParticipant=b;g.maybeGetGroupInvite=h;g.getGroupInvitesByThreadAndInvitedParticipant=c;g.getAndCheckGroupInviteFromMsg=e}),98);
__d("MAWRemoveGroupInvitesApi",["MAWDbGroupInviteTxns","MAWIndexedDb","MAWTransactionMode","WALogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeGroupInvites deleted "," record(s) from "," for ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE},"removeGroupInvites",function(a){return function(b,e){return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,e).then(function(a){d("WALogger").DEV(h(),a,b,e),c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:{threadJid:b}})}).then(function(){c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"GroupInviteLoaded",value:{actorId:e,threadJid:b}})})}});g.removeGroupInvites=a}),98);
__d("MAWLoadGroupInvitesTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDexieTable","MAWIndexedDb","MAWUserJidWrapper","WAJids","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[],f=d("MAWUserJidWrapper").getMyUserJid();b.forEach(function(b){return d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(){e.push(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant(a,b.jid,f))},user:c("emptyFunction")})});return d("MAWDexieTable").dexieAll(e).then(function(a){a.forEach(function(a,b){a.forEach(function(b,a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(b)})})})})}g.loadGroupInvites=a}),98);
__d("MAWDbPollTxns",["MAWIndexedDb","MAWTransactionMode","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";e=d("MAWIndexedDb").makeMsgrTransactor({poll:d("MAWTransactionMode").READONLY},"handleIncomingMessagesStanzas",function(a){return function(b,c){return a.poll.get([b,d("WAStanzaUtils").toStanzaId(c)])}});function a(a,b){return a.poll.put(b).then(function(){return b})}function b(a,b,c){return a.poll.get([b,d("WAStanzaUtils").toStanzaId(c)])}function c(a,b,c){return a.messages.where(["threadJid","pollStanzaId","sortOrderMs"]).between([c,b,Number.MIN_SAFE_INTEGER],[c,b,Number.MAX_SAFE_INTEGER],!1,!1).reverse().first()}g.getDbPoll=e;g.updatePoll=a;g.getPoll=b;g.maybeGetLatestPollUpdateMsg=c}),98);
__d("MAWMessagesCompare",["MAWMessagesDirection"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return function(b,c){if(c.sortOrderMs==null||b.sortOrderMs==null)return 0;if(b.sortOrderMs===c.sortOrderMs){var d,e;d=(d=b.externalId)!=null?d:"";e=(e=c.externalId)!=null?e:"";if(a!=null){d=a.has(d);e=a.has(e);if(d&&!e)return-1;else if(!d&&e)return 1}return((d=c.externalId)!=null?d:"").localeCompare((e=b.externalId)!=null?e:"")}return c.sortOrderMs-b.sortOrderMs}}var i=h(),j=function(a,b){return-1*h()(a,b)};function a(a){return d("MAWMessagesDirection").switchOnMWPMessagesDirection(a,{asc:j,desc:i})}g.makeCompareMessageMetadataForDescOrderFn=h;g.getSortComparisonFunctionForDirection=a}),98);
__d("MessagesRangesV2ExternalIds",[],(function(a,b,c,d,e,f){"use strict";a="";b="9999999999999999";f.MIN_EXTERNAL_ID=a;f.MAX_EXTERNAL_ID=b}),66);
__d("MAWLoadMessagesRequest",["FBLogger","MAWMessagesCompare","MAWMessagesDirection","MessagesRangesV2ExternalIds","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e){if(a.length===0)return[];e=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(d("MAWMessagesDirection").translateMawDirectionToMwpDirection(e));a=[].concat(a).sort(e);if(b.lowerBoundExternalId!=null&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){e=a.findIndex(function(a){return a.externalId===b.lowerBoundExternalId});e!==-1?a=a.slice(e):c("FBLogger")("messenger_web").mustfix("Get messages for range: no external id in source msgs list")}a=i(a,b);return a.slice(0,b.numMsgs)}function a(a,b,c,e){a=a.filter(function(a){var c;return((c=a.sortOrderMs)!=null?c:Number.MAX_SAFE_INTEGER)>=b.gte[0]&&((c=a.sortOrderMs)!=null?c:Number.MIN_SAFE_INTEGER)<=b.lte[0]});var f=d("MAWMessagesDirection").switchOnMAWMessagesDirection(c,{after:[b.gte,b.lte],before:[b.lte,b.gte]}),g=f[0],i=g[0];g=g[1];f=f[1];f[0];var j=f[1];f=h(a,{includeLowerBoundMsg:!0,lowerBoundExternalId:d("WAStanzaUtils").toStanzaId(g),lowerBoundSortOrderMs:i,numMsgs:e},c);if(j!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&j!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){a=f.findIndex(function(a){return a.externalId===j});if(a!==-1)return f.slice(0,a)}return f}function i(a,b){if(b.includeLowerBoundMsg||a.length===0)return a;return a[0].externalId===b.lowerBoundExternalId||a[0].sortOrderMs===b.lowerBoundSortOrderMs?a.slice(1):a}g.getMsgsForRange=h;g.getMsgsForBounds=a}),98);
__d("MAWLoadMsgsDedupper",["MAWDbMsgUtil","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=new Set();return function(b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);if(b==null)return!0;b=d("WAMsg").craftWAMsgIdString(b);if(b!=null){if(a.has(b))return!1;a.add(b)}return!0}}g["default"]=a}),98);
__d("MAWLoadMsgsUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=0,e=0,f=!1,g=null;return function(h){e++;if(g!=null&&g===h.sortOrderMs)return!1;if(e>b&&h.sortOrderMs!==a)return!0;h.msgId===c&&(f=!0);f&&d++;if(d>b)return!0;g=h.sortOrderMs;return!1}}function b(a){var b=!0,c=0,d=null;return function(e){if(d===null)c++;else if(d===e.sortOrderMs){c+=b?0:1;return!1}else c++,b=!1;if(c>a)return!0;d=e.sortOrderMs;return!1}}f.makeUntilWithRangeExtension=a;f.makeUntilWithRangeExtensionBothDirections=b}),66);
__d("MAWLoadMsgsTxnsV2",["FBLogger","I64","MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeReceiverFetchInfo","MAWBridgeTypesCreators","MAWBridgeXMA","MAWCurrentUser","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbPollTxns","MAWDbReactionsTxns","MAWDbReceiverFetchTxns","MAWDbXMATxns","MAWDexieTable","MAWGetIsMediaDownloadStatusEnabled","MAWHandleXmaTransactionUtil","MAWLoadMessagesRequest","MAWLoadMsgsDedupper","MAWLoadMsgsUtil","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaUtils","MAWMessagesDirection","MAWODSProxy","MAWRavenUtils","MAWXMAUtils","WAMsgType","WAOdsEnums","WATagsLogger","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMsgsByExternalId: From: externalId:",". ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, chatJid: ",", result: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs: From:"," orignalMsgId:",", chatJid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, chatJid: ",", range: ",".}"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);m=function(){return a};return a}function n(a,b,d,e,f,g){switch(d){case"before":return h();case"after":return i().then(function(a){return a.reverse()})}function h(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,0],[b,e],!0,!0).reverse().filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}function i(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,e],[b,Number.MAX_SAFE_INTEGER],!0,!0).filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}}function o(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){return a.map(function(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;return c==null?{reaction:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:f,reactToMsgId:e}),type:"delete"}:{reaction:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a}),type:"upsert"}}).filter(Boolean)})}function p(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){return q(a,c.threadJid,e).then(function(f){var g=f.map(function(a){return a.msgId}),h=d("MAWMediaUtils").createHdTypesForBridgeMedia(f);g=c.ravenEphemeralType!=null&&c.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(c.ravenEphemeralType,c.ravenEphemeralMediaState),sortOrderMs:c.sortOrderMs}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,sortOrderMs:c.sortOrderMs});return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,g,f)})})}))})}function q(a,b,c){return a.messages.where("msgId").anyOf(c.msgIds).toArray().then(function(a){return a.filter(function(a){return a.threadJid===b})})}function r(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return d("MAWDexieTable").dexieResolve(null);if(d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabledWithChunkVerification()){var c=[b.defaultPreviewMediaId,b.faviconMediaId,b.headerMediaId].filter(Boolean);return d("MAWDbMediaTxns").maybeBulkGetMediaFromMediaId(a,c).then(function(c){if(c.size===0)return d("MAWBridgeXMA").createBridgeXMA(null,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1});var e=b.defaultPreviewMediaId!=null?c.get(b.defaultPreviewMediaId):null,f=b.headerMediaId!=null?c.get(b.headerMediaId):null;c=b.faviconMediaId!=null?c.get(b.faviconMediaId):null;return d("MAWHandleXmaTransactionUtil").verifyAllMediaChunksForXMA(e,c,f,a).then(function(a){var c=a.hasMedia,f=a.hasXmaFaviconMedia;a=a.hasXmaHeaderMedia;return d("MAWBridgeXMA").createBridgeXMA(e,b,{hasMedia:c,hasXmaFaviconMedia:f,hasXmaHeaderMedia:a})})})}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1}):d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c==null?void 0:c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:a,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})})})}))}).then(function(a){return a.filter(Boolean)})}function s(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return b.receiverFetchId==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbReceiverFetchTxns").maybeGetReceiverFetchInfoFromReceiverFetchId(a,b.receiverFetchId).then(function(a){return a==null?d("MAWDexieTable").dexieResolve(null):d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(b,a)})})).then(function(a){return a.filter(Boolean)})}function t(a,b){var e=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){if(b.type!==d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE&&b.type!==d("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE)return null;var f=b.type===d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE?b.externalId:b.pollStanzaId;if(f==null){c("FBLogger")("GroupPollsE2EE").mustfix("pollStanzaId is null for poll msg in MLV2");return null}var g=e.get(f);if(g!=null){if(g.externalId===b.externalId){return u(a,b.threadJid,f,g.msgId,d("WATimeUtils").castToMillisTime((g=g==null?void 0:g.sortOrderMs)!=null?g:0))}return null}return d("MAWDbPollTxns").maybeGetLatestPollUpdateMsg(a,f,b.threadJid).then(function(c){if(c==null){var g;return u(a,b.threadJid,f,b.msgId,d("WATimeUtils").castToMillisTime((g=b.sortOrderMs)!=null?g:0))}e.set(f,c);if(c.externalId===b.externalId){return u(a,b.threadJid,f,c.msgId,d("WATimeUtils").castToMillisTime((g=c==null?void 0:c.sortOrderMs)!=null?g:0))}else return null})})).then(function(a){return a.filter(Boolean)})["finally"](function(){e.clear()})}function u(a,b,e,f,g){return a.poll.get([b,e]).then(function(a){if(a==null){c("FBLogger")("GroupPollsE2EE").mustfix("Poll is null in MLV2");return null}return{contactIdForCurrentUser:(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),dbPoll:a,latestUpdateMsgId:f,latestUpdateTimestampMs:g}})}function v(a,b,c,e,f,g,h){h===void 0&&(h=function(){return!0});var i=d("WATimeUtils").unixTime(),j=function(a){return a.messageExpirationTs==null||a.messageExpirationTs>i};c=d("MAWLoadMsgsUtil").makeUntilWithRangeExtension(f,c,g);return n(a,b,e,f,function(a){return h(a)&&j(a)},c).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:b,replyMediaInfo:a}})})}function w(a,b){return a.messages.where("externalId").equals(b).toArray()}function x(a,b){return w(a,b).then(function(e){e.length>1&&c("FBLogger")("messenger_web_pinned_messages").warn("duplicate MAW msg returned for externalId",b);return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:e,replyMediaInfo:a}})})}function y(a){a=a.filter(function(a){return a.ephemeralCounterStarted});if(a.length>0){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).LOG(m(),a.map(function(a){return a.msgId}));return d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a).msgs}return[]}function z(a,b){return a!=null?a:d("MAWMessagesDirection").switchOnMAWMessagesDirection(b,{after:Number.MIN_SAFE_INTEGER,before:Number.MAX_SAFE_INTEGER})}function a(a){var b=a.chatJid,c=a.config,e=a.db,f=a.direction,g=a.range,h=d("WATimeUtils").unixTime();a=function(a){var b=a.messageExpirationTs!=null&&a.messageExpirationTs<h,e=a.type===d("WAMsgType").MSG_TYPE.ADMIN&&!c.admin;a=a.isCollapsed===!0;return!b&&!e&&!a};var i=g.includeLowerBoundMsg?g.numMsgs:g.numMsgs+1;i=d("MAWLoadMsgsUtil").makeUntilWithRangeExtensionBothDirections(i);var j=z(g.lowerBoundSortOrderMs,f);return n(e,b,f,j,a,i).then(function(a){var b=d("MAWLoadMessagesRequest").getMsgsForRange(a,g,f);return d("MAWDexieTable").dexieAll(b.map(function(a){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(e,a)})).then(function(a){return{msgsForRange:b,replyMediaInfo:a}})}).then(function(a){var h=a.msgsForRange;a=a.replyMediaInfo;d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]).LOG(l(),b,g);return A(e,h,a,f,g.numMsgs,c,b)})}function b(a,b,c,e,f,g,h,i){var j=z(f,e);return v(a,b,c,e,j,h,function(a){var b=a.isCollapsed===!0;a=!i.admin&&a.type===d("WAMsgType").MSG_TYPE.ADMIN;return!(b||a)}).then(function(f){var l=f.msgs;f=f.replyMediaInfo;var m=l;g||(m=m.filter(function(a){return a.msgId!==h}),m.length===l.length&&l.length!==0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.LOAD_MORE_NO_ORIGINAL_MSG_IN_MAW,key:"mismatch"}));d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]).LOG(k(),j,h,b);return A(a,m,f,e,c,i,b)})}function A(a,b,c,e,f,g,h){var i=b.length;if(i===0)return d("MAWDexieTable").dexieResolve({editMsgHistory:[],expiringCountdown:[],hasMoreAfter:C(i,f,e),hasMoreBefore:B(i,f,e),medias:[],msgs:[],polls:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]});var k=b.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(c||[])[b])}).filter(Boolean),l=y(b);d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]).LOG(j(),h,k.map(function(a){return a.msgId+":"+a.sortOrderMs}));return d("MAWDexieTable").dexieAll([g.reactions?o(a,b):d("MAWDexieTable").dexieResolve([]),g.media?p(a,b):d("MAWDexieTable").dexieResolve([]),g.xma?r(a,b):d("MAWDexieTable").dexieResolve([]),g.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,b):d("MAWDexieTable").dexieResolve([]),g.receiverFetch?s(a,b):d("MAWDexieTable").dexieResolve([]),g.polls?t(a,b):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1],d=a[2],g=a[3],h=a[4];a=a[5];return{editMsgHistory:g,expiringCountdown:l,hasMoreAfter:C(i,f,e),hasMoreBefore:B(i,f,e),medias:c,msgs:k,polls:a,reactions:b,receiverFetchInfoPayloads:h,xmas:d}})}function B(a,b,c){switch(c){case"before":return a>=b;default:c;return!0}}function C(a,b,c){switch(c){case"after":return a>=b;default:c;return!0}}function e(a,b,c){return x(a,b).then(function(e){var f=e.msgs,g=e.replyMediaInfo;if(f.length===0)return{editMsgHistory:[],medias:[],msgs:[],polls:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]};var h=f.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(g||[])[b])}).filter(Boolean);d("WATagsLogger").TAGS(["MAWFetchMessageByPinnedExternalId"]).LOG(i(),b,h.map(function(a){return""+a.msgId}));return d("MAWDexieTable").dexieAll([c.reactions?o(a,f):d("MAWDexieTable").dexieResolve([]),c.media?p(a,f):d("MAWDexieTable").dexieResolve([]),c.xma?r(a,f):d("MAWDexieTable").dexieResolve([]),c.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,f):d("MAWDexieTable").dexieResolve([]),c.receiverFetch?s(a,f):d("MAWDexieTable").dexieResolve([]),c.polls?t(a,f):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4];a=a[5];return{editMsgHistory:e,medias:c,msgs:h,polls:a,reactions:b,receiverFetchInfoPayloads:f,xmas:d}})})}g.loadMoreMsgsAndMediaForRange=a;g.loadMoreMsgsAndMediaFromTs=b;g.loadMsgsAndMediaByExternalId=e}),98);
__d("MAWLoadMsgsTxns",["MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeTypesCreators","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWLoadMsgsTxnsV2","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaAfterTxns","MAWXMAUtils","WATagsLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);h=function(){return a};return a}function i(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){d("MAWMediaAfterTxns").handleNewMediaAfterTxn(c,e,b,a)})}))})}function j(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(a,b,c)})}))})}function k(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){a.forEach(function(a){return d("MAWDbReactionUtils").dispatchReaction(a)});return a})}function a(a,b,e,f,g){f===void 0&&(f=!1);g===void 0&&(g="before");return!c("gkx")("14304")?l(a,b,null,e,f,g).then(function(a){return{hasMoreAfter:a.hasMoreAfter,hasMoreBefore:a.hasMoreBefore}}):d("MAWLoadMsgsTxnsV2").loadMoreMsgsAndMediaFromTs(a,b,e,g,null,f,null,{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0}).then(function(a){var b=a.editMsgHistory,c=a.expiringCountdown,e=a.hasMoreAfter,f=a.hasMoreBefore,g=a.medias,h=a.msgs,i=a.reactions,j=a.receiverFetchInfoPayloads;a=a.xmas;h.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:h}});c.length>0&&d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:{msgs:c}});i.filter(function(a){return a.type==="upsert"}).forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"UpsertReaction",value:a.reaction})});i.filter(function(a){return a.type==="delete"}).forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:a.reaction})});a.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:a})});b.length>0&&d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:b});g.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMedias",value:g});j.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:a})});return{hasMoreAfter:e,hasMoreBefore:f}})}function l(a,b,c,e,f,g,l){f===void 0&&(f=!1);l===void 0&&(l=null);return d("MAWDbMsgTxns").getMsgsFromOffset(a,b,c,e,f,!1,g,l).then(function(b){var c=b.msgs,e=babelHelpers.objectWithoutPropertiesLoose(b,["msgs"]);return d("MAWDexieTable").dexieAll(c.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return babelHelpers["extends"]({msgs:c,replyMediaInfo:a},e)})}).then(function(e){var l=e.hasMoreAfter,m=e.hasMoreBefore,n=e.msgs,o=e.replyMediaInfo;e=n.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(o||[])[b])}).filter(Boolean);e.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:e}});e=n.filter(function(a){return a.ephemeralCounterStarted});e.length>0&&(d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).LOG(h(),e.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(e)}));(n.length>0||c==null)&&d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypesCreators").createBridgeMsgsLoadedInfo(b,n,f,m,l,g)});return d("MAWDexieTable").dexieAll([k(a,n),d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,n),i(a,n),j(a,n)]).then(function(a){a=a[0];return{hasMoreAfter:l,hasMoreBefore:m,msgs:n,reactions:a}})})}g.loadMsgAndMedia_COMPAT=a;g.loadMsgsAndMediaFromOffset_DO_NOT_USE=l}),98);
__d("MAWLoadOneToOneMessageRequestCapabilitiesTxn",["MAWDexieTable","MAWIndexedDb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a.map(d("WAJids").interpretAsUserJid).forEach(function(a){return a!=null&&d("MAWIndexedDb").afterTransaction({tag:"OneToOneMessageRequestLoaded",value:{fbid:d("WAJids").extractUserId(a),threadJid:a}})});return d("MAWDexieTable").dexieResolve()}g.loadOneToOneMessageRequestCapabilities=a}),98);
__d("MAWLoadThreadsTxns",["FBLogger","I64","MAWBridgeParticipants","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbParticipantTxns","MAWDexieTable","MAWIndexedDb","MAWLoadGroupInvitesTxns","MAWLoadMsgsTxns","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWMpsGating","MAWThreadMappingQPL","MAWThreadSnippetUtils","MAWTransactionMode","MAWUserJidWrapper","WAJids","WALogger","emptyFunction","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e,f){f===void 0&&(f="unknown");b.forEach(function(a){var b=d("MAWThreadMappingQPL").getInstanceKeyForJidInWorker(a.jid);d("MAWThreadMappingQPL").startInWorker({instanceKey:b,jid:a.jid,threadKey:a.optimisticThreadKey==null?void 0:(h||(h=d("I64"))).of_string(a.optimisticThreadKey),trigger:"loadContentsForThreads_"+f});d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,e==null?void 0:e.get(a.jid),void 0,"loadContentsForThreads_"+f,null,b)})});return d("MAWMpsGating").isFullMpsEnabled()?d("MAWDexieTable").dexieResolve(b):d("MAWDexieTable").dexieAll([].concat(b.map(function(b){return j(a,b,c)}),[i(a,b),k(a,b),d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities(b.map(function(a){return a.jid})),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])).then(function(){return b})}function b(a,b,c,e,f){f===void 0&&(f=!1);return d("MAWDexieTable").dexieAll([i(a,[c]),j(a,c,e),d("MAWThreadSnippetUtils").updateThreadInfoToUIOnPageLoad(a,c,f)]).then(function(e){e=e[0];b||m(a,c.jid,d("WAJids").interpretAsGroupJid(c.jid)!=null,!1,c.cannotReplyReason,c.archived);return e})}function e(a,b,c,e){e===void 0&&(e=!1);return d("MAWDexieTable").dexieAll([i(a,[c]),d("MAWThreadSnippetUtils").updateThreadInfoToUIOnPageLoad(a,c,e)]).then(function(e){e=e[0];b||m(a,c.jid,d("WAJids").interpretAsGroupJid(c.jid)!=null,!1,c.cannotReplyReason,c.archived);return e})}function i(a,b){return b.length===0?d("MAWDexieTable").dexieResolve([]):d("MAWDbParticipantTxns").getParticipantsInThreads(a,b.map(function(a){return a.jid})).then(function(a){c("gkx")("13628")||d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)});return a})}function j(a,b,c){return d("MAWLoadMsgsTxns").loadMsgAndMedia_COMPAT(a,b.jid,c,!0)}function k(a,b){var e=[];b.forEach(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return e.push(a)},user:c("emptyFunction")})});return a.groupInfo.bulkGet(e).then(function(a){a.forEach(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}f=function(a){a=a.threadJid;return l(a)};var l=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"checkIfGroupParticipant",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return m.apply(void 0,[a].concat(c))}});function m(a,b,e,f,g,h){e===void 0&&(e=!0);f===void 0&&(f=!0);var i=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbParticipantTxns").getParticipant(a,b,i).then(function(a){if(!a.success){var j=e?"group":"one_to_one";d("WALogger").LOG(["[Occamadillo] User is not a participant of "+j+" thread\n        "+b.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);if(g==null){var k;c("FBLogger")("maw_db","checkIfParticipant").catching((k=a.payload)!=null?k:c("err")(a.error)).warn("[Occamadillo] User %s is not a participant of %s thread %s, occam: %s, archived: %s, cannotReplyReason null.",i,j,b.toString(),f,h)}c("FBLogger")("labyrinth_web","checkIfParticipant").warn("[Occamadillo] User not a participant from checkIfParticipant");k={cannotReplyReason:"viewer_not_subscribed",threadJid:b};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(k)})}})}g.loadContentsForThreads=a;g.loadParticipantsAndMsgs=b;g.loadParticipantsAndThreadInfo=e;g.loadParticipants=i;g.loadGroups=k;g.checkIfGroupParticipant=f}),98);
__d("MAWDbGroupInfoTxns",["MAWBridgeTypesCreators","MAWIndexedDb","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b.jid).then(function(c){var d=b.participantVersion;c.success&&c.value.participantVersion!=null&&b.participantVersion==null&&(d=c.value.participantVersion);c=b.subject.content;c!=null&&c.length===0&&(c=void 0);var e={creationTs:b.creationTs,creator:b.creator,groupJid:b.jid,inviter:b.inviter,memberAddMode:b.memberAddMode,name:c,nameOwner:b.subject.user,nameTs:b.subject.ts,participantVersion:d};return i(a,e).then(function(){return e})})}function h(a,b){return a.groupInfo.get({groupJid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function i(a,b){return a.groupInfo.put(b).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(b)})})}function b(a,b){return a.groupInfo.bulkPut(b).then(function(){b.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}function c(a,b){return a.groupInfo.bulkGet(b)}function e(a,b){return a.groupInfo["delete"](b)}g.putGroupInfo=a;g.getGroupInfo=h;g.updateGroupInfo=i;g.bulkUpdateGroupInfo=b;g.getGroupInfos=c;g.deleteGroupInfo=e}),98);
__d("MAWGroupInviteManagementTxns",["MAWDbGroupInviteTxns","MAWDbParticipantTxns","MAWDexieTable","MAWUserJidWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=!1;return d("MAWDbParticipantTxns").getInvitedParticipantsInThread(a,b).then(function(e){if(e.length===0){c=!0;var f=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,f).then(function(){return c})}else{var g=[];e.forEach(function(c){g.push(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,c.userJid))});return d("MAWDexieTable").dexieAll(g).then(function(){return c})}})}g.deleteGroupInvitesByThread=a}),98);
__d("MAWThreadManagementTxns",["FBLogger","MAWBridgeEventTransmitter","MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbGroupInfoTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWGetOrCreateThreadTxns","MAWGroupInviteManagementTxns","MAWIndexedDb","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWQplProxy","MAWUserJidWrapper","WAJids","WALogger","WAMsgType","WASortedLists","WATimeUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted "," media rows and "," chunk rows"]);h=function(){return a};return a}function a(a,b,e,f){var g=b.authoritativeThreadKey,h=b.createTs,i=b.description,j=b.folder,k=b.lastActivityTimestamp,l=b.lastReadWatermarkTimestamp,n=b.offlineThreadingId,o=b.skipVerifyThread,p=b.userJid;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:g,clientThreadKey:n,createTs:h,description:i,folder:j,instanceKey:f,jid:p,lastActivityTimestamp:k,lastReadWatermarkTimestamp:l,skipVerifyThread:o},e).then(function(b){var g=b.created;b=b.thread;e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-start",{instanceKey:e});f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"process_setup_thread_start",{instanceKey:f});g=m(a,p,g,b);e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-end",{instanceKey:e});f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"process_setup_thread_end",{instanceKey:f});return g})}function b(a,b,c,e){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){if(!b.success)return null;var f=b.value;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:d("WATimeUtils").castUnixTimeToMillisTime(f.creationTs),description:"getOrRepairGroupThread",folder:c,jid:f.groupJid,skipVerifyThread:e}).then(function(a){var b=a.created;a=a.thread;return{created:b,groupInfo:f,thread:a}})})}function i(a,b){var c=[],e=[];b.forEach(function(a){d("MAWDbMsg").isMediaMsg(a)&&a.mediaId!=null&&(c.push(a.mediaId),e.push(a.msgId))});return a.media.bulkGet(c).then(function(b){var c=[],f=[];b.forEach(function(a,b){if(a!=null){var g=e[b];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.plaintextHash!=null&&c.push(a.hashedPlaintextHash),f.push(a.mediaId))}});b=a.media.bulkDelete(f);var g=a.chunk.where("hashedPlaintextHash").anyOf(c)["delete"]();return d("MAWDexieTable").dexieAll([b,g]).then(function(){d("WALogger").LOG(h(),f.length,c.length)})})}function j(a,b){return d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b).then(function(c){return a.messages.where("threadJid").equals(b.jid).toArray().then(function(d){return k(a,b,c,d,!0)})})}function e(a,b,c,e){var f=c==null?void 0:c.lastMessageTimestamp;if(c==null)return j(a,b);var g=a.messages.where("threadJid").equals(b.jid).toArray(),h=d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b);return d("MAWDexieTable").dexieAll([g,h]).then(function(g){var h=g[0];g=g[1];var i=[],j=new Set();f!=null&&h.forEach(function(a){var b;b=(b=a.originalTs)!=null?b:a.ts;b<=f+1&&(j.add(a.msgId),i.push(a))});if((c==null?void 0:c.messages.length)!==0){var l=new Set();c.messages.forEach(function(a){l.add((a=a.key)==null?void 0:a.id)});h.forEach(function(a){l.has(a.externalId)&&!j.has(a.msgId)&&(j.add(a.msgId),i.push(a))})}if(i.length!==h.length)for(var m of h)if(!j.has(m.msgId)&&m.type!==d("WAMsgType").ADMIN)return k(a,b,g,i,!1,e);return k(a,b,g,h,!0,e)})}function k(a,b,c,e,f,g){var h=d("WAJids").interpretAsGroupJid(b.jid),j=f?d("MAWDbThreadTxns").deleteThreadRow(a,b.jid):d("MAWDexieTable").dexieResolve(),k=f?d("MAWDbParticipantTxns").deleteAllParticipantsForThread(a,b.jid):d("MAWDexieTable").dexieResolve(),l=d("MAWDexieTable").dexieResolve(!1),m=d("MAWDexieTable").dexieResolve();h!=null&&f&&(l=d("MAWGroupInviteManagementTxns").deleteGroupInvitesByThread(a,h),m=d("MAWDbGroupInfoTxns").deleteGroupInfo(a,h));return d("MAWDexieTable").dexieAll([i(a,e),d("MAWDbReactionsTxns").deleteAllReactionsForMessages(a,e),d("MAWDbMsgTxns").deleteMessages(a,e,g),j,k,m,l]).then(function(a){a[0];a[1];a[2];a[3];a[4];a[5];a=a[6];f?(d("MAWBridgeEventTransmitter").deleteMessagesOfThreadAfterTxn(b,c),h!=null&&a&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:d("MAWBridgeTypesCreators").createBridgeDeleteGroupInvite(b.jid)}),d("MAWIndexedDb").afterTransaction({tag:"ThreadHiddenV2",value:b.jid})):d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.jid,e)});return{deletedMessages:e.map(function(a){return d("MAWDbMsg").getWAMsgId(a)})}})}function l(a,b){var c=d("WAJids").interpretAsUserJid(b);if(c==null)return d("MAWDexieTable").dexieResolve([]);c=[{type:"participant",userJid:c}];var e=d("MAWUserJidWrapper").getMyUserJid();e!==b&&c.push({type:"participant",userJid:e});return d("MAWDbParticipantTxns").bulkUpsertParticipantsInThread(a,b,c)}function m(a,b,e,f){b=d("WAJids").interpretAsUserJid(b);if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Non-user jids are not supported");b=l(a,f.jid).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})});return d("MAWDexieTable").dexieAll([d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities([f.jid]),b]).then(function(){return{created:e,thread:f}})}g.getOrSetupOneToOneThread=a;g.getGroupThread=b;g.deleteAllThreadData=j;g.metaSyncChatDeleteThread=e;g.upsertParticipantsInOneToOneChat=l;g.processSetupThreadResponse=m}),98);
__d("MAWGroupInfoStore",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadThreadsTxns","MAWThreadManagementTxns","MAWTransactionMode","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null&&typeof a==="object"&&a.groupStatus!=null&&typeof a.groupStatus==="string"?a.groupStatus:void 0}function i(a){return a!=null&&typeof a==="object"&&a.clientThreadKey!=null&&typeof a.clientThreadKey==="string"?a.clientThreadKey:void 0}function j(a){return a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number"?a.folder:void 0}function k(a){return a!=null&&typeof a==="object"&&a.updateParticipantMedatadata!=null&&typeof a.updateParticipantMedatadata==="boolean"?a.updateParticipantMedatadata:void 0}function l(a){return a===null?{}:a}a=function(){function a(a){var b=this;this.get=function(a,c){c=j(c);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadManagementTxns").getGroupThread(b.db,a,c).then(function(a){return a!=null?a:null}).then(function(a){return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWLoadThreadsTxns").loadContentsForThreads(b.db,[a.thread],1,null,"getGroupInfoStore").then(function(){return a.groupInfo}).then(function(a){return d("WAResultOrError").makeResult(m(a))})}))};this.create=function(a,c){var e=h(c)==="added"?d("WATimeUtils").millisTime():d("WATimeUtils").castUnixTimeToMillisTime(a.creationTs);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetOrCreateThreadTxns").getOrCreateThread(b.db,{clientThreadKey:i(c),createTs:e,description:"MAWGroupInfoStore-create",folder:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:a.jid}).then(function(c){var e=c.created,f=c.thread,g=n(a);return d("MAWDexieTable").dexieAll([b.db.groupInfo.put(g),d("MAWDbMsgTxns").getThreadNewestMessageId(b.db,f.jid)]).then(function(a){a[0],a[1],d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)})}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(b.db,[f.jid]):d("MAWDexieTable").dexieResolve()}).then(function(){return e?d("WAResultOrError").makeResult(g.groupJid):d("WAResultOrError").makeError("existing")})}))};this["delete"]=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([b.db.threads.get({jid:a}),b.db.groupInfo["delete"](a)]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").deleteThreadRow(b.db,a.jid),b.db.participants.where("threadJid").equals(a.jid)["delete"]()]).then(function(){return d("WAResultOrError").makeResult()})}))};this.update=function(a,c,e){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(f){return f==null?d("WAResultOrError").makeError("missing_group"):b.db.groupInfo.get(a).then(function(a){if(a==null)return d("WAResultOrError").makeError("missing_group");a=m(a);a=c(a);var g=n(a);return b.db.groupInfo.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});k(e)===!0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(f.jid)});return d("WAResultOrError").makeResult()})})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.groupInfo.clear())};this.db=a}var b=a.prototype;b.has=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.groupInfo.get(a).then(function(a){return a!=null?!0:!1}))};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,editMsgHistory:b.READONLY,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,poll:b.READONLY,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};function m(a){return babelHelpers["extends"]({jid:a.groupJid},l(a.creator!=null?{creator:a.creator}:null),{creationTs:a.creationTs},l(a.participantVersion!=null?{participantVersion:a.participantVersion}:null),{inviter:a.inviter,memberAddMode:a.memberAddMode,subject:babelHelpers["extends"]({content:a.name},l(a.nameOwner!=null?{user:a.nameOwner}:null),l(a.nameTs!=null?{ts:a.nameTs}:null))})}function n(a){var b=a.subject.content;b!=null&&b.length===0&&(b=void 0);return{creationTs:a.creationTs,creator:a.creator,groupJid:a.jid,inviter:a.inviter,memberAddMode:a.memberAddMode,name:b,nameOwner:a.subject.user,nameTs:a.subject.ts,participantVersion:a.participantVersion}}g.MAWGroupInfoStore=a}),98);
__d("MAWThreadFetchAndEmitTxns",["MAWDexieTable","MAWLoadGroupInvitesTxns","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWLoadThreadsTxns","MAWThreadManagementTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f="fetchAndEmitThread");return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getGroupThread(a,b,c).then(function(a){return a==null?null:{created:a.created,thread:a.thread}})},user:function(b){var g;return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{createTs:e==null?void 0:d("WATimeUtils").castUnixTimeToMillisTime(e),description:f,folder:(g=c)!=null?g:void 0,userJid:b})}}).then(function(b){return b==null||b.thread==null?null:d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b.thread],1,null,f).then(function(){return b})})}function b(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();b=Array.from(b);return a.threads.where("jid").anyOf(b).toArray().then(function(b){b=b.filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWLoadThreadsTxns").loadParticipants(a,b),d("MAWLoadThreadsTxns").loadGroups(a,b),d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities(b.map(function(a){return a.jid})),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])}).then(c("emptyFunction"))}g.fetchAndEmitThread=a;g.emitThreadContents=b}),98);
__d("MAWMessageStore",["MAWAckLevel","MAWAuthor","MAWBridgeMsg","MAWDbMsgTxns","MAWDbThread","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MAWLocalizationUtils","MAWMsgType","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteMsgTxns","WAJids","WALogger","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);h=function(){return a};return a}function i(a){if(a!=null&&typeof a==="object"&&a.optimisticMsg!=null){a=a.optimisticMsg;if(typeof a.msgId==="string"&&typeof a.ts==="number")return{msgId:a.msgId,ts:a.ts}}return void 0}function j(a){return a!=null&&typeof a==="object"&&a.openMessageOtid!=null&&typeof a.openMessageOtid==="string"?a.openMessageOtid:void 0}function k(a){if(a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number")if(a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX)return d("MAWFolderTypes").FOLDER_ID.INBOX;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.PENDING)return d("MAWFolderTypes").FOLDER_ID.PENDING;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.OTHER)return d("MAWFolderTypes").FOLDER_ID.OTHER;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.ARCHIVED)return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;return null}a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a,b){var e=this,f=i(b),g=j(b);b=k(b);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(this.db,a.id.chat,b,void 0,"MAWMessageStore_DEPRECATED-create").then(function(b){if(b==null)return d("WAResultOrError").makeError({type:"missing_thread"});b=b.thread;if(a.type===d("MAWMsgType").MSG_TYPE.TEXT){var h=void 0;a.ephemeralSetting!=null&&(h={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});h={ack:a.ack,altIndex:void 0,author:a.id.author,ephemeralSetting:h,externalId:a.id.externalId,forwardingScore:a.forwardingScore,isForwarded:a.forwardingScore>0,msgContent:{content:((h=a.msgContent)==null?void 0:h.content)||""},serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.TEXT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,"MAWMessageStore::create",{openMessageOtid:g,optimisticMsg:f}).then(function(){return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ICDC_ALERT){h={ack:a.ack,altIndex:void 0,author:a.id.author,externalId:a.id.externalId,msgContent:{adminType:a.msgContent.adminType,authorName:a.msgContent.authorName},serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,"MAWMessageStore::create",{openMessageOtid:g,optimisticMsg:f}).then(function(){a.hasUnknownName&&!d("WAJids").isAuthorMe(a.id.author)&&!d("WAJids").isAuthorSystem(a.id.author)&&d("MAWIndexedDb").afterTransaction({tag:"SyncContacts",value:[d("WAJids").userIdFromJid(a.id.author)]});return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ADMIN){h={ack:a.ack,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:a.id.externalId,msgContent:babelHelpers["extends"]({},a.msgContent,{version:d("MAWLocalizationUtils").isAdminMsgNormalized(a.msgContent.adminType)?1:0}),serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:a.type};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,"MAWMessageStore::create").then(function(){return d("WAResultOrError").makeResult()})}throw c("err")("non renderable store not implemented yet")}))};b.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.chat}),this.db.messages.where("externalId").equals(a.externalId).toArray()]).then(function(b){var c,e=b[0];b=b[1];if(e==null)return d("MAWDexieTable").dexieResolve(null);b=b.find(function(b){return b.threadJid===e.jid&&b.author===a.author});return b==null||b.type!=="Text"?d("MAWDexieTable").dexieResolve(null):d("MAWDexieTable").dexieResolve({ack:b.ack,forwardingScore:(c=b.forwardingScore)!=null?c:0,id:a,msgContent:{content:b.msgContent.content},ts:b.ts,type:b.type})}))};b.update=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.id.chat}),this.db.messages.where("externalId").equals(a.id.externalId).toArray()]).then(function(c){var e=c[0];c=c[1];if(e==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));var f=c.find(function(b){return b.threadJid===e.jid&&b.author===a.id.author});if(f==null||f.type!=="Text")return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));c=f.ack<d("MAWAckLevel").ACK.sent;f.ack=a.ack;f.ts=a.ts;f.serverTs=a.sentTs;var g=void 0;a.ephemeralSetting!=null&&(g={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});f.ephemeralSetting=g;g=a.sentTs;g=g==null?g:d("WATimeUtils").castUnixTimeToMillisTime(g);c=g!=null&&c?b.db.threads.put(babelHelpers["extends"]({},e,{newestMsgTs:g,threadOrder:d("MAWDbThread").craftThreadOrder(g,e.jid)})):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b.db.messages.put(f),c]).then(function(){var a=null;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,a)});return d("WAResultOrError").makeResult()})}))};b.deleteReactionsForMsg=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.reactions.where("reactToExternalId").equals(a.externalId).filter(function(b){return d("MAWAuthor").getAuthorUserJid(b.reactToAuthor)===d("MAWAuthor").getAuthorUserJid(a.author)&&b.threadJid===a.chat}).toArray().then(function(a){return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))}))};b.bulkDelete=function(a){var b=this,c=d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.author,e=a.chat;a=a.externalId;var f=d("MAWAuthor").getAuthorUserJid(c);return b.db.reactions.where("reactToExternalId").equals(a).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===f&&a.threadJid===e}).toArray()})).then(function(a){return a.flat()}).then(function(a){d("WALogger").LOG(h(),a.length);return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))});return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbMsgTxns").getMsgsByProtocolMsgId(this.db,a).then(function(a){var e=a.map(function(a){return a.rowId});return d("MAWDexieTable").dexieAll([b.db.messages.bulkDelete(e),c]).then(function(){return e.length})}))};b.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.messages.where("threadJid").equals(a).toArray()).then(function(b){return b==null||b.length===0?[]:b.map(function(b){return{author:b.author,chat:a,externalId:b.externalId}})})};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:b.READWRITE,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,poll:b.READONLY,reactions:b.READWRITE,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};g.MAWMessageStore_DEPRECATED_DO_NOT_USE=a}),98);
__d("WAResultOrErrorUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[];a.forEach(function(a){a.success&&b.push(a.value)});return b}function b(a){var b=[];a.forEach(function(a){a.success||b.push(a.error)});return b}f.unpackValues=a;f.unpackErrors=b}),66);
__d("MAWParticipantsStore",["MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAArrayGroupBy","WAArrayZip","WAGlobals","WAResultOrError","WAResultOrErrorUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(a){return a!=null?d("MAWDbParticipantTxns").getParticipantsInThread(b.db,a.jid).then(function(b){return d("WAResultOrError").makeResult(b.map(function(b){return h(b,a.jid)}))}):d("WAResultOrError").makeError("missing_group")}))};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,a.map(function(a){a=a.chatJid;return a})).then(function(b){return d("WAResultOrErrorUtils").unpackValues(a.map(function(a){return!b.has(a.chatJid)?d("WAResultOrError").makeError():d("WAResultOrError").makeResult({participantId:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),waParticipant:a})}))}).then(function(a){return b.db.participants.bulkGet(a.map(function(a){a=a.participantId;return a})).then(function(b){return d("WAArrayZip").zip(a,b).map(function(a){var b=a[0].waParticipant;a=a[1];return{chatJid:b.chatJid,dbParticipantToPut:babelHelpers["extends"]({deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)},a,i(b)),existed:a!=null,participant:b}})})}).then(function(a){var c=a.map(function(a){a=a.dbParticipantToPut;return babelHelpers["extends"]({},a)});c.forEach(function(a){return d("MAWDbParticipantTxns").logIfIllegalParticipant(a,"MAWParticipantsStore::bulkPut")});return b.db.participants.bulkPut(c).then(function(){return l(b.db,a)})}))};this.bulkDelete=function(a,c){c=c||{};var e=c.remover,f=d("WAArrayGroupBy").groupBy(a.map(function(a,b){return{index:b,key:a}}),function(a){a=a.key;return a.groupJid});c=f.map(function(a){a=a[0];return a});return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,c).then(function(a){return f.flatMap(function(b){var c=b[0];b=b[1];return b.map(function(b){var e=b.index;b=b.key;return!a.has(c)?d("WAResultOrError").makeError({index:e,message:"missing_group"}):d("WAResultOrError").makeResult({groupJid:c,index:e,participantId:d("MAWDbParticipant").craftParticipantId(c,b.userJid),participantKey:[c,b.userJid],userJid:b.userJid})})})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),e=d("WAResultOrErrorUtils").unpackErrors(a).map(function(a){return d("WAResultOrError").makeError(a)});a=c.map(function(a){a=a.participantId;return a});return b.db.participants.bulkGet(a).then(function(a){return d("WAArrayZip").zip(c,a).map(function(a){var b=a[0];a=a[1];return a==null?d("WAResultOrError").makeError({index:b.index,message:"missing_participant"}):d("WAResultOrError").makeResult(b)}).concat(e)})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),f=c.map(function(a){a=a.participantKey;return a}),g=c.map(function(a){var b=a.groupJid;a=a.userJid;return{groupJid:b,userJid:a}});return d("MAWDbParticipantTxns").bulkDeleteParticipants(b.db,f).then(function(){return m(b.db,g,e)}).then(function(){return a})}).then(function(a){return a.map(function(a){return a.success?{index:a.value.index,result:d("WAResultOrError").makeResult()}:{index:a.error.index,result:d("WAResultOrError").makeError(a.error.message)}}).sort(function(a,b){a=a.index;b=b.index;return a-b}).map(function(a){a=a.result;return a})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.participants.clear())};this.db=a};a.tableLocks={participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE};function h(a,b){var c=a.addressable!=null?{addressable:a.addressable}:null;return babelHelpers["extends"]({chatJid:b,type:a.type,user:a.userJid},c)}function i(a){return{addressable:a.addressable,id:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),threadJid:a.chatJid,type:a.type,userJid:a.user}}function j(a){return a.map(function(a){return a.user}).filter(function(a){return a===d("WAGlobals").getMyUserJid()||a==="@me"}).length>0}function k(a,b){a=a.threads;return a.where("jid").anyOf(b).toArray().then(function(a){return new Set(a.map(function(a){a=a.jid;return a}))})}function l(a,b){var c=b.filter(function(a){a=a.existed;return!a}).map(function(a){var b=a.chatJid;a=a.participant;return{chatJid:b,participant:a}});c=d("WAArrayGroupBy").groupBy(c,function(a){a=a.chatJid;return a}).map(function(a){var b=a[0];a=a[1];return[b,a.map(function(a){a=a.participant;return a})]});b.forEach(function(a){a=a.dbParticipantToPut;d("MAWIndexedDb").afterTransaction({tag:"ParticipantUpdated",value:d("MAWBridgeParticipants").createBridgeParticipant(a)})});b=c.filter(function(a){a[0];a=a[1];return j(a)}).map(function(a){a=a[0];return a});return d("MAWDbThreadTxns").subscribeToThreads(a,b)}function m(a,b,c){b=Array.from(b);b.forEach(function(a){a=a.groupJid;return d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(a)})});var e=new Set(b.filter(function(a){return a.userJid===d("WAGlobals").getMyUserJid()&&(c===d("WAGlobals").getMyUserJid()||c==="@me")}).map(function(a){return a.groupJid}));b=new Set(b.filter(function(a){a=a.userJid;return a!==c&&(a===d("WAGlobals").getMyUserJid()||a==="@me")}).filter(function(a){a=a.groupJid;return!e.has(a)}).map(function(a){a=a.groupJid;return a}));return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").archiveThreads(a,Array.from(e),!0),d("MAWDbThreadTxns").unsubscribeFromThreads(a,Array.from(b))])}g.MAWParticipantsStore=a}),98);
__d("MAWRunInTransaction",["MAWDexie","MAWGroupInfoStore","MAWIndexedDb","MAWMessageStore","MAWParticipantsStore","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h={GroupInfoStore:d("MAWGroupInfoStore").MAWGroupInfoStore.tableLocks,MessagesStore:d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE.tableLocks,ParticipantsStore:d("MAWParticipantsStore").MAWParticipantsStore.tableLocks};a=function(a,b,e){var f=[];for(var g in a)a[g]===!0&&f.push(g);g=f.flatMap(function(a){return Object.entries(h[a])}).reduce(function(a,b){var c=b[0];b=b[1];if(a[c]===d("MAWTransactionMode").READWRITE)return a;c=c;return babelHelpers["extends"]({},a,(a={},a[""+c]=b,a))},{});g=d("MAWIndexedDb").makeMsgrTransactor(g,(f=e)!=null?f:"runInTransaction",function(e){return function(){var f={CollectionVersionStore:null,GroupInfoStore:a.GroupInfoStore===!0?new(d("MAWGroupInfoStore").MAWGroupInfoStore)(e):null,MessagesStore:a.MessagesStore===!0?new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(e):null,MissingKeyStore:null,ParticipantsStore:a.ParticipantsStore===!0?new(d("MAWParticipantsStore").MAWParticipantsStore)(e):null,PendingMutationStore:null,SyncActionStore:null,SyncKeyStore:null};return new(c("MAWDexie").Promise)(function(a){a(b(f))})}});return g()};g.runInTransaction=a}),98);
__d("MAWAddGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"addGroupParticipants")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h,i){h=a.GroupInfoStore;var j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield h.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});yield a.bulkPut(k);if(b!=null){f=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,k.map(function(a){return a.user}),e,i);yield j.create(f);yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h,i){return a.apply(this,arguments)}}();g.addGroupParticipants=a;g.addGroupParticipantsTransactor=h}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWQplProxy","MAWTransactionMode","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b,e,f){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_msg_and_reaction_fetch_start",{instanceKey:f.qplInstanceKey});return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var g=b[0];b=b[1];f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_msg_and_reaction_fetch_end",{instanceKey:f.qplInstanceKey});if(g!=null){var h=(e==null?void 0:e.isRetriable)===!0?d("MAWAckLevel").ACK.failedRetryable:d("MAWAckLevel").ACK.expired,i=c("gkx")("7471");f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_system_ack_start",{annotations:{"int":{ack:h}},instanceKey:f.qplInstanceKey});return d("MAWDbMsgTxns").updateSystemAck(a,g.msgId,h,void 0,void 0,i&&(e==null?void 0:e.applicationErrorCode)!=null?e==null?void 0:e.applicationErrorCode:void 0).then(function(a){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_system_ack_end",{instanceKey:f.qplInstanceKey});return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"})}if(b!=null){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_delete_reaction_start",{instanceKey:f.qplInstanceKey});return d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_delete_reaction_end",{instanceKey:f.qplInstanceKey});return"dropped"})}f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_msg_and_reaction_missing",{instanceKey:f.qplInstanceKey});return"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMessageSendScheduler",["WorkerScheduler","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=12e4,i;function a(){i==null&&(i=d("WorkerScheduler").makeScheduler("message-send",{concurrency:5,defaultSamplingRate:500,maxConcurrency:5,maxThrottleMs:500,timeToStuckMs:c("gkx")("11177")?c("justknobx")._("3814"):h}));return i}g.messageSendScheduler=a}),98);
__d("MAWMessageSendsCommon",["MAWMarkMsgDroppedApi","MAWMessageSendScheduler","MAWQplProxy","WAGetSafeQPLError","WAPromiseDelays","WAResultOrError","WATagsLogger","WATimeUtils","WAWaitForComms","WorkerScheduler","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Guard: should not happen, result is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message send fails: ",". Error text: ",""]);i=function(){return a};return a}var j=1e3,k=d("WATagsLogger").TAGS(["MessageSend"]);function l(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){d("MAWQplProxy").sendQplPointThroughBridge(a,"backend_reached",{annotations:{bool:{backendSetupReadyFromWorker:!d("WAWaitForComms").isStillWaitingForComms()}},instanceKey:b});var g;try{d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_start",{annotations:{},instanceKey:b});yield d("WAWaitForComms").waitForComms();d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_end",{annotations:{},instanceKey:b});d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_start",{annotations:{},instanceKey:b});g=(yield d("MAWMessageSendScheduler").messageSendScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){return c(d("WATimeUtils").unixTime())},name:e,priority:d("WorkerScheduler").BLOCKING_PRIORITY}));if(g.success===!0)d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_end",{instanceKey:b});else{var m;d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorType:(m=(m=g.error)==null?void 0:m.type)!=null?m:"unknown-error"}},instanceKey:b})}}catch(c){k.ERROR(i(),c,d("WAGetSafeQPLError").getSafeQPLErrorMessage(c));d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(c),errorType:"runtime-error",sendFailureError:d("WAGetSafeQPLError").getSafeQPLErrorMessage(c)}},instanceKey:b});f!=null&&(yield d("MAWMarkMsgDroppedApi").markMsgDropped(f,void 0,{qplEventType:a,qplInstanceKey:b}));throw c}if(!g){m="null-response-from-message-send";k.ERROR(h());d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{instanceKey:b});return d("WAResultOrError").makeError({applicationErrorCode:null,details:m,isRetriable:!0,type:"unexpected-message-codepath"})}if(g.success===!0)return g;g.success;f!=null&&(yield d("MAWMarkMsgDroppedApi").markMsgDropped(f,g.error,{qplEventType:a,qplInstanceKey:b}));if(((m=g.error)==null?void 0:m.type)==="retryable-error"){m=(m=g.error.backoff)!=null?m:j;yield d("WAPromiseDelays").delayMs(m);return l(a,b,c,e,f)}else return g});return m.apply(this,arguments)}g.messageSendLogger=k;g.messageSendObserver=l}),98);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWTransactionMode","MAWTransactor","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWTransactor").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE},"writeDebugMsg",function(a){return function(b,e,f){return!c("gkx")("23958")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,c),(f==null?void 0:f.decryptionError)==="errDuplicateMsg"?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f.protocolMsgId).then(function(a){if(a==null)return", no existing message";return a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?", existing ciphertext message":",  existing message"}):d("MAWDexieTable").dexieResolve(""),d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,c)]).then(function(a){var b=a[0],f=a[1],g=a[2];a=a[3];a=d("MAWDbMsg").craftDebugMsgId(c.chatId,a-1);f=d("WATimeUtils").castToMillisTime(((b=(b=b==null?void 0:b.sortOrderMs)!=null?b:f)!=null?b:0)+1);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[fb-only][DEBUG]: "+(e+g)],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.jid,d("MAWExternalId").generateExternalId());d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(babelHelpers["extends"]({},b,{msgId:a,sortOrderMs:f}))})})})}});g.writeDebugMsg=b}),98);
__d("MAWGetEditMsgForSending",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("FBLogger")("messenger_web").mustfixThrow("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isEdit:!0,isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(i(),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WAConsumerApplication.pb","WAMsgType","decodeProtobuf","getMediaTypeFromConsumerMessage"],(function(a,b,c,d,e,f,g){"use strict";({});function h(a){var b=d("MAWMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return h(a)}}function b(a){var b;a=(a=a.payload)==null?void 0:(a=a.subProtocol)==null?void 0:a.consumerMessage;if(a==null)return{isRevoked:!1,type:"text"};a=d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a.payload);if(a==null?void 0:(b=a.payload)==null?void 0:(b=b.applicationData)==null?void 0:b.revoke)return{isRevoked:!0,type:"text"};b=d("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(a);return b!=null?{mediaType:b,type:"media"}:{isRevoked:!1,type:"text"}}g.waGetMessageTypeFromMsg=h;g.getMessageTypeFromMsg=a;g.getMessageTypeFromMessageApplication=b}),98);
__d("MAWGetMsgForSendingApi",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);l=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return m(a,b).then(function(a){if(!a.success){d("WALogger").LOG(l(),b,a.error);return{type:a.error}}a=a.value;var e=a.contactsInThread,f=a.groupInvite,g=a.isReplyMsg,h=a.media,i=a.msg;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(i.type)&&!d("MAWDbMsg").isContentMsg(i)){d("WALogger").LOG(k(),b,i.type);throw c("FBLogger")("messenger_web").mustfixThrow("We do not support message sending with "+i.type+" type")}var m=d("MAWAsMessageApplication").asMessageApplication(i,h,f,a,i.threadJid),n=null;i.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&f?n={invitedParticipantUserJid:f.inviteeJid,isRevoked:!1,type:"text"}:n=d("MAWSendMsgUtil").getMessageTypeFromMsg(i.type);if(d("WAJids").isAuthorSystem(i.author))throw c("FBLogger")("messenger_web").mustfixThrow("A system message cannot be sent");d("WALogger").LOG(j(),b);return{contactsInThread:e,dbMsg:i,isReplyMsg:g,isXMAMsg:a!=null,media:h,messageApplication:m,messageType:n,protocolMsgId:{author:i.author,chat:i.threadJid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:i.externalId},type:"unsent",xmaPayload:a}})}});function m(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var j=d("MAWXMAUtils").maybeXMAMessage(e),k=g.quote!=null;return d("MAWDexieTable").dexieAll([e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),j?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null,d("MAWDbParticipantTxns").getParticipantsInThread(a,g.threadJid).then(function(a){return a.map(function(a){return a.userJid})})]).then(function(a){var b=a[0],c=a[1],e=a[2];a=a[3];if(!b.success)return b;if(e!=null&&!e.success){d("WALogger").ERROR(h(),j,g.type);return d("WAResultOrError").makeError("missing_xma")}b=b.value;return d("WAResultOrError").makeResult({contactsInThread:a,groupInvite:c,isReplyMsg:k,media:b,msg:g,xmaPayload:e!=null?e.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetNoteReplyMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWSendMsgUtil","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);h=function(){return a};return a}function i(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)]).then(function(a){a=a[0];a=a;if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}else if(a.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("WAResultOrError").makeResult({msg:a})})}b=d("MAWIndexedDb").makeMsgrTransactor({media:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getNoteReplyForSending",function(a){return function(b){return i(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asNoteReplyMessageApplication(a),e=d("MAWSendMsgUtil").getMessageTypeFromMsg(a.type);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("A system message cannot be sent");return{dbMsg:a,messageApplication:b,messageType:e,protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getNoteReplyForSending=b}),98);
__d("MAWGetReactionForSending",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").getReaction(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("FBLogger")("messenger_web").mustfixThrow("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("MAWLoadThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWLoadThreadParticipantsApi -- loadThreadParticipants -- there is no thread in db"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"loadThreadParticipants",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){d("WALogger").ERROR(h());return[]}return d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){return a.map(function(a){return a.userJid})})})}});g.loadThreadParticipants=a}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] previousEditedMsg is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"]);o=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(o());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f)]).then(function(f){var g=f[0],o=f[1],p=f[2];f=p.sort(function(a,b){return b.editTs-a.editTs});var q=p.find(function(a){return a.editExternalId===b.externalId}),r=f[1];if(o==null){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("missing_original_msg")}if(q==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_newest_edited_msg")}if(r==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_previous_edited_msg")}if(q.editExternalId!==f[0].editExternalId){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("invalid_newest_edited_msg")}if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_thread")}if(o.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("invalid_original_msg")}return a.messages.where("quoteExternalId").equals(e).toArray().then(function(e){var f,g=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent,editCount:((f=o.editCount)!=null?f:0)-1,msgContent:r.msgContent}),i=d("WAGlobals").getMyUserJid(),j=[];f=e.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===i)&&a.threadJid===b.chat});if(f!=null){e=f.quote;var k=f.quoteExternalId;if(e==null)c("FBLogger")("messenger_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",k);else{k=babelHelpers["extends"]({},f,{quote:babelHelpers["extends"]({},e,{content:babelHelpers["extends"]({},e.content,{msgContent:babelHelpers["extends"]({},g.msgContent)})})});j.push(k)}}f=[];o.editCount===1&&p.length===2&&f.push(r.editMsgHistoryId);f.push(q.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(g),a.editMsgHistory.bulkDelete(f)]).then(function(){d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)});j.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult()})})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editedMsg?.editExternalId is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsgHistory is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"]);n=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,ftsBackloggedMessages:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"markEditMsgSent",function(a){return function(b,e,f,g){var o=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(o==null){d("WALogger").ERROR(n());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,o),d("MAWFTSTxns").maybePutMessageToBacklog(a,e)]).then(function(n){var o=n[0];n=n[1];var p=n.find(function(a){return a.editExternalId===e}),q=n.find(function(a){return a.editExternalId===b.externalId});if(o==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_original_msg")}if(p==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_original_msg_edit_history")}if((q==null?void 0:q.editExternalId)==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_edit_external_id")}if(q.sendStatus!=null&&q.sendStatus>d("MAWAckLevel").ACK.clock&&o.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j());return d("WAResultOrError").makeError("already_sent")}if(q.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("not_author")}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([q.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var r=[];if(n.length===2&&o.editCount===1){n=babelHelpers["extends"]({},p,{sendStatus:d("MAWAckLevel").ACK.sent});r.push(n)}p=babelHelpers["extends"]({},q,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});r.push(p);var s=r.map(function(a){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:o.msgId})}),t=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(t.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(r),a.messages.put(t),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,t)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(t,void 0,a)});d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:s});return d("WAResultOrError").makeResult(t)})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WALogger","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);i=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(g){var j=g[0];g=g[1];if(j==null&&!g.success)return d("WAResultOrError").makeError("msg_missing_in_db");else if(j!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([j.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});g.success&&d("WALogger").ERROR(i());var k=j.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,j.msgId,d("MAWAckLevel").ACK.sent,e,f),d("MAWDbThreadTxns").getThread(a,j.threadJid)]).then(function(b){var c=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("thread_missing_in_db")}b=b.value;var f=d("WATimeUtils").castUnixTimeToMillisTime(e);f=babelHelpers["extends"]({},b,{lastReadMsgTs:f,newestMsgTs:f,threadOrder:d("MAWDbThread").craftThreadOrder(f,b.jid)});b=k?d("MAWDbThreadTxns").updateThread(a,f):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,c),b]).then(function(){return d("WAResultOrError").makeResult(c)})})}else if(g.success){var l=g.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,l.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(l.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)}).then(function(){return d("WAResultOrError").makeResult(null)})}return d("WAResultOrError").makeError("msg_missing_in_db")})}});g.markMsgSent=b}),98);
__d("MAWSendWrittenMsg",["EBAPI","FBLogger","MAWBridge","MAWDebugMsg","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetNoteReplyMsgForSendingApi","MAWGetReactionForSending","MAWJids","MAWLoadThreadParticipantsApi","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMessageSendsCommon","MAWMpsGating","MAWODSProxy","MAWSendMsgUtil","MAWUpdateThreadListItem","MpsTypes","WAAPI","WAAsMessageApplication","WABuildMpsPayload","WAFrankingTypes","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WebMps","asyncToGeneratorRuntime","encodeProtobuf","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to save message to MPS: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END "," : ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);k=function(){return a};return a}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){d("MAWMessageSendsCommon").messageSendLogger.LOG(k(),a.protocolMsgId);b.addPoint("get_msg_for_sending_start",{string:{type:a.type}});var f,g,l,m,n=null,o;if(e==null){if(a.type==="message"||a.type==="revoke"||a.type==="bump")n=(yield d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId));else if(a.type==="reaction")n=(yield d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId));else if(a.type==="edit")n=(yield d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId));else if(a.type==="noteReply")n=(yield d("MAWGetNoteReplyMsgForSendingApi").getNoteReplyForSending(a.protocolMsgId));else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(n.type!=="unsent"){d("MAWMessageSendsCommon").messageSendLogger.LOG(j(),n.type);return d("WAResultOrError").makeError({details:n.type,isRetriable:!0,type:"wrong-message-state"})}var p=n,q=p.dbMsg,r=p.isReplyMsg;p=p.isXMAMsg;o=n.protocolMsgId;f=n.messageApplication;l=n.messageType;g=q==null?void 0:q.type;m=n.editOriginalExternalId;q=(q==null?void 0:q.ephemeralSetting)!=null&&((q=(q=q.ephemeralSetting)==null?void 0:q.ephemeralExpirationInSec)!=null?q:0)>0;b.addPoint("get_msg_for_sending_end",{bool:{isEditMsg:m!=null,isEphemeralMsg:q,isReplyMsg:r,isXMAMsg:p},string:{msgType:l.type}});q&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_OLD_MESSAGE_SEND,key:"sendEphemeralMsg"},!0)}else f=e.messageApplication,l=d("MAWSendMsgUtil").getMessageTypeFromMessageApplication(f),m=null,o=a.protocolMsgId;r=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,f).readBuffer();p={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(r)),version:"v3"};b.addPoint("wa_send_msg_start");q=(yield c("WAAPI").sendChatMessage({loadThreadParticipants:d("MAWLoadThreadParticipantsApi").loadThreadParticipants,messagePayload:{backupDirective:null,frankingKey:((q=f.metadata)==null?void 0:q.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((e=f.metadata)==null?void 0:e.frankingKey)):null,frankingVersion:(a=f.metadata)==null?void 0:a.frankingVersion,messageBytes:p,messageType:l,protocolMsgId:o}},b));if(q.success===!1){b.addPoint("wa_send_msg_fail",{string:{errorType:q.error.type,msgType:g}});m!=null?yield d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(o,m):yield d("MAWMarkMsgDroppedApi").markMsgDropped(o,q.error);d("MAWMessageSendsCommon").messageSendLogger.ERROR(i(),q.error.type,(e=q.payload)!=null?e:"");switch(q.error.type){case"non-retryable-error":if(q.error.applicationErrorCode!=null&&q.error.applicationErrorCode===10009)try{d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"RefreshContact",value:d("MAWJids").convertChatJidToIntJid(o.chat)}]})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to call bridge handler RefreshContact for JID %s and mediaType %s",o.chat,g)}return q;case"missing-receipt":case"wrong-message-state":case"unexpected-message-codepath":case"result-parsing-error":case"retryable-error":case"no-recipients":case"encryption-error":case"too-many-retries":return q;default:q.error.type;throw c("err")("Unreachable code")}}q.success;b.addPoint("wa_send_msg_end");((a=q.value.meta)==null?void 0:a.pOrDhashMismatch)&&(b.addPoint("dhash_phash_mismatch"),c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(o.chat,"Outgoing msg "+o.externalId+" got a phash mismatch")));if(n!=null){b.addPoint("mark_edit_msg_sent_start");l=m!=null?yield d("MAWMarkEditMsgSentApi").markEditMsgSent(o,m,q.value.serverTs,q.value.reportingMeta):yield d("MAWMarkMsgSentApi").markMsgSent(o,q.value.serverTs,q.value.reportingMeta);b.addPoint("mark_edit_msg_sent_end");if(l.success&&l.value!=null){e=l.value;yield d("MAWUpdateThreadListItem").updateThreadListItemFromInsertion(e,e.threadJid,"outgoing_msg",m!=null)}}if(d("MAWMpsGating").isMpsEnabled())try{yield d("WebMps").mps().saveNewMessages([{directive:null,insertionSource:d("MpsTypes").InsertionSource.Send,message:d("WABuildMpsPayload").buildMpsMessage({encryptedTransportMessage:r},{externalId:o.externalId,senderJid:d("WAGlobals").getMyUserJid(),serverTs:q.value.serverTs,threadId:o.chat})}],{source:"wa-message-sent"})}catch(a){d("MAWMessageSendsCommon").messageSendLogger.ERROR(h(),a)}if(n!=null&&!d("MAWMpsGating").isFullMpsEnabled()){b.addPoint("eb_upload_scheduling_start");a=n;l=a.dbMsg;e=a.isXMAMsg;m=a.media;r=a.xmaPayload;yield c("EBAPI").uploadSentMessage({dbMsg:l,instanceKey:o.externalId,isXMAMsg:e,media:m,messageApplication:f,messageApplicationBytes:p.bytes,protocolMsgId:o,serverTs:q.value.serverTs,xmaPayload:r});b.addPoint("eb_upload_scheduling_end")}return q});return m.apply(this,arguments)}function a(a,b,c,d){b.addAnnotations({bool:{is_secure:!0},string:{description:c,jid:a.protocolMsgId.chat}});return l(a,b,d)}g.sendWrittenMsgExternal=a}),98);
__d("MAWWriteGroupInviteTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLowLevelApiTypes","MAWThreadManagementTxns","MAWUserJidWrapper","WAGroupInviteUtils","WAJids","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){return!c.success?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP:d("MAWDbGroupInviteTxns").maybeGetGroupInvite(a,b.threadJid,b.inviteeJid).then(function(c){return c&&!d("WATimeUtils").isInFuture(c.inviteExpirationTs)?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE:d("MAWDbGroupInviteTxns").putGroupInvite(a,b)})})}function b(a,b,c,e){var f=b.caption,g=b.groupJid,h=b.inviteCode;b=b.inviteExpiration;var i=d("WAJids").interpretAsUserJid(c);if(g==null||b==null||h==null||i==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args"}));c=[d("WATimeUtils").castLongIntToUnixTime(b),d("WAJids").toGroupJid(g),d("WAGroupInviteUtils").toInviteCode(h)];var j=c[0];b=c[1];var k=c[2],l={folder:e,groupJid:b,inviteCode:k,inviteExpireTs:j,inviterJid:i,type:"group_invite"};return d("MAWThreadManagementTxns").getGroupThread(a,b,e,!0).then(function(b){return b==null?d("WAResultOrError").makeError(l):d("MAWDbParticipantTxns").getParticipant(a,b.thread.jid,i)}).then(function(b){if(!b.success)return d("WAResultOrError").makeError(l);var c=d("MAWUserJidWrapper").getMyUserJid(),e=d("MAWDbParticipant").craftParticipantId(b.value.threadJid,c);return d("MAWDbGroupInviteTxns").putGroupInvite(a,{caption:f==null?void 0:f.text,inviteCode:k,invitedParticipantId:e,inviteeJid:c,inviteExpirationTs:j,inviterJid:i,threadJid:b.value.threadJid}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(a)});return d("WAResultOrError").makeResult()})})}g.writeGroupInvite=a;g.writeIncomingGroupInviteMsg=b}),98);
__d("MAWBuildNewMsgPayload",["FBLogger","MAWAdminMsgType","MAWAuthor","MAWDbMsg","MAWJids","MAWMsgType","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"]);i=function(){return a};return a}function a(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("FBLogger")("messenger_web").mustfixThrow("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}if(e.noteContent!=null){f=d("MAWJids").toUserJid(b.threadJid);g={content:{author:f,expirationTs:d("WATimeUtils").castToUnixTime(e.noteExpirationTs),externalId:b.externalId,msgContent:{content:e.noteContent},ts:b.ts,type:d("WAMsgType").NOTE_REPLY},remoteJid:void 0}}i=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});f=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},i,{msgContent:{commands:e.commands,content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},i,{hdType:e.hdType,type:d("MAWMsgType").MSG_TYPE.IMAGE},f);case"Video":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("FBLogger")("messenger_web").mustfixThrow("XMA Message Missing xmaMessageType");f=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},i,{msgContent:{commands:e.commands,content:f,mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("FBLogger")("messenger_web").mustfixThrow("EditAction is not supported yet");case"BumpExistingMessage":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE});case"ReceiverFetch":throw c("FBLogger")("messenger_web").mustfixThrow("ReceiverFetch is not supported yet");case"GroupPollCreate":return babelHelpers["extends"]({},b,{msgContent:{adminMsgContent:[(f=e.title)!=null?f:""],adminType:d("MAWAdminMsgType").CURRENT_USER_CREATED_POLL,version:1},type:d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE});case"GroupPollUpdate":throw c("FBLogger")("messenger_web").mustfixThrow("GroupPollUpdate is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("FBLogger")("messenger_web").mustfixThrow("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function b(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("FBLogger")("messenger_web").mustfixThrow("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("FBLogger")("messenger_web").mustfixThrow("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("FBLogger")("messenger_web").mustfixThrow("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("FBLogger")("messenger_web").mustfixThrow("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function e(a){var b,e={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(i());return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},e,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(h(),a.type);throw c("FBLogger")("messenger_web").mustfixThrow("Trying to reply to a message type that does not support replies")}}g.buildNewMsg=a;g.getNewUnrenderedMsg=b;g.msgToQuotedMsg=e}),98);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWBuildNewMsgPayload","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WALogger","WATimeUtils","emptyFunction","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeOutgoingMsg: "," is not identical for partial optimistic upsert: "," vs ",""]);h=function(){return a};return a}var i=function(a,b,c,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c,a,{annotations:e,instanceKey:b})};function j(a,b,c){if(b===c)return;d("WALogger").WARN(h(),a,b,c)}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,e,f,g,h,m,n){g.content!=null&&(g.content=d("MAWVault").vault(g.content));i("write_outgoing_msg_start",n,m);return d("MAWDexieTable").dexieAll([a.threads.get({jid:e}),a.messages.where("externalId").equals(b).toArray(),k(a,g.quote,e),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,g.ravenProtocolMsgId,h)]).then(function(e){var k=e[0],o=e[1],p=e[2];e=e[3];i("write_outgoing_msg_data_fetched",n,m,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(h)}});if(k==null)return{type:"missing_thread"};var q=o.find(function(a){return a.threadJid===k.jid&&a.author===d("WAJids").AUTHOR_ME});if(q!=null&&q.ack!==d("MAWAckLevel").ACK.partialOptimistic)return q.ack>=d("MAWAckLevel").ACK.sent?{msgId:q.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:q.externalId},type:"already_sent"}:{msgId:q.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:q.externalId},type:"not_sent"};else{var r=q==null?void 0:q.rowId;q&&(j("ts",q.ts,f),j("threadJid",q.threadJid,k.jid));if(!d("MAWDbMsg").isUnrenderedMsgType(h)){o={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:g.ephemeralSetting,externalId:b,isForwarded:g.isForwarded,specialTextSize:g.specialTextSize,threadJid:k.jid,ts:f};var s=d("MAWBuildNewMsgPayload").buildNewMsg(h,o,g,p),t=g.isFirstMsg,u=g.openMessageOtid,v=g.openMessageParticipantCount,w=g.optimisticMsg,x=g.participantCount;o=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,s).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,s,k,"MAWWriteOutgoingMsgApi",{isCurrentDeviceSendingMsg:!0,isFirstMsg:t,isOutgoing:!0,openMessageOtid:u,openMessageParticipantCount:v,optimisticMsg:w,participantCount:x,quotedReplyAttachmentMeta:b,s2sInstanceKey:n,upsertRowData:r!=null?{msgId:c("nullthrows")(q==null?void 0:q.msgId),rowId:r}:void 0})})}else{p={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:k.jid,ts:f};p=d("MAWBuildNewMsgPayload").getNewUnrenderedMsg(h,p,g,e==null?void 0:e.externalId);o=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,p,k)}return o.then(function(c){i("write_outgoing_msg_promise_resolved",n,m);return l(a,h,k.jid,f).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:b},type:"not_sent"}})})}})}});function k(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=d("MAWBuildNewMsgPayload").msgToQuotedMsg(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function l(a,b,e,f){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:f};return a.ephemeralSettings.put(b)}).then(c("emptyFunction"))}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(c("emptyFunction"))})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b;g.getQuoteInfo=k}),98);
__d("MAWWriteMetaSyncsTxns",["MAWDbDeletedMessages","MAWDbPendingStanza","MAWDbPendingStanzaTxns","MAWDbThreadTxns","MAWDexieTable","MAWFTSTxns","MAWThreadManagementTxns","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWWriteMetaSyncsTxns] Thread delete stanza was processed before thread insertion ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received chatDelete: ",""]);i=function(){return a};return a}var j=30*d("WATimeUtils").DAY_SECONDS;function a(a,b){d("WALogger").LOG(i(),b);var c=b.messageRange;c=c!=null?d("MAWDbPendingStanzaTxns").putPendingStanza(a,{content:{metaSyncMessageRange:c},type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD},j,b.chatJid,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.chatJid),c,d("MAWFTSTxns").maybePutThreadToPurgeBacklog(a,b.chatJid)]).then(function(c){c=c[0];if(c.success)return d("MAWThreadManagementTxns").metaSyncChatDeleteThread(a,c.value,b.messageRange,d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.cast(b.type));else{d("WALogger").LOG(h(),b.chatJid);return{deletedMessages:[]}}})}g.PENDING_DELETE_THREAD_EXPIRATION_IN_SEC=j;g.handleChatDelete=a}),98);
__d("WADeleteReceiptsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"deleteReceipts",function(a){return function(b){return h(a,b)}});g.deleteAllReceiptsForWAMsgIds=h;g.deleteReceipts=a}),98);
__d("MAWHandleMetaSyncAction",["MAWIndexedDb","MAWTransactionMode","MAWWriteDeleteMessageTxns","MAWWriteMetaSyncsTxns","Promise","WAAssertUnreachable","WADeleteReceiptsApi","WALogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received action: ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(a of a.actions)a.chatAction?yield k(a.chatAction):a.messageAction&&(yield n(a.messageAction))});return j.apply(this,arguments)}function k(a){d("WALogger").LOG(i(),a);switch(a.type){case"chat_archive":return l(a);case"chat_delete":return o(a).then(function(a){a=a.deletedMessages;return d("WADeleteReceiptsApi").deleteReceipts(a)});default:a.type;return m(a)}}function l(a){return(h||(h=b("Promise"))).resolve()}function m(a){return(h||(h=b("Promise"))).resolve()}function n(a){switch(a.type){case"delete_for_me":return p(a).then(c("emptyFunction"));default:return c("WAAssertUnreachable")(a.type)}}var o=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,deletedMessages:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeThreadBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"handleChatDeleteTxn",function(a){return function(b){return d("MAWWriteMetaSyncsTxns").handleChatDelete(a,b)}}),p=d("MAWIndexedDb").makeMsgrTransactor({chunk:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"handleDeleteForMeTxn",function(a){return function(b){return d("MAWWriteDeleteMessageTxns").handleDeleteForMe(a,b)}});g.handleMetaSyncActions=a}),98);
__d("MAWChangeGroupParticipantAdminStatusApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupParticipantAdminStatus")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield i.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:g,user:a.user}});yield a.bulkPut(k);if(b!=null){yield i.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})});for(f=0;f<k.length;f++)g==="admin"?a=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,k[f].user,e,h):a=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,k[f].user,e,h),yield j.create(a)}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.changeGroupParticipantAdminStatus=a;g.changeGroupParticipantAdminStatusTransactor=h}),98);
__d("MAWGetMsgIdByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getMsgIdByProtocolMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b.success)return d("WAResultOrError").makeResult(b.value.msgId);else if(c!=null)return d("WAResultOrError").makeResult(c.reactionId);else if(a.success&&a.value.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("WAResultOrError").makeResult(a.value.msgId);var e="missing_msg_in_db";b=b.error;a=a.error;if(b==="missing_msg"&&c==null&&a==="missing_unrendered_msg")e="missing_all_db_msg";else if(b==="missing_thread_msg"&&a==="missing_thread_unrendered_msg")e="missing_all_thread";else if(b==="missing_thread_msg"||a==="missing_thread_unrendered_msg"){e=b+"__"+((c=a)!=null?c:"unrenderedMsgResultNoError")}return d("WAResultOrError").makeError(e)})}});g.getMsgIdByProtocolMsgId=b}),98);
__d("MAWMediaManagerUiIntegrationCheck",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return(a=c("qex")._("4221"))!=null?a:!1}g.getIsMediaManagerUiIntegrationEnabled=a}),98);
__d("WAIsDownloadMediaErrorRetryable",[],(function(a,b,c,d,e,f){"use strict";a=function(a){switch(a){case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"invalid-webp":case"invalid-mp4":return!1;case"create-payload-failed":case"resign-cdn-url-request-error":case"resign-cdn-url-runtime-error":case"direct-path-undefined":case"direct-path-corrupted":case"direct-path-empty":case"missing-media-entry":case"missing-media-entry-for-restore":case"missing-sort-order-ms-for-restore":case"signature-expired":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"no-host":case"backoff":case"body-network-error":case"disconnected":case"runtime-error":case"access-expired":case"http-fetch-exception":case"unspecified-http-error":case"server-timeout":case"preview-not-supported":return!0;default:a;return!0}};f.isDownloadMediaErrorRetryable=a}),66);
__d("MAWDownloadAndHandleMedia",["MAWAckLevel","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbMsgTxns","MAWEBSwitch","MAWGetMostRescentDecodedMediaEntry","MAWGetMsgByProtocolIdApi","MAWGetMsgIdByProtocolMsgId","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleMediaDownloadApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWHandleMediaPreviewDownloadAsFailedApi","MAWIndexedDb","MAWIsMsgDeletedWithReason","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManager","MAWMediaManagerUiIntegrationCheck","MAWQplProxy","MAWShadowTestMediaStorage","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWVideoAudioValidationUtils","Promise","Random","WAAPI","WAErrorMessage","WAHashUtils","WAIsDownloadMediaErrorRetryable","WAIsMediaExpiredError","WAIsMp4","WAIsWebP","WAJids","WAJobOrchestratorTypes","WAMediaCrypto","WAMediaManager","WAMediaUtils","WAPrewarmMediaValidate","WAResultOrError","WAStartMediaDownloadQplFlow","WATagsLogger","WAValidateMedia","asyncToGeneratorRuntime","cr:10071","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["media validation audioStreamReport: ",", videoStreamReport: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["media validation was skipped: ",", setup_failed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate media: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate for msg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for msg ",", error: "," "]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["fail to resign cdn url. ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url sproc start. ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql error: ",". ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql success. ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql failed: ",". ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql start. ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["media key expired, resign cdn url for msgId: ",". isEBDownloadEnforced: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to prewarm media validate: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Failed to get DecodedMediaEntry - reason: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Missing msgId in Db - reason: "," msgType: ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["DownloadAndHandleMedia: "," hash with "," msgId, entry ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["start legacy downloadAndHandleMedia"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persist media runtime-error: ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["fullsize download runtime-error: ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["start Media Manager downloadAndHandleMedia. msgType: ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media preview: ",""]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["preview not supported"]);E=function(){return a};return a}var F=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]),G=0;a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndHandleMedia",function(a){var b=a.hash,c=a.msgType,e=a.protocolMsgId;a=a.qplEntryPoint;var f=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:a,msgType:c,protocolMsgId:e,triggerUIView:null});return H({downloadEntry:a,hash:b,mediaDownloadFlow:f,msgType:c,protocolMsgId:e})}).end();function H(a){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.downloadEntry,d=a.downloadType;d=d===void 0?"fullsizeAndPreview":d;var e=a.hash,f=a.mediaDownloadFlow,g=a.msgType;a=a.protocolMsgId;S(e,"download_and_handle_media");if(c("gkx")("5850")){yield J({downloadEntry:b,downloadType:d,hash:e,mediaDownloadFlow:f,msgType:g,protocolMsgId:a});return}return O({hash:e,mediaDownloadFlow:f,msgType:g,protocolMsgId:a})});return I.apply(this,arguments)}function J(a){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.downloadEntry,c=a.downloadType,e=a.hash,f=a.mediaDownloadFlow,g=a.msgType;a=a.protocolMsgId;F.DEV(C(),g);f.addAnnotations({string:{msgType:g}});g={fullSizePlaintextHash:e,mediaDownloadFlow:f,priority:Z(b)};if(c==="preview"&&d("MAWMediaManagerUiIntegrationCheck").getIsMediaManagerUiIntegrationEnabled()){b=d("MAWMediaManager").getMawMediaManager().enqueueDownloadPreview(g);return L({hash:e,previewPromise:b,protocolMsgId:a})}if(c==="fullsize"&&d("MAWMediaManagerUiIntegrationCheck").getIsMediaManagerUiIntegrationEnabled()){b=d("MAWMediaManager").getMawMediaManager().enqueueDownloadFullSize(g);return M({fullsizePromise:b,hash:e,mediaDownloadFlow:f,protocolMsgId:a})}c=(yield d("MAWMediaManager").getMawMediaManager().enqueueDownloadFullSizeAndPreview(g));b=c.fullsizePromise;g=c.previewPromise;void L({hash:e,previewPromise:g,protocolMsgId:a});return M({fullsizePromise:b,hash:e,mediaDownloadFlow:f,protocolMsgId:a})});return K.apply(this,arguments)}function L(a){var c=a.hash,e=a.previewPromise,f=a.protocolMsgId;return d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload(c).then(function(){return e}).then(function(a){if(a.success===!1){if(a.error==="preview-not-supported"){F.DEV(E());return}return(h||(h=b("Promise"))).reject(a.error)}else{var e=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(a.value.serverMediaType);return e==null?(h||(h=b("Promise"))).reject("unsupported preview media type "+a.value.serverMediaType):d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload(c,a.value.validatedResult.validatedPlaintext,e,f)}})["catch"](function(a){F.LOG(D(),a);return d("MAWHandleMediaPreviewDownloadAsFailedApi").handleMediaPreviewDownloadFailed(c,a.toString()).then(function(){return(h||(h=b("Promise"))).reject(a)})})}function M(a){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=a.fullsizePromise,f=a.hash,g=a.mediaDownloadFlow;a=a.protocolMsgId;e=(yield e["catch"](function(a){F.ERROR(B(),a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}));if(e.success===!1){F.LOG(A(),a);g.endFail(e.error,{string:{failReason:e.payload==null?e.error:d("WAErrorMessage").maybeGetMessageFromError(e.payload)}});U(f,e.error);return}b=(b=e.value.validatedResult.mimeType)!=null?b:e.value.unvalidatedMimeType;g.addPoint("handle_media_download_start");var h=window.performance.now();b=(yield d("MAWHandleMediaDownloadApi").handleMediaDownload(f,b,e.value.validatedResult.validatedPlaintext,a,e.value.validatedResult)["catch"](function(a){F.ERROR(z(),a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}));a=window.performance.now();c("gkx")("14317")&&X({filePlaintext:e.value.validatedResult.validatedPlaintext,idbReadLatency:a-h});b.success||(g.endFail("handle_media_download_fail",{string:{failReason:b.payload==null?b.error:d("WAErrorMessage").maybeGetMessageFromError(b.payload)}}),V(f,b.error));g.addPoint("handle_media_download_end");g.endSuccess();T(f,e.value.validatedResult)});return N.apply(this,arguments)}function O(a){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.hash,f=a.mediaDownloadFlow,g=a.msgType,h=a.protocolMsgId;F.LOG(y());F.LOG(x(),d("WAHashUtils").sanitisePlaintextHash(e),h,f.downloadEntry);f.addPoint("maw_pre_download_start");a=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(h));if(!a.success){var z=(yield d("MAWIsMsgDeletedWithReason").isMsgDeletedWithReason(h));if(z){f.addPoint("media_deleted");f.endSuccess();W(e,"media_deleted");return}f.addPoint("maw_pre_download_fail");f.endFail(a.error,{string:{failReason:a.error}});F.ERROR(w(),a.error,g);W(e,a.error);return}var A=a.value;z=(yield d("MAWGetMostRescentDecodedMediaEntry").getMostRecentDecodedMediaEntry(e));if(!z.success){f.addPoint("maw_pre_download_fail");f.endFail(z.error,{string:{failReason:z.error}});F.ERROR(v(),z.error);yield Q(A);W(e,z.error);return}g=z.value;try{d("WAPrewarmMediaValidate").prewarmMediaValidate(g.serverMediaType)}catch(a){F.ERROR(u(),a)}f.addPoint("maw_pre_download_end");a=c("MAWEBSwitch").isEnabled()&&c("gkx")("23960");a&&f.addPoint("forcing_eb_download");z=function(){G++;f.addAnnotations({"int":{fileCount:G}});return d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload.apply(void 0,arguments)["finally"](function(){G--})};z=a?d("WAResultOrError").makeError("signature-expired"):yield c("WAAPI").downloadMedia({downloadMediaMetric:f,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:z,handleMediaPreviewDownloadFailed:d("MAWHandleMediaPreviewDownloadAsFailedApi").handleMediaPreviewDownloadFailed,hash:e,mediaEntry:g,protocolMsgId:h,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg});f.addPoint("maw_post_download_start");if(z.success===!1){var B=g.objectId;g=g.serverMediaType;var C=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(g);c("MAWEBSwitch").isEnabled()&&d("WAIsMediaExpiredError").isMediaExpiredError(z.error)&&B!=null&&C!=null?(F.LOG(t(),A,a),void d("MAWGetMsgByProtocolIdApi").getMsgsByProtocolMsgIdsTxn([h]).then(function(a){a=a[0]||{};a=a.sortOrderMs;if(a==null){f.addPoint("resign_cdn_url_missing_sort_order");return}var c=d("WAMediaUtils").stringToDeliveryObjectId(B),g=f.getFlowDetails().instanceKey.toString(),i={string:{externalId:h.externalId,mediaType:C,objectId:c,restoreEntry:"downloadAndHandleMedia",restoreMethod:b("cr:10071")==null?"sproc":"gql"}};f.addPoint("resign_cdn_url_start",i);var j="hash: "+d("WAHashUtils").sanitisePlaintextHash(e)+". msgId: "+A+". traceId: "+g;if(b("cr:10071")!==null)F.LOG(s(),j),f.addPoint("resign_cdn_url_gql_start"),void b("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:h.chat,deliveryObjectId:c,externalId:h.externalId,mediaType:C,sortOrderMs:a}).then(function(a){if(a.success===!1){a.error==="direct-path-undefined"?V(e,a.error):W(e,a.error);F.LOG(r(),a.error,j);f.endFail(a.error,{string:{failReason:a.error}});return}F.LOG(q(),j);f.addPoint("resign_cdn_url_gql_success");a=d("MAWJobDefinitions").createStartJobInfo("downloadAndRestoreMedia",{deliveryObjectId:c,mediaDownloadFlow:f,msgId:A,plaintextHash:e,restorationCdnUrl:a.value,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},traceId:f.getFlowDetails().instanceKey});f.addPoint("download_and_restore_media_fire");return d("MAWJobManager").getJobManager().fireAndForget(a)})["catch"](function(a){V(e,"resign_gql_"+a),F.ERROR(p(),a,j),f.endFail("runtime-error",{string:{failReason:a.toString()}})});else{F.LOG(o(),j);f.addPoint("resign_cdn_url_sproc_start");i={attachmentObjectId:c,mediaType:C,messageId:h.externalId,messageTimeStamp:a,msgId:A,plaintextHash:e,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,threadId:d("WAJids").threadIdForChatJid(h.chat),threadJid:h.chat};void d("MAWHandleEchoMediaMsgsRestoreV2").invokeRestoreAccessCheckSprocToDownloadAttachment(h.externalId,i,f)}})["catch"](function(a){V(e,"resign_sproc_"+a),F.ERROR(n(),a),f.endFail("resign_cdn_url_fail",{string:{failReason:a.toString()}})})):(d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:z.error,hash:e,status:d("MAWMediaDownloadStatusForUI").getStatusFromWAAPIDownloadMediaError(z.error),type:"main"}),f.endFail("maw_post_download_fail",{string:{failReason:z.error}}),F.EXPECTED_ERROR(m(),A,z.error),yield Q(A));return}z.success;g=z.value;a=g.mimeType;z=g.plaintext;g=d("WAIsWebP").isWebP(new Uint8Array(z))||d("WAIsMp4").isMp4(new Uint8Array(z));var D=null;if(g){D=(yield d("WAValidateMedia").validateMedia(z,f));if(D.success===!1){f.endFail(D.error,{string:{failReason:D.error}});F.LOG(l(),A);F.ERROR(k(),D.error);yield Q(A);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:D.error,hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main",validationResult:{audioAvgBitsPerSecond:null,audioNumberOfChannels:null,audioSamplingRate:null,audioStreamType:null,validatedMimeType:D.error,videoAvgBitsPerSecond:null,videoCalculatedFps:null,videoDuration:null,videoHeight:null,videoNominalFps:null,videoStreamType:null,videoWidth:null}});return}g=D.value;var E=g.audioStreamReport,H=g.mimeType,I=g.skipValidation;g.validatedPlaintext;var J=g.validationSetupFailed;g=g.videoStreamReport;F.LOG(j(),I,J);F.DEV(i(),E,g);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"media_validation_success",hash:e,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main",validationResult:d("MAWVideoAudioValidationUtils").normalizeValidationResult({audioAvgBitsPerSecond:E==null?void 0:E.avgBitsPerSecond,audioNumberOfChannels:E==null?void 0:E.numberOfChannels,audioSamplingRate:E==null?void 0:E.samplingRate,audioStreamType:E==null?void 0:E.streamType,validatedMimeType:H,videoAvgBitsPerSecond:g==null?void 0:g.avgBitsPerSecond,videoCalculatedFps:g==null?void 0:g.calculatedFps,videoDuration:g==null?void 0:g.duration,videoHeight:g==null?void 0:g.videoHeight,videoNominalFps:g==null?void 0:g.nominalFps,videoStreamType:g==null?void 0:g.streamType,videoWidth:g==null?void 0:g.videoWidth})})}I=z;f.addPoint("handle_media_download_start");E=(yield d("MAWHandleMediaDownloadApi").handleMediaDownload(e,a,I,h,(J=D)==null?void 0:J.value));if(E.success){f.addPoint("handle_media_download_end");T(e,(H=D)==null?void 0:H.value)}else f.addPoint("maw_post_download_fail"),f.endFail("handle_media_download_fail_"+E.error,{string:{failReason:E.error}}),V(e,E.error);f.addPoint("maw_post_download_end");f.endSuccess()});return P.apply(this,arguments)}function Q(a){return R.apply(this,arguments)}function R(){R=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c("gkx")("4219")&&c("justknobx")._("2092"))return;yield d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,receiverFetchInfo:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY},"downloadMedia",function(a){return function(b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c)}})(a,d("MAWAckLevel").ACK.failed)});return R.apply(this,arguments)}function S(a,b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:b,hash:a,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"})}function T(a,b){b=(b=b)!=null?b:{};var e=b.audioStreamReport,f=b.mimeType;b=b.videoStreamReport;d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_media_download_end",hash:a,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main",validationResult:d("MAWVideoAudioValidationUtils").normalizeValidationResult({audioAvgBitsPerSecond:e==null?void 0:e.avgBitsPerSecond,audioNumberOfChannels:e==null?void 0:e.numberOfChannels,audioSamplingRate:e==null?void 0:e.samplingRate,audioStreamType:e==null?void 0:e.streamType,validatedMimeType:f,videoAvgBitsPerSecond:b==null?void 0:b.avgBitsPerSecond,videoCalculatedFps:b==null?void 0:b.calculatedFps,videoDuration:b==null?void 0:b.duration,videoHeight:b==null?void 0:b.videoHeight,videoNominalFps:b==null?void 0:b.nominalFps,videoStreamType:b==null?void 0:b.streamType,videoWidth:b==null?void 0:b.videoWidth})})}function U(a,b){d("WAIsDownloadMediaErrorRetryable").isDownloadMediaErrorRetryable(b)?V(a,b):W(a,b)}function V(a,b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:b,hash:a,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"})}function W(a,b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:b,hash:a,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"})}function X(a){var b=a.filePlaintext;a=a.idbReadLatency;var e=d("Random").random()<Y()/100;if(!e)return;e=d("Random").uint32();e=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521472095,"2859"),{"int":{input_file_size:b.byteLength},string:{storage_type:"idb"}},{providedInstanceKey:e});e.addAnnotations({"double":{read_latency:a}});e.endSuccess();void d("MAWShadowTestMediaStorage").runMediaStorageShadowTesting(b)}function Y(){return c("gkx")("2067")?100:c("justknobx")._("4271")}function Z(a){switch(a){case"UILayout":case"DYIMediaManager":return d("WAMediaManager").MediaTaskPriority.HIGH;case"MebWAMediaDownloader":case"InstamadilloAddMessageMediaContent":case"MAWDyiDownloadMedia":case"WAIncomingMsg":return d("WAMediaManager").MediaTaskPriority.MEDIUM;case"MAWHandleFutureproofMsg":case"handleEchoMediaMsgsRestore":case"SyncMedia":case"EBRestore":return d("WAMediaManager").MediaTaskPriority.LOW}}g.downloadAndHandleMedia=a;g.downloadAndHandleMediaImpl=H;g.sendUIStatusDownloading=S;g.sendUIStatusSuccess=T;g.sendUIStatusFailure=U;g.getPriorityFromDownloadEntry=Z}),98);
__d("WADecodeIncomingMsg",["WALogger","WALongInt","WAMsgApplication.pb","WAMsgTransport.pb","WAParseMessageApplication","WAParseMessageTransport","WAStanzaUtils","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeIncomingMsg called with unexpected encoding version: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instamadillo decodeIncomingMsg called with null applicationPayload"]);i=function(){return a};return a}function j(a,b,c){return a.futureProof&&c!=null?{version:"v3",type:"futureProof",futureProof:a.futureProof,protobuf:b,applicationPayload:c,subtype:null}:{version:"v3",type:"error",error:a.error}}function a(a,b,c,e){if(b==="v2")return{version:"v2",encoded:a};else if(b==="v3"){var f=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgTransport.pb").MessageTransportSpec,a);c=d("WAParseMessageTransport").parseMessageTransport(f,c);f=n(f);if(c.type==="error")return j(c,a);if(c.type==="skdm")return k(c.skdm,c.icdc);else if(c.type==="applicationPayload"){if(e===!0){if(c.applicationPayload.payload==null){d("WALogger").DEV(i());return{version:"v3",type:"error",error:"instamadillo unhandled proto"}}return{version:"v3",type:"instamadillo",applicationPayload:new Uint8Array(c.applicationPayload.payload),backupDirective:f}}e=l(c.applicationPayload,a,c.icdc,f);if(c.skdm!=null){a=k(c.skdm,c.icdc);return{version:"v3",type:"msgWithSKDM",msg:e,skdm:a}}return e}else if(c.type==="empty")return{version:"v3",type:"empty"};else{c.type;return{version:"v3",type:"error",error:"unhandled proto with type "+c.type}}}else{d("WALogger").DEV(h(),b);return{type:"error",version:"v3",error:"decodeIncomingMsg called with unexpected encoding version: "+b}}}function k(a,b){var c=a.axolotlSenderKeyDistributionMessage;a=a.groupId;if(c==null)return{type:"error",version:"v3",error:"parseSKDM called with null axolotlSenderKeyDistributionMessage"};else if(a==null)return{type:"error",version:"v3",error:"parseSKDM called with null groupId"};return{version:"v3",type:"skdm",msg:{senderKey:c,groupId:a},icdc:b}}function l(a,b,c,e){var f=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);if(f.payload==null)return m(f.metadata,a.payload);var g=d("WAParseMessageApplication").parseMessageApplication(f);if(g.type==="error")return j(g,b);return a.payload==null?j({error:"Empty application payload",type:"error",version:"v3"},b):{version:"v3",type:"subprotocol",metadata:(f=f.metadata)!=null?f:null,subprotocolType:g.subprotocolType,subprotocol:g.payload,applicationPayload:a.payload,protobuf:b,frankingContent:a.payload,backupDirective:e,icdc:c}}function m(a,b){a=a==null?void 0:a.chatEphemeralSetting;if(a!=null){var c=a.ephemeralExpiration,e=a.ephemeralSettingTimestamp;if(c==null)return{version:"v3",type:"error",error:"Ephemeral setting without expiration"};if(b==null)return{error:"Empty application payload",type:"error",version:"v3"};try{e=e!=null?d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(e)/1e3):d("WATimeUtils").DEFAULT_UNIXTIME;return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:c,ephemeralLastUpdatedOrSetTimestamp:e,isEphemeralSettingReset:(e=a.isEphemeralSettingReset)!=null?e:!1,applicationPayload:b}}catch(f){return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:c,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").DEFAULT_UNIXTIME,isEphemeralSettingReset:(e=a.isEphemeralSettingReset)!=null?e:!1,applicationPayload:b}}}else return{version:"v3",type:"error",error:"MessageApplication has no payload and is not ephemeral"}}function n(a){a=(a=a.protocol)==null?void 0:(a=a.ancillary)==null?void 0:a.backupDirective;if(a==null)return null;var b=a.messageId,c=a.actionType;a=a.supplementalKey;return b==null||c==null?null:{messageId:d("WAStanzaUtils").toStanzaId(b),actionType:c,supplementalKey:a}}g.decodeIncomingMsg=a;g.parseEphemeralSetting=m}),98);
__d("WAParseV3Protocol",["WAAckLevel","WAAssertUnreachable","WAGlobals","WAHex","WAMsgType","WAParseConsumerMessageProtocol","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b,e,f,g,h,i){h={id:{chat:e,author:g,externalId:f},ts:h,serverTs:h,ack:d("WAAckLevel").ACK.RECEIVED,forwardingScore:b.type!=="futureProof"?(f=b==null?void 0:(g=b.metadata)==null?void 0:g.forwardingScore)!=null?f:0:0};g=b.type!=="futureProof"&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)!=null&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)>0;if(b.type==="futureProof"||g&&!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return{unstoredMsg:{type:d("WAMsgType").FUTUREPROOF,msgContent:{subtype:null,protobuf:d("WAHex").bytesToBuffer(b.protobuf)},id:h.id,ts:h.ts,sentTs:h.sentTs,serverTs:h.serverTs,ack:h.ack,reportingMeta:h.reportingMeta},unstoredMedia:null,unstoredQuotedMedia:null};else if(b.type==="subprotocol"){f=a==null?void 0:a.get(b.subprotocolType);if(f!=null)return f(e,b.subprotocol,h,b.protobuf,b.metadata,i);switch(b.subprotocolType){case"consumerMessage":return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(e,b.subprotocol,h,b.protobuf,b.metadata,i);case"businessMessage":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);case"paymentMessage":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);case"multiDevice":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);case"voip":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);default:throw c("err")("Subprotocol parser for: "+b.subprotocolType+" was not found")}}else return c("WAAssertUnreachable")(b.type)}}g.createV3ProtocolParser=a}),98);
__d("MAWMessageRequestUtils",["MAWFolderTypes","WADbContact"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a===d("MAWFolderTypes").FOLDER_ID.PENDING||a===d("MAWFolderTypes").FOLDER_ID.OTHER;return a}function b(a,b){return(a===null||a===d("MAWFolderTypes").FOLDER_ID.INBOX)&&(b===d("WADbContact").REVERSED_ONE_WAY_CONTACT||b===d("WADbContact").NON_CONTACT)}g.isMessageRequestOrSpamThread=a;g.isInboxRequest=b}),98);
__d("MAWMarkThreadAsReadTxns",["FBLogger","MAWBridgeThread","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMessageRequestUtils","MAWTimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d,e,f){f===void 0&&(f=!1);var g=new Map();g.set(b,{msgId:d,sortOrderMs:e});return h(a,g,f).then(function(a){a=a.get(b);if(a==null)throw c("FBLogger")("messenger_web_devx","maw_mark_thread_as_read").warn("ThreadReadReceiptInfo unexpectedly unavailable for thread\n         in markThreadAsReadUpToMsgSortOrderMs()");return a})}function h(a,b,c){c===void 0&&(c=!1);return j(a,b).then(function(e){var f=e.threadJidToReadReceiptInfo,g=e.updatedThreads;return a.threads.bulkPut(g).then(function(){g.forEach(function(a){var e;e=(e=b.get(a.jid))==null?void 0:e.sortOrderMs;e!=null&&!c&&d("MAWIndexedDb").afterTransaction({tag:"ThreadTimestampsUpdated",value:d("MAWBridgeThread").createBridgeThreadTimestampsUpdated(a.jid,e,e,!1)});f.set(a.jid,{isReadReceiptExpectedToBeSent:(a=(e=f.get(a.jid))==null?void 0:e.isReadReceiptExpectedToBeSent)!=null?a:!1,type:"success"})});return f})})}function i(a,b,c){return d("MAWDbMsgTxns").getThreadOldestMessageId(a,b.jid).then(function(a){if(a==null)return null;a=d("MAWTimeUtils").ensureValidMillisTime(b.newestMsgTs);return babelHelpers["extends"]({},b,{lastReadMsg:c.msgId,newestMsgTs:a})})}function j(a,b){var e=new Map(),f=Array.from(b.keys()),g=[];return a.threads.where("jid").anyOf(f).toArray().then(function(h){var j=new Map();h.forEach(function(a){return j.set(a.jid,a)});f.forEach(function(a){j.has(a)||j.set(a,null)});h=Array.from(j).map(function(d){var f=d[0];d=d[1];if(d==null){e.set(f,{isReadReceiptExpectedToBeSent:!1,type:"missing"});return}f=k(d.folder);e.set(d.jid,{isReadReceiptExpectedToBeSent:f,type:"success"});f=b.get(d.jid);if(f==null)throw c("FBLogger")("maw_threads","maw_mark_thread_as_read").warn("ThreadReadReceiptInfo unexpectedly unavailable for thread\n            in getThreadJidToReadReceiptInfo()");return i(a,d,f).then(function(a){a!=null&&g.push(a)})});return d("MAWDexieTable").dexieAll(h).then(function(){return{threadJidToReadReceiptInfo:e,updatedThreads:g}})})}function k(a){return!d("MAWMessageRequestUtils").isMessageRequestOrSpamThread(a)}g.markThreadAsReadUpToMsgSortOrderMs=a;g.bulkMarkThreadAsReadUpToMsgSortOrderMs=h;g.isReadReceiptExpectedToBeSentFor=k}),98);
__d("MAWRemoveGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAAPI","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(e))},"removeGroupParticipants").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[1]]));return a});return function(b){return a.apply(this,arguments)}}())};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield i.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return a.user});f=k.map(function(a){return{groupJid:c,userJid:a}});yield a.bulkDelete(f,{remover:e});if(b!=null){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,k,e,h);yield j.create(a);yield i.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.removeGroupParticipants=a;g.removeGroupParticipantsTransactor=h}),98);
__d("createInstamadilloAddMessagePayload",["I64","InstamadilloMessageIdUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a!=null?{ephemeralityParams:{ephemeralDurationSec:(h||(h=d("I64"))).to_int32(a)}}:{}}function j(a){return a.isForwarded===!0?{forwardingParams:{forwardedThreadId:(h||(h=d("I64"))).to_string(a.threadKey)}}:{}}function k(a){if(a.replySourceId==null&&a.replySourceTimestampMs==null)return{};function b(){return a.replySourceId!=null?{repliedToMessageOtid:d("InstamadilloMessageIdUtils").fromInstamadilloMessageId(a.replySourceId).stanzaId}:{}}function c(){return a.replySourceTimestampMs!=null?{repliedToMessageWaServerTimeSec:(h||(h=d("I64"))).to_string(a.replySourceTimestampMs)}:{}}return{repliedToMessage:babelHelpers["extends"]({},b(),c())}}function a(a,b){b={content:{text:{text:b?void 0:a.text}},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function b(a,b){b={content:{media:b},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function c(a,b){b={content:{receiverFetchXma:JSON.parse(b)},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}g.createInstamadilloAddMessageTextPayload=a;g.createInstamadilloAddMessageMediaPayload=b;g.createInstamadilloAddMessageReceiverFetchXmaPayload=c}),98);
__d("createInstamadilloTransportPayload",[],(function(a,b,c,d,e,f){"use strict";function a(a){a={add:a};return a}function b(a){a={supplement:a};return a}function c(a){a={"delete":a};return a}function d(a){a={franking:a};return a}f.createInstamadilloAddMessageTransportPayload=a;f.createInstamadilloSupplementMessageTransportPayload=b;f.createInstamadilloDeleteMessageTransportPayload=c;f.createInstamadilloFrankingTransportPayload=d}),66);
__d("MWBUtil",[],(function(a,b,c,d,e,f){"use strict";a=30;b=["impersonation"];c=["ig_user_impersonation"];d=Array.of.apply(Array,b.concat(c));f.SPAM_REPORT_MESSAGE_COUNT=a;f.MSGR_IMPERSONATION_TAGS=b;f.IG_IMPERSONATION_TAGS=c;f.ALL_IMPERSONATION_TAGS=d}),66);
__d("MAWHIMLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["HandleIncomingMessage"]);g["default"]=a}),98);
__d("MAWEphemeralAdminMsgBuildTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWEphemeralUtils","MAWIndexedDb","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h,i,j){if(e<0)throw c("FBLogger")("messenger_web").mustfixThrow("Received unexpected ephemeral time setting");e=d("MAWEphemeralUtils").getEphemeralSettingChangeData(b,e,h,i);var k={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:(h=b)!=null?h:d("WAJids").AUTHOR_SYSTEM,msgContent:e,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};i=b!=null?d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,j,g.jid,b):d("MAWDexieTable").dexieResolve();return i.then(function(b){if(b==null){var c=babelHelpers["extends"]({},k,{externalId:j,sortOrderMs:d("WATimeUtils").castUnixTimeToMillisTime(f),threadJid:g.jid,ts:f});return d("MAWWriteMsgTxns").writeDedupedEphemeralSettingAdminMessage(a,c,g,d("WATimeUtils").castUnixTimeToMillisTime(f)).then(function(a){return babelHelpers["extends"]({},c,{msgId:a.msgId,protocolMsgId:a.protocolMsgId,rowId:a.rowId})})}else if(b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var e=babelHelpers["extends"]({},b,k);return a.messages.put(e).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.threadJid,[b])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(e)});return e})}else return null})}function b(a,b,c,e,f,g,h){var i=b===d("MAWUserJidWrapper").getMyUserJid(),j=d("MAWEphemeralUtils").getEphemeralScreenshotActionData(f,b,i),k=j.ephemeralScreenshotActionContent;j=j.ephemeralScreenshotActionType;if(h==null){var l={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:i?d("WAJids").AUTHOR_ME:b,externalId:g,msgContent:{adminMsgContent:k,adminType:j,screenshotActionType:f,version:1},sortOrderMs:d("WATimeUtils").castUnixTimeToMillisTime(e),threadJid:c.jid,ts:e,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return d("MAWWriteMsgTxns").writeDedupedEphemeralSettingAdminMessage(a,l,c,d("WATimeUtils").castUnixTimeToMillisTime(e)).then(function(a){return babelHelpers["extends"]({},l,{msgId:a.msgId,protocolMsgId:a.protocolMsgId,rowId:a.rowId})})}else if(h.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var m=babelHelpers["extends"]({},h,{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:i?d("WAJids").AUTHOR_ME:b,msgContent:{adminMsgContent:k,adminType:j,screenshotActionType:f,version:1},type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION});return a.messages.put(m).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(h.threadJid,[h])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(m)});return m})}else return d("MAWDexieTable").dexieResolve(null)}g.writeEphemeralSettingAdminMsg=a;g.writeEphemeralScreenshotActionMsg=b}),98);
__d("MAWMsgActionType",[],(function(a,b,c,d,e,f){"use strict";a={DELETE_FOR_ME:"DELETE_FOR_ME",NO_ACTION:"NO_ACTION",REVOKE:"REVOKE",UPDATE_CIPHERTEXT:"UPDATE_CIPHERTEXT",UPDATE_CIPHERTEXT_WITH_ASSOCIATED:"UPDATE_CIPHERTEXT_WITH_ASSOCIATED",WRITE:"WRITE",WRITE_WITH_ASSOCIATED:"WRITE_WITH_ASSOCIATED"};f.MSG_ACTION=a}),66);
__d("MAWDbReceiptTxns",["MAWDexieTable","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly fetched null data from a msgIdToReceiptData map"]);h=function(){return a};return a}function a(a,b,c){return i([{deliveryReceipts:b==="delivered"?c:[],msgId:a,readReceipts:b==="read"?c:[],senderReceipts:b==="sender"?c:[]}]).then(function(a){return a[0]||{type:"missing"}})}function i(a){var b=a.map(function(a){return a.msgId}),c=new Map();a.forEach(function(a){c.set(a.msgId,a)});a=b.map(function(a){var b=c.get(a);if(b==null){d("WALogger").ERROR(h());return null}var e=new Set(),f=new Map(),g=b.deliveryReceipts,i=b.readReceipts;b=b.senderReceipts;[{receiptType:"delivered",receivers:g},{receiptType:"read",receivers:i},{receiptType:"sender",receivers:b}].forEach(function(a){var b=a.receiptType;a=a.receivers;a.forEach(function(a){var c=a.device;a=a.ts;c=d("WAJids").extractUserJid(c);var g=!1;if(b!=="sender"){var h=f.get(c);a=j(h,b,a);f.set(c,a);g=k(h,a)}g&&e.add(c)})});return{affectedUserJids:e,receipt:{msgId:a,statusTsPerUser:f}}}).filter(Boolean);return d("MAWDexieTable").dexieResolve(a.map(function(a){return{affectedUserJids:a.affectedUserJids,receipt:a.receipt}}))}function j(a,b,c){var d;d=(d=a==null?void 0:a.deliveredTs)!=null?d:c;a=a==null?void 0:a.readTs;b==="read"&&a==null&&(a=c);return{deliveredTs:d,readTs:a}}function k(a,b){return((b==null?void 0:b.deliveredTs)||0)>((a==null?void 0:a.deliveredTs)||0)||((b==null?void 0:b.readTs)||0)>((a==null?void 0:a.readTs)||0)}function b(a,b){return a.receipts.bulkDelete(b)}g.writeReceiptsForDevices=a;g.bulkWriteReceiptsForDevices=i;g.bulkDeleteAllReceiptsForMessages=b}),98);
__d("MAWPendingReceiptProcessingTxns",["MAWDbMsg","MAWDbParticipantTxns","MAWDbReceiptTxns","MAWDexieTable","MAWMarkThreadAsReadTxns","WAJids","WALogger","WAMsg","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing pending receipts for "," from ",""]);h=function(){return a};return a}function a(a,b,c){var e=d("WAMsg").craftWAMsgIdString({author:c.author,chat:b,externalId:c.externalId});return a.pendingReceipts.get(e).then(function(b){if(b==null)return;d("WALogger").LOG(h(),c.externalId,c.author);if(b.author===d("WAJids").AUTHOR_ME){var f=d("MAWDexieTable").dexieResolve();b.deliveryReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(c.msgId,"delivered",b.deliveryReceipts)}));b.readReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(c.msgId,"read",b.readReceipts)}));return f.then(function(b){var f=[];b!=null&&b.type!=="missing"&&b.receipt.statusTsPerUser.forEach(function(b,e){var g=b.deliveredTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0),h=b.readTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0);b=(b=b.readTs)!=null?b:d("WATimeUtils").castToUnixTime(0);f.push(d("MAWDbParticipantTxns").updateParticipantTimestamps(a,[c.threadJid,e],g,h,b))});return d("MAWDexieTable").dexieAll(f).then(function(){a.pendingReceipts["delete"](e)})})}else return d("MAWDexieTable").dexieAll([d("MAWMarkThreadAsReadTxns").markThreadAsReadUpToMsgSortOrderMs(a,c.threadJid,c.msgId,d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(c)))]).then(function(){return a.pendingReceipts["delete"](e)})})}g.processPendingReceipts=a}),98);
__d("MAWUpdateIsCollapsedMsgTxns",["MAWBridgeMsg","MAWDexieTable","MAWIndexedDb","MWXMAV2IsDataclassLiveLocationXMA","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=1e3;function a(a,b,c,e){var f=b.collapsibleId;return f==null?d("MAWDexieTable").dexieResolve(b):a.messages.where(["threadJid","collapsibleId","sortOrderMs"]).between([e,f,Number.MIN_SAFE_INTEGER],[e,f,Number.MAX_SAFE_INTEGER],!1,!1).reverse().first().then(function(e){if(e!=null)if(b.serverTs!=null&&b.serverTs>e.serverTs){var f=babelHelpers["extends"]({},e,{isCollapsed:!0});return a.messages.put(f).then(function(){return d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f)})}).then(function(){return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},b,{isCollapsed:!1}))})}else d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},b,{isCollapsed:!0}));else return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},b,{isCollapsed:i(c,b.serverTs)}))})}var i=function(a,b){var e=c("justknobx")._("4207");e=Math.floor(Date.now()/h)-e;var f=a!=null?JSON.parse(a):null;return b!=null&&b<e&&d("MWXMAV2IsDataclassLiveLocationXMA").isDataclassLiveLocationXMA(a)&&(f==null?void 0:(b=f.content.custom_template_data)==null?void 0:(e=b.location_metadata)==null?void 0:e.session_state)==="STARTED"};g.maybeUpdatePreviousCollapsibleMsgs=a}),98);
__d("MAWWriteEditTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBulkEditMsgsTxns","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWUnsafeCoerce","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=b.args,f=b.externalId,g=e.editMsgContent;e=e.originalProtocolMsgId;var i=e.chat,j=e.externalId;return d("MAWDexieTable").dexieAll([a.threads.get({jid:i}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e)]).then(function(e){var k=e[0],l=e[1];if(k==null)return d("WAResultOrError").makeError("missing_thread");if(l==null)return d("WAResultOrError").makeError("missing_msg");if(l.type!==d("WAMsgType").MSG_TYPE.TEXT)throw c("FBLogger")("messenger_web").mustfixThrow("Only text or cipher text can be edited. Original msg type: %s",l.type);return d("MAWDexieTable").dexieAll([a.messages.where("quoteExternalId").equals(j).toArray(),a.editMsgHistory.where("originalMsgExternalId").equals(j).toArray()]).then(function(e){var k=e[0];e=e[1];var m=e.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===f});if((m==null?void 0:m.sendStatus)!=null&&m.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("already_sent");m=[];m.push(h(b,i,j));e=e.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===j});e==null&&(l.editCount==null||l.editCount===0)&&m.push(h(l,i,j));return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,m,!1).then(function(){var b,e=babelHelpers["extends"]({},l,{ack:d("MAWAckLevel").ACK.clock,editCount:((b=l.editCount)!=null?b:0)+1,msgContent:g}),h=[],m=d("MAWUserJidWrapper").getMyUserJid();k.filter(function(a){var b;return(((b=a.quote)==null?void 0:b.content.author)===d("WAJids").AUTHOR_ME||((b=a.quote)==null?void 0:b.content.author)===m)&&a.threadJid===i}).forEach(function(a){if(a!=null){var b=a.quote,d=a.quoteExternalId;if(b==null)c("FBLogger")("messenger_web").warn("[edit message] Failed to get the quoted content for a msg that has been quoted.",d);else{d=babelHelpers["extends"]({},a,{quote:babelHelpers["extends"]({},b,{content:babelHelpers["extends"]({},b.content,{msgContent:babelHelpers["extends"]({},e.msgContent)})})});h.push(d)}}});return a.messages.bulkPut([e].concat(h)).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,l)}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e,void 0,a)})}).then(function(){h.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult({originalMsgExternalId:j,originalMsgId:l.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:i,externalId:f}})})})})})}function h(a,b,c){var e;return{author:d("WAJids").AUTHOR_ME,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:(e=(e=a.args)==null?void 0:e.editMsgContent)!=null?e:d("MAWUnsafeCoerce").unsafeCoerce(a.msgContent),originalMsgExternalId:c,sendStatus:d("MAWAckLevel").ACK.clock,specialTextSize:a.specialTextSize,threadJid:b}}function b(a,b,c,e,f,g,h){if(b.type!==d("WAMsgType").MSG_TYPE.TEXT||!e||e.length===0)return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b,c,f,g,h);var i=e.sort(function(a,b){return b.editTs-a.editTs})[0].msgContent;e=e.length;return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,babelHelpers["extends"]({},b,{editCount:e,msgContent:i}),c,f,g,h).then(function(c){return(c.type===d("WAMsgType").MSG_TYPE.TEXT?d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,[d("MAWBulkEditMsgsTxns").getMessageHistory(babelHelpers["extends"]({},c,{msgContent:b.msgContent}),c.threadJid)],g):d("MAWDexieTable").dexieResolve()).then(function(){return c})})}g.writeEdit=a;g.writeNewIncomingMsgAndEditHistory=b}),98);
__d("MAWWriteGroupPollCreateTxns",["I64","MAWArmadilloPollTableSchema.pb","MAWCurrentUser","MAWDbParticipantTxns","MAWDexieTable","MAWIndexedDb","MAWWriteMsgTxns","WAResultOrError","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e){var f=c.optionsHashed;if(f==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args_poll_option_hashes"}));f=b.author;var g=b.externalId,h=b.ts,k=e.jid;return d("MAWDexieTable").dexieAll([i(a,k,c,f,g),d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b,e,"handleGroupPollCreate")]).then(function(a){var b=a[0];a=a[1];j(b,a.msgId,d("WATimeUtils").castUnixTimeToMillisTime(h))}).then(function(){return d("WAResultOrError").makeResult()})}function i(a,b,e,f,g){var h=e.encKey,i=e.latestSenderTimestampsMs,j=e.name,k=e.optionsHashed,l=e.selectableOptionsCount;return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(e){var m={chatJid:b,encKey:h,latestSenderTimestampsMs:i,pollAuthor:f,pollOptions:c("nullthrows")(k),pollParticipantCount:e.length,pollStanzaId:g,pollState:d("MAWArmadilloPollTableSchema.pb").POLL_STATE.OPEN,selectableOptionsCount:l,title:j};return a.poll.put(m).then(function(){return m})})}function j(a,b,c){d("MAWIndexedDb").afterTransaction({tag:"NewPoll",value:{contactIdForCurrentUser:(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),dbPoll:a,latestUpdateMsgId:b,latestUpdateTimestampMs:c}})}g.handleIncomingGroupPollCreate=a;g.savePollToDb=i;g.sendPollToUI=j}),98);
__d("MAWDbPollUtils",["FBLogger","MAWLocalizationType","WAJids","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d,e){var f=a.pollAuthor,g=new Map(a.pollOptions.entries().map(function(a){var d=a[0];a=a[1];return a.optionText==null||!a.voteAuthors.has(b)?null:[d.toString(),c("nullthrows")(a.optionText)]}).filter(Boolean)),h=new Map(e.map(function(a){return[a.hashedOptionName,a.optionName]}));e=e.filter(function(a){return!g.has(a.hashedOptionName)}).map(function(a){return a.optionName});var k=Array.from(g.entries().map(function(a){var b=a[0];a=a[1];return h.has(b)?null:a}).filter(Boolean));if(d.length>0)if(e.length>0||k.length>0)return i(a,f);else return j(a,b,d);if(e.length>0)if(k.length===0)return m(a,b,e);else if(e.length===k.length)return p(a,b,e);else return i(a,f);if(k.length>0)return s(a,b,k);throw c("FBLogger")("messenger_web").mustfixThrow("Not a valid update for poll")}function h(a){if(a===d("WAJids").AUTHOR_SYSTEM||a===d("WAJids").AUTHOR_ME)throw c("FBLogger")("messenger_web").mustfixThrow("Not a valid author for poll vote");return d("WAJids").userIdFromJid(a)}function i(a,b){var c=b===d("WAJids").AUTHOR_ME;return c?{adminMsgContent:[a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE,version:1}:{adminMsgContent:[h(b),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE,version:1}}function j(a,b,c){if(c.length===1)return k(a,b,c[0]);else return l(a,b,c[0],c.length)}function k(a,b,c){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION,version:1}:{adminMsgContent:[h(b),c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION,version:1}}function l(a,b,c,e){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS,version:1}:{adminMsgContent:[h(b),c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS,version:1}}function m(a,b,c){if(c.length===1)return n(a,b,c[0]);else return o(a,b,c[0],c.length)}function n(a,b,c){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE,version:1}:{adminMsgContent:[h(b),c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE,version:1}}function o(a,b,c,e){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES,version:1}:{adminMsgContent:[h(b),c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES,version:1}}function p(a,b,c){if(c.length===1)return q(a,b,c[0]);else return r(a,b,c[0],c.length)}function q(a,b,c){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE,version:1}:{adminMsgContent:[h(b),c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE,version:1}}function r(a,b,c,e){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES,version:1}:{adminMsgContent:[h(b),c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES,version:1}}function s(a,b,c){if(c.length===1)return t(a,b,c[0]);else return u(a,b,c[0],c.length)}function t(a,b,c){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE,version:1}:{adminMsgContent:[h(b),c,a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE,version:1}}function u(a,b,c,e){return b===d("WAJids").AUTHOR_ME?{adminMsgContent:[c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES,version:1}:{adminMsgContent:[h(b),c,e.toString(),a.title],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES,version:1}}g.getAdminMessageForUpdate=a}),98);
__d("MAWWriteGroupPollMessageTxns",["FBLogger","I64","MAWCurrentUser","MAWDbPoll","MAWDbPollTxns","MAWDbPollUtils","MAWDexieTable","MAWGroupPollsDualEncryptionUtils","MAWIndexedDb","MAWMsgType","MAWWriteMsgTxns","WALongInt","WAResultOrError","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e){var f=c.decrypted;c=c.encryptedMessage;var g=b.author,k=(c=c.pollCreationMessageKey)==null?void 0:c.id;return k==null||g==null||f==null?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args_poll_update_message"})):d("MAWDbPollTxns").getPoll(a,e.jid,k).then(function(c){if(c==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"missing_poll_for_update"}));var l=i(c,f),m=l.optionsToAdd;l=l.selectedOptions;m=d("MAWDbPollUtils").getAdminMessageForUpdate(c,g,m,l);var n=d("WAStanzaUtils").toStanzaId(k);l=babelHelpers["extends"]({},b,{msgContent:m,pollStanzaId:n,type:d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE});return d("MAWDexieTable").dexieAll([j(a,c,g,f),d("MAWWriteMsgTxns").writeNewIncomingMsg(a,l,e,"handleGroupPollUpdate")]).then(function(b){var c=b[0],f=b[1];return d("MAWDbPollTxns").maybeGetLatestPollUpdateMsg(a,n,e.jid).then(function(a){var b;d("MAWIndexedDb").afterTransaction({tag:"NewPoll",value:{contactIdForCurrentUser:(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),dbPoll:c,latestUpdateMsgId:(b=a==null?void 0:a.msgId)!=null?b:f.msgId,latestUpdateTimestampMs:d("WATimeUtils").castUnixTimeToMillisTime((b=a==null?void 0:a.ts)!=null?b:f.ts)}});return d("WAResultOrError").makeResult()})})})}function i(a,b){var c=b.optionsToAdd;b=b.vote;var e=a.pollOptions;b=((a=b==null?void 0:b.selectedOptions)!=null?a:[]).map(function(a){var b;a=d("MAWGroupPollsDualEncryptionUtils").getBase64EncodedHash(a);b=(b=e.get(a))==null?void 0:b.optionText;return b==null?null:{hashedOptionName:d("MAWDbPoll").convertOptionHashToString(a),optionName:b}}).filter(Boolean);return{optionsToAdd:((a=c)!=null?a:[]).map(function(a){return a.optionName}),selectedOptions:b}}function j(a,b,e,f){var g,h=f.optionsToAdd;f=f.vote;var i=b.pollOptions;h=h;k(h,i);h=d("WALongInt").maybeNumber((h=f==null?void 0:f.senderTimestampMs)!=null?h:0);if(h!=null&&h>((g=b.latestSenderTimestampsMs.get(e))!=null?g:0)){b.latestSenderTimestampsMs.set(e,d("WATimeUtils").castToMillisTime(h));g=f;l(g,i,e)}else h===0?c("FBLogger")("GroupPollsE2EE").warn("Poll vote message doesn't have a timestamp"):h==null?c("FBLogger")("GroupPollsE2EE").warn("Poll vote message timestamp is not a valid number"):h===0?c("FBLogger")("GroupPollsE2EE").mustfix("Poll vote message doesn't have a timestamp"):h==null?c("FBLogger")("GroupPollsE2EE").mustfix("Poll vote message timestamp is not a valid number"):c("FBLogger")("GroupPollsE2EE").info("Dropping poll vote message since we already have a newer vote message from this author %s",e);f=babelHelpers["extends"]({},b,{pollOptions:i});return d("MAWDbPollTxns").updatePoll(a,f).then(function(){return b})}function k(a,b){a==null?void 0:a.forEach(function(a){var c=a.hashedOptionName,d={optionText:a.optionName,voteAuthors:new Set()},e=b.get(c);e==null?b.set(c,d):e.optionText===void 0&&b.set(c,{optionText:a.optionName,voteAuthors:e.voteAuthors})})}function l(a,b,c){b.values().forEach(function(a){a.voteAuthors["delete"](c)}),a==null?void 0:a.selectedOptions.forEach(function(a){a=d("MAWGroupPollsDualEncryptionUtils").getBase64EncodedHash(a);if(!b.has(a)){var e={optionText:void 0,voteAuthors:new Set()};b.set(a,e)}(e=b.get(a))==null?void 0:e.voteAuthors.add(c)})}g.handleGroupPollUpdate=a;g.writeIncomingGroupPollUpdateMsg=j}),98);
__d("MAWXMAManagementTxns",["FBLogger","MAWDexieTable","MAWMediaManagementTxns","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g){var i=b.unstoredDbXMA,j=b.unstoredFavicon,k=b.unstoredHeaderMedia,l=b.unstoredPreviews;f===void 0&&(f=!1);g===void 0&&(g="wa");var m=new Map(),n=function(b){return b!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b,c,g,!0).then(function(a){return[b.plaintextHash,a]}):d("MAWDexieTable").dexieResolve([void 0,void 0])};f||(m.set(j==null?void 0:j.plaintextHash,n(j)).set(k==null?void 0:k.plaintextHash,n(k)),l==null?void 0:l.forEach(function(a){m.set(a==null?void 0:a.plaintextHash,n(a))}));b=Array.from(m.values());return d("MAWDexieTable").dexieAll(b).then(function(b){var g,m=new Map(b),n=((g=l)!=null?g:[]).map(function(a){return m.get(a.plaintextHash)}).filter(Boolean);return h(a,f?d("MAWXMAUtils").buildUnstoredTombstonedXMA(i):i,m.get(j==null?void 0:j.plaintextHash),m.get(k==null?void 0:k.plaintextHash),n,c,e).then(function(a){return{dbMedias:b.map(function(a){a[0];a=a[1];return a}).filter(Boolean),dbXMA:a,firstPreview:n[0]}})})}function h(a,b,d,e,f,g,h){h=babelHelpers["extends"]({},b,{associatedMessageId:(b=h)!=null?b:void 0,defaultPreviewMediaId:(h=f[0])==null?void 0:h.mediaId,defaultPreviewMediaPlaintextHash:(b=f[0])==null?void 0:b.plaintextHash,faviconMediaId:d==null?void 0:d.mediaId,faviconPlaintextHash:d==null?void 0:d.plaintextHash,headerMediaId:e==null?void 0:e.mediaId,headerMediaPlaintextHash:e==null?void 0:e.plaintextHash,msgId:g.msgId,previewMediaIds:f.map(function(a){return a.mediaId})});return a.xma.add(h).then(function(b){return a.xma.get(b)}).then(function(a){if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Failed to write XMA to db");return a})}function b(a,b,c,e,f,g,h,i,j,k,l,m,n){var o=d("MAWXMAUtils").isXMAExpired(!1,j.targetExpiringAtSec);h=babelHelpers["extends"]({},j,{associatedMessageId:(j=h)!=null?j:void 0,author:i.author,externalId:i.externalId,isTombstoned:o,msgId:g,offlineAttachmentId:k,targetType:f,threadJid:i.chat});var p=o?h:babelHelpers["extends"]({},h,{defaultPreviewMediaId:(j=b)!=null?j:void 0,defaultPreviewMediaPlaintextHash:(g=l)!=null?g:void 0,faviconMediaId:(k=e)!=null?k:void 0,faviconPlaintextHash:(f=n)!=null?f:void 0,headerMediaId:(i=c)!=null?i:void 0,headerMediaPlaintextHash:(o=m)!=null?o:void 0,previewMediaIds:b!=null?[b]:[]});return a.xma.add(p).then(function(a){return babelHelpers["extends"]({},p,{xmaId:a})})}g.handleUnstoredXMAContent=a;g.saveXMA=b}),98);
__d("MAWWriteXMAMessageTxns",["FBLogger","MAWBridgeMsg","MAWDbXMATxns","MAWDexieTable","MAWExpiredXMACleaner","MAWGetIsMediaDownloadStatusEnabled","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWMsgType","MAWWriteMsgTxns","MAWXMAManagementTxns","MAWXMAUtils","MWPBumpEntityKey","WAJids","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";f=6*d("WATimeUtils").HOUR_SECONDS;var h=new Set([d("MAWMsgType").MSG_TYPE.TEXT,d("MAWMsgType").MSG_TYPE.GIF,d("MAWMsgType").MSG_TYPE.STICKER]);function a(a,b,c,e){var f=c.unstoredAssociatedMedia,g=c.unstoredAssociatedMsg,h=c.unstoredDbXMA;return d("MAWDbXMATxns").maybeGetAssociatedXMAMsg(a,g,e.jid).then(function(c){var i=b;if(c!=null&&c.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var j=c.serverTs,k=c.sortOrderMs;c=c.ts;i=babelHelpers["extends"]({},b,{serverTs:j,sortOrderMs:k!=null?k-1:k,ts:c})}j=[h.targetExpiringAtSec,h.targetType];k=j[0];c=j[1];d("MAWXMAUtils").isXMAStoryReaction(c)&&(g==null?void 0:g.msgContent)!=null&&(i=babelHelpers["extends"]({},b,{msgContent:g.msgContent}));j=d("MAWXMAUtils").isXMAExpired(h.isTombstoned,k);i.isExpiredXmaMsg=j;k=!d("MAWXMAUtils").isXMAStoryReaction(c)&&g!=null?d("MAWWriteMsgTxns").prepareMsgWriteData(a,g,e):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([d("MAWWriteMsgTxns").prepareMsgWriteData(a,i,e),k]).then(function(a){var b=a[0];a=a[1];return{associatedData:a,associatedMedia:f,associatedMsg:g,xmaData:b,xmaMsg:i}})})}function b(a,b,c,e,f){var g=c.unstoredDbXMA,h=[g.targetExpiringAtSec,g.targetType],i=h[0];h=h[1];if(b==null||b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("MAWDexieTable").dexieResolve({dbMedias:null,dbXMA:null});b.isExpiredXmaMsg!==!0&&i!=null&&d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(i);d("MAWXMAUtils").isXMAStoryReaction(h)&&d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b)});return d("MAWXMAManagementTxns").handleUnstoredXMAContent(a,babelHelpers["extends"]({},c,{unstoredDbXMA:g}),b,f,b.isExpiredXmaMsg===!0,e).then(function(c){var e=c.dbMedias,f=c.dbXMA;c=c.firstPreview;var g=d("MAWDexieTable").dexieResolve();if(f!=null&&!d("MAWXMAUtils").isXMAStoryReply(f.targetType)&&b.isExpiredXmaMsg!==!0)if(d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabledWithChunkVerification()){var h=new Map(e.map(function(a){return[a.mediaId,a]})),i=f.headerMediaId!=null?h.get(f.headerMediaId):null;h=f.faviconMediaId!=null?h.get(f.faviconMediaId):null;g=d("MAWHandleXmaTransactionUtil").checkAllMediaChunksAndHandleXmaAfterTransaction(a,f,c,h,i)}else g=d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(a,f,c);return g.then(function(){return{dbMedias:e,dbXMA:f}})})}function e(a,b,e,f,g,i,j,k){if(!h.has(g.type))throw c("FBLogger")("messenger_web").mustfixThrow("flow check, this message type is not supported for XMA replies: "+g.type);var l=b.author;if(l==="@system")throw c("FBLogger")("messenger_web").mustfixThrow("wrong author of story reply");var m=d("WAJids").interpretAsUserJid(f);if(m==null)throw c("FBLogger")("messenger_web").mustfixThrow("this is a flow check, participant jid can not be null");var n=(k=k==null?void 0:(k=k[0])==null?void 0:k.plaintextHash)!=null?k:g.plaintextHash;(i?void 0:e==null?void 0:e.defaultPreviewMediaId)!=null&&n==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","write_xma_message_txns_handle_xma_reply_msg");k={author:l===d("WAJids").AUTHOR_ME?m:d("WAJids").AUTHOR_ME,expirationTs:e.targetExpiringAtSec,externalId:e.externalId,mediaId:i?void 0:e==null?void 0:e.defaultPreviewMediaId,plaintextHash:c("justknobx")._("2969")&&!i?n:void 0,sourceId:(l=(k=e.defaultCTA)==null?void 0:k.nativeUrl)!=null?l:(m=e.defaultCTA)==null?void 0:m.actionUrl,ts:b.ts,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.targetType};var o=babelHelpers["extends"]({},g,{mediaId:(l=j==null?void 0:j.mediaId)!=null?l:g.mediaId,quote:{content:k,remoteJid:f}});return a.messages.put(o).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:c("justknobx")._("2969")&&!i?d("MAWBridgeMsg").createBridgeMsg(o,void 0,{replyPlaintextHash:n}):d("MAWBridgeMsg").createBridgeMsg(o)})})}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=f;g.XMA_REPLY_MSG_SUPPORTED_TYPES=h;g.prepareXMAWriteData=a;g.handleIncomingXMA=b;g.handleXMAReplyMsg=e}),98);
__d("MAWHandleIncomingMsgApi",["FBLogger","MAWDbMsgTxns","MAWDbPendingStanzaTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWEphemeralAdminMsgBuildTxns","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWHIMLogger","MAWJidUtils","MAWMediaManagementTxns","MAWMsgActionType","MAWMsgType","MAWODSProxy","MAWPendingReceiptProcessingTxns","MAWUpdateIsCollapsedMsgTxns","MAWUpdateQuotedMsgTxns","MAWWriteEditTxns","MAWWriteGroupInviteTxns","MAWWriteGroupPollCreateTxns","MAWWriteGroupPollMessageTxns","MAWWriteMsgTxns","MAWWriteReceiverFetchTxns","MAWWriteRevokeMessageTxns","MAWWriteXMAMessageTxns","MAWXMAUtils","MWXMAV2IsCollapsibleXMA","WAGetPlatformFromStanzaId","WAJids","WAOdsEnums","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Could not write dbAssociatedMsg but it exists: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Finished writing the incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Finished writing the incoming xma, has associated data = ",""]);j=function(){return a};return a}var k=d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult(void 0));function a(a,b,c){var e;b.receiveFlow.addPoint("him_write_message_start");var f=((e=b==null?void 0:(e=b.msg)==null?void 0:(e=e.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec)!=null?e:0)>0;return l(a,b,c).then(function(a){var c;b.receiveFlow.addPoint("him_write_message_end",{bool:{isEphemeralMsg:f,outOfSync:(a==null?void 0:(c=a.value)==null?void 0:c.outOfSyncEphemeralSetting)!=null},string:{msgWrittenResultType:(c=a==null?void 0:(c=a.value)==null?void 0:c.msgType)!=null?c:"unknown"}});f&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.TOTAL_INCOMING_MESSAGE,key:"ephemeralMsgs"});return a})["catch"](function(a){var c;a.message="[handleIncomingMsg] ["+((c=b.type)!=null?c:"")+"/"+b.action+"] "+a.message;throw a})}function l(a,b,e){if(b.action===d("MAWMsgActionType").MSG_ACTION.NO_ACTION)return k;var f=function(c,e,f){return d("MAWEphemeralMsgTxns").syncEphemeralSettingOnIncomingMsg(a,c,e,b.thread,f)};switch(b.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.msg,b.thread,"MAWHandleIncomingMsgApi::handleIncomingMsgInternal",e,b.stanzaSource).then(function(){return d("WAResultOrError").makeResult(null)});case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:return d("MAWDbRavenActionTxns").writeRavenActionMsg(a,b.msg,b.thread).then(function(){return d("WAResultOrError").makeResult(null)});case d("MAWMsgType").MSG_TYPE.REACTION:return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({reactToExternalId:b.msg.reactToExternalId}));case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("WAJids").isAuthorMe(b.id.author)?k:d("MAWWriteGroupInviteTxns").writeIncomingGroupInviteMsg(a,b.msg,b.thread.jid,b.folder);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return b.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME?d("MAWWriteMsgTxns").handleDeleteForMeMessage(a,b.msg,b.thread,b.pendingDeleteForMeStanza).then(function(a){return n(a)}):r(a,b.msg,b.thread.jid).then(function(c){if(c)return k;c=b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT?d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.msg,b.existingMsg,b.thread,b.existingEditMsgHistory,b.stanzaSource):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?d("MAWWriteMsgTxns").handleOutOfOrderRevokedMessage(a,b.msg,b.thread,b.pendingRevokedStanza,b.pendingRevokedStanza!=null):d("MAWWriteEditTxns").writeNewIncomingMsgAndEditHistory(a,b.msg,b.thread,b.editMsgHistories,"MAWHandleIncomingMsgApi::handleIncomingMsgInternal",e,b.stanzaSource);return c.then(function(c){var g=b.type===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?d("MAWWriteReceiverFetchTxns").handleUnstoredReceiverFetchInfo(a,c,b.receiverFetchInfo):d("MAWDexieTable").dexieResolve(),h=b.media!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b.media,c,b.stanzaSource,void 0,void 0,void 0,e):d("MAWDexieTable").dexieResolve();c.quote!=null&&b.receiveFlow.addAnnotations({bool:{isQuote:!0},string:{quoteType:c.quote.content.type}});return d("MAWDexieTable").dexieAll([g,h]).then(function(e){e[0];var g=e[1];return d("MAWDexieTable").dexieAll([o(a,b.id,c,c.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF),f(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return n(c,a,g==null?null:[g])})}).then(function(e){var f={author:c.author,chat:c.threadJid,externalId:c.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f).then(function(c){if(c!=null)return d("MAWUpdateQuotedMsgTxns").associateAllReplies(a,c,b.thread.jid)}).then(function(){return e})})})});case d("MAWMsgType").MSG_TYPE.REVOKED:return d("MAWWriteRevokeMessageTxns").writeIncomingRevokeMsg(a,b.msg,b.thread,b.originalMsg,b.previousRevokeMsg,b.ebTimestampMs).then(function(c){return d("MAWDexieTable").dexieAll([o(a,b.id,c),f(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return n(c,a)})});case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,d("MAWJidUtils").getAuthorJid(b.id.author),b.msg.ephemeralExpirationInSec,b.msg.ephemeralLastUpdatedOrSetTimestamp,b.msg.isEphemeralSettingReset,b.thread,b.ts,b.id.externalId,!0).then(function(a){return n(null,a==null?void 0:a.outOfSyncEphemeralSetting)});case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({msgType:void 0,outOfSyncEphemeralSetting:void 0,plaintextHashs:void 0}));case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralScreenshotActionMsg(a,d("MAWJidUtils").getAuthorJid(b.id.author),b.thread,b.ts,b.screenshotActionType,b.id.externalId,b.existingMsg).then(function(c){return d("MAWDexieTable").dexieAll([o(a,b.id,c),f(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return n(c,a)})});case d("MAWMsgType").MSG_TYPE.XMA:if(b.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME)return d("MAWWriteMsgTxns").handleDeleteForMeMessage(a,b.msg,b.thread,b.pendingDeleteForMeStanza).then(function(a){return n(a)});var g=b.xma!=null&&d("MWXMAV2IsCollapsibleXMA").isCollapsibleXMA(b.xma.unstoredDbXMA.xmaDataclass)&&c("gkx")("12844")?d("MAWUpdateIsCollapsedMsgTxns").maybeUpdatePreviousCollapsibleMsgs(a,b.msg,b.xma.unstoredDbXMA.xmaDataclass,b.thread.jid):d("MAWDexieTable").dexieResolve(b.msg);g=b.action===d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED?p(a,b,e):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?m(a,b,e):g.then(function(c){return m(a,babelHelpers["extends"]({},b,{msg:c}),e).then(function(c){return d("MAWWriteXMAMessageTxns").handleIncomingXMA(a,c,b.xma,b.stanzaSource,null).then(function(a){return babelHelpers["extends"]({},a,{dbMsg:c})})})});return g.then(function(e){var g=e.dbAssociatedMsg,h=e.dbMedias,i=e.dbMsg;c("MAWHIMLogger").LOG(j(),b.action===d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED);return d("MAWDexieTable").dexieAll([o(a,b.id,i,!0,g),f(i,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(c){c[0];var e=c[1];return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b.id).then(function(c){if(c!=null)return d("MAWUpdateQuotedMsgTxns").associateAllReplies(a,c,b.thread.jid)}).then(function(){return e})}).then(function(a){return n(i,a,h)})});case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return d("MAWWriteGroupPollCreateTxns").handleIncomingGroupPollCreate(a,b.msg,b.pollInfo,b.thread);case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return d("MAWWriteGroupPollMessageTxns").handleGroupPollUpdate(a,b.msg,b.pollInfo,b.thread);default:throw c("FBLogger")("messenger_web").mustfixThrow("We do not support handleIncomingMsgInternal with type: "+((g=b.type)!=null?g:""))}}function m(a,b,c){return b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED?d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.msg,b.existingMsg,b.thread,null,b.stanzaSource):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?d("MAWWriteMsgTxns").handleOutOfOrderRevokedMessage(a,b.msg,b.thread,b.pendingRevokedStanza,b.pendingRevokedStanza!=null):d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.msg,b.thread,"MAWHandleIncomingMsgApi::writeXmaMsg",c,b.stanzaSource)}function n(a,b,c){return d("WAResultOrError").makeResult({msgType:a==null?void 0:a.type,outOfSyncEphemeralSetting:(a=b)!=null?a:void 0,plaintextHashs:c==null?void 0:c.map(function(a){return a.plaintextHash})})}function o(a,b,e,f,g){var h=b.author;b=b.chat;f===void 0;if(e==null)return d("MAWDexieTable").dexieResolve();if(e==null)return d("MAWDexieTable").dexieResolve();f=d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,b,e);e=h===d("WAJids").AUTHOR_ME&&g!=null&&g.type!==d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,b,g):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([f,e]).then(function(){c("MAWHIMLogger").LOG(i())})}function p(a,b,e){e===void 0&&(e=!0);b.associatedMsg.externalId===b.msg.externalId&&c("FBLogger")("messenger_web").mustfix("[handleIncomingXMAWithAssociatedData] associatedMsg and msg have the same externalId, platform %s",d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(b.msg.externalId));var f=b.existingAssociatedMsg,g;f!=null?f.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?g=d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.associatedMsg,f,b.thread,null,b.stanzaSource):g=d("MAWDexieTable").dexieResolve(f):g=d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.associatedMsg,b.thread,"MAWHandleIncomingMsgApi::handleIncomingXMAWithAssociatedData",e,b.stanzaSource);return g.then(function(c){return c.type===d("MAWMsgType").MSG_TYPE.REVOKED?d("MAWDexieTable").dexieResolve({dbAssociatedMsg:null,dbMedias:null,dbMsg:null}):m(a,b,e).then(function(e){if(b.associatedMedia!=null)return d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b.associatedMedia,c,b.stanzaSource).then(function(d){return q(a,e,c,b.xma,b.msg,b.associatedMsg,b.thread.jid,b.stanzaSource,d)});else return q(a,e,c,b.xma,b.msg,b.associatedMsg,b.thread.jid,b.stanzaSource)})})}function q(a,b,e,f,g,i,j,k,l){return d("MAWWriteXMAMessageTxns").handleIncomingXMA(a,b,f,k,e.msgId).then(function(f){var k=f.dbMedias;f=f.dbXMA;e==null&&c("MAWHIMLogger").ERROR(h(),i.externalId);return(e!=null&&f!=null&&d("MAWXMAUtils").isXMAStoryReply(f.targetType)?d("MAWWriteXMAMessageTxns").handleXMAReplyMsg(a,g,f,j,e,g.isExpiredXmaMsg===!0,l,k):d("MAWDexieTable").dexieResolve()).then(function(){return l!=null?{dbAssociatedMsg:e,dbMedias:k!=null?[].concat(k,[l]):[l],dbMsg:b}:{dbAssociatedMsg:e,dbMedias:k,dbMsg:b}})})}function r(a,b,c){var e;if(b.type!==d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE)return d("MAWDexieTable").dexieResolve(!1);e=(e=b.quote)==null?void 0:(e=e.content)==null?void 0:e.externalId;var f=(b=b.quote)==null?void 0:b.content.author;if(e==null||f==null)return d("MAWDexieTable").dexieResolve(!1);b=d("MAWJidUtils").maybeToProtocolMsgId(f,c,e);return d("MAWDexieTable").dexieAll([a.deletedMessages.get(babelHelpers["extends"]({},b)),a.unrenderedMessages.get({externalId:e}),d("MAWDbPendingStanzaTxns").maybeGetPendingRevokedStanza(a,e,f,c),d("MAWDbPendingStanzaTxns").maybeGetPendingDeletedStanza(a,e,f,c)]).then(function(a){var b=a[0],d=a[1],e=a[2];a=a[3];d=d!=null&&d.author===f&&d.threadJid===c;return b!=null||d||e!=null||a!=null})}g.handleIncomingMsg=a;g.processReceipts=o}),98);
__d("MAWLinkReactionsToMsgsTxns",["MAWDbMsgTxns","MAWDbReactionUtils","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.reduce(function(a,b){var c,d={author:b.reactToAuthor,chat:b.threadJid,externalId:b.reactToExternalId};c=(c=a.get(d))!=null?c:[];c.push(b);return a.set(d,c)},new(d("WAMsgMap").MsgMap)())}function i(a){a.forEach(function(a){d("MAWDbReactionUtils").dispatchReaction(a)})}function j(a,b){return a.reactions.where("reactToExternalId").anyOf(b).toArray().then(function(a){return h(a.filter(function(a){return a.reactToMsgId==null}))})}function a(a,b){return j(a,b).then(function(b){return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b.keys()).then(function(a){return a.flatMap(function(a){var c={author:a.author,chat:a.threadJid,externalId:a.externalId};c=(c=b.get(c))!=null?c:[];return c.map(function(b){b.reactToMsgId=a.msgId;return b})})})})}function b(a,b){return a.reactions.bulkPut(b).then(function(){i(b)})}g.getReactionLinkUpdatesForExternalIds=a;g.updateReactionLinks=b}),98);
__d("MAWOfflineThreadTxns",["I64","MAWBridgeThread","MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThread","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWThreadMappingQPL","MAWUserJidWrapper","MAWWriteBulkWriteIncomingAdminMsgTxns","WAArrayZip","WAJids","WATagsLogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Duplicated thread creation for ",""]);i=function(){return a};return a}var j=new Set();function a(a,b,c){var e=[],f=new Set(b),g=new Map(),h=new Map();c.forEach(function(a){h.set(a.jid,"exists"),g.set(a.jid,a),f["delete"](a.jid),e.push(a)});f.forEach(function(a){j.has(a)&&d("WATagsLogger").TAGS(["occamadillo","incoming_processing"]).LOG(i(),a)});return o(a,f).then(function(b){b.oneToOneThreadsCreationData.forEach(function(a){j.add(a.thread.jid)});b.groupThreadsCreationData.forEach(function(a,b){j.add(b),a.groupInfo==null&&h.set(b,"missing")});return a.threads.bulkAdd(p(b),{allKeys:!0}).then(function(b){return d("MAWDbThreadTxns").getThreads(a,Array.from(f.values())).then(function(b){e.push.apply(e,b);m(e);var c=q(b);return d("MAWDexieTable").dexieAll([k(a,c),d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,b)]).then(function(){b.forEach(function(a){return g.set(a.jid,a)});return{threadCreationResult:h,threads:g}})})})})}function k(a,b){return d("MAWDexieTable").dexieAll([l(a,b),d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities(Array.from(b.values()).map(function(a){return a.jid}))])}function l(a,b){var e=[],f=d("MAWUserJidWrapper").getMyUserJid();b.forEach(function(a,b){e.push({threadJid:b,type:"participant",userJid:b}),f!==b&&e.push({threadJid:b,type:"participant",userJid:f})});return d("MAWDbParticipantTxns").bulkAddParticipantsInThreads(a,e).then(c("emptyFunction"))}function m(a){a.forEach(function(a){var b=d("MAWThreadMappingQPL").getInstanceKeyForJidInWorker(a.jid);d("MAWThreadMappingQPL").startInWorker({instanceKey:b,jid:a.jid,threadKey:a.optimisticThreadKey==null?void 0:(h||(h=d("I64"))).of_string(a.optimisticThreadKey),trigger:"createAllThreadsForOfflineMsgs"});d("MAWThreadMappingQPL").addPoint("verify_optimistic_maw_thread",b);d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,a.optimisticThreadKey,void 0,"createAllThreadsForOfflineMsgs",null,b)})})}function n(a,b){return{folder:null,jid:a,lastReadMsg:null,lastReadMsgReceiptSent:null,lastReadMsgTs:null,newestMsgTs:b!=null?d("WATimeUtils").castUnixTimeToMillisTime(b):null,oldestMsg:null,optimisticThreadKey:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(d("WATimeUtils").millisTime(),a)}}function o(a,b){var c=[],e=[];b.forEach(function(a){d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return c.push(a)},user:function(a){return e.push(a)}})});return d("MAWDbGroupInfoTxns").getGroupInfos(a,c).then(function(a){var b=new Map(d("WAArrayZip").zip(c,a));a=new Map(c.map(function(a){var c=b.get(a);return[a,{groupInfo:c,thread:n(a,c==null?void 0:c.creationTs)}]}));var f=new Map(e.map(function(a){return[a,{thread:n(a,null)}]}));return{groupThreadsCreationData:a,oneToOneThreadsCreationData:f}})}function p(a){var b=a.groupThreadsCreationData;a=a.oneToOneThreadsCreationData;return Array.from(b.values()).map(function(a){a=a.thread;return a}).concat(Array.from(a.values()).map(function(a){a=a.thread;return a}))}function q(a){var b=new Map();a.forEach(function(a){d("WAJids").switchOnMsgrChatJidType(a.jid,{group:c("emptyFunction"),user:function(c){return b.set(c,a)}})});return b}g.createAllThreadsForOfflineMsgs=a}),98);
__d("MAWPreprocessMsgs",["FBLogger","LSMEBTaskCreationSource","MAWBuildIncomingMsgs","MAWDbMsgTxns","MAWDexieTable","MAWHIMLogger","MAWMediaGalleryEBTaggingUtils","MAWMediaManagementTxns","MAWMsgActionType","MAWMsgType","MAWWriteMsgTxns","MAWWriteXMAMessageTxns","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported message type on preprocessing ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media is null for StanzaID ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Preparing media for msg with StanzaID ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpected msg type when writing ephemeral setting message. Should not happen"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["No unstored content for incoming message: SHOULD NEVER HAPPEN"]);l=function(){return a};return a}var m=c("MAWHIMLogger").TAGS(["MAWPreprocessMsgs"]);function a(a){var b=[],c=[];a.forEach(function(a){var d=a.msgData;a=a.unstoredContent;switch(d.type){case"IncomingMsg":if(a==null){m.ERROR(l());return}var e=a.unstoredDbEditActionMsg;a=a.unstoredDbReaction;if(a!=null){a={chatJid:d.id.chat,unstoredReaction:a};b.push(a)}e!=null&&c.push({chatJid:d.id.chat,msg:e});break;case"IncomingCiphertextMsg":default:break}});return{editActionMsgs:c,reactionMsgs:b}}function b(a,b,c,d){b.receiveFlow.addPoint("him_get_preprocessing_data_start");return n(a,b,c,d).then(function(a){var c;b.receiveFlow.addPoint("him_get_preprocessing_data_end",{string:{action:a.action,type:(c=a.type)!=null?c:""}});return a})}function n(a,b,e,f){var g=b.msgData,l=b.receiveFlow,n=b.stanzaSource,p=b.unstoredContent;b=g.folder;var q=g.id,r=g.ts,s={id:q,receiveFlow:l,stanzaSource:n,thread:e,ts:r},t=d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.NO_ACTION,msg:null,type:null}));switch(g.type){case"IncomingMsg":if(p==null)return t;var u=p.unstoredDbGroupPollCreateInfo;l=p.unstoredDbGroupPollUpdateInfo;var v=p.unstoredDbMsg,w=p.unstoredDbRavenActionMsg,x=p.unstoredDbReaction,y=p.unstoredDbReceiverFetchInfo,z=p.unstoredIncomingDbGroupInvite;if(w!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:w,type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION}));else if(x!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:x,type:d("MAWMsgType").MSG_TYPE.REACTION}));else if(z!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,folder:b,msg:z,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE}));else if(v==null)return t;else if(v.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN){w=g.msg;if(w.version==="v3"&&w.type==="ephemeral")return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:w,type:v.type}));else{m.ERROR(k());return t}}else if(v.type===d("MAWMsgType").MSG_TYPE.TEXT||v.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF)return d("MAWWriteMsgTxns").prepareTextMsgWriteData(a,v,e).then(function(a){var b=a.editMsgHistories,c=a.existingEditMsgHistory,e=a.existingMsg,f=a.isDeletedWithThread,g=a.isDeleteForMeOrRevoked,h=a.pendingDeleteForMeStanza;a=a.pendingRevokedStanza;var i=o(e,v,c);if(g||f||e!=null&&i!==!0)return t;if(i&&e!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,existingEditMsgHistory:c,existingMsg:e,msg:v,type:v.type});if(h!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:v,pendingDeleteForMeStanza:h,type:v.type});return a!=null?babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,msg:v,pendingRevokedStanza:a,type:v.type}):babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,editMsgHistories:b,msg:n==="ebrestore"?babelHelpers["extends"]({},v,{source:"eb_restore"}):v,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.IMAGE||v.type===d("MAWMsgType").MSG_TYPE.VIDEO||v.type===d("MAWMsgType").MSG_TYPE.PTT||v.type===d("MAWMsgType").MSG_TYPE.GIF||v.type===d("MAWMsgType").MSG_TYPE.STICKER||v.type===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE||v.type===d("MAWMsgType").MSG_TYPE.RAVEN){v.type===d("MAWMsgType").MSG_TYPE.IMAGE&&((x=g.msg.metadata)==null?void 0:x.groupId)!=null&&(v.groupId=g.msg.metadata.groupId,v.groupIndex=g.msg.metadata.groupIndex,v.groupSize=g.msg.metadata.groupSize);v.type===d("MAWMsgType").MSG_TYPE.IMAGE&&(p==null?void 0:(b=p.unstoredDbMedia)==null?void 0:(z=b.validatedImageInfo)==null?void 0:z.hdType)!=null&&(v.hdType=p==null?void 0:p.unstoredDbMedia.validatedImageInfo.hdType);m.LOG(j(),v.externalId);return d("MAWMediaManagementTxns").prepareMediaWriteData(a,v,p==null?void 0:p.unstoredDbMedia,e).then(function(a){var b=a.existingMsg,e=a.isDeletedWithThread,g=a.isDeleteForMeOrRevoked,h=a.pendingDeleteForMeStanza,j=a.pendingRevokedStanza;a=a.shouldDropDocument;var k=[p==null?void 0:p.unstoredDbMedia,o(b,v)],l=k[0];k=k[1];l==null&&m.LOG(i(),v.externalId);if(n==="ebrestore"&&b!=null&&l!=null&&b.source==="media_restore"&&(!d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryEBTaggingRestoreEnabled()||f!==c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE)){var q=!d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryEBTaggingRestoreEnabled()&&f===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?"media_restore":"eb_restore";return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,existingMsg:b,media:l,msg:babelHelpers["extends"]({},v,{source:q}),type:v.type})}if(a===!0||g||e||l==null||b!=null&&!k)return t;if(k&&b!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,existingMsg:b,media:l,msg:v,type:v.type});if(h!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:v,pendingDeleteForMeStanza:h,type:v.type});return j!=null?babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,msg:v,pendingRevokedStanza:j,type:v.type}):babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,media:l,msg:n==="ebrestore"?babelHelpers["extends"]({},v,{source:f===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?"media_restore":"eb_restore"}):v,type:v.type})})}else if(v.type===d("MAWMsgType").MSG_TYPE.XMA){var A=p==null?void 0:p.unstoredXMA;return A==null?t:d("MAWWriteXMAMessageTxns").prepareXMAWriteData(a,v,A,e).then(function(a){var b=a.xmaData.existingMsg,e=o(b,v),f=n==="ebrestore"?babelHelpers["extends"]({},a.xmaMsg,{source:"eb_restore"}):a.xmaMsg;if(a.associatedMsg!=null&&a.associatedData!=null&&!a.associatedData.isDeletedWithThread&&!a.associatedData.isDeleteForMeOrRevoked){var g,h=a.associatedMsg,i=a.associatedData.existingMsg;if(e&&b!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED,associatedMsg:h,existingAssociatedMsg:i,existingMsg:b,msg:f,type:v.type,xma:A});if(b!=null&&a.associatedData.existingMsg!=null)return t;if([b,(g=a.associatedData)==null?void 0:g.existingMsg].filter(function(a){return a==null}).length===1){c("FBLogger")("messenger_web").mustfix("[duplicate msgs] XMA and associated inconsistency: existing message not found for %s, xmaMessageType: %s, authorMe: %s, xma data: existingMsgType: %s, isDeletedWithThread: %s, isDeleteForMeOrRevoked: %s, hasPendingDeleteForMeStanza: %s, hasPendingRevokedStanza: %s, associated data: existingMsgType: %s, isDeletedWithThread: %s, isDeleteForMeOrRevoked: %s, hasPendingDeleteForMeStanza: %s, hasPendingRevokedStanza: %s",b==null?"XMA":"Associated",f==null?void 0:f.xmaMessageType,d("WAJids").isAuthorMe(f==null?void 0:f.author),b==null?void 0:b.type,(g=a.xmaData)==null?void 0:g.isDeletedWithThread,(g=a.xmaData)==null?void 0:g.isDeleteForMeOrRevoked,((g=a.xmaData)==null?void 0:g.pendingDeleteForMeStanza)!=null,((g=a.xmaData)==null?void 0:g.pendingRevokedStanza)!=null,i==null?void 0:i.type,(g=a.associatedData)==null?void 0:g.isDeletedWithThread,(g=a.associatedData)==null?void 0:g.isDeleteForMeOrRevoked,((g=a.associatedData)==null?void 0:g.pendingDeleteForMeStanza)!=null,((g=a.associatedData)==null?void 0:g.pendingRevokedStanza)!=null)}return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED,associatedMedia:a.associatedMedia,associatedMsg:h,existingAssociatedMsg:i,msg:f,type:v.type,xma:A})}if(e&&b!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,existingMsg:b,msg:f,type:v.type,xma:A});g=a.xmaData;h=g.isDeletedWithThread;i=g.isDeleteForMeOrRevoked;e=g.pendingDeleteForMeStanza;g=g.pendingRevokedStanza;if(h||i||b!=null)return t;if(e!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:a.xmaMsg,pendingDeleteForMeStanza:e,type:v.type});return g!=null?babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,msg:a.xmaMsg,pendingRevokedStanza:g,type:v.type}):babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:f,type:v.type,xma:A})})}else if(v.type===d("MAWMsgType").MSG_TYPE.REVOKED)return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,v.revokedExternalId,e.jid,q.author),d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,v.externalId,e.jid,q.author)]).then(function(a){var b=a[0];a=a[1];return a!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,ebTimestampMs:v.ebTimestampMs,msg:v,originalMsg:b,previousRevokeMsg:a,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION){w=d("WAJids").isAuthorMe(q.author)?d("WAGlobals").getMyUserJid():q.author;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,q.externalId,e.jid,w)]).then(function(a){a=a[0];return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,existingMsg:a,screenshotActionType:v.msgContent.screenshotActionType,type:v.type})})}else if(v.type===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE)return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,q.externalId,e.jid,q.author).then(function(a){return a!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:v,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH&&y!=null)return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,q.externalId,e.jid,q.author).then(function(a){return a!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:v,receiverFetchInfo:y,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE)return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,q.externalId,e.jid,q.author).then(function(a){return a!=null||u==null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:v,pollInfo:u,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE)return l==null||l.decrypted===void 0?t:d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:v,pollInfo:l,type:v.type}));else{m.ERROR(h(),v.type);return t}case"IncomingCiphertextMsg":if(!((x=g==null?void 0:g.createPlaceholder)!=null?x:!1))return t;var B=d("MAWBuildIncomingMsgs").buildUnstoredCiphertextMsg(q,r);return d("MAWWriteMsgTxns").prepareMsgWriteData(a,B,e).then(function(a){var b=a.existingMsg,c=a.isDeletedWithThread;a=a.isDeleteForMeOrRevoked;return a||c||b!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:B,type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT})});case"UnavailableMsg":case"FrankingInvalidMsg":var C=d("MAWBuildIncomingMsgs").buildUnstoredUnavailableMsg(q,r);return d("MAWWriteMsgTxns").prepareMsgWriteData(a,C,e).then(function(a){var b=a.existingMsg,c=a.isDeletedWithThread;a=a.isDeleteForMeOrRevoked;return a||c||b!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:C,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE})})}}function o(a,b,c){if(a==null&&c==null)return!1;return b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?!1:(a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.CIPHERTEXT||(c==null?void 0:c.msgContent.content)===""}g.classifyIncomingMsgs=a;g.getMessageDataByType=b;g.isCiphertextUpdate=o}),98);
__d("MAWBulkHandleIncomingMsgApi",["LSMEBTaskCreationSource","MAWBulkEditMsgsTxns","MAWBulkWriteReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWHIMLogger","MAWHandleIncomingMsgApi","MAWIndexedDb","MAWLinkReactionsToMsgsTxns","MAWMsgActionType","MAWMsgType","MAWODSProxy","MAWOfflineThreadTxns","MAWPreprocessMsgs","MAWReceiverBumpEligibilityCache","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWThreadFetchAndEmitTxns","MAWTransactionMode","WAMsgMap","WAOdsEnums","WAResultOrError","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Should never have 'write' and 'delete' in same OQ batch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Should never have 'update ciphertext' and 'delete' in same OQ batch"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling message with StanzaID ",", action "," and type ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling "," messages"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot create thread for message. Reason: ",". StanzaID ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot create thread for message. Reason: ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Previous message processing action failed so subsequent one can't succeed"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["ERROR!!! At this point we must have fields in the map, ",""]);o=function(){return a};return a}function a(a,b){var e;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,deletedMessages:e.READWRITE,deviceChangeAlerts:e.READWRITE,editMsgHistory:e.READWRITE,ephemeralSettings:e.READWRITE,ftsBackloggedMessages:e.READWRITE,ftsPurgeBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,mediaBackup:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingReceipts:e.READWRITE,pendingStanzas:e.READWRITE,poll:e.READWRITE,reactions:e.READWRITE,receiverFetchInfo:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"bulkHandleIncomingMsgs",function(e){return function(){var f=new(d("WAMsgMap").MsgMap)();d("MAWODSProxy").odsBumpEntityKey({amount:a.length,entity:d("WAOdsEnums").Entity.TOTAL_INCOMING_MESSAGE,key:"msgs"});d("MAWDexieTable").setDexiePSDItem("offlineQueueSize",a.length);d("MAWReceiverBumpEligibilityCache").updateReceiverBumpEligibilityCache(a);var g=new Set(a.map(function(a){a=a.msgData;return a.id.chat})),h=d("MAWPreprocessMsgs").classifyIncomingMsgs(a),i=h.editActionMsgs,j=h.reactionMsgs,k=function(a,b){var e=f.get(a);!b.success?f.set(a,b):e==null?c("MAWHIMLogger").ERROR(o(),b):!e.success?c("MAWHIMLogger").WARN(n()):f.set(a,d("WAResultOrError").makeResult(babelHelpers["extends"]({},e.value,b.value)))},r=function(a,b){f.set(a,d("WAResultOrError").makeResult({protocolMsgId:a,unknownGroup:b==="missing"}))},u=function(f){var g=f.threadCreationResult,h=f.threads;return d("MAWDexieTable").dexieAll(a.map(function(a){var f,i=h.get(a.msgData.id.chat);f=(f=g.get(a.msgData.id.chat))!=null?f:"missing";if(i==null){c("MAWHIMLogger").ERROR(m(),f);c("MAWHIMLogger").WARN(l(),f,a.msgData.id.externalId);return}r(a.msgData.id,f);return d("MAWPreprocessMsgs").getMessageDataByType(e,a,i,b)}).filter(Boolean))["catch"](function(a){a.message="[getAllMessagesProcessingData] "+a.message;throw a})},v=b!==c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE,w=function(a){a=s(a);var b=d("MAWDexieTable").dexieResolve();a.forEach(function(a){b=b.then(function(){return d("MAWHandleIncomingMsgApi").handleIncomingMsg(e,a,v)}).then(function(b){k(a.id,b),q(a.id,a.ts)})});b["catch"](function(a){a.message="[writeIncomingMsgs] "+a.message;throw a});return b},x=function(){return i.length===0?d("MAWDexieTable").dexieResolve():d("MAWBulkEditMsgsTxns").prepareDataForMessageEdit(e,i).then(function(a){return d("MAWBulkEditMsgsTxns").bulkEditMsgs(e,i,a)})};h=function(){return p(e,g).then(function(a){return d("MAWDexieTable").dexieAll([u(a),d("MAWBulkWriteReactionsTxns").prepareReactionsData(e,j)]).then(function(a){var b=a[0];a=a[1];return d("MAWBulkWriteReactionsTxns").bulkWriteReactions(e,a).then(function(){return w(b)}).then(function(){return x()}).then(function(){return d("MAWThreadFetchAndEmitTxns").emitThreadContents(e,g)}).then(function(){return t(e,f)}).then(function(){return{msgResults:f}})})})};var y=function(){return p(e,g).then(function(a){return d("MAWDexieTable").dexieAll([u(a),d("MAWBulkWriteReactionsTxns").prepareReactionsData(e,j)])}).then(function(a){var b=a[0];a=a[1];return d("MAWDexieTable").dexieAll([w(b).then(x),d("MAWBulkWriteReactionsTxns").bulkWriteReactions(e,a)])}).then(function(){return d("MAWDexieTable").dexieAll([t(e,f),d("MAWThreadFetchAndEmitTxns").emitThreadContents(e,g)])}).then(function(){return{msgResults:f}})},z=c("qex")._("3654");return z===!0?y():h()}})()}function p(a,b){var c=Array.from(b);return d("MAWDbThreadTxns").getThreads(a,c).then(function(b){return d("MAWOfflineThreadTxns").createAllThreadsForOfflineMsgs(a,c,b)})}function q(a,b){var c;a=a.chat.toString();d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.updateChatState((c={},c[a]=b,c));d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.addMAWEntity(1);(a=d("MAWSharedOfflineQueueMetric").getOfflineQueueMetric())==null?void 0:a.addMAWEntity(1)}var r=c("MAWHIMLogger").TAGS(["MergeActions"]);function s(a){r.LOG(k(),a.length);var b=new(d("WAMsgMap").MsgMap)();for(var c of a){r.LOG(j(),c.id.externalId,c.action,c.type);c.receiveFlow.addPoint("him_merge_actions");var e=b.get(c.id);if(e==null){b.set(c.id,c);continue}if(e.action===c.action&&e.type===c.type){c.receiveFlow.addAnnotations({bool:{merge_actions_duplicate:!0}});continue}switch(c.action){case d("MAWMsgActionType").MSG_ACTION.NO_ACTION:continue;case d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT:case d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED:if(e.action===d("MAWMsgActionType").MSG_ACTION.REVOKE||e.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME){r.ERROR(i());continue}b.set(c.id,c);continue;case d("MAWMsgActionType").MSG_ACTION.WRITE:case d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED:if(e.action===d("MAWMsgActionType").MSG_ACTION.REVOKE||e.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME){r.ERROR(h());continue}switch(c.type){case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:break;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:e.type===d("MAWMsgType").MSG_TYPE.UNAVAILABLE&&b.set(c.id,c);break;default:b.set(c.id,c)}break;case d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME:case d("MAWMsgActionType").MSG_ACTION.REVOKE:e.action!==d("MAWMsgActionType").MSG_ACTION.REVOKE&&b.set(c.id,c);break}}e=[];for(c of a){var f;a=b.get(c.id);c.receiveFlow.addAnnotations({string:{final_action:(f=a==null?void 0:a.action)!=null?f:"undefined",final_msg_type:(f=a==null?void 0:a.type)!=null?f:"undefined",has_replaced_action:(c!==a).toString(),initial_action:c.action,initial_msg_type:c.type}});if(a==null||a.action===d("MAWMsgActionType").MSG_ACTION.NO_ACTION)continue;e.push(a);b["delete"](c.id)}return e}function t(a,b){var c=new Set();b.values().forEach(function(a){if(a.success){a=a.value;var b=a.protocolMsgId;a=a.reactToExternalId;a!=null?c.add(a):b!=null&&c.add(b.externalId)}});return d("MAWLinkReactionsToMsgsTxns").getReactionLinkUpdatesForExternalIds(a,Array.from(c)).then(function(b){return d("MAWLinkReactionsToMsgsTxns").updateReactionLinks(a,b)})}g.bulkHandleIncomingMsgs=a;g.linkMsgsToReactions=t}),98);
__d("MAWCommonScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("msgr-common",{concurrency:1,maxConcurrency:10,maxThrottleMs:5e3}));return h}g.mawCommonScheduler=a}),98);
__d("MAWMessageDropError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.name="MAWMessageDropError";c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.MAWMessageDropError=a}),66);
__d("MAWMessageParseError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.name="MAWMessageParseError";c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.MAWMessageParseError=a}),66);
__d("MAWParseBumpExistingMessageMsg",["FBLogger","WAMessageKey","WAParseConsumerMessageProtocol","WAParseProtocolUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chat,e=a.content,f=a.meta;a=a.metadata;e=e.bumpExistingMessage;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("bumpExistingMessage has no content");e=e.key;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("bumpExistingMessage has no message key");var g=d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(f.id.author);g=d("WAMessageKey").extractProtocolMessageId(b,g,e);e=g.author;g=g.externalId;a=d("WAParseProtocolUtils").parseEphemerality(f,a);var h=a.deleteTs,i=a.ephemeralSetting;a=a.expirationTs;h={ack:f.ack,deleteTs:h,ephemeralSetting:i,expirationTs:a,id:{author:f.id.author,chat:f.id.chat,externalId:f.id.externalId},quote:{content:{author:e,externalId:g,ts:null,type:"Unavailable"},remoteJid:b},reportingMeta:f.reportingMeta,sentTs:f.sentTs,serverTs:f.serverTs,ts:f.serverTs,type:"BumpExistingMessage"};return{contentTypeForLogging:"bumpExistingMessage",unstoredMedia:null,unstoredMsg:h,unstoredQuotedMedia:null,unstoredXMA:null}}g["default"]=a}),98);
__d("MAWParseNetworkVerificationMsg",["MAWMessageDropError","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Web does not support network verification code"]);h=function(){return a};return a}function a(a){d("WALogger").EXPECTED_ERROR(h());throw new(d("MAWMessageDropError").MAWMessageDropError)("Web does not support network verification")}g.parseNetworkVerificationMsg=a}),98);
__d("MAWParseNoteReplyMsg",["FBLogger","MAWJids","MAWMsgType","WAGlobals","WAJids","WALongInt","WAMediaTransport.pb","WAMsgType","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAParseReadOnlyMetadataDataclassToUnsafeObject","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=a.content,f=a.ebTimestampMs,g=a.meta;a=a.metadata;e=e.noteReplyMessage;if(h(a))return"noteMention";if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage has no content");b=(b=e.noteText)==null?void 0:b.text;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage has no note text");var i=e.noteTimestampMs!=null?d("WATimeUtils").castMilliSecondsToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(e.noteTimestampMs)):void 0,j=d("MAWJids").toUserJid(g.id.author),k=d("MAWJids").toUserJid(g.id.chat);j=k===j?d("WAJids").AUTHOR_ME:k;k=d("WAParseProtocolUtils").parseEphemerality(g,a);a=k.deleteTs;var l=k.ephemeralSetting;k=k.expirationTs;a={ack:g.ack,deleteTs:a,ebTimestampMs:f,ephemeralSetting:l,expirationTs:k,forwardingScore:g.forwardingScore,id:{author:g.id.author,chat:g.id.chat,externalId:g.id.externalId},quote:{content:{author:j,expirationTs:i,externalId:g.id.externalId,msgContent:{content:b},ts:g.serverTs,type:d("WAMsgType").NOTE_REPLY},remoteJid:g.id.chat},ts:g.serverTs};var m,n;l=(f=e.textContent)==null?void 0:f.text;k=e.stickerContent;j=e.videoContent;if(l!=null){i=babelHelpers["extends"]({msgContent:{content:l},type:d("MAWMsgType").MSG_TYPE.TEXT},a);b=i}else if(k!=null){f=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,k==null?void 0:k.payload);m=d("WAParseMediaTransportProtocol").parseStickerMsg(f,g.ts);if(m){e=babelHelpers["extends"]({mediaId:m.plaintextHash,type:d("MAWMsgType").MSG_TYPE.STICKER},a);b=e}else{if(((l=f.integral)==null?void 0:l.receiverFetchId)!=null)if(d("WAGlobals").getConfig().isStickerReceiverFetchEnabled()){n=d("WAParseMediaTransportProtocol").parseStickerReceiverFetchInfo(f);if(n==null)throw c("FBLogger")("messenger_web").mustfixThrow("consumerMessage has no sticker receiver fetch info");i=babelHelpers["extends"]({type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH},a);b=i}else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage sticker receiver fetch is not enabled");else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage sticker has no media")}}else if(j!=null){k=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,j==null?void 0:j.payload);i=k==null?void 0:(e=k.integral)==null?void 0:(l=e.transport)==null?void 0:(f=l.ancillary)==null?void 0:f.mimetype;e=(k==null?void 0:(j=k.ancillary)==null?void 0:j.gifPlayback)===!0&&i==="image/gif";m=d("WAParseMediaTransportProtocol").parseVideoMsg(k,g.ts,e);if(m&&e){l=babelHelpers["extends"]({mediaId:m.plaintextHash,type:d("MAWMsgType").MSG_TYPE.GIF},a);b=l}else if(!m)throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage video has no media");else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage video is not a gif")}else throw c("FBLogger")("messenger_web").mustfixThrow("noteReplyMessage has no valid content");return{contentTypeForLogging:"noteReplyMessage",unstoredMedia:m,unstoredMsg:b,unstoredQuotedMedia:null,unstoredReceiverFetchInfo:n,unstoredXMA:null}}function h(a){a=c("WAParseReadOnlyMetadataDataclassToUnsafeObject")(a);return(a==null?void 0:(a=a.note_metadata)==null?void 0:a.message_type)==="MENTION"}g["default"]=a}),98);
__d("MAWParseRavenActionNotificationMsg",["FBLogger","MAWMsg","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e,f=a.content;a=a.meta;b=(b=f.ravenActionNotifMessage)==null?void 0:b.actionType;b=d("MAWMsg").MAWRavenActionNotifType.cast(b);e=(e=f.ravenActionNotifMessage)==null?void 0:e.actionTimestamp;var g;if(e!=null){e=Number(e);e>d("WATimeUtils").MAX_INT?g=d("WATimeUtils").castMilliSecondsToUnixTime(e):g=d("WATimeUtils").castToUnixTime(e)}e=((e=f.ravenActionNotifMessage)==null?void 0:(e=e.key)==null?void 0:e.id)!=null?d("WAStanzaUtils").toStanzaId((e=f.ravenActionNotifMessage)==null?void 0:(f=e.key)==null?void 0:f.id):null;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when getting actionType for RavenNotificationMessage "+a.id.externalId);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when getting actionTimestamp for RavenNotificationMessage "+a.id.externalId);if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when getting ravenActionToMsgExternalId for RavenNotificationMessage "+a.id.externalId);f={ack:a.ack,actionTimestamp:g,actionType:b,id:a.id,ravenActionToMsgExternalId:e,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.serverTs,type:"RavenAction"};return{unstoredMedia:null,unstoredMsg:f,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenActionNotificationMessage=a}),98);
__d("MAWParseRavenMsg",["FBLogger","MAWMsg","MAWMsgType","MAWParseSubprotocolVersionConsts","WALogger","WAMediaTransport.pb","WAParseMediaTransportProtocol","WAParseProtocolUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n        received video messsage version is older than expected ",". "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n        received image messsage version is older than expected ",". "]);i=function(){return a};return a}function a(a){var b=a.content,e=a.ebTimestampMs,f=a.meta;a=a.metadata;b=b.ravenMessageMsgr;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven message payload has no content");var g=d("MAWMsg").MAWRavenMsgEphemeralType.cast(b.ephemeralType);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error when casting ephemeralType for Raven message");var j=void 0,k=void 0;if(b.imageMessage)(b.imageMessage.version==null||b.imageMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(i(),d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION),j=d("WAParseMediaTransportProtocol").decodeImageTransport(b.imageMessage.payload,f.ts,"image"),k=d("MAWMsg").MAWRavenMsgMediaType.IMAGE;else if(b.videoMessage){(b.videoMessage.version==null||b.videoMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(h(),d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION);b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,b.videoMessage.payload);j=d("WAParseMediaTransportProtocol").parseVideoMsg(b,f.ts,!1);k=d("MAWMsg").MAWRavenMsgMediaType.VIDEO}else throw c("FBLogger")("messenger_web").mustfixThrow("Error unsupported Raven message type");if(j==null)throw c("FBLogger")("messenger_web").mustfixThrow("Error Raven message has no associated image or video");b=d("WAParseProtocolUtils").parseEphemerality(f,a);a=b.deleteTs;var l=b.ephemeralSetting;b=b.expirationTs;a={ack:f.ack,deleteTs:a,ebTimestampMs:e,ephemeralSetting:l,expirationTs:b,id:f.id,mediaId:j.plaintextHash,ravenEphemeralMediaState:g===d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT?d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN,ravenEphemeralType:g,ravenMediaType:k,reportingMeta:f.reportingMeta,sentTs:f.sentTs,serverTs:f.serverTs,ts:f.ts,type:d("MAWMsgType").MSG_TYPE.RAVEN};return{unstoredMedia:j,unstoredMsg:a,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenMessage=a}),98);
__d("MAWParseScreenshotActionMsg",["FBLogger","MAWExternalId","MAWMsgType","WAAckLevel","WAArmadilloApplication.pb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.content;a=a.meta;b=b.screenshotAction;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("screenshotAction has no content");b=b.screenshotType;if(b==null)throw c("FBLogger")("messenger_web").mustfixThrow("Missing screenshot type in payload");if(![d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE,d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING].includes(b))throw c("FBLogger")("messenger_web").mustfixThrow("Received unexpected screenshot action type");b={ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a.id.chat,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:[],adminType:"youEphemeralTakeScreenshot",screenshotActionType:b},ts:a.serverTs,type:d("MAWMsgType").EPHEMERAL_SCREENSHOT_ACTION};return{contentTypeForLogging:"screenshotAction",unstoredMedia:null,unstoredMsg:b,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseEphemeralScreenshotActionProtocol=a}),98);
__d("MAWParseArmadilloProtocol",["FBLogger","MAWMessageParseError","MAWMsgType","MAWParseBumpExistingMessageMsg","MAWParseNetworkVerificationMsg","MAWParseNoteReplyMsg","MAWParseRavenActionNotificationMsg","MAWParseRavenMsg","MAWParseScreenshotActionMsg","MAWParseXMAProtocol","WAArmadilloApplication.pb","WAHex","WALogger","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - Dropping message. contentType: ",", reason: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - handling futureproof message for contentType: ",""]);i=function(){return a};return a}b={unstoredMedia:null,unstoredMsg:null,unstoredQuotedMedia:null,unstoredXMA:null};var j=new Map([["screenshotAction",d("MAWParseScreenshotActionMsg").parseEphemeralScreenshotActionProtocol],["extendedContentMessage",d("MAWParseXMAProtocol").parseXMAProtocol],["noteReplyMessage",c("MAWParseNoteReplyMsg")],["bumpExistingMessage",c("MAWParseBumpExistingMessageMsg")],["ravenMessageMsgr",d("MAWParseRavenMsg").parseRavenMessage],["ravenActionNotifMessage",d("MAWParseRavenActionNotificationMsg").parseRavenActionNotificationMessage],["networkVerificationMessage",d("MAWParseNetworkVerificationMsg").parseNetworkVerificationMsg]]);function a(a,b,c,e,f,g,m){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,b);b=(b=b.payload)==null?void 0:b.content;if(!b)throw new(d("MAWMessageParseError").MAWMessageParseError)("parse_armadillo_protocol_error:: empty_payload_content");var n=l(b);try{var o=j.get(n),p=null;if(o!=null){o=o({chat:a,content:b,ebTimestampMs:m,meta:c,metadata:g,protobuf:e},f);if(typeof o!=="string")return o;else p=o}d("WALogger").LOG(i(),n);return{contentTypeForLogging:n,unstoredMedia:null,unstoredMsg:{ack:c.ack,id:c.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(e),subtype:(a=p)!=null?a:k(n)},reportingMeta:c.reportingMeta,sentTs:c.sentTs,serverTs:c.serverTs,ts:c.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null}}catch(a){d("WALogger").ERROR(h(),n,a);throw new(d("MAWMessageParseError").MAWMessageParseError)("parse_armadillo_protocol_error:: contentType:: "+n+" reason:: "+a)}}function k(a){switch(a){case"bumpExistingMessage":return"bumpMessage";default:return null}}function l(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("FBLogger")("messenger_web").mustfixThrow(JSON.stringify(a)+" armadillo payload content should only have one field");a=b[0];return a}g.EMPTY_CONTENT=b;g.parseArmadilloProtocol=a}),98);
__d("MAWIncomingMsgUtils",["FBLogger","MAWEphemeralUtil","MAWParseArmadilloProtocol","MAWUnstoredContentToUnstoredDbContentUtils","WAParseV3Protocol"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){if(h==null){var b=function(b,c,e,f,g,h){return d("MAWParseArmadilloProtocol").parseArmadilloProtocol(b,c,e,f,a,g,h)};h=d("WAParseV3Protocol").createV3ProtocolParser(new Map([["armadillo",b]]))}return h}function a(a,b){var e=a.author,f=a.chat,g=a.ebTimestampMs,h=a.externalId,j=a.msg,k=a.reportingMeta;a=a.serverTs;if(j.version==="v2")throw c("FBLogger")("messenger_web").mustfixThrow("Armadillo does not support protobuf v2");if(j.type==="ephemeral"){var l=d("MAWEphemeralUtil").buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder(a);k!=null&&l.unstoredDbMsg!=null&&(l.unstoredDbMsg.reportingMeta=k);return l}l=babelHelpers["extends"]({unstoredXMA:null},i(b)(j,f,h,e,a,g));k!=null&&l.unstoredMsg!=null&&(l.unstoredMsg.reportingMeta=k);return d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(l)}g.getDbMsg=a}),98);
__d("MAWProtocolQueueDecodeProto",["MAWIncomingMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){switch(a.type){case"IncomingMsg":var e=a.folder,f=a.id,g=a.msg,h=a.reportingMeta;a=a.ts;var i=f.author,j=f.chat;f=f.externalId;return d("MAWIncomingMsgUtils").getDbMsg({author:i,chat:j,ebTimestampMs:c,externalId:f,folder:e,msg:g,reportingMeta:h,serverTs:a},b);case"InvisibleMsg":case"IncomingCiphertextMsg":default:return}}g.decodeMsg=a}),98);
__d("isUseridAnnotationEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("24163")}g["default"]=a}),98);
__d("MAWUserHash",["MAWCurrentUser","WAGlobals","WAJids","isUseridAnnotationEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MAWCurrentUser").isEmployee()&&c("isUseridAnnotationEnabled")()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null}g.getUserHash=a}),98);
__d("WAServerRPCLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["ServerRPC"]);g.logger=a}),98);
__d("MAWIncomingMsg",["MAWUserHash","WAGetPlatformFromStanzaId","WAHashStringToNumber","WAServerRPCLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAServerRPCLogger").logger.TAGS(["HandleIncomingMsg"]);b=function(a){var b=a.encTypes,c=a.incomingType,e=a.msg,f=a.queueType,g=a.retryCount;a=a.taskSource;var h=e.details;e=e.decrypted;return{"int":{messageAge:d("WATimeUtils").unixTime()-h.ts,msgId:d("WAHashStringToNumber").hashStringToNumber(h.externalId.toString()),offlineDelivery:h.offline,retryCount:g,taskSource:a},string:{e2eePlatform:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(h.externalId),incomingType:c,jid:h.from.chat,msgDecryptedDataType:e.type,msgType:h.type,queueType:f,threadType:h.from.type,userHash:d("MAWUserHash").getUserHash()},string_array:{encTypes:b}}};g.logger=a;g.prepareAnnotationsForIncomingMessage=b}),98);
__d("MAWProtocolQueueUtils",["LSMEBTaskCreationSource","MAWIncomingMsg","MAWMessageReceiveReliabilityLogger","WAGetStorageQplAnnotations","WAHashStringToNumber","WAPREList","WAPREMetrics","WAQPLProxy","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){b===void 0&&(b=d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE);var e=a.stanza,f=d("WAPREMetrics").startMetric(b,d("MAWIncomingMsg").prepareAnnotationsForIncomingMessage({incomingType:e.incomingType,msg:e.message,queueType:e.message.details.offline!=null?"offline":"online",retryCount:e.message.details.retryCount,taskSource:c("LSMEBTaskCreationSource").UNKNOWN}),d("WAHashStringToNumber").hashStringToNumber(e.stanzaId.toString()),d("MAWMessageReceiveReliabilityLogger").RECEIVE_RELIABILITY_TIMEOUT);c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){f.addAnnotations(a)}));f.addPoint("consumer_handle_message_stanza_start");return babelHelpers["extends"]({},a,{receiveFlow:f})}function a(a){return h({decodedMsg:void 0,stanza:a})}function b(a,b){var e=d("WAQPLProxy").waQPLProxyStartResume(a.incomingType==="wa"?c("qpl")._(1056840931,"814"):c("qpl")._(521477947,"2395"),d("WAHashStringToNumber").hashStringToNumber(a.stanzaId));e.addAnnotations(d("MAWIncomingMsg").prepareAnnotationsForIncomingMessage({incomingType:a.incomingType,msg:a.message,queueType:a.message.details.offline!=null?"offline":"online",retryCount:a.message.details.retryCount,taskSource:b}));return e}function e(a,b){c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){b.addAnnotations(a)}));b.addPoint("consumer_handle_message_stanza_start");return babelHelpers["extends"]({},a,{receiveFlow:b})}g.addMetricToMessage=h;g.addMetricToProtocolMessage=a;g.startMetricForIncomingMsgV2=b;g.addAnnotationsToMessage=e}),98);
__d("MAWGetSyncResponseBackoffInfoByJidApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({ephemeralSettings:d("MAWTransactionMode").READONLY},"getSyncResponseBackoffInfoByJid",function(a){return function(b){return a.ephemeralSettings.get({userJid:b}).then(function(a){return a==null?null:a.ephemeralSyncResponseBackoffInfo})}});g.getSyncResponseBackoffInfoByJid=a}),98);
__d("MAWSendEphemeralSettingMsg",["FBLogger","MAWGetSyncResponseBackoffInfoByJidApi","MAWLoggerUtils","MAWMessageSendsCommon","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","WAAPI","WAJids","WAQPLProxy","WAResultOrError","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["send ephemeral setting message: chatJid ",", type ",", externalId ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ephemeral sync response backed off"]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]);function m(a,b,c,d,e,f){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,m){if(a.isForSyncResponse){var n=(yield d("WAJids").switchOnMsgrChatJidType(b,{group:function(){throw c("FBLogger")("messenger_web").mustfixThrow("ChatJid is not supposed to be a group")},user:function(a){return d("MAWGetSyncResponseBackoffInfoByJidApi").getSyncResponseBackoffInfoByJid(a)}}));if(o(f,n)){l.LOG(k());return d("WAResultOrError").makeResult({description:"send not needed",messageType:"fixMe"})}}n=a.isForSyncResponse?d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE;yield c("WAAPI").getDevicesBeforeSend({chatJid:b,reason:"SendEphemeralSettings"});f=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,b,f,a,n,g,m));l.LOG(j(),b,n,e);if(f.type==="already_sent"){l.LOG(i());return d("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"})}else if(f.type==="missing_thread"){l.LOG(h());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}b=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:f.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(g,m),"MAWSendEphemeralSettingMsg"));if(b.success===!1)return d("WAResultOrError").makeError(b.error);else return d("WAResultOrError").makeResult({chatJid:f.protocolMsgId.chat,content:a.content,ephemeralSetting:a.ephemeralSetting,externalId:f.protocolMsgId.externalId,initiatingSource:a.initiatingSource,messageType:"sendMsg",quote:a.quote,source:a.source,specialTextSize:a.specialTextSize,xmaMessageType:a.xmaMessageType})});return n.apply(this,arguments)}function a(a){var b=a.args,c=a.chatJid,e=a.externalId,f=a.qplEventType,g=a.qplInstanceKey;return d("MAWMessageSendsCommon").messageSendObserver(f,g,function(a){return m(b,c,e,a,f,g)},"ephemeral",{author:d("WAJids").AUTHOR_ME,chat:c,externalId:e})}function o(a,b){if(b==null)return!1;var c=b.syncResponseRetries;b=b.syncResponseSentTs;switch(c){case 1:return d("WATimeUtils").happenedWithinAt(a,b,3*60);case 2:return d("WATimeUtils").happenedWithinAt(a,b,15*60);default:return!0}}g.sendEphemeralSettingMsgFn=a}),98);
__d("MAWUpdateThreadListItemFromCOP",["MAWDbMsgTxns","MAWDeletedReactionsCache","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","MAWUpdateThreadListItem","WALogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWUpdateThreadListItemFromCOP] Bump message not found in db"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=p(a);if(a.length===0)return;yield j(a)});return i.apply(this,arguments)}var j=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"updateThreadListItemFromCOP",function(a){return function(b){return k(a,b)}});function k(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.protocolMsgId,e=b.source;b=b.unstoredDbContent;var f=b.unstoredDbEditActionMsg,g=b.unstoredDbMsg;b=b.unstoredDbReaction;if(b!=null)return l(a,b,c,e);if(f!=null)return m(a,f,c,e);return g!=null?g.type===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE?o(a,c,e):n(a,g,c,e):d("MAWDexieTable").dexieResolve()})).then(c("emptyFunction"))}function l(a,b,c,e){return q(a,b,c).then(function(f){if(f)return;if(b.reaction!=null)return d("MAWUpdateThreadListItem").updateThreadListItemFromInsertionTxn(a,b,c.chat,e);f=d("MAWDeletedReactionsCache").DeletedReactionsCache.get(c);d("MAWDeletedReactionsCache").DeletedReactionsCache["delete"](c);if(f!=null)return d("MAWUpdateThreadListItem").updateThreadListItemFromDeletionTxn(a,f,f.threadJid)})}function m(a,b,c,e){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,{author:c.author,chat:c.chat,externalId:b.originalMsgExternalId}).then(function(b){if(b==null)return;return d("MAWUpdateThreadListItem").updateThreadListItemFromInsertionTxn(a,b,c.chat,e,!0)})}function n(a,b,c,e){return d("MAWUpdateThreadListItem").updateThreadListItemFromInsertionTxn(a,b,c.chat,e)}function o(a,b,c){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(e){if(e==null){d("WALogger").ERROR(h());return}d("MAWUpdateThreadListItem").updateThreadListItemFromInsertionTxn(a,e,b.chat,c)})}function p(a){return a.map(function(a){var b=a[0],c=b.decodedMsg;b=b.stanza;a[1];a=a[2];return c==null||a==null||!a.success?null:{protocolMsgId:a.value.protocolMsgId,source:b.incomingType==="ebrestore"?"eb_restore":"incoming_msg",unstoredDbContent:c}}).filter(Boolean)}function q(a,b,c){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,{author:b.reactToAuthor,chat:c.chat,externalId:b.reactToExternalId}).then(function(a){return a==null})}g.maybeUpdateThreadListItemsFromCOPMessagesHandler=a}),98);
__d("WAQueryGroupInvite",["WADeprecatedSendIq","WAPREList","WAPREMetrics","WAQueryGroup","WAResultOrError","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUP,{string:{key:"query_group_invite"}});a=(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.GROUP_JID(a),type:"get",xmlns:"w:g2"},f.wap("query",null,f.wap("add_request",{admin:f.USER_JID(e),code:f.CUSTOM_STRING(b),expiration:f.CUSTOM_STRING(c.toString(10))})));e=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,d("WAQueryGroup").parseQueryGroupResponse));if(!e.success){g.endFail("query_group_for_invitee_fail");return d("WAResultOrError").makeError(e)}g.endSuccess();return d("WAResultOrError").makeResult(e.result.group)});return h.apply(this,arguments)}g.queryGroupInvite=a}),98);
__d("MAWCOPMessagesHandler",["ACTSanitizerApiLazyLoader","EBAPI","FBLogger","IGDInstamadilloUtils","LSMEBTaskCreationSource","LSMessagingThreadAttributionType","MAWBridge","MAWCommonScheduler","MAWDbStaleQueue","MAWDebugMsg","MAWDownloadAndHandleMedia","MAWExternalId","MAWIsQuotaExceededError","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMediaGalleryM2Utils","MAWMessageDropError","MAWMessageParseError","MAWMpsGating","MAWMsgType","MAWODSProxy","MAWProtocolQueueDecodeProto","MAWProtocolQueueMsg","MAWProtocolQueueUtils","MAWQplProxy","MAWSendEphemeralSettingMsg","MAWSharedCOPLogger","MAWUpdateThreadListItemFromCOP","MWEBODSEntityName.enum","MWEBODSUtils","MWSharedS2SBaseAnnotations","Promise","WACreateGroup","WAGlobals","WAHashUtils","WAJids","WAMsgMap","WAOdsEnums","WAProtocolQueue","WAQueryGroup","WAQueryGroupInvite","WAResultOrError","WAStartMediaDownloadQplFlow","WATimeUtils","WorkerScheduler","asyncToGeneratorRuntime","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media: externalId="," - plaintextFollowUp - plaintextHash=",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find db result for message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing messages batch, see transactor error reports."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot prepare msgs to put to EBUploadQueue: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot prepare msgs to put to EBUploadQueue: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decode fails: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot load XMA Validation WASM module: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scheduling job for ",", plaintextHash: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: detected out-of-sync ephemeral setting for ",", sending EPHEMERAL_SYNC_RESPONSE"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["message consumer: ",""]);r=function(){return a};return a}function a(a,b){b===void 0&&(b=c("LSMEBTaskCreationSource").UNKNOWN);return s(a,b)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(r(),a);return[]})}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.length===0)return[];var e=new Set();y(a);var f=(yield A()),g=new(d("WAMsgMap").MsgMap)(),h=c("gkx")("8488"),o=new Map(a.map(function(a){a=z(a);a=d("WAProtocolQueue").mapProcolQueueMessageV2toV1(a);var h=a.incomingType==="ebrestore",i=d("MAWProtocolQueueUtils").startMetricForIncomingMsgV2(a,b);try{if(a.message.decrypted.type==="InstamadilloMsg")if(c("gkx")("3577")){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.IGDW_INSTAMADILLO_MESSAGE_ON_OLD_WORKER,key:"message"});e.add(a.stanzaQueueId);i.endFail("instamadillo_msg_on_old_worker");return null}else{i.endFail("instamadillo_msg_not_supported_on_msgr");throw c("FBLogger")("messenger_web").mustfixThrow("InstamadilloMsg is not supported in MSGR. Should never happen "+d("IGDInstamadilloUtils").getE2EEGatingStateAsString())}var j=d("MAWProtocolQueueDecodeProto").decodeMsg(a.message.decrypted,f,a.ebTimestampMs);g.set(a.message.decrypted.id,a.incomingType);h&&(a.message.details.type=(j==null?void 0:j.unstoredDbReaction)!=null?"reaction":(j==null?void 0:j.unstoredXMA)!=null||(j==null?void 0:j.unstoredDbMedia)!=null?"media":"text");return[a.stanzaQueueId,d("MAWProtocolQueueUtils").addAnnotationsToMessage({decodedMsg:j!=null?j:void 0,stanza:babelHelpers["extends"]({},a)},i)]}catch(b){h=b instanceof Error?b:null;c("MAWSharedCOPLogger").ERROR(n(),b);j=b instanceof d("MAWMessageParseError").MAWMessageParseError?b:null;var k=b instanceof d("MAWMessageDropError").MAWMessageDropError;if(k){e.add(a.stanzaQueueId);i.addPoint("network_verification_msg_dropped");i.endSuccess({string:{isDropped:"true"}});return null}if(j==null){c("promiseDone")(d("MAWDbStaleQueue").mawAddStaleStanza(a,"Decode issue: "+((k=h==null?void 0:h.message)!=null?k:"")))}e.add(a.stanzaQueueId);i.endFail("decoding_error",{string:{errorDescription:(a=(k=j==null?void 0:j.message)!=null?k:h==null?void 0:h.message)!=null?a:"",isDropped:"true"}});return null}}).filter(Boolean)),p=0;if(h&&!d("MAWMpsGating").isFullMpsEnabled())try{d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.call",o.size);var q=Array.from(o.values()).filter(function(a){return a.stanza.incomingType==="wa"});p=q.length;yield c("EBAPI").uploadReceivedMessagesProtobufOnly({uploadArray:q})}catch(a){c("MAWSharedCOPLogger").ERROR(m(),a)}var r=(yield d("MAWProtocolQueueMsg").handleIncomingMessagesStanzas(Array.from(o.values()),b));r.toAck.forEach(function(a){return e.add(a)});q=a.map(function(a){var b=o.get(a.stanzaQueueId);if(b==null)return null;b=b;var c=r.followUpParams.incomingMsgResults.get(b.stanza.message.decrypted.id);return[b,e.has(a.stanzaQueueId),c]}).filter(Boolean);if(!h&&!d("MAWMpsGating").isFullMpsEnabled())try{d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.call",o.size),yield c("EBAPI").uploadReceivedMessages({incomingMessages:Array.from(o.values()).filter(function(a){return a.stanza.incomingType==="wa"}),msgResults:r.followUpParams.incomingMsgResults})}catch(a){c("MAWSharedCOPLogger").ERROR(l(),a)}e.size!==a.length&&c("MAWSharedCOPLogger").WARN(k());var s=new Map(),t=new Set();q.forEach(function(a){var e=a[0],f=a[1];a=a[2];e.receiveFlow.addPoint("consumer_handle_message_stanza_end",{bool:{dbSuccess:!!(a==null?void 0:a.success)}});if(f){e.receiveFlow.addPoint("ack_received");var h=e.stanza.message.decrypted.type;h==="UnavailableMsg"||h==="IncomingCiphertextMsg"?e.receiveFlow.endFail(h):(e.stanza.message.details.type==="media"&&e.receiveFlow.addPoint("message_with_media"),e.receiveFlow.endSuccess())}if(!a&&!f){c("MAWSharedCOPLogger").ERROR(j());e.receiveFlow.endFail("db_result_not_found");return}if(!a)return;if(a.success===!1){h=a.error;switch(h.type){case"group_invite":e.receiveFlow.endFail("end_with_db_error_group_invite");s.set(h.groupJid,{folder:h.folder,inviteCode:h.inviteCode,inviteExpireTs:h.inviteExpireTs,inviterJid:h.inviterJid});e.receiveFlow.endFail("need_group_invite");break;case"invalid_args":e.receiveFlow.endFail("invlid_args");break;default:e.receiveFlow.endFail(h.type);break}return}a.success;if(a.value!=null){f=a.value;var k=f.msgType;h=f.outOfSyncEphemeralSetting;a=f.plaintextHashs;var l=f.protocolMsgId;f=f.unknownGroup;if(f){f=d("WAJids").interpretAsGroupJid(l.chat);f!=null&&t.add(f)}u(h,l);f=!(b===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE&&d("MAWMediaGalleryM2Utils").shouldSkipSyncToLSDB());f&&(a==null?void 0:a.forEach(function(a){c("MAWSharedCOPLogger").LOG(i(),e.stanza.message.details.externalId,d("WAHashUtils").sanitisePlaintextHash(a));v({msgType:k,plaintextHash:a,protocolMsgId:l,source:(a=g.get(l))!=null?a:"wa"})}))}});yield d("MAWUpdateThreadListItemFromCOP").maybeUpdateThreadListItemsFromCOPMessagesHandler(q);w(t);x(s);h&&p>0&&p>e.size&&d("MAWODSProxy").odsBumpEntityKey({amount:p-e.size,entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"upload_count_higher_than_acks"});return Array.from(e)});return t.apply(this,arguments)}function u(a,e){a!=null&&(c("MAWSharedCOPLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]).LOG(q(),e==null?void 0:e.externalId),c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=d("MAWLoggerUtils").getInstanceKey(),e=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25313175,"1551"),yield d("MWSharedS2SBaseAnnotations").getSendToSentBaseAnnotations(d("MWSharedS2SBaseAnnotations").getMessageTypeParams({isEphemeralSetting:!0}),c("LSMessagingThreadAttributionType").UNKNOWN),{providedInstanceKey:b});try{b=(yield d("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:{ephemeralSetting:{ephemeralExpirationInSec:a.correctEphemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:a.correctEphemeralLastUpdatedOrSetTimestamp},isEphemeralSettingReset:!1,isForSyncResponse:!0},chatJid:a.chatJid,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:b}));if(b.success){e.endSuccess();if(b.value!=null){var f=b.value;d("MAWBridge").getBridge().fireAndForget("event","handleMessageSendResult",{report:f,success:!0},!0)}}else e.endFail(b.error.type)}catch(a){f=a instanceof Error?a:null;e==null?void 0:e.endFail("failed_to_send_empemeral_settings",{string:{errorDescription:(b=f==null?void 0:f.message)!=null?b:""}})}});function f(){return e.apply(this,arguments)}return f}(),name:"ephemeral_sync_response",priority:d("WorkerScheduler").BACKGROUND_PRIORITY})))}function v(a){var b=a.msgType,e=a.plaintextHash,f=a.protocolMsgId;a=a.source;if(f!=null&&e!=null&&b!==d("MAWMsgType").MSG_TYPE.RAVEN){c("MAWSharedCOPLogger").TAGS(["downloadAndHandleMedia"]).LOG(p(),f,d("WAHashUtils").sanitisePlaintextHash(e));var g=a==="ebrestore"?"EBRestore":"WAIncomingMsg";if(c("gkx")("12064")){if(c("gkx")("1614")&&a==="ebrestore")return;a=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:g,msgType:b,protocolMsgId:f,triggerUIView:null});void d("MAWDownloadAndHandleMedia").downloadAndHandleMediaImpl({downloadEntry:g,hash:e,mediaDownloadFlow:a,msgType:b,protocolMsgId:f})}else d("MAWJobManager").getJobManager().fireAndForget(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(f,e,g,b,null))}}function w(a){if(a.size===0)return;c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return e()},name:"queryGroup",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));function e(){return f.apply(this,arguments)}function f(){f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a).map(function(a){return d("WAQueryGroup").queryGroup(a,"interactive")["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return f.apply(this,arguments)}}function x(a){if(a.size===0)return;c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return e()},name:"queryGroupInvite",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));function e(){return f.apply(this,arguments)}function f(){f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];var c=a.inviteCode,e=a.inviteExpireTs;a=a.inviterJid;return d("WAQueryGroupInvite").queryGroupInvite(b,c,e,a)["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return f.apply(this,arguments)}}function y(a){if(c("gkx")("23915"))for(a of a)a.subtype==="ciphertext"&&c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(a.jid,"Message "+a.stanzaId+" has decryption error: "+a.decryptionError+" from user "+a.from,{decryptionError:a.decryptionError,protocolMsgId:{author:d("WAGlobals").getMyDeviceJid()===a.from?"@me":d("WAJids").extractUserJid(a.from),chat:a.jid,externalId:a.stanzaId}}))}function z(a){if(a.message==null)return a;if(a.message.type!=="ephemeral")return a;var b=a.serverTs;a.message.ephemeralLastUpdatedOrSetTimestamp=a.message.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").DEFAULT_UNIXTIME?b:a.message.ephemeralLastUpdatedOrSetTimestamp;return a}function A(){return d("ACTSanitizerApiLazyLoader").loadACTSanitizerApi().then(function(a){return a.isXMAValid})["catch"](function(a){c("MAWSharedCOPLogger").TAGS(["ActSanitizerWasmApi"]).ERROR(o(),a);return function(){throw a}})}g["default"]=a}),98);
__d("MAWDbHistorySyncQRCodeData",[],(function(a,b,c,d,e,f){"use strict";a="qrCodeRowId";f.qrCodeRowId=a}),66);
__d("MAWHandleEncryptedBackupsSecretsApi",["MAWDbHistorySyncQRCodeData","MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({historySyncQRCodeData:d("MAWTransactionMode").READWRITE},"handleEncryptedBackupsSecret",function(a){return function(b){var e=b.backupId,f=b.epoch,g=b.mailboxRootKey,i=b.obliviousValidationToken,j=b.serverDataId,k=b.tempOcmfClientState;return a.historySyncQRCodeData.get(d("MAWDbHistorySyncQRCodeData").qrCodeRowId).then(function(b){if(!(b==null?void 0:b.isQRScanned))return a.historySyncQRCodeData.put({isQRScanned:!0,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"CallFinishAddDevice",value:{backupId:e.toString(),epoch:h(f),mailboxRootKey:g,obliviousValidationToken:i,serverDataId:j.toString(),tempOcmfClientState:k}});return})["catch"](function(b){return a.historySyncQRCodeData.put({isQRScanned:!1,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(c("emptyFunction"))})})}});function h(a){return a.map(function(a){var b=a.anonId,c=a.id,d=a.rootKey;a=a.status;return{epoch_anon_id:b,epoch_id:c.toString(),epoch_root_key:d,epoch_status:a.toString()}})}g.handleEncryptedBackupsSecret=a}),98);
__d("MAWProtocolQueueAppdata",["MAWHandleEncryptedBackupsSecretsApi","MAWHandleMetaSyncAction","MAWSharedCOPLogger","Promise","WAConvertAppData","WAMsgApplication.pb","WAParseMessageApplication","WAProtocolQueue","WAResultOrError","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata: backup secret"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata: meta sync"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Appdata contains unparseable message application."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parse Appdata application protocol"]);n=function(){return a};return a}function a(a){var c=a.map(function(a){return o(a.appdata)});return(h||(h=b("Promise"))).all(c.map(function(a){a=p(a);return a})).then(function(b){var c=[];b.map(function(b,d){b.success===!0&&c.push(a[d].stanzaQueueId)});return{followUpParams:void 0,toAck:c}})}function o(a){c("MAWSharedCOPLogger").DEV(n());a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,d("WAProtocolQueue").extractSubProtocolFromAppdataProtocol(a).payload);a=d("WAParseMessageApplication").parseMessageApplication(a);if(a.type==="error"){c("MAWSharedCOPLogger").ERROR(m());return}return d("WAConvertAppData").parseAppData(a)}function p(a){c("MAWSharedCOPLogger").LOG(l());if(a==null)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());switch(a.type){case"meta_sync":c("MAWSharedCOPLogger").LOG(k());return d("MAWHandleMetaSyncAction").handleMetaSyncActions(a).then(function(){return d("WAResultOrError").makeResult()});case"backups_secrets":c("MAWSharedCOPLogger").LOG(j());return d("MAWHandleEncryptedBackupsSecretsApi").handleEncryptedBackupsSecret(a.encryptedBackupsSecrets).then(function(){return d("WAResultOrError").makeResult()});case"sync_key_share":return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());case"sync_key_request":return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());default:a.type;c("MAWSharedCOPLogger").WARN(i(),a.type);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}g.handleAppdataStanzas=a}),98);
__d("MAWCOPAppdataHandler",["MAWIsQuotaExceededError","MAWProtocolQueueAppdata","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing appdata batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["appdata consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueAppdata").handleAppdataStanzas(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWDbAddDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.add(b)}f.addDeviceChangeAlertsTxn=a}),66);
__d("MAWDbGetAlertsWithDeviceJidTxn",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.deviceChangeAlerts.filter(function(a){return a.deviceJid===b&&!a.loggedOut}).toArray().then(function(a){a.length>1&&c("err")("Invalid result, more than one active devices with the same deviceJid: "+b);return a[0]})}g.getAlertsWithDeviceJidTxn=a}),98);
__d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn",["MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.deviceChangeAlerts.filter(function(a){return a.isArchived===!1}).toArray().then(function(a){return d("MAWIndexedDb").afterTransaction({tag:"UnArchivedSelfDeviceChangeAlerts",value:a.length})})}g.getUnArchivedDeviceChangeAlertsCountTxn=a}),98);
__d("MAWDbUpdateDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.put(b)}f.updateDeviceChangeAlertsTxn=a}),66);
__d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["MAWDbGetAlertsWithDeviceJidTxn","MAWDbUpdateDeviceChangeAlertsTxn"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,b).then(function(b){return d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))})}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("WAUpdateDevicesForUserApi",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.allowSecurityAlertForContact;a=a.isMe;return!a&&b}f.getShouldShowAdminMessages=a}),66);
__d("WAUpdateRotateSenderKeyToTrue",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"updateRotateSenderKeyToTrue",function(a){return function(b){return d("WADbPersonalSenderKeyStatusTxns").bulkSetRotateSenderKeyToTrueTxn(a,b)}});g.updateRotateSenderKeyToTrue=a}),98);
__d("WAUpdateRotateSenderKeyToTrueV2",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.stores.personalSenderKeyStatuses.bulkGet(a));c=c.filter(function(a){return a!=null}).map(function(a){return babelHelpers["extends"]({},a,{rotateSenderKey:!0})});yield b.stores.personalSenderKeyStatuses.bulkPut(c);return c});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("updateRotateSenderKeyToTrue"))};g.updateRotateSenderKeyToTrue=a}),98);
__d("MAWProtocolQueueInstructions",["MAWAdminWriteUserDeviceMsgTxn","MAWBridge","MAWDbAddDeviceChangeAlertsTxn","MAWDbDeviceChangeAlerts","MAWDbGetAlertsWithDeviceJidTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbMsgTypeVersionTxns","MAWDbThreadTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDexieTable","MAWIndexedDb","MAWODSProxy","MAWTransactionMode","WAAssertUnreachable","WADbContact","WADexieToWormMigration","WAGlobals","WAJids","WALogger","WAOdsEnums","WAUpdateDevicesForUserApi","WAUpdateRotateSenderKeyToTrue","WAUpdateRotateSenderKeyToTrueV2","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ICDC error instruction for thread "," not found"]);h=function(){return a};return a}function i(a,b){b=new Set(b.map(function(a){return a.jid}));return d("MAWDexieTable").dexieAll([d("MAWDbMsgTypeVersionTxns").maybeBulkGetSecuritySetting(a),d("MAWDbThreadTxns").getAllThreadsForUsers(a,Array.from(b))])}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersRelationships",{users:Array.from(new Set(a.map(function(a){return a.jid})))}));a=(yield k(a,b));b=a.followUpParams;a=a.toAck;b=b.groupsToUpdateForIdentityRemoved.flat();var c=d("WADexieToWormMigration").isWorm("MAWProtocolQueueInstructions")?d("WAUpdateRotateSenderKeyToTrueV2").updateRotateSenderKeyToTrue:d("WAUpdateRotateSenderKeyToTrue").updateRotateSenderKeyToTrue;yield c(b);return{followUpParams:void 0,toAck:a}});return j.apply(this,arguments)}var k=d("MAWIndexedDb").makeMsgrTransactor({appMeta:(e=d("MAWTransactionMode")).READONLY,deviceChangeAlerts:e.READWRITE,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,messages:e.READWRITE,participants:e.READONLY,threads:e.READWRITE},"handleInstructions",function(a){return function(b,c){return i(a,b).then(function(e){var f=e[0],g=f.allowSecurityAlertForContact,h=f.allowSecurityAlertForSelf,i=e[1];return d("MAWDexieTable").dexieSequentialAll(b.map(function(b){var e=b.jid,f=e===d("WAGlobals").getMyUserJid(),j=d("WAUpdateDevicesForUserApi").getShouldShowAdminMessages({allowSecurityAlertForContact:g,isMe:f})&&c.get(e)===d("WADbContact").TWO_WAY_CONTACT,k={allowSecurityAlertForSelf:h,isMe:f,shouldShowAdminMessages:j,threads:(f=i.get(e))!=null?f:[],user:e};return function(){return l(a,b,k)}})).then(function(){var a=b.filter(function(a){return a.instruction==="identityRemoved"}).map(function(a){a=(a=i.get(a.jid))!=null?a:[];a=a.map(function(a){return d("WAJids").interpretAsGroupJid(a.jid)}).filter(Boolean);return a});return{followUpParams:{groupsToUpdateForIdentityRemoved:a},toAck:b.map(function(a){return a.stanzaQueueId})}})})}});function l(a,b,d){switch(b.instruction){case"identityChanged":return m(a,b,d);case"identityAdded":return n(a,b,d);case"identityRemoved":return o(a,b,d);case"icdcError":return p(a,b,d);default:throw c("WAAssertUnreachable")(b)}}function m(a,b,c){var e=c.allowSecurityAlertForSelf,f=c.isMe,g=c.shouldShowAdminMessages;c=c.threads;var h=f&&b.model!=null&&b.platform!=null&&b.notificationTs!=null;return d("MAWDexieTable").dexieAll([h&&b.model!=null&&b.platform!=null&&b.notificationTs!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:b.device,identity:b.identity,isArchived:!e,model:b.model,platform:b.platform,ts:b.notificationTs}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(g?c.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,b.jid,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,b.notificationTs)}):[])).then(function(){(h||g)&&d("MAWODSProxy").odsBumpEntityKey({entity:f?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})})}function n(a,b,c){var e=c.allowSecurityAlertForSelf,f=c.isMe,g=c.shouldShowAdminMessages,h=c.threads,i=c.user,j=f&&b.model!=null&&b.platform!=null&&b.notificationTs!=null;return d("MAWDexieTable").dexieAll([j&&b.model!=null&&b.platform!=null&&b.notificationTs!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").ADD,deviceJid:b.device,identity:b.identity,isArchived:!e,model:b.model,platform:b.platform,ts:b.notificationTs}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(g?h.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,b.notificationTs)}):[])).then(function(){(j||g)&&d("MAWODSProxy").odsBumpEntityKey({entity:f?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})})}function o(a,b,c){var e=c.isMe,f=c.shouldShowAdminMessages,g=c.threads,h=c.user;return d("MAWDexieTable").dexieAll([e?d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,b.device).then(function(){return d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,b.device)}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(f?g.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,h,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,b.notificationTs)}):[])).then(function(){(e||f)&&d("MAWODSProxy").odsBumpEntityKey({entity:e?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})})}function p(a,b,c){c=c.threads;if(!d("WAGlobals").getConfig().isICDCErrorEnabled())return d("MAWDexieTable").dexieResolve();c=c.find(function(a){return a.jid===b.jid});if(c==null){d("WALogger").ERROR(h(),b.jid);return d("MAWDexieTable").dexieResolve()}return d("MAWAdminWriteUserDeviceMsgTxn").writeICDCAlert(a,b.jid,c,b.notificationTs)}g.handleInstructions=a}),98);
__d("MAWCOPInstructionsHandler",["MAWIsQuotaExceededError","MAWProtocolQueueInstructions","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing instructions batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instruction consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueInstructions").handleInstructions(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWChangeGroupMemberAddModeApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupMemberAddMode")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){var h=a.GroupInfoStore;a=a.MessagesStore;var i=(yield h.get(b));if(!i.success)return d("WAResultOrError").makeError("missing_group");yield h.update(b,function(a){return babelHelpers["extends"]({},a,{memberAddMode:e})});if(g==="create_admin_message"){i=d("MAWAdminMsgHelpers").createMemberAddModeChangeAdminMsg(b,e,c,f);i!=null&&(yield a.create(i))}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}();g.changeGroupMemberAddMode=a;g.changeGroupMemberAddModeTransactor=h}),98);
__d("MAWAdminAddParticipantMsg",["MAWLocalizationType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e){switch(a){case 1:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER}}function l(a,b){switch(a){case 1:return{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU};case 2:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER}}return{adminMsgContent:[(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER}}function m(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER}}return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER}}function n(a,b){var c=d("MAWUserJidWrapper").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?l(b.length,e===c?f:g):m(b.length,g,f);if(a===c)return j(b.length,g,f);a=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,a,e===c?f:g):k(b.length,a,g,f)}function a(a,b){return babelHelpers["extends"]({},n(a,b),{version:h})}g.createAddParticipantsAdminMessage=a}),98);
__d("MAWAdminRemoveParticipantMsg",["MAWAdminMsgType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c,e){switch(a){case 1:return e?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_LEFT_GROUP}:{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e,f){switch(a){case 1:return f?{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_LEFT_GROUP}:{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER}}function l(a,b){var c=d("MAWUserJidWrapper").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_YOU}:{adminMsgContent:[g],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_ONE_USER};if(a===c)return j(b.length,g,f,e===c);var h=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,h,e===c?f:g):k(b.length,h,g,f,e===a)}function a(a,b){return babelHelpers["extends"]({},l(a,b),{version:h})}g.createRemoveParticipantsAdminMessage=a}),98);
__d("MAWAdminWriteChangeParticipantsAdminMsgTxn",["FBLogger","MAWAdminAddParticipantMsg","MAWAdminRemoveParticipantMsg","MAWDbThreadTxns","MAWLocalizationUtils","MAWUserJidWrapper","MAWWriteMsgTxns","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b,d("MAWAdminAddParticipantMsg").createAddParticipantsAdminMessage)}function b(a,b){return h(a,b,d("MAWAdminRemoveParticipantMsg").createRemoveParticipantsAdminMessage)}function h(a,b,e){var f=b.admin,g=b.chatJid,h=b.participants,i=b.serverTs;if(h.length===0)throw c("FBLogger")("messenger_web").mustfixThrow("invalid number of participants when writing participants change admin msg");return d("MAWDbThreadTxns").getThread(a,g).then(function(g){if(!g.success)throw c("FBLogger")("messenger_web").mustfixThrow("no thread when writing participants change admin msg");g=g.value;var j=d("MAWUserJidWrapper").getMyUserJid();j=f==="@me"?j:f;if(j==null)return;j=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(e(j,h),g.jid,b.externalId,i);return d("MAWWriteMsgTxns").writeMsg(a,j,g,"MAWAdminWriteChangeParticipantsAdminMsgTxn").then(c("emptyFunction"))})}g.writeAddParticipantAdminMsg=a;g.writeRemoveParticipantAdminMsg=b}),98);
__d("MAWAdminWriteGroupNameChangeTxn",["MAWAdminMsgType","MAWDexieTable","MAWExternalId","MAWLocalizationUtils","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=b.name;if(f==null)return d("MAWDexieTable").dexieResolve();var g=d("MAWUserJidWrapper").getMyUserJid(),h=[];b.nameOwner===g?(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_NAMED_GROUP,h.push(f)):b.nameOwner==null?(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_NAMED_GROUP,h.push(f)):(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_NAMED_GROUP,h.push(d("WAJids").userIdFromJid(b.nameOwner),f));b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:h,adminType:g,version:1},e.jid,d("MAWExternalId").generateExternalId(),d("WATimeUtils").castMillisTimeToUnixTime(d("WATimeUtils").millisTime()));return d("MAWWriteMsgTxns").writeMsg(a,b,e,"MAWAdminWriteGroupNameChangeTxn").then(c("emptyFunction"))}g.writeGroupNameChangeInfo=a}),98);
__d("MAWParticipantManagementTxns",["MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWUserJidWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(e){if(c.length===0&&e.length===0)return{addedJids:[],participants:e,removedJids:[],typeUpdateJids:[]};var f=new Map();e.forEach(function(a){f.set(a.userJid,a)});var g=new Set(c.map(function(a){return a.userJid})),h=[],i=[],j=[],k=[];f.forEach(function(a,b){g.has(b)||(a.type!=="invitedParticipant"?h.push(b):(k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.userJid);b==null?(i.push(a),a.type==="admin"&&k.push({type:a.type,userJid:a.userJid})):(b.type!==a.type&&k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},b,a)))});var l=h.indexOf(d("MAWUserJidWrapper").getMyUserJid())>=0;e=function(){return[d("MAWDbParticipantTxns").bulkAddParticipants(a,b,i),d("MAWDbParticipantTxns").bulkUpdateParticipants(a,j),d("MAWDbParticipantTxns").bulkDeleteParticipantsInThread(a,b,h),l?d("MAWDbThreadTxns").archiveThreads(a,[b],!0):d("MAWDexieTable").dexieResolve()]};return d("MAWDexieTable").dexieAll(e()).then(function(a){var b=a[0];a=a[1];return{addedJids:i.map(function(a){return a.userJid}),participants:[].concat(b,a),removedJids:h,typeUpdateJids:k}})})}g.syncParticipantList=a}),98);
__d("MAWGroupManagementTxns",["MAWAdminWriteChangeParticipantsAdminMsgTxn","MAWAdminWriteGroupNameChangeTxn","MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWParticipantManagementTxns","MAWThreadManagementTxns","MAWUserJidWrapper","WATimeUtils","isGroupInvitesEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWThreadManagementTxns").deleteAllThreadData(a,c),d("MAWDbGroupInfoTxns").deleteGroupInfo(a,b)]).then(function(a){a=a[0];return a}).then(function(a){return a})}b=function(a,b){var e=b.authoritativeThreadKey,f=b.deduplicationKey,g=b.extras,h=b.folder,i=b.groupStatus,j=b.groupToCreate,k=b.serverTs;b=i==="added"?d("WATimeUtils").unixTime():j.creationTs;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:e,clientThreadKey:g==null?void 0:g.clientThreadKey,createTs:d("WATimeUtils").castUnixTimeToMillisTime(b),deduplicationKey:f,description:"createGroup",folder:h==null?d("MAWFolderTypes").FOLDER_ID.INBOX:h,jid:j.jid}).then(function(b){var e=b.created,f=b.thread;b=j.participants.map(function(a){return a.error?c("isGroupInvitesEnabled")()&&a.error.errorCode===403?{addressable:!0,type:"invitedParticipant",userJid:a.error.user}:null:{addressable:a.value.addressable,type:a.value.type,userJid:a.value.user}}).filter(Boolean);var g=e?d("MAWDbParticipantTxns").bulkAddParticipants:d("MAWParticipantManagementTxns").syncParticipantList;g=g(a,f.jid,b);b=d("MAWUserJidWrapper").getMyUserJid();b=i==="added"&&!e&&j.creator!==b?d("MAWAdminWriteChangeParticipantsAdminMsgTxn").writeAddParticipantAdminMsg(a,{admin:j.inviter,chatJid:f.jid,externalId:d("MAWExternalId").generateExternalId(),participants:[b],serverTs:k}):d("MAWDexieTable").dexieResolve();j.description;j.participants;var h=babelHelpers.objectWithoutPropertiesLoose(j,["description","participants"]);return d("MAWDexieTable").dexieAll([g,d("MAWDbGroupInfoTxns").putGroupInfo(a,h),b]).then(function(b){b[0];b=b[1];return e&&i==="added"?d("MAWAdminWriteGroupNameChangeTxn").writeGroupNameChangeInfo(a,b,f):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(a,[f.jid]):d("MAWDbThreadTxns").subscribeToThreads(a,[f.jid])}).then(function(a){return f.jid})})};g.deleteGroup=a;g.createGroupInternal=b}),98);
__d("MAWThreadTypes",["MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b={chunk:(a=d("MAWTransactionMode")).READWRITE,deletedMessages:a.READWRITE,editMsgHistory:a.READWRITE,groupInfo:a.READWRITE,groupInvites:a.READWRITE,media:a.READWRITE,messages:a.READWRITE,participants:a.READWRITE,pendingStanzas:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READWRITE};g.ThreadRelatedTablesPermissions=b}),98);
__d("MAWDeleteGroupsApi",["MAWDbThreadTxns","MAWDexieTable","MAWGroupManagementTxns","MAWIndexedDb","MAWThreadTypes","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor(d("MAWThreadTypes").ThreadRelatedTablesPermissions,"deleteGroups",function(a){return function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.group;return d("MAWDbThreadTxns").getThread(a,c).then(function(b){return!b.success?d("WAResultOrError").makeError("missing_thread"):d("MAWGroupManagementTxns").deleteGroup(a,c,b.value).then(function(a){return d("WAResultOrError").makeResult({deletedGroupId:c,deletedMsgIds:a.deletedMessages})})})})).then(function(a){return a})}});g.deleteGroupsFromMAW=a}),98);
__d("WADeleteGroupFollowUpLowLevelApi",["MAWDexieTable","MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE},"deleteGroupFollowUpLowLevel",function(a){return function(b,c){return d("MAWDexieTable").dexieAll([d("WADbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,[b]),h(a,c)]).then(function(){})}});function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}g.deleteGroupFollowUpLowLevel=a}),98);
__d("WADeleteGroupFollowUpLowLevelApiV2",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return d("WASignalDB").getDb().runInTransaction(["senderKeySessions","personalSenderKeyStatuses"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){yield (h||(h=b("Promise"))).all([c.stores.senderKeySessions.readIndex("groupJid",[a]).then(function(a){return c.stores.senderKeySessions.bulkDelete(a.map(function(a){return a.id}))}),c.stores.personalSenderKeyStatuses["delete"](a)])});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("deleteGroupFollowUpLowLevel"))};g.deleteGroupFollowUpLowLevel=a}),98);
__d("MAWDeleteGroup",["MAWDeleteGroupsApi","Promise","WADeleteGroupFollowUpLowLevelApi","WADeleteGroupFollowUpLowLevelApiV2","WALogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteGroups failed to delete group to a non-existent thread"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=(yield d("MAWDeleteGroupsApi").deleteGroupsFromMAW(e.map(function(b){return{deleter:a,group:b}})));return(h||(h=b("Promise"))).all(e.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.success)d("WALogger").ERROR(i());else{a=a.value;var c=a.deletedGroupId;a=a.deletedMsgIds;yield (h||(h=b("Promise"))).all([d("WADeleteGroupFollowUpLowLevelApi").deleteGroupFollowUpLowLevel(c,a),d("WADeleteGroupFollowUpLowLevelApiV2").deleteGroupFollowUpLowLevel(c,a)])}});return function(b){return a.apply(this,arguments)}}())).then(c("emptyFunction"))});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWUpdateGroupSubjectApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAJids","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"updateGroupSubject")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.GroupInfoStore;a=a.MessagesStore;var f=(yield e.get(b));if(!f.success)return d("WAResultOrError").makeError("missing_group");f=f.value;if(f.subject.ts!=null&&(c.ts==null||f.subject.ts>c.ts))return d("WAResultOrError").makeResult();yield e.update(b,function(a){return babelHelpers["extends"]({},a,{subject:c})});e=(yield e.get(f.jid));if(!e.success)return d("WAResultOrError").makeError("missing_group");f=e.value;e=f.subject.user;f=d("MAWAdminMsgHelpers").createGroupNameChangeAdminMsg(b,f,e!=null?d("WAJids").userIdFromJid(e):void 0,(b=c.ts)!=null?b:d("WATimeUtils").unixTime());f!=null&&(yield a.create(f));return d("WAResultOrError").makeResult()});return function(b,c,d){return a.apply(this,arguments)}}();g.updateGroupSubject=a;g.updateGroupSubjectTransactor=h}),98);
__d("MAWHandleGroupNotifications",["FBLogger","MAWAddGroupParticipantsApi","MAWChangeGroupMemberAddModeApi","MAWChangeGroupParticipantAdminStatusApi","MAWDeleteGroup","MAWRemoveGroupInvitesApi","MAWRemoveGroupParticipantsApi","MAWUpdateGroupSubjectApi","Promise","WAAPI","WACreateGroup","WAGlobals","WAResultOrError","asyncToGeneratorRuntime","emptyFunction","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=a.notification;switch(a.type){case"join":return i(a).then(function(){return d("WAResultOrError").makeResult()});case"add":return k(a);case"remove":return l(a);case"promote":return n(a);case"demote":return m(a);case"delete":var e=a.groupJid,f=a.participant;if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group delete notification without deleter JID: "+e);return c("MAWDeleteGroup")(f,[e]).then(function(){return d("WAResultOrError").makeResult()});case"subject":return o(a).then(function(){return d("WAResultOrError").makeResult()});case"memberAddMode":return p(a);default:a.type;return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.isE2EEMigration)return;var b=a.group,e=a.isNew,f=a.key,g=a.serverTs;yield d("WACreateGroup").createGroups([{extras:f!=null?{deduplicationKey:f,platform:"msgr"}:null,folder:null,groupStatus:e?"new":"added",groupToCreate:b,key:f,serverTs:g}]);e=a.group.participants.map(function(a){if(a.success)return a.value.user;else return a.error.user});var h=d("WAGlobals").getMyUserJid();f=c("justknobx")._("1162");f&&e.find(function(a){return a===h})&&(yield d("MAWRemoveGroupInvitesApi").removeGroupInvites(b.jid,h));yield c("WAAPI").getDevices({ignoreDhash:!1,reason:"added-to-group",users:new Set(e)})});return j.apply(this,arguments)}function k(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId,h=a.reason,i=a.serverTs;a=a.versionId;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group add participant notification without adder JID: "+b);return d("MAWAddGroupParticipantsApi").addGroupParticipants({current:a,previous:g},b,e,f,!1,h,i)}function l(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId,h=a.serverTs;a=a.versionId;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group remove participant notification without remover JID: "+b);var i=null;a!=null&&(i={current:a,previous:g});return d("MAWRemoveGroupParticipantsApi").removeGroupParticipants(i,b,e,f,!1,h)}function m(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId,g=a.serverTs;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"participant",g)}function n(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId,g=a.serverTs;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"admin",g)}function o(a){var b=a.groupJid,e=a.participant,f=a.subject;a=a.ts;return d("MAWUpdateGroupSubjectApi").updateGroupSubject(b,{content:f,ts:a,user:e}).then(c("emptyFunction"))}function p(a){var b=a.groupJid,c=a.memberAddMode,e=a.participant;a=a.serverTs;return d("MAWChangeGroupMemberAddModeApi").changeGroupMemberAddMode(b,e,c,a,"create_admin_message")}g.persistGroupNotification=a}),98);
__d("WAParticipant",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"admin":case"superadmin":return!0;default:return!1}}f.isGroupAdminParticipantType=a}),66);
__d("WASyncParticipantsApi",["WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=a.ParticipantsStore;var e=(yield a.bulkGetInGroup(b));if(e.success!==!0)return d("WAResultOrError").makeError("missing_participants");if(c.length===0&&e.value.length===0)return d("WAResultOrError").makeResult({removedJids:[],addedJids:[],typeUpdateJids:[]});var f=new Map();e.value.forEach(function(a){f.set(a.user,a)});var g=new Set(c.map(function(a){return a.user})),h=[],i=[],j=[],k=[];f.forEach(function(a,c){g.has(c)||(a.type!=="invitedParticipant"?h.push({userJid:c,groupJid:b}):(k.push({previousType:a.type,newType:a.type,userJid:a.user}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.user);b==null?(i.push(a),a.type==="admin"&&k.push({previousType:"nonparticipant",newType:a.type,userJid:a.user})):(b.type!==a.type&&k.push({previousType:b.type,newType:a.type,userJid:a.user}),j.push(babelHelpers["extends"]({},b,a)))});yield a.bulkPut(i);yield a.bulkPut(j);yield a.bulkDelete(h);return d("WAResultOrError").makeResult({removedJids:h.map(function(a){a=a.userJid;return a}),addedJids:i.map(function(a){return a.user}),typeUpdateJids:k})});return function(b,c,d){return a.apply(this,arguments)}}();g.syncParticipantsTransactor=a}),98);
__d("MAWResetGroupParticipantInfoApi",["MAWAdminMsgHelpers","MAWRunInTransaction","Promise","WAAPI","WALogger","WAParticipant","WAResultOrError","WASyncParticipantsApi","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received an error when sync-ing participants"]);i=function(){return a};return a}a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return j.apply(void 0,[a].concat(e))},"resetGroupParticipantInfo").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[0]]));return a});return function(b){return a.apply(this,arguments)}}())};var j=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;e=e.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});a=(yield d("WASyncParticipantsApi").syncParticipantsTransactor({ParticipantsStore:a},c,e));if(f!=null){e=(yield g.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:f})}));if(!e.success)return e}if(a.success!==!0){d("WALogger").ERROR(i());return a}g=a.value;e=[];if(g.removedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,g.removedJids,null,d("WATimeUtils").unixTime());e.push(j.create(a))}if(g.addedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,g.addedJids,null,d("WATimeUtils").unixTime());e.push(j.create(a))}if(g.typeUpdateJids.length>0)for(a=0;a<g.typeUpdateJids.length;a++){var k=g.typeUpdateJids[a].previousType,l=g.typeUpdateJids[a].newType;k=d("WAParticipant").isGroupAdminParticipantType(k);l=d("WAParticipant").isGroupAdminParticipantType(l);var m=!k&&l;k=k&&!l;if(m){l=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,g.typeUpdateJids[a].userJid,null,d("WATimeUtils").unixTime());e.push(j.create(l))}else if(k){m=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,g.typeUpdateJids[a].userJid,null,d("WATimeUtils").unixTime());e.push(j.create(m))}}return(h||(h=b("Promise"))).all(e).then(function(){return d("WAResultOrError").makeResult()})});return function(b,c,d,e){return a.apply(this,arguments)}}();g.resetGroupParticipantInfo=a;g.resetGroupParticipantInfoTransactor=j}),98);
__d("MAWProtocolQueueGroupNotification",["FBLogger","MAWHandleGroupNotifications","MAWResetGroupParticipantInfoApi","Promise","WAAPI","WACreateGroup","WALogger","WAQueryGroup","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create group infos"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to recover missing group info"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[doGroupRecovery] Cannot get a group, as per ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get group info"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received a participant with an error"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ParticipantRecovery] Cannot get a group, as per ",""]);p=function(){return a};return a}function a(a){var b=a.notification;return d("MAWHandleGroupNotifications").persistGroupNotification(a).then(function(a){return a.success?a:d("WAResultOrError").makeResult({errorResult:a,groupNotification:b})})}function e(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var b=(yield d("WAQueryGroup").queryGroup(a,"participant_change_recovery"));if(b.success===!1){var f;d("WALogger").ERROR(p(),b.error);throw c("FBLogger")("messenger_web").mustfixThrow("[ParticipantRecovery] Cannot get a group, as per "+JSON.stringify((f=b.error)!=null?f:null))}f=b.value;b=f.participants.map(function(a){if(a.error){d("WALogger").ERROR(o());return null}return a.value}).filter(Boolean);b=(yield d("MAWResetGroupParticipantInfoApi").resetGroupParticipantInfo(a,b,f.participantVersion));f=b.error;!b.success&&f==="missing_group"&&e.push(a)}catch(a){d("WALogger").DEV(n()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{c("WAAPI").queryGroups({groups:e,type:"array"})["catch"](function(a){d("WALogger").DEV(m()).devConsole(a)})}catch(a){d("WALogger").DEV(l()).devConsole(a)}});return q.apply(this,arguments)}function f(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("WAQueryGroup").queryGroup(a,"interactive"));if(a.success===!1){var b;d("WALogger").ERROR(k(),a.error);throw c("FBLogger")("messenger_web").mustfixThrow("[doGroupRecovery] Cannot get a group, as per "+JSON.stringify((b=a.error)!=null?b:null))}e.push(a.value)}catch(a){d("WALogger").DEV(j()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{yield d("WACreateGroup").createGroups(e.map(function(a){return{extras:null,folder:null,groupStatus:"queried",groupToCreate:a,key:null,serverTs:d("WATimeUtils").unixTime()}}))}catch(a){d("WALogger").DEV(i()).devConsole(a)}});return r.apply(this,arguments)}g.handleProtocolQueueGroupNotification=a;g.doParticipantRecovery=e;g.doGroupRecovery=f}),98);
__d("MAWAdminWriteUsersConnectedMsgTxn",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","MessengerMSplitFlag","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg found a thread without messages from both users, which we'll not append to."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg failed to create or get 1:1 thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg is called for self thread"]);j=function(){return a};return a}function a(a,b,e,f){var g=d("MAWUserJidWrapper").getMyUserJid();if(b===g){d("WALogger").WARN(j());return d("MAWDexieTable").dexieResolve()}return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(i());return}var j=b.value;b=d("MAWDbMsgTxns").doesThreadHaveMsgsMatchCriteria(a,j.jid,function(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN?!1:a.author===g||a.author===d("WAJids").AUTHOR_ME});var k=d("MAWDbMsgTxns").doesThreadHaveMsgsMatchCriteria(a,j.jid,function(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN?!1:a.author!==g&&a.author!==d("WAJids").AUTHOR_ME});return d("MAWDexieTable").dexieAll([b,k]).then(function(b){var g=b[0];b=b[1];if(!g||!b){d("WALogger").WARN(h());return}g=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:c("MessengerMSplitFlag").is_msplit_account||e?d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT:d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED,version:1},j.jid,d("MAWExternalId").generateExternalId(),f);return d("MAWWriteMsgTxns").writeDedupedUsersConnectedAdminMessage(a,g,j).then(function(){var a=d("WAJids").interpretAsUserJid(j.jid);if(a==null)return;d("MAWIndexedDb").afterTransaction({tag:"UpdateContactAsConnected",value:{contactUserId:d("WAJids").extractUserId(a),threadJid:j.jid}})})})})}g.writeUsersConnectedAdminMsg=a}),98);
__d("MAWHandleConnectedAdminMsgApi",["MAWAdminWriteUsersConnectedMsgTxn","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleConnectedAdminMsg: chat ",""]);h=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({ftsBackloggedMessages:(a=d("MAWTransactionMode")).READWRITE,groupInfo:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"handleConnectedAdminMsg",function(a){return function(b){var c=b.chatJid,e=b.isOtherContactMsplit;b=b.notificationTs;d("WALogger").LOG(h(),c);return d("MAWAdminWriteUsersConnectedMsgTxn").writeUsersConnectedAdminMsg(a,c,e,b)}});g.handleConnectedAdminMsg=b}),98);
__d("MAWUpdateThreadFolderApi",["MAWBridgeTypesCreators","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread "," folder with folder id ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread ",""]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE},"updateThreadFolder",function(a){return function(b,c){d("WALogger").LOG(i(),b);return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},b.value,{folder:c})).then(function(a){d("WALogger").LOG(h(),b.value.jid,c);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:c,threadJid:b.value.jid})});return})})}});g.updateThreadFolder=a}),98);
__d("MAWProtocolQueueNotification",["MAWBridge","MAWFolderTypes","MAWHandleConnectedAdminMsgApi","MAWODSProxy","MAWProtocolQueueGroupNotification","MAWUpdateThreadFolderApi","Promise","WAJids","WALogger","WAOdsEnums","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") unknown thread action, jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") connected, jid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") with folder id ",", jid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unsupported notification type: ",""]);l=function(){return a};return a}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.stanzaId;a=a.notification;var f=a.actions,g=a.chatJid,l=a.ts,m=d("WAJids").interpretAsUserJid(g),n=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersIsMsplit",{users:[m].filter(Boolean)}));return(h||(h=b("Promise"))).all(f.map(function(a){switch(a.type){case"folder":var c;c=(c=a.folderId)!=null?c:d("MAWFolderTypes").FOLDER_ID.INBOX;d("WALogger").LOG(k(),e,c,g);return d("MAWUpdateThreadFolderApi").updateThreadFolder(g,c);case"connected":d("WALogger").LOG(j(),e,g);c=m!=null&&n.get(m)===!0;return d("MAWHandleConnectedAdminMsgApi").handleConnectedAdminMsg({chatJid:g,isOtherContactMsplit:c,notificationTs:l});default:a.type;d("WALogger").ERROR(i(),e,g);return(h||(h=b("Promise"))).reject("Handle thread notification: unknown thread action")}})).then(c("emptyFunction"))});return n.apply(this,arguments)}function a(a){return(h||(h=b("Promise"))).all(a.map(function(a){a=a.notification;a=o(a);return a})).then(function(b){var c={groupRecoveries:[],participantRecoveries:[]},d=[];b.map(function(b,e){if(b.success===!0){d.push(a[e].stanzaQueueId);if(b.value!=null){e=b.value;e.type==="group"&&c.groupRecoveries.push(e.data.groupNotification.groupJid)}}});return{followUpParams:c,toAck:d}})}function o(a){switch(a.type){case"group":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_PROTOCOL_QUEUE_NOTIFICATION,key:a.type+"."+a.notification.type});return d("MAWProtocolQueueGroupNotification").handleProtocolQueueGroupNotification(a).then(function(a){return a.value?d("WAResultOrError").makeResult({data:a.value,type:"group"}):d("WAResultOrError").makeResult()});case"thread":a.notification.actions.forEach(function(b){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_PROTOCOL_QUEUE_NOTIFICATION,key:a.type+"."+b.type})});return m(a).then(function(){return d("WAResultOrError").makeResult()});default:a;d("WATagsLogger").TAGS(["ProtocolQueue"]).ERROR(l(),a.type);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}g.handleIncomingNotificationStanzas=a}),98);
__d("MAWCOPNotificationsHandler",["MAWCommonScheduler","MAWIsQuotaExceededError","MAWProtocolQueueGroupNotification","MAWProtocolQueueNotification","MAWSharedCOPLogger","WorkerScheduler","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing notifications batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["notification consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var e=(yield d("MAWProtocolQueueNotification").handleIncomingNotificationStanzas(a));e.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());a=e.followUpParams;var f=a.groupRecoveries,g=a.participantRecoveries;g.length>0&&c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return d("MAWProtocolQueueGroupNotification").doParticipantRecovery(g)},name:"ParticipantsRecovery",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));f.length>0&&c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWProtocolQueueGroupNotification").doGroupRecovery(f)});function c(){return a.apply(this,arguments)}return c}(),name:"GroupsRecovery",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));return e.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWIncomingReceiptDataFormatTxns",["MAWDbMsgTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWMsgType","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to map the threadId of a message to its threadJid during receipt-writing"]);h=function(){return a};return a}function i(a){var b=a.author,c=a.chat;a=a.externalId;return c+"_"+a+"_"+b}function a(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var c=new Map(),e=new Set();b.forEach(function(a){a=a.msgs;a.forEach(function(a){return e.add(babelHelpers["extends"]({},a))})});a=d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,Array.from(e)),d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByProtocolMsgId(a,Array.from(e))]).then(function(a){var b=a[0];a=a[1];var c=[];b.forEach(function(a){return c.push({msg:a,renderType:"regular"})});a.forEach(function(a){return c.push({msg:a,renderType:"unrendered"})});return{msgs:c}});return a.then(function(a){a=a.msgs;b.forEach(function(a){var b=a.msgs,d=a.receivers,e=a.type;b.forEach(function(a){var b=i(a),f=c.get(b)||{deliveryReceipts:[],protocolMsgId:a,readReceipts:[],senderReceipts:[]};d.forEach(function(a){if(e==="read"||e==="read-self"){f.readReceipts.push(a);return}else if(e==="delivered"){f.deliveryReceipts.push(a);return}else if(e==="sender"){f.senderReceipts.push(a);return}else if(e==="inactive"){f.deliveryReceipts.push(a);return}e});c.set(b,f)})});var e=new Map(),f=new Map(),g=[];a.forEach(function(a){var b=a.msg,g=b.author,j=b.externalId,k=b.msgId,l=b.threadJid;b=b.type;if(l==null){d("WALogger").ERROR(h());return}if(b!==d("MAWMsgType").MSG_TYPE.CIPHERTEXT){b=i({author:g,chat:l,externalId:j});g=c.get(b);if(g!=null){g.protocolMsgId;l=babelHelpers.objectWithoutPropertiesLoose(g,["protocolMsgId"]);j=babelHelpers["extends"]({msgId:k},l);f.set(k,j);c["delete"](b)}}e.set(k,a)});c.forEach(function(a){var b=a.deliveryReceipts,c=a.protocolMsgId;a=a.readReceipts;if(b.length===0&&a.length===0)return;var d=c.author,e=c.chat;c=c.externalId;g.push({author:d,deliveryReceipts:b,externalId:c,readReceipts:a,thread:e})});return{msgIdToDbMsgMap:e,pendingReceiptsToWrite:g,receiptsToWriteMap:f}})}g.prepareDataForReceiptsToWrite=a}),98);
__d("MAWIncomingReceiptUtils",["WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["User "," is in affectedUserJids in receipt-writing results, but they have no corresponding read/delivery receipt entry in the DB"]);h=function(){return a};return a}function a(a){var b=new Map();a.forEach(function(a){if(a.msgRenderType==="unrendered")return;a.affectedUserJids.forEach(function(c){var e=a.receipt.statusTsPerUser.get(c);if(e==null){d("WALogger").WARN(h(),c);return}c=[a.threadJid,c];var f=b.get(JSON.stringify(c)),g=e.deliveredTs!=null,i=e.readTs!=null;g=g?a.msgTs:0;i=i?a.msgTs:0;e=(e=e.readTs)!=null?e:0;if(f!=null){var j=f.lastDeliveredMsgTs,k=f.lastReadMsgTs;f=f.lastReadActionTs;g=Math.max(g,j);i=Math.max(i,k);e=Math.max(e,f)}b.set(JSON.stringify(c),{lastDeliveredMsgTs:d("WATimeUtils").castToUnixTime(g),lastReadActionTs:d("WATimeUtils").castToUnixTime(e),lastReadMsgTs:d("WATimeUtils").castToUnixTime(i)})})});return new Map(Array.from(b).map(function(a){var b=a[0];a=a[1];return[JSON.parse(b),a]}))}g.getMaxTimestampsPerParticipant=a}),98);
__d("MAWAckAndTimestampUpdatesForReceiptsTxns",["MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIncomingReceiptUtils","MAWLoggerUtils","WATagsLogger","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating timestamps for "," participants"]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.Incoming]);function a(a,b,e){b=d("MAWIncomingReceiptUtils").getMaxTimestampsPerParticipant(b);i.LOG(h(),b.size);var f=[];b.forEach(function(a,b){f.push({deliveredWatermarkTs:a.lastDeliveredMsgTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadMsgTs,participantKey:b})});b=e.regular.length>0?d("MAWDbMsgTxns").bulkUpdateSystemAck(a,e.regular):d("MAWDexieTable").dexieResolve();e=e.unrendered.length>0?d("MAWDbUnrenderedMsgTxns").bulkUpdateSystemAckForUnrenderedMsgs(a,e.unrendered):d("MAWDexieTable").dexieResolve();b=d("MAWDexieTable").dexieAll([b,e]);return d("MAWDexieTable").dexieAll([b,f.length>0?d("MAWDbParticipantTxns").bulkUpdateParticipantTimestamps(a,f,i):d("MAWDexieTable").dexieResolve()]).then(c("emptyFunction"))}g.handleAckAndTimestampUpdatesForReceipts=a}),98);
__d("MAWDbPendingReceiptTxns",["WAJids","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.map(function(a){var b=a.author,c=a.externalId;a=a.thread;return d("WAMsg").craftWAMsgIdString({author:b,chat:a,externalId:c})});return a.pendingReceipts.where("id").anyOf(c).toArray().then(function(c){var e=new Map();c.forEach(function(a){e.set(a.id,a)});var f=b.map(function(a){var b=a.author,c=a.externalId,f=a.thread,g=d("WAMsg").craftWAMsgIdString({author:b,chat:f,externalId:c}),h=e.get(g),i=(h=h)!=null?h:{author:b,deliveryReceipts:[],externalId:c,id:g,readReceipts:[],thread:f};b===d("WAJids").AUTHOR_ME?(a.deliveryReceipts.forEach(function(a){i.deliveryReceipts.push(a)}),a.readReceipts.forEach(function(a){i.readReceipts.push(a)})):(i.deliveryReceipts=[],a.readReceipts.forEach(function(a){i.readReceipts.push(a)}));return i});return a.pendingReceipts.bulkPut(f).then(function(){return f})})}function b(a,b){return a.pendingReceipts.bulkGet(b)}g.bulkAddPendingReceipts=a;g.getPendingReceipts=b}),98);
__d("MAWIncomingReceiptDataFormatUtils",["MAWAckLevel","MAWDbMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=[],e=[];a.forEach(function(a){var f=null,g=a.receipt.msgId,h=a.receipt.statusTsPerUser,i=b.get(g);if(i==null)return;var j=i.msg;i=i.renderType;a.affectedUserJids.forEach(function(a){var b,c=null;((b=h.get(a))==null?void 0:b.readTs)!=null?c=d("MAWAckLevel").ACK.read:((b=h.get(a))==null?void 0:b.deliveredTs)!=null&&(c=d("MAWAckLevel").ACK.received);f=f==null||c!=null&&c>f?c:f});f!=null&&f>j.ack&&(i==="regular"?c.push({ack:f,msgId:g,reportingMeta:null}):(i,e.push({ack:f,msgId:g})))});return{regular:c,unrendered:e}}function b(a,b,c){return a.map(function(a){var e=b.get(a.receipt.msgId);if(e==null)return null;var f=e.msg,g=c.get(f.msgId);return g==null||g.deliveryReceipts.length===0&&g.readReceipts.length===0?null:babelHelpers["extends"]({},a,{externalId:f.externalId,msgRenderType:e.renderType,msgTs:d("MAWDbMsg").getCanonicalTsFromMsg(f),threadJid:f.threadJid})}).filter(Boolean)}g.createUpdateSystemAckParams=a;g.formatWriteReceiptResultsWithExtras=b}),98);
__d("MAWReceiptTrace",["ArmadilloDataTraceType","MAWBridgeTrace","MAWBridgeTraceEvent","MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==="delivered"){a=b.reduce(function(a,b){return b.externalId!=null?[].concat(a,[b.externalId]):a},[]);a.length>0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData(a,c("MAWBridgeTraceEvent").ReceivedReceipt,d("ArmadilloDataTraceType").armadilloMessageSend)})}}g.flushTrace=a}),98);
__d("MAWIncomingReceiptTxns",["MAWAckAndTimestampUpdatesForReceiptsTxns","MAWDbPendingReceiptTxns","MAWDbReceiptTxns","MAWDexieTable","MAWIncomingReceiptDataFormatUtils","MAWReceiptTrace"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();var c=b.msgIdToDbMsgMap,e=b.pendingReceiptsToWrite,f=b.receiptsToWriteMap;b=Array.from(f.values());return d("MAWDexieTable").dexieAll([d("MAWDbReceiptTxns").bulkWriteReceiptsForDevices(b),d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,e)]).then(function(b){b=b[0];var e=d("MAWIncomingReceiptDataFormatUtils").createUpdateSystemAckParams(b,c);b=d("MAWIncomingReceiptDataFormatUtils").formatWriteReceiptResultsWithExtras(b,c,f);var g=b.filter(function(a){a=((a=f.get(a.receipt.msgId))==null?void 0:a.deliveryReceipts)||[];return a.length>0});g.length>0&&d("MAWReceiptTrace").flushTrace("delivered",g);return d("MAWAckAndTimestampUpdatesForReceiptsTxns").handleAckAndTimestampUpdatesForReceipts(a,b,e)})}g.bulkHandleIncomingReceipts=a}),98);
__d("MAWWriteAppDataReceiptsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeAppDataReceipts",function(a){return function(b){return h(a,b).then(function(b){return i(a,b)})}});function h(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=b.reduce(function(a,b){var c=a.appDataExternalIdSet,d=a.appDataReceiversSet;a=b.externalIds;b=b.receivers;a.forEach(function(a){c.add(a)});b.forEach(function(a){d.add(a)});return{appDataExternalIdSet:c,appDataReceiversSet:d}},{appDataExternalIdSet:new Set(),appDataReceiversSet:new Set()});var c=b.appDataExternalIdSet;b=b.appDataReceiversSet;c=Array.from(c);var e=Array.from(b);return a.appData.where("externalId").anyOf(c).toArray().then(function(a){if(a.length===0)return;return j(a,e)})}function i(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();var e=b.toDelete;b=b.toUpdate;return d("MAWDexieTable").dexieAll([e.length>0?a.appData.bulkDelete(e):d("MAWDexieTable").dexieResolve(),b.length>0?a.appData.bulkPut(b):d("MAWDexieTable").dexieResolve()]).then(c("emptyFunction"))}function j(a,b){return a.reduce(function(a,c){if(c==null)return a;for(var d of b)c.permittedIdentitiesPerDevice["delete"](d);if(c.permittedIdentitiesPerDevice.size===0){a.toDelete.push(c.appDataId);return a}else{a.toUpdate.push(c);return a}},{toDelete:[],toUpdate:[]})}g.writeAppDataReceipts=a;g.prepareBulkAppDataReceipts=h;g.writeBulkAppDataReceipts=i}),98);
__d("MAWWritePeerMsgReceiptsApi",["MAWDbMsg","MAWDbMsgTxns","MAWDbPendingReceiptTxns","MAWDexieTable","MAWLoggerUtils","MAWMarkThreadAsReadTxns","MAWMsgType","WAGlobals","WAJids","WATagsLogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," receipt for messages not from me"]);h=function(){return a};return a}function i(a,b,c){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(a){return a==null||a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?{msg:b,readReceipt:c,type:"missing"}:{dbMsg:a,msg:b,readReceipt:c,type:"found"}})}function j(a){a=a.map(function(a){return a.type==="missing"?null:a.dbMsg}).filter(Boolean);return a.reduce(function(a,b){var c=b.threadJid,e=d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(b)),f=a.get(c);(f==null||e>f.msgSortOrderMs)&&a.set(c,{msgId:b.msgId,msgSortOrderMs:e});return a},new Map())}function a(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.map(function(a){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.PeerReceipt]).LOG(h(),a.type);if(a.type==="delivered")return;var b={device:void 0,ts:void 0};a.receivers.forEach(function(a){var c=a.device;a=a.ts;var e=d("WAJids").extractUserJid(c);e===d("WAGlobals").getMyUserJid()&&(b.ts==null||a<b.ts)&&(b.device=c,b.ts=a)});if(b.device!=null&&b.ts!=null)return babelHelpers["extends"]({},a,{receivers:{device:b.device,ts:b.ts}});else return}).filter(Boolean);var c=[];b.forEach(function(a){a.msgs.forEach(function(b){c.push([b,a.receivers])})});return d("MAWDexieTable").dexieAll(c.map(function(b){var c=b[0];b=b[1];return i(a,c,b)}))}function b(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var e=[],f=[];b.map(function(a){a.type==="missing"?e.push({author:a.msg.author,deliveryReceipts:[],externalId:a.msg.externalId,readReceipts:[a.readReceipt],thread:a.msg.chat}):f.push({msgId:a.msg,ts:a.readReceipt.ts})});var g=j(b);b=b.reduce(function(a,b){b=b.msg.chat;var c=g.get(b);c!=null&&a.set(b,{msgId:c.msgId,sortOrderMs:c.msgSortOrderMs});return a},new Map());return d("MAWDexieTable").dexieAll([d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,e),d("MAWMarkThreadAsReadTxns").bulkMarkThreadAsReadUpToMsgSortOrderMs(a,b)]).then(c("emptyFunction"))}g.getResultByProtocolMsgId=i;g.prepareReceiptsForMeToWrite=a;g.bulkWritePeerReceiptsForMsgsNotFromMeInternal=b}),98);
__d("MAWBulkWriteReceiptsApi",["MAWDexieTable","MAWIncomingReceiptDataFormatTxns","MAWIncomingReceiptTxns","MAWIndexedDb","MAWTransactionMode","MAWWriteAppDataReceiptsApi","MAWWritePeerMsgReceiptsApi","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=[],e=[],f=[];b.forEach(function(a){switch(a.type){case"msg-receipt":c.push(a.params);break;case"not-from-me":e.push(a.params);break;default:f.push(a.params);break}});return d("MAWDexieTable").dexieAll([f.length>0?d("MAWWriteAppDataReceiptsApi").prepareBulkAppDataReceipts(a,f):d("MAWDexieTable").dexieResolve(),c.length>0?d("MAWIncomingReceiptDataFormatTxns").prepareDataForReceiptsToWrite(a,c):d("MAWDexieTable").dexieResolve(),e.length>0?d("MAWWritePeerMsgReceiptsApi").prepareReceiptsForMeToWrite(a,e):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b==null)return{incomingReceiptData:c,processedPeerReceiptsNotForMeResults:a};var d=b.toDelete;b=b.toUpdate;return{appDataReceipts:{toDelete:d,toUpdate:b},incomingReceiptData:c,processedPeerReceiptsNotForMeResults:a}})}b=d("MAWIndexedDb").makeMsgrTransactor({appData:(a=d("MAWTransactionMode")).READWRITE,chunk:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,pendingReceipts:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"bulkWriteReceipts",function(a){return function(b){return b.length===0?d("MAWDexieTable").dexieResolve():h(a,b).then(function(b){var e=b.appDataReceipts,f=b.incomingReceiptData;b=b.processedPeerReceiptsNotForMeResults;return d("MAWDexieTable").dexieAll([e!=null&&(e==null?void 0:e.toDelete.length)>0&&(e==null?void 0:e.toUpdate.length)>0?d("MAWWriteAppDataReceiptsApi").writeBulkAppDataReceipts(a,e):d("MAWDexieTable").dexieResolve(),f!=null?d("MAWIncomingReceiptTxns").bulkHandleIncomingReceipts(a,f):d("MAWDexieTable").dexieResolve(),b.length>0?d("MAWWritePeerMsgReceiptsApi").bulkWritePeerReceiptsForMsgsNotFromMeInternal(a,b):d("MAWDexieTable").dexieResolve()]).then(c("emptyFunction"))})}});g.bulkWriteReceipts=b}),98);
__d("MAWSharedProtocolQueueReceipt",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function g(a){if(a.receiptType==="appdata")return{params:{externalIds:a.externalIds,receivers:[a.from]},type:"appdata"};var b,c,d=a.chat;switch(a.receiptType){case"user":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;case"group":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;default:a.receiptType;c=[a.externalId];b=a.receivers;break}var e=a.messageAuthor;a=a.type;if(e==="@me"||a==="sender")return{params:{msgs:c.map(function(a){return{author:"@me",chat:d,externalId:a}}),receivers:b,type:a},type:"msg-receipt"};else return{params:{msgs:c.map(function(a){return{author:e,chat:d,externalId:a}}),receivers:b,type:a},type:"not-from-me"}}function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.map(function(a){a=g(a.receipt);return a});yield b(c);return{followUpParams:void 0,toAck:a.map(function(a){return a.stanzaQueueId})}});return h.apply(this,arguments)}f.sharedHandleIncomingReceiptStanza=a}),66);
__d("WADbHandlePermitedIdentitiesApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"handlePermitedIdentitiesPerDevice",function(a){return function(b){var c=Array.from(b.keys());return a.receipts.where("waMsgId").anyOf(c).toArray().then(function(a){return a.map(function(a){var c;c=(c=b.get(a.waMsgId))!=null?c:new Set();for(c of c){var d;(d=a.permittedIdentitiesPerDevice)==null?void 0:d["delete"](c)}return a})}).then(function(b){return a.receipts.bulkPut(b).then(function(){})})}});g.handlePermitedIdentitiesPerDevice=a}),98);
__d("WAPreKeysStanzaUtils",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;return(b=d("WAWap")).wap("key",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey))}function b(a){var b;return(b=d("WAWap")).wap("skey",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey),b.wap("signature",null,a.signature))}function c(a){var b=a.child("skey"),c=null;if(a.hasChild("key")){var d=a.child("key");c={id:d.child("id").contentUint(3),publicKey:d.child("value").contentSerializedPubKey()}}return{identity:a.child("identity").contentSerializedPubKey(),signedKey:{id:b.child("id").contentUint(3),publicKey:b.child("value").contentSerializedPubKey(),signature:b.child("signature").contentBytes(64)},oneTimeKey:c}}g.xmppPreKey=a;g.xmppSignedPreKey=b;g.readSessionInfo=c}),98);
__d("WAReceiptUtils",["WACryptoManagerUtils","WADeprecatedSendIq","WAMapWithDefault","WAMsg","WAPreKeysStanzaUtils","WARequestPreKeyDigest","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.retryCount;c=c+1;c>=3&&(yield d("WARequestPreKeyDigest").requestPreKeyDigestFn(function(a){return a(b)}));var e=null;c>=2&&(e=(yield d("WACryptoManagerUtils").getSignalInfoForRetry(b.cryptoManager)));var f=b.cryptoManager.regInfo.regId;return k(a,c,f,e)});return i.apply(this,arguments)}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.externalId,e=a.from,f=a.participant,g;e.type==="group"?g=e.groupJid:(e.type,g=e.deviceJid);yield d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(yield h(a,b),{id:c,"class":"receipt",from:g,participant:f})});return j.apply(this,arguments)}function k(a,b,c,e){var f=null;if(e!=null){var g=e.keyType,h=e.signedPreKey,i=e.preKey;e=e.publicKey;var j=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null;f=d("WAWap").wap("keys",null,d("WAWap").wap("type",null,d("WAWap").BIG_ENDIAN_CONTENT(g,1)),d("WAWap").wap("identity",null,e),d("WAPreKeysStanzaUtils").xmppPreKey(i),d("WAPreKeysStanzaUtils").xmppSignedPreKey(h),j)}a.from.type==="group"?g=a.from.groupJid:(a.from.type,g=a.from.deviceJid);return d("WAWap").wap("receipt",{category:a.category!=null?d("WAWap").CUSTOM_STRING(a.category):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:a.participant?d("WAWap").DEVICE_JID(a.participant):d("WAWap").DROP_ATTR,recipient:a.recipient?d("WAWap").USER_JID(a.recipient):d("WAWap").DROP_ATTR,to:d("WAWap").JID(g),type:"retry"},d("WAWap").wap("retry",{count:d("WAWap").INT(b),id:d("WAWap").CUSTOM_STRING(a.externalId),t:d("WAWap").INT(a.ts),v:"1"}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(c)),f)}function c(a){var b=new(d("WAMapWithDefault").MapWithDefault)(function(a){return new Set()});for(a of a){var c=a.receipt;if(c.receiptType==="group"||c.receiptType==="user")for(var e of c.externalIds)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:e})).add(c.from.author);else if(c.receiptType==="group-server-agg")for(e of c.receivers)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:c.externalId})).add(e.device)}return b.toMap()}g.makeRetryReceipt=h;g.sendRetryReceipt=a;g.calculateIdentitiesToDelete=c}),98);
__d("MAWProtocolQueueReceipt",["MAWBulkWriteReceiptsApi","MAWSharedProtocolQueueReceipt","WADbHandlePermitedIdentitiesApi","WAReceiptUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WADbHandlePermitedIdentitiesApi").handlePermitedIdentitiesPerDevice(d("WAReceiptUtils").calculateIdentitiesToDelete(a)).then(function(){return d("MAWSharedProtocolQueueReceipt").sharedHandleIncomingReceiptStanza(a,d("MAWBulkWriteReceiptsApi").bulkWriteReceipts)})}g.handleIncomingReceiptStanza=a}),98);
__d("MAWCOPReceiptsHandler",["MAWIsQuotaExceededError","MAWProtocolQueueReceipt","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing receipts batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["receipt consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueReceipt").handleIncomingReceiptStanza(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWBulkGetAppDataForRetryApi",["MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("WATimeUtils").DAY_SECONDS;a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READONLY},"bulkGetAppDataForRetry",function(a){return function(b){var c=b.map(function(a){a=a.externalId;return a});return a.appData.where("externalId").anyOf(c).toArray().then(function(a){var c=new Map(a.map(function(a){return[a.externalId,a]}));return b.map(function(a){var b=a.deviceJid;a=a.externalId;a=c.get(a);if(a==null)return{type:"missing"};b=a.permittedIdentitiesPerDevice.get(b);return b==null||!d("WATimeUtils").happenedWithin(a.ts,h)?{type:"unauthorized"}:{appData:a.contents,deviceIdentity:b,permittedIdentitiesPerDevice:a.permittedIdentitiesPerDevice,type:"unacked"}})})}});g.bulkGetAppDataForRetry=a}),98);
__d("MAWConstants",[],(function(a,b,c,d,e,f){"use strict";a=5;b="Facebook user";c="Instagram user";d=3;f.MESSAGE_RETRY_COUNT_LIMIT=a;f.FB_UNKNOWN_USER=b;f.INS_UNKNOWN_USER=c;f.CURRENT_REGISTRATION_VERSION=d}),66);
__d("MAWWriteAppDataRetryApi",["MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeAppDataRetry",function(a){return function(b,d,e){return a.appData.get({externalId:b}).then(function(b){if(b==null)return;var f=b.permittedIdentitiesPerDevice,g=f.get(d);if(g==null)return;g.baseKey=e;f.set(d,g);return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:f}).then(c("emptyFunction"))})}});g.writeAppDataRetry=a}),98);
__d("WAMarkParticipantNeedsKeyApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"markParticipantNeedsKey",function(a){return function(b,c){return d("WADbPersonalSenderKeyStatusTxns").removeDevicesToMultiplePersonalSenderKeyStatuses(a,[b],[c]).then(function(){})}});g.markParticipantNeedsKey=a}),98);
__d("WAMarkParticipantNeedsKeyApiV2",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.personalSenderKeyStatuses.get(a));if(d==null||d.rotateSenderKey)return;d.hasSenderKey["delete"](c);yield b.stores.personalSenderKeyStatuses.bulkPut([d])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("markParticipantNeedsKey"))};g.markParticipantNeedsKey=a}),98);
__d("WASendAppDataIndividualProtocol",["WAAsMessageApplication","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendAppData Failed to encrypt appdata"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata retry to device with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to device with error: ",""]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["sendAppDataIndividual"]);function a(a,b,c,e,f){return o(a,b,c,void 0,e,f)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(m(),a);return d("WAResultOrError").makeError("runtime-error")})}function c(a,b,c,e,f,g){return o(a,b,c,e,f,g)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(l(),a);return d("WAResultOrError").makeError("runtime-error")})}function o(a,b,c,d,e,f){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){n.LOG(k(),b);a=d("WAConvertAppData").convertAppData(a);var l={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArray()),version:"v3"};a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptDeviceJidMessage(c,{messageBytes:l,type:"appdata"},{cryptoManager:a},void 0,g,f)},{operationType:"encrypt",flush:!0}));if(a==null){n.LOG(j());return d("WAResultOrError").makeError("encrypt-failure")}var m;e!=null&&(m={appdataT:d("WATimeUtils").unixTime(),encRetryMixinArgs:{encCount:e}});e={appdataTo:c,encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)},encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},retryMixinArgs:m};e={peerPeerSingle:e};var o=void 0;if(a.type==="pkmsg"){var p=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());p=p==null?void 0:p.identityKey;if(p==null){n.ERROR(i());return d("WAResultOrError").makeError("no-public-identity")}o={deviceIdentityElementValue:p}}p={appdataId:b,peerMsgTypesArgs:e,deviceIdentityMixinArgs:o};b=(yield d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(p));switch(b.name){case"PeerResponseSuccess":return d("WAResultOrError").makeResult({baseKey:a.baseKey});default:b.name;n.ERROR(h(),b.value.error);return d("WAResultOrError").makeError("ack-failure")}});return p.apply(this,arguments)}g.sendAppDataToIndividualDeviceProtocol=a;g.sendAppDataRetryToIndividualDeviceProtocol=c}),98);
__d("WAWriteMsgRetryApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetry",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){if(b==null||b.permittedIdentitiesPerDevice==null)return;var e=b.permittedIdentitiesPerDevice,f=e.get(c);if(f==null)return;f.baseKey=d;e.set(c,f);return a.receipts.put(babelHelpers["extends"]({},b,{permittedIdentitiesPerDevice:e})).then(function(){})})}g.writeMsgRetry=a}),98);
__d("WAWriteMsgRetryCountApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetryCount",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){var e;if(b==null||d==null)return;e=(e=b.retryCountsPerDevice)!=null?e:new Map();e.set(c,d);return a.receipts.put(babelHelpers["extends"]({},b,{retryCountsPerDevice:e})).then(function(){})})}g.writeMsgRetryCount=a}),98);
__d("MAWSharedHandleRetryRequest",["MAWBulkGetAppDataForRetryApi","MAWConstants","MAWDebugMsg","MAWWriteAppDataRetryApi","Promise","WACryptoManagerUtils","WACryptoUtils","WADexieToWormMigration","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMarkParticipantNeedsKeyApi","WAMarkParticipantNeedsKeyApiV2","WAQPLProxy","WASendAppDataIndividualProtocol","WASendMsgInternal","WASentBytesCache","WAWap","WAWriteMsgRetryApi","WAWriteMsgRetryCountApi","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because receipt is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because (messageId, deviceJID, retryCount) is already executed for retryCount ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type "," id: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest unexpected receipt"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest called for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown receipt categories: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied due to retry count"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received retry request from peer without recipient set"]);q=function(){return a};return a}function r(){var a=0,b=0,c=new Map();return{getMetrics:function(){var d;return{appDataMissing:(d=c.get("appDatamissing"))!=null?d:0,appDataUnauthorized:(d=c.get("appDataunauthorized"))!=null?d:0,appDataUnsupported:(d=c.get("appDataunsupported"))!=null?d:0,msgMissing:(d=c.get("msgmissing"))!=null?d:0,msgUnauthorized:(d=c.get("msgunauthorized"))!=null?d:0,msgUnsupported:(d=c.get("msgunsupported"))!=null?d:0,receiptFailures:b,receiptSuccesses:a}},markError:function(){return b++},markSuccess:function(){return a++},setError:function(a){var b=c.get(a);b!=null?c.set(a,b+1):c.set(a,1)}}}function s(a,b){return b+"_"+a}function a(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];d("WALogger").LOG(n(),a.map(function(a){a=a.externalId;return a}).join(","));var e=d("WAQPLProxy").waQPLProxyStart(c("qpl")._(25308942,"164"),{bool:{bulk:!0},"int":{receipts:a.length},string:{origin:self.location.origin}}),f=new Set(a.filter(function(a){return a.category!=null&&!C(a)||D(a)}).map(function(a){return a.externalId})),g=a.filter(function(a){return!f.has(a.externalId)&&!C(a)}),i=a.filter(C);i=(yield (h||(h=b("Promise"))).all([u(i),x(g)]));g=i[0];i=i[1];e.addPoint("get_msg_for_retry_complete");var j=[],k=r();for(a of a){var l=g.get(a.externalId),o=i.get(s(a.from.author,a.externalId));f.has(a.externalId)?(e.addPoint("just_ack"),k.markError(),k.setError("just_ack"),E(a)):l!=null?(e.addPoint("app_data_for_retry"),yield F(a,l,e,!1,k),e.addPoint("app_data_for_retry_complete")):o!=null?(e.addPoint("msg_for_retry"),yield H(a,o,e,!1,k),e.addPoint("msg_for_retry_complete")):(d("WALogger").ERROR(m()),k.markError(),k.setError("unexpected_receipt"));j.push(B(a))}e.endSuccess({"int":babelHelpers["extends"]({},k.getMetrics())});return j});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=a.map(function(a){var b=a.externalId;a=a.from;return{deviceJid:a.author,externalId:b}});b=(yield d("MAWBulkGetAppDataForRetryApi").bulkGetAppDataForRetry(b));return new Map(b.map(function(b,c){c=a[c];return[c.externalId,b]}))});return v.apply(this,arguments)}function w(a){return a.map(function(a){var b=a.externalId,c=a.from,e=a.recipient,f=c.chat;if(c.type==="device"&&d("WAJids").extractUserJid(c.author)===d("WAJids").extractUserJid(d("WAGlobals").getMyDeviceJid())){if(e==null){d("WALogger").ERROR(q());return}f=e}e={author:"@me",chat:f,externalId:b};return{deviceJid:c.author,protocolMsgId:e,retryCount:a.retryCount}})}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=w(a),c=a.filter(function(a,c){return b[c]!=null}),e=b.filter(Boolean);a=(yield d("WASentBytesCache").sentBytesCache().getMsgsForRetry(e));a=new Map(a.map(function(a,b){return[s(e[b].deviceJid,c[b].externalId),{msgForRetry:a,retryRequest:e[b]}]}));return a});return y.apply(this,arguments)}function z(a,b){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=void 0,e=(yield d("WAGlobals").getWaOneQueue().enqueue(function(b){b=b.cryptoManager;return d("WACryptoManagerUtils").getParticipantInfo(a.from.author,b)},{flush:!1,operationType:"get_participant_info"}));if(a.keys!=null){var f=a.keys,g=a.timestamp;b={baseKey:b.baseKey,keys:f,timestamp:g};f=J(a,e);f?c={session:b,type:"compareTSAndUseSession"}:c={session:b,type:"useSession"}}else{g=e==null||a.regId!==e.regId;g&&(c={type:"requestNewSession"})}return c});return A.apply(this,arguments)}function B(a){var b,c=a.externalId;a=a.from;return(b=d("WAWap")).wap("ack",{"class":"receipt",id:b.CUSTOM_STRING(c),participant:b.PARTICIPANT_JID(a),to:b.TO_JID(a),type:"retry"})}function C(a){a=a.category;return a==="peer_appdata"||a==="peer"}function D(a){a=a.retryCount;return a>=d("MAWConstants").MESSAGE_RETRY_COUNT_LIMIT}function E(a){if(D(a)){d("WALogger").LOG(p());return}if(a.category!=null){d("WALogger").WARN(o(),a.category);return}}function F(a,b,c,d,e){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){e===void 0&&(e=!0);var g=a.externalId,h=a.from,i=a.retryCount;c.addPoint("get_app_data_for_retry");if(b.type!=="unacked"){d("WALogger").LOG(l(),b.type,g);e?c.endFail(b.type):c.addPoint(b.type);f==null?void 0:f.markError();f==null?void 0:f.setError("appData"+b.type);return}e=b.appData;b=b.deviceIdentity;a=(yield z(a,b));c.addPoint("get_session_info");e=(yield d("WASendAppDataIndividualProtocol").sendAppDataRetryToIndividualDeviceProtocol(e,g,h.author,i,b.pubKey,a));c.addPoint("send_app_data");if(i>=2&&e.success===!0&&e.value.baseKey!=null){b=e.value.baseKey;yield d("MAWWriteAppDataRetryApi").writeAppDataRetry(g,h.author,b)}f==null?void 0:f.markSuccess();return e});return G.apply(this,arguments)}function H(a,b,c,d,e){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h;f===void 0&&(f=!0);var l=b.msgForRetry;b=b.retryRequest;var m=a.externalId,n=a.from,o=a.retryCount,p=b.protocolMsgId.chat;if(l.type!=="unacked"){f&&e.endFail(l.type);d("WALogger").LOG(k(),l.type);g==null?void 0:g.markError();g==null?void 0:g.setError("msg"+l.type);return}if(l.retryCount!=null&&l.retryCount>0&&l.retryCount===o){f&&e.endFail("unauthorized");d("WALogger").LOG(j(),o);g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}if(n.type==="group"){var q=d("WADexieToWormMigration").isWorm("MAWSharedHandleRetryRequest")?d("WAMarkParticipantNeedsKeyApiV2").markParticipantNeedsKey:d("WAMarkParticipantNeedsKeyApi").markParticipantNeedsKey;yield q(n.chat,n.author);e.addPoint("mark_participant_needs_key_complete")}q=l.backupDirective;var r=l.frankingKey,s=l.frankingVersion,t=l.isInstamadillo,u=l.messageBytes,v=l.messageType,w=l.protocolMsgId,x=(yield d("WALoadReceiptApi").loadReceipt({author:w.author,chat:w.chat,externalId:w.externalId}).then(function(a){return a.success?a.value:null}));h=x==null?void 0:(h=x.permittedIdentitiesPerDevice)==null?void 0:h.get(b.deviceJid);if(x==null||h==null){f&&e.endFail("unauthorized");d("WALogger").LOG(i());g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}x=(yield z(a,h));e.addPoint("get_session_info_complete");c("gkx")("24021")&&(yield d("MAWDebugMsg").writeDebugMsg(p,"Handling retry request for message: "+l.protocolMsgId.externalId.toString()+" to user "+n.author));f=(yield d("WAGenReportingMeta").genReportingMeta(u.bytes,r,s));a=(yield d("WASendMsgInternal").sendMessage({backupDirective:q,chat:p,count:o,deviceIdentity:null,externalId:m,identityKey:h.pubKey,messageBytes:u,messageType:v,protocolMsgId:w,reportingMeta:f,sessionInfo:x,to:n.author,type:"direct"},e,t));e.addPoint("send_message_complete");if(o>=2&&a.success&&a.value.baseKey!=null){l=a.value.baseKey;yield d("WAWriteMsgRetryApi").writeMsgRetry(b.protocolMsgId,n.author,l)}o>=1&&a.success&&(yield d("WAWriteMsgRetryCountApi").writeMsgRetryCount(b.protocolMsgId,n.author,o));g==null?void 0:g.markSuccess()});return I.apply(this,arguments)}function J(a,b){if(a.offline==null)return!1;var c=b==null||a.regId!==b.regId;b=b!=null&&a.keys!=null&&!d("WACryptoUtils").uint8ArraysEqual(b.pubKey,a.keys.identity);return c||b}g.bulkHandleRetryRequest=a}),98);
__d("MAWCOPRetryHandler",["MAWIsQuotaExceededError","MAWSharedCOPLogger","MAWSharedHandleRetryRequest","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["receipt consumer: ",""]);h=function(){return a};return a}function a(a){return i(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(h(),a);return[]})}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];yield d("MAWSharedHandleRetryRequest").bulkHandleRetryRequest(a.map(function(a){return a.retry}));return a.map(function(a){return a.stanzaQueueId})});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSplitProtocolEntityByType",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b={appdatas:[],instructions:[],messages:[],notifications:[],receipts:[],retries:[]};a.forEach(function(a){switch(a.type){case"message":b.messages.push(a);return;case"retryReceipt":b.retries.push(a);return;case"appdata":b.appdatas.push(a);return;case"notification":b.notifications.push(a);return;case"receipt":b.receipts.push(a);return;default:a;b.instructions.push(a);return}});return b}f["default"]=a}),66);
__d("MawMpsPayloadToWaProtocolEntry",["MAWJids","MAWUnsafeCoerce","MpsDeserializers","MpsFutureProofKey","MpsTypes","WAArmadilloTransportEvent.pb","WADecodeIncomingMsg","WAFranking","WAFrankingTypes","WAJids","WAProtocolQueue","WAStanzaUtils","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return null}function a(a){return a.directive==null?null:i(a.message.payload,a.message.messageId,a.message.threadId,a.message.senderId,a.message.timestampMs,"wa")}function b(a){var b=a.toplevelProtobuf,c=b.messageId,d=b.payload,e=b.senderId,f=b.threadId;b=b.timestampMs;d=i(d,c,f,e,b,"ebrestore");c=a.supplementalProtobufs;b=Array.from(c.values()).map(function(a){a=i(a.payload,a.messageId,f,e,a.timestampMs,"ebrestore");return a});return[d].concat(b).filter(Boolean)}function i(a,b,c,e,f,g){a=d("MpsDeserializers").DeserializedBackupMessage.create(a);var i=a.payload();switch(i.kind){case"messageApplication":var j=i,k=j.subProtocol(),l;if(k==null){l=d("WADecodeIncomingMsg").parseEphemeralSetting(j.proto.metadata,i.bytes);if(l.type==="error")return null}else{var m;l={applicationPayload:j.bytes,backupDirective:null,frankingContent:j.bytes,icdc:null,metadata:(m=i.proto.metadata)!=null?m:null,protobuf:new Uint8Array(j.bytes),subprotocol:k.bytes,subprotocolType:k.kind==="armadillo"?"armadillo":"consumerMessage",type:"subprotocol",version:"v3"}}l={contentType:h(j),fbFolderId:null,from:d("WAJids").toDeviceJid(d("MAWJids").toUserJid(e),d("WAJids").DEFAULT_DEVICE_ID),incomingType:g,jid:d("MAWJids").threadIdToChatJid(c),message:l,offline:null,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,recipient:void 0,remoteIdentity:null,reportingMeta:{frankingKey:null,frankingTag:((m=a.proto.metadata)==null?void 0:(k=m.frankingMetadata)==null?void 0:k.frankingTag)!=null?d("WAFrankingTypes").castToFrankingTag(new Uint8Array(a.proto.metadata.frankingMetadata.frankingTag)):null,frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null,reportingTag:((j=a.proto.metadata)==null?void 0:(g=j.frankingMetadata)==null?void 0:g.reportingTag)!=null?new Uint8Array(a.proto.metadata.frankingMetadata.reportingTag):null},retryCount:0,serverTs:d("WATimeUtils").castMilliSecondsToUnixTime(f),stanzaId:d("MpsTypes").messageIdToStanzaId(b),subtype:"armadillo",type:"message"};m=d("MAWUnsafeCoerce").unsafeCoerce(b);return babelHelpers["extends"]({},l,{stanzaQueueId:m});case"transportEvent":k=i;if(k.proto.event!=null){j=k.proto.event;if(j.icdcAlert!=null){g={instruction:"icdcError",jid:d("MAWJids").toUserJid(e),notificationTs:d("WATimeUtils").castMilliSecondsToUnixTime(f),priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,type:"instruction"};l=d("MAWUnsafeCoerce").unsafeCoerce(b);return babelHelpers["extends"]({},g,{stanzaQueueId:l})}}if(k.proto.placeholder!=null&&k.proto.placeholder.type!=null)switch(k.proto.placeholder.type){case d("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE:m={contentType:null,decryptionError:"",fbFolderId:null,from:d("WAJids").toDeviceJid(d("MAWJids").toUserJid(e),d("WAJids").DEFAULT_DEVICE_ID),hideDecryptionFailure:((m=a.proto.metadata)==null?void 0:m.futureProofBehavior)===d("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofNoPlaceholder,jid:d("MAWJids").threadIdToChatJid(c),offline:null,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,recipient:void 0,reportingMeta:{frankingKey:null,frankingTag:((j=a.proto.metadata)==null?void 0:(g=j.frankingMetadata)==null?void 0:g.frankingTag)!=null?d("WAFrankingTypes").castToFrankingTag(new Uint8Array(a.proto.metadata.frankingMetadata.frankingTag)):null,frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null,reportingTag:((l=a.proto.metadata)==null?void 0:(k=l.frankingMetadata)==null?void 0:k.reportingTag)!=null?new Uint8Array(a.proto.metadata.frankingMetadata.reportingTag):null},retryCount:0,serverTs:d("WATimeUtils").castMilliSecondsToUnixTime(f),stanzaId:d("WAStanzaUtils").toStanzaId(b),subtype:"ciphertext",type:"message"};j=d("MAWUnsafeCoerce").unsafeCoerce(b);return babelHelpers["extends"]({},m,{stanzaQueueId:j});case d("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.UNAVAILABLE_MESSAGE:j={contentType:null,fbFolderId:null,from:d("WAJids").toDeviceJid(d("MAWJids").toUserJid(e),d("WAJids").DEFAULT_DEVICE_ID),jid:d("MAWJids").threadIdToChatJid(c),offline:null,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,recipient:void 0,reportingMeta:{frankingKey:null,frankingTag:((g=a.proto.metadata)==null?void 0:(l=g.frankingMetadata)==null?void 0:l.frankingTag)!=null?d("WAFrankingTypes").castToFrankingTag(new Uint8Array(a.proto.metadata.frankingMetadata.frankingTag)):null,frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null,reportingTag:((k=a.proto.metadata)==null?void 0:(m=k.frankingMetadata)==null?void 0:m.reportingTag)!=null?new Uint8Array(a.proto.metadata.frankingMetadata.reportingTag):null},retryCount:0,serverTs:d("WATimeUtils").castMilliSecondsToUnixTime(f),stanzaId:d("WAStanzaUtils").toStanzaId(b),subtype:"unavailable",type:"message"};e=d("MAWUnsafeCoerce").unsafeCoerce(b);return babelHelpers["extends"]({},j,{stanzaQueueId:e})}break;case"locallyTransformedMessage":break;case"adminMessage":break;default:i}}function e(a,b,e){b=new Set(b);for(a of a)!b.has(d("MAWUnsafeCoerce").unsafeCoerce(a.message.messageId))&&!e.has(a.message.messageId)&&e.set(a.message.messageId,c("err")("Ack not received"));return e}g.mpsIncomingPayloadToWAProtocolEntry=a;g.mpsFullMessageToMawPayload=b;g.mawAcksToMpsIncomingPayloadErrorMap=e}),98);
__d("MAWProtocolQueueProcess",["FBLogger","MAWCOPAppdataHandler","MAWCOPInstructionsHandler","MAWCOPMessagesHandler","MAWCOPNotificationsHandler","MAWCOPReceiptsHandler","MAWCOPRetryHandler","MAWSharedCOPLogger","MAWSplitProtocolEntityByType","MawMpsPayloadToWaProtocolEntry","Promise","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New COP handler for "," msgs, "," appdatas, "," notifications, "," receipts, "," retries, "," instructions"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["New COP handler for "," msgs, "," appdatas, "," notifications, "," receipts, "," retries, "," instructions"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["New COP handler for "," msgs, "," appdatas, "," notifications, "," receipts, "," retries, "," instructions"]);k=function(){return a};return a}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=c("MAWSplitProtocolEntityByType")(a);c("MAWSharedCOPLogger").LOG(k(),a.messages.length,a.appdatas.length,a.notifications.length,a.receipts.length,a.retries.length,a.instructions.length);a=(yield (h||(h=b("Promise"))).all([c("MAWCOPMessagesHandler")(a.messages),c("MAWCOPInstructionsHandler")(a.instructions),c("MAWCOPReceiptsHandler")(a.receipts),c("MAWCOPAppdataHandler")(a.appdatas),c("MAWCOPNotificationsHandler")(a.notifications),c("MAWCOPRetryHandler")(a.retries)])).flat();return a});return l.apply(this,arguments)}function e(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){try{return d("MawMpsPayloadToWaProtocolEntry").mpsFullMessageToMawPayload(a)}catch(d){var b=c("getErrorSafe")(d);c("FBLogger")("COP").catching(b).mustfix("Failed to convert FullMessage %s to MAW payload",a.toplevelProtobuf.messageId);return null}}).flat().filter(Boolean);a=c("MAWSplitProtocolEntityByType")(a);c("MAWSharedCOPLogger").LOG(j(),a.messages.length,a.appdatas.length,a.notifications.length,a.receipts.length,a.retries.length,a.instructions.length);yield (h||(h=b("Promise"))).all([c("MAWCOPMessagesHandler")(a.messages),c("MAWCOPInstructionsHandler")(a.instructions),c("MAWCOPAppdataHandler")(a.appdatas),c("MAWCOPNotificationsHandler")(a.notifications)])});return m.apply(this,arguments)}function f(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=new Map(),f=a.map(function(a){try{return d("MawMpsPayloadToWaProtocolEntry").mpsIncomingPayloadToWAProtocolEntry(a)}catch(d){var b=c("getErrorSafe")(d);c("FBLogger")("COP").catching(b).mustfix("Failed to convert incoming payload to MAW payload");e.set(a.message.messageId,b);return null}}).flat().filter(Boolean);f=c("MAWSplitProtocolEntityByType")(f);c("MAWSharedCOPLogger").LOG(i(),f.messages.length,f.appdatas.length,f.notifications.length,f.receipts.length,f.retries.length,f.instructions.length);f=(yield (h||(h=b("Promise"))).all([c("MAWCOPMessagesHandler")(f.messages),c("MAWCOPInstructionsHandler")(f.instructions),c("MAWCOPAppdataHandler")(f.appdatas),c("MAWCOPNotificationsHandler")(f.notifications)])).flat();return d("MawMpsPayloadToWaProtocolEntry").mawAcksToMpsIncomingPayloadErrorMap(a,f,e)});return n.apply(this,arguments)}g.processProtocolQueueEntries=a;g.processMPSFullMessageEntries=e;g.processMPSIncomingPayloadEntries=f}),98);
__d("MAWDecryptUnstoredPollUpdateMessage",["FBLogger","MAWGroupPollsDualEncryptionUtils","Promise","WAGlobals","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=e.encryptedMessage.vote,i=e.encryptedMessage.addOption,j=f.encKey,k=f.pollAuthor===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyUserJid():d("WAJids").authorAsUserJid(f.pollAuthor);f=f.pollStanzaId;var l=a.externalId;a=a.author===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyUserJid():d("WAJids").authorAsUserJid(a.author);if(a==null||l==null||k==null){c("FBLogger")("GroupPollsE2EE").mustfix("Missng param - pollUpdateSenderJid:%s pollUpdateStanzaId:%s pollCreationSenderJid:%s",a,l,k);return(h||(h=b("Promise"))).resolve(e)}j={pollCreationMessageKey:j,pollCreationSenderJid:k,pollCreationStanzaId:f,pollUpdateSenderJid:a,pollUpdateStanzaId:l};k=null;g!=null&&(k=(yield d("MAWGroupPollsDualEncryptionUtils").decryptGroupPollVote(g,j).then(function(a){if(a.success===!1){c("FBLogger")("GroupPollsE2EE").mustfix("Failed to decrypt vote for pollUpdateStanzaId:%s",l,a.error);return null}return a.value})));f=null;if(i!=null){a=(yield d("MAWGroupPollsDualEncryptionUtils").decryptGroupPollAddOption(i,j).then(function(a){if(a.success===!1){c("FBLogger")("GroupPollsE2EE").mustfix("Failed to decrypt poll options for pollUpdateStanzaId:%s",l,a.error);return null}return a.value}));a!=null&&(f=(yield (h||(h=b("Promise"))).all(a.pollOption.map(function(a){if(a.optionName==null)return null;var b=a.optionName;return d("MAWGroupPollsDualEncryptionUtils").getHashForOptionName(b).then(function(a){return{hashedOptionName:a,optionName:b}})}).filter(Boolean))))}return k==null&&f==null?e:babelHelpers["extends"]({},e,{decrypted:{optionsToAdd:(g=f)!=null?g:void 0,vote:(i=k)!=null?i:void 0}})});return i.apply(this,arguments)}g.decryptUnstoredPollUpdateMessage=a}),98);
__d("MAWProtocolQueueMsg",["FBLogger","MAWBulkHandleIncomingMsgApi","MAWDbPoll","MAWDbPollTxns","MAWDecryptUnstoredPollUpdateMessage","MAWGroupPollsDualEncryptionUtils","MAWHIMLogger","MAWMpsGating","MAWMsgType","MAWParseXMAProtocol","MAWXMALoggingUtils","MAWXMAUtils","PersistedQueueDB","Promise","WAStanzaRootTag","asyncToGeneratorRuntime","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot have null result for non-invisible msgs"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle: "," msgs: done"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle: "," msgs"]);k=function(){return a};return a}function l(a,b){if(a==null)return b;return a>b?b:a}function a(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=new Set(),g=a.filter(function(a){return a.stanza.message.details.retryCount>0});if(g.length>0){var m=d("MAWMpsGating").isMpsM3()?[]:yield d("PersistedQueueDB").getPersistedQueues().runInTransaction(["stanzaQueue"],"readonly",function(a){return(h||(h=b("Promise"))).all(g.map(function(b){return a.stores.stanzaQueue.readIndex("[jid+priority+stanzaId]",[b.stanza.jid,b.stanza.priority,b.stanza.stanzaId])}))},"fetch-pending-ciphertext-stanzas");g.forEach(function(a,b){var c,e=null;m[b].forEach(function(a){if(a.type!==d("WAStanzaRootTag").STANZA_ROOT_TAG.MESSAGE)return;a;if(a.subtype!=="ciphertext")return;e==null&&(e=a);e.serverTs>a.serverTs&&(e=a)});if(e==null)return;e;b=e.serverTs;a.stanza.message.details.ts=l(a.stanza.message.details.ts,b);a.stanza.message.decrypted.ts=l(a.stanza.message.decrypted.ts,b);if(((c=a.decodedMsg)==null?void 0:c.unstoredDbMsg)!=null){c=a.decodedMsg.unstoredDbMsg;c.ts=l(c.ts,b);c.serverTs=l(c.serverTs,b)}if(((c=a.decodedMsg)==null?void 0:c.unstoredDbMedia)!=null){c=a.decodedMsg.unstoredDbMedia;c.ts=l(c.ts,b)}})}var n=a.map(function(a){var b,e,g=a.decodedMsg,h=a.receiveFlow;a=a.stanza;var i=a.message.decrypted,j=d("MAWXMALoggingUtils").getXmaTargetTypeStringFromEnum(g==null?void 0:g.xmaTargetTypeForLogging);b=g==null?void 0:(b=g.unstoredXMA)==null?void 0:b.unstoredDbXMA.xmaDataclass;e=g==null?void 0:(e=g.unstoredXMA)==null?void 0:e.unstoredDbXMA.targetType;e=d("MAWParseXMAProtocol").getUnsupportedMessageType(e,b);h.addAnnotations({bool:{furuteproof:(g==null?void 0:(b=g.unstoredDbMsg)==null?void 0:b.type)===d("MAWMsgType").MSG_TYPE.FUTUREPROOF},"int":{xmaTargetType:(b=g==null?void 0:g.xmaTargetTypeForLogging)!=null?b:-1},string:{contentType:(b=g==null?void 0:g.contentTypeForLogging)!=null?b:"",subtype:(b=g==null?void 0:(b=g.unstoredDbMsg)==null?void 0:(b=b.msgContent)==null?void 0:b.subtype)!=null?b:e,xmaTargetTypeString:j}});if(d("MAWXMAUtils").isRtcXMA(g==null?void 0:(b=g.unstoredXMA)==null?void 0:(e=b.unstoredDbXMA)==null?void 0:e.targetType)&&!c("gkx")("13099")){h.endFail("rtc_xma_not_supported");f.add(a.stanzaQueueId);return null}if(i.type==="InstamadilloMsg"){h.endFail("instamadillo_not_supported");f.add(a.stanzaQueueId);return null}if(i.type==="InvisibleMsg"){f.add(a.stanzaQueueId);return null}return{msgData:i,receiveFlow:h,stanzaSource:a.incomingType,unstoredContent:g}}).filter(Boolean),o=c("qex")._("3170")!==!0?n:yield (h||(h=b("Promise"))).all(n.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e,f=a.msgData,g=a.receiveFlow,i=a.stanzaSource,j=a.unstoredContent;if((j==null?void 0:(e=j.unstoredDbMsg)==null?void 0:e.type)===d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE&&(j==null?void 0:j.unstoredDbGroupPollCreateInfo)!=null){var k;e=j.unstoredDbGroupPollCreateInfo;k=(k=e.options)!=null?k:[];k=(yield (h||(h=b("Promise"))).all(k.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWGroupPollsDualEncryptionUtils").getHashForOptionName(a));return{optionHash:b,optionText:a}});return function(b){return a.apply(this,arguments)}}())));k=new Map(k.map(function(a){var b=a.optionHash;a=a.optionText;return[d("MAWDbPoll").convertStringToOptionHash(b),{optionText:a,voteAuthors:new Set()}]}));return{msgData:f,receiveFlow:g,stanzaSource:i,unstoredContent:babelHelpers["extends"]({},j,{unstoredDbGroupPollCreateInfo:babelHelpers["extends"]({},e,{optionsHashed:k})})}}if((j==null?void 0:j.unstoredDbGroupPollUpdateInfo)!=null){e=j.unstoredDbGroupPollUpdateInfo;k=(k=e.encryptedMessage.pollCreationMessageKey)==null?void 0:k.id;if(k==null){c("FBLogger")("GroupPollsE2EE").warn("pollStanzaId is null");return{msgData:f,receiveFlow:g,stanzaSource:i,unstoredContent:j}}k=(yield d("MAWDbPollTxns").getDbPoll(f.id.chat,k));if(k==null)return{msgData:f,receiveFlow:g,stanzaSource:i,unstoredContent:j};e=(yield d("MAWDecryptUnstoredPollUpdateMessage").decryptUnstoredPollUpdateMessage(f.id,e,k));return{msgData:f,receiveFlow:g,stanzaSource:i,unstoredContent:babelHelpers["extends"]({},j,{unstoredDbGroupPollUpdateInfo:e})}}return a});return function(b){return a.apply(this,arguments)}}()));c("MAWHIMLogger").LOG(k(),o.length);return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(o,e).then(function(b){var d=b.msgResults;c("MAWHIMLogger").LOG(j(),o.length);a.map(function(a){a=a.stanza;var b=d.get(a.message.decrypted.id);if(b==null){f.has(a.stanzaQueueId)||c("MAWHIMLogger").ERROR(i());return}b.success===!0&&f.add(a.stanzaQueueId)});return{followUpParams:{incomingMsgResults:d,incomingMsgs:a},toAck:Array.from(f)}})["catch"](function(b){var c="Not an Error instance",d="N/A";typeof b.message==="string"&&(c=b.message);typeof b.stack==="string"&&(d=b.stack);a.forEach(function(a){a.receiveFlow.endFail("consumer_handle_message_transaction_error",{string:{errorDescription:c,errorStack:d}})});throw b})});return m.apply(this,arguments)}g.handleIncomingMessagesStanzas=a}),98);
__d("MpsToUIPostProcessor",["FBLogger","MpsMessageToBridge","MpsMessageToBridgeWrapper","MpsToBridgeMessageId","MpsTypes","WAJids","WATimeUtils","WebMps","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return[{tag:"NewMsg",value:a}]}function i(a){return[{tag:"EditMsgHistoryAdded",value:[a]}]}function j(a){if(a.type==="upsert")return[{tag:"UpsertReaction",value:a.reaction}];else if(a.type==="delete")return[{tag:"DeleteReaction",value:a.reaction}];a.type;throw c("FBLogger")("messenger_web").mustfixThrow("unreachable")}function k(a){return[{tag:"NewMedia",value:a}]}function l(a){return[{tag:"MsgsStartCountdown",value:a}]}function m(a){return[{tag:"NewReceiverFetchInfo",value:a}]}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.directive.actionType===d("MpsTypes").ActionType.DeleteTopLevel){var b=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.message),e=d("MpsToBridgeMessageId").mpsToBridgeMsgId(b.message.threadId,a.directive.targetMessageId);return[{tag:"DeleteMessages",value:{messages:[{msgId:e,ts:b.getUnixTs()}],threadJid:b.getChatJid()}}]}if(!(a.directive.actionType===d("MpsTypes").ActionType.UpsertTopLevel||a.directive.actionType===d("MpsTypes").ActionType.UpsertSupplemental||a.directive.actionType===d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder))return[];e=a.directive.actionType===d("MpsTypes").ActionType.UpsertSupplemental?a.directive.targetMessageId:a.message.messageId;b=(yield d("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"UI-fetch"},messageId:e,threadId:a.message.threadId}));e=b.value;if(!e)return[];a=d("MpsMessageToBridge").mpsFullMessagetoBridge(e);if(a==null)return[];b=[a.topLevel].concat(a.supplementals).map(function(a){switch(a.kind){case"bridgeMsg":return h(a.value);case"bridgeEditHistoryMsg":return i(a.value);case"bridgeReactionAction":return j(a.value);case"bridgeMedia":return k(a.value);case"bridgeMsgsStartCountdown":return l(a.value);case"bridgeReceiverFetchInfo":return m(a.value);default:a.kind;throw c("FBLogger")("messenger_web").mustfixThrow("unreachable")}});a=b.flat();b=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(e.toplevelProtobuf);e=[{tag:"VerifyThreadExists",value:{authoritativeThreadKey:null,cannotReplyReason:null,clientThreadKey:null,description:"mpsToUIPostProcessor",folder:null,instanceKey:null,isGroup:d("WAJids").switchOnMsgrChatJidType(b.getChatJid(),{group:function(){return!0},user:function(){return!1}}),jid:b.getChatJid(),lastActivityTs:d("WATimeUtils").castToMillisTime(0),lastReadTs:d("WATimeUtils").castToMillisTime(0)}}];return e.concat(a)});return n.apply(this,arguments)}g.mpsToUIEventPostProcessPayload=a}),98);
__d("MawMpsCop",["FBLogger","MAWBridge","MAWMpsGating","MAWProtocolQueueProcess","MawCopScheduler","MawMpsCopProtocolQueueProcessor","MpsToUIPostProcessor","MpsTypes","Promise","WAPubSub","WAWaitForUserUnblocked","WebMps","asyncToGeneratorRuntime","getErrorSafe","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=10;e=c("justknobx")._("2653");var j=e?1:10,k=10,l=function(){function a(){this.$1=d("WAPubSub").simplePubSub(),this.$3=new Map(),this.$2=new(d("MawMpsCopProtocolQueueProcessor").ProtocolQueueProcessor)()}var e=a.prototype;e.loadMoreMsgsIntoMaw=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WebMps").mps().loadMessages(babelHelpers["extends"]({},a,{config:{shouldFetchSupplementals:!0,shouldFetchTags:!0,strategy:"full-fetch"}})));if(a.success===!1)return;return d("MAWProtocolQueueProcess").processMPSFullMessageEntries(a.value.messages)});function c(b){return a.apply(this,arguments)}return c}();e.subscribe=function(a){return this.$1.subscribe(a)};e.$4=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;if(this.$3.size===0)return{exhausted:!0};var c=[];this.$3.forEach(function(d,e){c.push.apply(c,d.splice(-a)),d.length===0&&b.$3["delete"](e)});if(d("MAWMpsGating").isFullMpsEnabled()){yield this.$5(c);return{exhausted:this.$3.size===0}}yield this.$6(c);return{exhausted:this.$3.size===0}});function c(b){return a.apply(this,arguments)}return c}();e.$7=function(a){var b=this;a.forEach(function(a){var c,d=a.message.threadId;c=(c=b.$3.get(d))!=null?c:[];c.push(a);b.$3.set(d,c)})};e.$5=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=new Map(),f=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{f.push.apply(f,yield d("MpsToUIPostProcessor").mpsToUIEventPostProcessPayload(a))}catch(b){e.set(a.message.messageId,c("getErrorSafe")(b))}});return function(b){return a.apply(this,arguments)}}()));d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:f});a.forEach(function(a){var b=e.get(a.message.messageId);if(b){b=b;c("FBLogger")("mps").catching(b).mustfix("Failed to process payload for UI for thread id = %s , message Id = %s",a.message.threadId,a.message.messageId)}})});function e(b){return a.apply(this,arguments)}return e}();e.$6=function(a){return d("MAWProtocolQueueProcess").processMPSIncomingPayloadEntries(a).then(function(a){a.forEach(function(a,b){c("FBLogger")("mps").catching(a).mustfix("Failed to process payload for MAW for message Id = %s",b)})})["catch"](function(a){c("FBLogger")("mps").catching(a).mustfix("Failed to process payload for MAW")})};e.postProcessMessages=function(a){if(d("WAWaitForUserUnblocked").isStillWaitingForUserUnblocked()){this.$7(a);return(h||(h=b("Promise"))).resolve()}if(d("MAWMpsGating").isFullMpsEnabled())return this.$5(a);return a.length>0&&a[0].insertionSource===d("MpsTypes").InsertionSource.Send?(h||(h=b("Promise"))).resolve():this.$6(a)};e.subscribeToOfflineQueue=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"offline-start":d("WAWaitForUserUnblocked").maybeResetWaitForUserUnblocked();break;case"offline-end":b.$1.publish({type:"maw-infra-start"});b.$4(d("MAWMpsGating").isFullMpsEnabled()?i:j).then(function(){b.$1.publish({success:!0,type:"maw-infra-end"})})["catch"](function(a){c("FBLogger")("cop").catching(a).mustfix("offline-end cop fails"),b.$1.publish({success:!1,type:"maw-infra-end"})})["finally"](function(){d("WAWaitForUserUnblocked").unblockUser(),b.$8(),b.$2.startProcessing()});break;default:a.type;break}})};e.$8=function(){var a=this;if(this.$9!=null)return;this.$9=d("MawCopScheduler").copScheduler().task({fn:function(){return a.$4(k)},name:"background-iterator"});this.$9.run().then(function(b){a.$9=null,b.exhausted===!1&&a.$8()})["catch"](function(b){c("FBLogger")("cop").catching(b).mustfix("Cop fails"),a.$9=null,a.$8()})};return a}(),m;function a(){if(!m){m=new l();return m}return m}g.MpsCop=l;g.mpsCop=a}),98);
__d("MawMpsCopProtocolQueueProcessor",["FBLogger","MAWProtocolQueueProcess","MAWSharedCOPHandleBatch","MawCopScheduler","Promise","WAProtocolQueue","WAWaitForUserUnblocked","WorkerScheduler","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(){this.$2=c("justknobx")._("2539"),this.$3=null,this.$1()}var e=a.prototype;e.$4=function(){var a=this;if(this.$3!=null)return;this.$3=d("MawCopScheduler").copScheduler().task({fn:function(){return d("WAWaitForUserUnblocked").isStillWaitingForUserUnblocked()?(h||(h=b("Promise"))).resolve({exhausted:!0,handled:0}):d("MAWSharedCOPHandleBatch").copHandleBatch(d("WAProtocolQueue").protocolQueue().index("priority").read,{limit:a.$2,order:"desc"},d("MAWProtocolQueueProcess").processProtocolQueueEntries)},name:"protocol-queue",priority:d("WorkerScheduler").BACKGROUND_PRIORITY});this.$3.run().then(function(b){a.$3=null,b.exhausted===!1&&a.$4()})["catch"](function(b){c("FBLogger")("cop").catching(b).mustfix("ProtocolQueueProcessor fails"),a.$3=null,a.$4()})};e.startProcessing=function(){this.$4()};e.$1=function(){var a=this;d("WAProtocolQueue").protocolQueue().subscribe(function(b){switch(b.type){case"flush":if(d("WAWaitForUserUnblocked").isStillWaitingForUserUnblocked())return;a.startProcessing();return}})};return a}();g.ProtocolQueueProcessor=a}),98);
__d("MAWSharedOfflineQueueMetric",["$InternalEnum","FBLogger","MAWMpsGating","MawMpsCop","WAGlobals","WAPREList","WATagsLogger","WATimeUtils","WAWaterFlow"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["New mailbox age is ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New mailbox age is ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Waterflow should start before the start of the processing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Possible stuck reason: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["offline-resume"]);f=b("$InternalEnum").Mirrored(["OFFLINE","ONLINE"]);var m=b("$InternalEnum").Mirrored(["WA_CLIENT_INFRA","WA_CLIENT_INFRA_DUPLICATED_START","WA_PASSIVE_MODE","WA_PASSIVE_MODE_FAIL","MAW_INFRA","MAW_STUCK","WA_STUCK","MAW_NOT_IDLE_OQ"]),n=function(){function a(a,b,c,e){this.$1=0,this.$3=c,this.$2=d("WAWaterFlow").makeWaterflow("offline-resume",d("WAPREList").PRE_METRIC.OFFLINE_QUEUE),this.$6(a),this.$7(),this.$8(b),this.$9(e),this.$4=Math.round(d("WATimeUtils").performanceAbsoluteNow()/1e3)}var b=a.prototype;b.$8=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"passive-mode-start":b.$2.isOnGoing()||b.$2.startMetric();b.$2.startPoint(m.WA_PASSIVE_MODE,{passiveModeAcks:a.count});b.$10("wa");break;case"passive-mode-end":b.$2.endPoint(m.WA_PASSIVE_MODE);b.$10("wa");break;default:a.type,b.$2.addPoint(m.WA_PASSIVE_MODE_FAIL),b.$10("wa")}})};b.$9=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"new-message":if(a.commonMessageBase.offline==null)return;b.addWAMessage();b.$10("wa");break}})};b.$6=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"offline-start":b.$11(a.offlineStats);b.$10("wa");break;case"offline-end":b.$2.isOnGoing()&&(b.$2.endPoint(m.WA_CLIENT_INFRA),b.$10("maw"));break;case"offline-entity":b.$12(a.serverTs,a.offline);b.$10("wa");break;case"offline-processed":b.$13(a.count);b.$10("wa");break;case"connection-lost":b.$2.isOnGoing()&&b.$2.endFail("connection-lost",{isConnectionLost:!0});b.$14();break;default:a}})};b.$10=function(a){var b=this;clearTimeout(this.$5);this.$2.isOnGoing()&&(this.$5=setTimeout(function(){b.$2.isOnGoing()&&(a==="wa"?b.$2.addPoint(m.WA_STUCK,{waStuck:!0}):b.$2.addPoint(m.MAW_STUCK,{mawStuck:!0}),l.WARN(k(),a))},d("WAGlobals").getConfig().offlineQueueStuckTimeoutMs()))};b.$14=function(){clearTimeout(this.$5)};b.$7=function(){var a=this;d("MAWMpsGating").isFullMpsEnabled()||d("MAWMpsGating").isMpsM3()?d("MawMpsCop").mpsCop().subscribe(function(b){a.$15(b)}):this.$3.subscribe(function(b){a.$15(b)})};b.$15=function(a){switch(a.type){case"idle-oq-safe-guard":if(!this.$2.isOnGoing())break;this.$2.addPoint(m.MAW_NOT_IDLE_OQ);break;case"maw-infra-start":if(!this.$2.isOnGoing())break;this.$10("maw");this.$2.startPoint(m.MAW_INFRA);break;case"maw-infra-batch":this.$2.isOnGoing()||(this.$2.startMetric(),this.$2.startPoint(m.MAW_INFRA));this.$10("maw");this.$2.reAnnotate(function(a){a=a.mawInfraBatchCount;return{mawInfraBatchCount:((a=a)!=null?a:0)+1}});break;case"maw-infra-end":if(!this.$2.isOnGoing())break;this.$2.endPoint(m.MAW_INFRA);this.$14();a.success?this.$2.endSuccess():this.$2.endFail("fail");break;default:a}};b.addWAMessage=function(){this.$2.isOnGoing()&&(this.$2.reAnnotate(function(a){a=a.waMessage;return{waMessage:((a=a)!=null?a:0)+1}}),this.$10("wa"))};b.addMAWEntity=function(a){this.$2.isOnGoing()&&(this.$2.reAnnotate(function(b){b=b.mawProcessedCount;return{mawProcessedCount:((b=b)!=null?b:0)+a}}),this.$10("maw"))};b.$11=function(a){this.$2.isOnGoing()?this.$2.addPoint(m.WA_CLIENT_INFRA_DUPLICATED_START):(this.$1++,this.$2.startMetric(),this.$4=Math.round(d("WATimeUtils").performanceAbsoluteNow()/1e3)),this.$2.startPoint(m.WA_CLIENT_INFRA,{batchSize:d("WAGlobals").getConfig().limitPullMode()?250:d("WAGlobals").getConfig().batchSize(),expectedAppdata:a.appdata,expectedCount:a.count,expectedMessage:a.message,expectedNotification:a.notification,expectedReceipt:a.receipt,mpsStatus:this.$16(),offlineResumeCount:this.$1,waDanglingQueue:d("WAGlobals").getConfig().waDanglingQueue()})};b.$16=function(){if(d("MAWMpsGating").isFullMpsEnabled())return"full";if(d("MAWMpsGating").isMpsM3())return"m3";if(d("MAWMpsGating").isMpsM2())return"m2";if(d("MAWMpsGating").isMpsDev())return"dev";return d("MAWMpsGating").isMpsEnabled()?"should_not_be_exposed_separately":"disabled"};b.getDetails=function(){var a;return((a=this.$2)==null?void 0:a.getAnnotations())||{}};b.$13=function(a){var b;(b=this.$2)==null?void 0:b.reAnnotate(function(b){return{waProcessed:((b=b.waProcessed)!=null?b:0)+a}})};b.addRuntimeErrorDuringOffflineQueue=function(){if(this.$2.isOnGoing()){var a;(a=this.$2)==null?void 0:a.reAnnotate(function(a){return{runtimeErrors:((a=a.runtimeErrors)!=null?a:0)+1}})}};b.addDecryptionError=function(){if(this.$2.isOnGoing()){var a;(a=this.$2)==null?void 0:a.reAnnotate(function(a){return{decryptErrors:((a=a.decryptErrors)!=null?a:0)+1}})}};b.addRetriesTrack=function(a){if(this.$2.isOnGoing()){var b;(b=this.$2)==null?void 0:b.reAnnotate(function(b){return{retries:((b=b.retries)!=null?b:0)+a}})}};b.$12=function(a,b){var c=this;if(!this.$2.isOnGoing()){l.WARN(j());return}this.$2.reAnnotate(function(d){var e=d.mailboxAgeSec,f=d.maxOffline;d=d.waDownloaded;e=e;e==null&&a!=null&&(e=c.$4-a,l.LOG(i(),e));e!=null&&a!=null&&(c.$4-a>e&&(e=c.$4-a,l.LOG(h(),e)));return{mailboxAgeSec:e,maxOffline:Math.max((e=f)!=null?e:0,b),waDownloaded:((f=d)!=null?f:0)+1}})};return a}(),o;function a(a,b,d,e){if(o!=null){var f=o;c("FBLogger")("messenger_e2ee_web").mustfix("Offline sync reported is inited twice");return f}o=new n(a,b,d,e);return o}function e(){if(o==null){c("FBLogger")("messenger_e2ee_web").mustfix("Offline sync reported is not inited");return null}return o}g.OfflineMode=f;g.OfflineStages=m;g.makeOfflineQueueMetric=a;g.getOfflineQueueMetric=e}),98);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c="SocketClosed";a=b.call(this,(a=a)!=null?a:c)||this;a.name=c;return a}var c=a.prototype;c.toString=function(){return this.name};return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){var c=this;this.$3=new(d("WABinary").Binary)();this.closed=!1;this.$4=!1;this.onFrame=null;this.onClose=null;this.$5=function(a){c.$3.writeByteArray(a),c.convertBufferedToFrames()};this.$6=function(){if(c.$3.peek(n)){d("WALogger").LOG(l());c.$4=!0;return}c.$9()};this.$7=function(a){d("WALogger").DEV(k()).devConsole(a)};this.$2=b;this.$1=a;a.onData=this.$5;a.onClose=this.$6;a.onError=this.$7}var b=a.prototype;b.sendFrame=function(a){if(this.$4)return;this.throwIfClosed();var b=this.$2,c=a.byteLength;this.$8(c);var d=this.$1.dataToSend;b?(this.$2=null,d.ensureAdditionalCapacity(b.length+3+c),d.writeByteArray(b)):d.ensureAdditionalCapacity(3+c);d.writeUint8(c>>16);d.writeUint16(c&65535);d.write(a);this.$1.requestSend()};b.$9=function(){if(this.closed)return;d("WALogger").LOG(j());this.$4=!1;this.closed=!0;var a=this.onClose;a&&a()};b.$8=function(a){if(a>=1<<24){d("WALogger").WARN(i(),a);throw new(d("WAErrors").BufferTooLargeError)("Buffer too large: "+a)}};b.convertBufferedToFrames=function(){var a=this.$3,b=this.onFrame;while(b&&a.peek(n)){var c=o(a);c=a.readByteArray(c);b(c);b=this.onFrame}this.$4&&!a.peek(n)&&this.$9();b&&a.size()&&d("WALogger").LOG(h(),a.size())};b.throwIfClosed=function(){if(this.closed)throw new m()};b.close=function(){this.$1.close()};return a}();function n(a){if(a.size()<3)return!1;var b=o(a);return b<=a.size()}function o(a){return a.readUint8()<<16|a.readUint16()}g.SocketClosed=m;g.FrameSocket=a}),98);
__d("WANoiseSocket",["Promise","WACryptoDependencies","WALogger","WAPromiseQueue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendFrame adding to queue with frame size: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending encrypted frame to web socket"]);k=function(){return a};return a}a=(h||(h=b("Promise"))).reject("UNINITIALIZED HANDSHAKE");var l=new Uint8Array(0);a["catch"](function(){});c=function(){function a(a,b,c){var e=this;this.$4=[];this.$5=new(d("WAPromiseQueue").PromiseQueue)();this.$6=new(d("WAPromiseQueue").PromiseQueue)();this.$7=0;this.$8=0;this.$9=!1;this.$14=function(a){!e.$1.closed?(d("WALogger").DEV(k()).tags("WANoiseSocket"),e.$1.sendFrame(a)):d("WALogger").LOG(j())};this.$12=function(a){var b=e.$7++;e.$5.enqueueHandlers(o(e.$2,b,void 0,a),e.$15)};this.$13=function(){e.$9=!0,e.$5.wait().then(function(){e.$9=!1;var a=e.$11;a&&a()})};this.$15=function(a){e.$10?e.$10(a):e.$4.push(a)};this.$1=a;this.$3=b;this.$2=c;a.onFrame=this.$12;this.$1.onClose=this.$13;a.convertBufferedToFrames()}var c=a.prototype;c.sendFrameAsync=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield this.sendFrame(a));return a});function c(b){return a.apply(this,arguments)}return c}();c.sendFrame=function(a){if(this.$9)return(h||(h=b("Promise"))).resolve();this.$1.throwIfClosed();var c=this.$8++;d("WALogger").DEV(i(),a.length).tags("WANoiseSocket");return this.$6.enqueueHandlers(n(this.$3,c,void 0,a),this.$14)};c.setOnFrame=function(a){this.$10=a};c.setOnClose=function(a){this.$11=a};c.close=function(){this.$1.close()};return a}();function m(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function n(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}function o(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}g.NoiseSocket=c}),98);
__d("MAWDbGetDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.get(b)}f.getDeviceChangeAlertsTxn=a}),66);
__d("WADevToolsDebugFns",["WADevToolsBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={};for(var c in a){var e=a[c];b[c]={id:c,args:e.serializedArgs,desc:e.desc,title:e.name}}d("WADevToolsBridge").getDevToolBridge().setHandlers("backend",{getDebugFns:function(){return b},callDebugFn:function(b){var c=b.id;b=b.args;(c=a[c]).execute.apply(c,b)}})}function b(a,b){return babelHelpers["extends"]({name:a},b)}g.registerDebugFnsToDevTool=a;g.defineDebugFunction=b}),98);
__d("MAWDebugSendMultipleMsgs",["MAWBridge","MAWExternalId","MAWLoggerUtils","Promise","WADevToolsDebugFns","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("WADevToolsDebugFns").defineDebugFunction("sendMultipleMsgs",{desc:"Sends multiple messages to a thread",execute:function(a,e){return(h||(h=b("Promise"))).all(Array.from(Array(e).keys()).map(function(b){return d("MAWBridge").getBridge().sendAndReceive("backend","sendMsg",{args:{content:b+" message"},chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})}))},serializedArgs:[{desc:"ChatJid of the thread to send messages to",name:"chatJid",placeholder:"1234@msgr",type:"string"},{desc:"Number of messages to send",name:"numberOfMsgs",placeholder:"100",type:"number"}]});g.sendMultipleMsgs=a}),98);
__d("MAWSendSenderKeyDistributionMsg",["MAWDebugMsg","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","Promise","WAQPLProxy","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set();function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){if(i.has(a))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());yield d("MAWDebugMsg").writeDebugMsg(a,"Sending key distribution msg");e=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,a,d("WATimeUtils").unixTime(),{},d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION,c("qpl")._(25313175,"1551"),f));if(e.type==="already_sent")return d("WAResultOrError").makeError("already_sent");else if(e.type==="missing_thread")return d("WAResultOrError").makeError("missing_thread");yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:e.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(c("qpl")._(25313175,"1551"),f),"MAWSendSenderKeyDistributionMsg");return d("WAResultOrError").makeResult()});return j.apply(this,arguments)}g.sendSenderKeyDistributionMsg=a}),98);
__d("WAIndexDBStorage",["Promise","err"],(function(a,b,c,d,e,f,g){var h,i="idb-storage-testing-db",j="idb-storage-testing-store";function a(){return new(h||(h=b("Promise")))(function(a,b){var c=indexedDB.open(i);c.onerror=function(a){b(a.target.error)};c.onupgradeneeded=function(a){a=a.target.result;a.createObjectStore(j)};c.onsuccess=function(b){b=b.target.result;a(b)}})}function d(a){var c=a.idb,d=a.fileBuffer,e=a.key;return new(h||(h=b("Promise")))(function(a,b){var f=c.transaction([j],"readwrite");f.oncomplete=function(){a()};f.onerror=function(a){b(a.target.error)};f.onabort=function(a){b(a.target.error)};f=f.objectStore(j);f=f.put(d,e);f.onerror=function(a){b(a.target.error)};f.onsuccess=function(){a()}})}function e(a){var d=a.idb,e=a.key;return new(h||(h=b("Promise")))(function(a,b){var f=d.transaction([j],"readonly");f.onerror=function(a){b(a.target.error)};f.onabort=function(a){b(a.target.error)};f=f.objectStore(j);var g=f.get(e);g.onerror=function(a){b(a.target.error)};g.onsuccess=function(){if(!(g.result instanceof ArrayBuffer)){b(c("err")("Result is not an ArrayBuffer"));return}a(g.result)}})}function f(a){var c=a.idb;return new(h||(h=b("Promise")))(function(a,b){var d=c.transaction([j],"readwrite");d.oncomplete=function(){a()};d.onerror=function(a){b(a.target.error)};d.onabort=function(a){b(a.target.error)};d=d.objectStore(j);d=d.clear();d.onerror=function(a){b(a.target.error)};d.onsuccess=function(){a()}})}function k(a){a=a.idb;a.close();indexedDB.deleteDatabase(i)}g.prepareIDB=a;g.writeToIDB=d;g.readFromIDB=e;g.cleanupIDB=f;g.deleteIdb=k}),98);
__d("WAOpfsSyncStorage",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g,h="opfs-storage-testing-filesystem";function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;if((navigator==null?void 0:(a=navigator.storage)==null?void 0:a.getDirectory)==null)return(g||(g=b("Promise"))).reject("OPFS is not supported");a=(yield navigator.storage.getDirectory());a=(yield a.getDirectoryHandle(h,{create:!0}));return a});return i.apply(this,arguments)}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.directoryHandle,c=a.fileBuffer;a=a.fileName;b=(yield b.getFileHandle(a,{create:!0}));a=(yield b.createSyncAccessHandle());a.write(c);return a.close()});return j.apply(this,arguments)}function d(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.directoryHandle;a=a.fileName;b=(yield b.getFileHandle(a));a=(yield b.createSyncAccessHandle());b=a.getSize();b=new ArrayBuffer(b);yield a.read(b);a.close();return b});return k.apply(this,arguments)}function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c,d=a.directoryHandle;a=a.fileName;if((navigator==null?void 0:(c=navigator.storage)==null?void 0:c.getDirectory)==null)return(g||(g=b("Promise"))).reject("OPFS is not supported");yield d.removeEntry(a)});return l.apply(this,arguments)}f.prepareFileSystem=a;f.writeToFileSystem=c;f.readFromFileSystem=d;f.cleanupFileSystem=e}),66);
__d("WATestBenchmark",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g=function(){return performance.now()};function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){var e={},f=[],h=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,d){f.push(b);e[b]=[];for(var h=0;h<a;h++){var i=g();for(var j=0;j<c;j++)yield d(h,j);j=g();e[b].push((j-i)/c)}});return function(a,b){return d.apply(this,arguments)}}();yield d(h);return f.map(function(a){var b=e[a].sort(function(a,b){return a-b}),c=b.length;return{name:a,min:b[0],p50:b[Math.floor(c/2)],avg:b.reduce(function(a,b){return a+b},0)/c}})});return h.apply(this,arguments)}function i(a){if(a<1){var b=Math.round(a*1e4);return b+"\u03bcs"}b=Math.round(a);return b+"ms"}function c(a,b){b.forEach(function(b){var c=b.name,d=b.min,e=b.avg;b=b.p50;a("["+c+"] min: "+i(d)+", avg: "+i(e)+", p50: "+i(b))})}function d(a,b){var c="\n";b.forEach(function(a){var b=a.name,d=a.min,e=a.avg;a=a.p50;c+=b+","+Math.round(d)+","+Math.round(e)+","+Math.round(a)+"\n"});a(c)}f.createBenchmark=a;f.printReport=c;f.printAsCSVInMS=d}),66);
__d("WAWebCacheStorage",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g="web-cache-storage-testing";function a(){return caches.open(g)}function c(a){var b=a.cache,c=a.fileBuffer;a=a.key;c=new Response(c);return b.put(a,c)}function d(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.cache;a=a.key;b=(yield b.match(a));return b.arrayBuffer()});return h.apply(this,arguments)}function e(){return caches["delete"](g).then(function(){})}f.prepareCache=a;f.writeToCache=c;f.readFromCache=d;f.cleanupCache=e}),66);
__d("WARunStorageBenchmark",["Promise","WAIndexDBStorage","WAOpfsSyncStorage","WATestBenchmark","WAWebCacheStorage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g){var i=1024*e;i=new Blob([new Uint8Array(i).fill(255)]);var j=(yield i.arrayBuffer());a("datapoints: "+f+" repetitions: "+g+" blob size: "+e+"KB");var k=(yield d("WAIndexDBStorage").prepareIDB());yield d("WAIndexDBStorage").cleanupIDB({idb:k});yield d("WAWebCacheStorage").cleanupCache();var l=(yield d("WAWebCacheStorage").prepareCache()),m=(yield d("WAOpfsSyncStorage").prepareFileSystem());a("start write benchmark...");i=(yield d("WATestBenchmark").createBenchmark(f,g,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a("IndexedDB write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAIndexDBStorage").writeToIDB({idb:k,fileBuffer:yield j,key:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}()),yield a("Web Cache write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAWebCacheStorage").writeToCache({cache:l,fileBuffer:j,key:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}()),yield a("OPFS Sync write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAOpfsSyncStorage").writeToFileSystem({directoryHandle:m,fileBuffer:j,fileName:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}())});return function(b){return a.apply(this,arguments)}}()));a("end write benchmark...");c?d("WATestBenchmark").printAsCSVInMS(a,i):d("WATestBenchmark").printReport(a,i);a("start read benchmark...");e=(yield d("WATestBenchmark").createBenchmark(f,g,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c;yield a("IndexedDB read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){c=(yield d("WAIndexDBStorage").readFromIDB({idb:k,key:a+"_"+b}))});return function(b,c){return a.apply(this,arguments)}}());var e;yield a("Web Cache read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){e=(yield d("WAWebCacheStorage").readFromCache({cache:l,key:a+"_"+b}))});return function(b,c){return a.apply(this,arguments)}}());var f;yield a("OPFS Sync read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){f=(yield d("WAOpfsSyncStorage").readFromFileSystem({directoryHandle:m,fileName:a+"_"+b})),yield d("WAOpfsSyncStorage").cleanupFileSystem({directoryHandle:m,fileName:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}());if(c instanceof ArrayBuffer&&e instanceof ArrayBuffer&&f instanceof ArrayBuffer)return;return(h||(h=b("Promise"))).reject("read result is not ArrayBuffer")});return function(b){return a.apply(this,arguments)}}()));a("end read benchmark...");c?d("WATestBenchmark").printAsCSVInMS(a,e):d("WATestBenchmark").printReport(a,e)});return function(b,c,d,e,f){return a.apply(this,arguments)}}();g.runStorageBenchmark=a}),98);
__d("WormDbDebuggingUtils",["WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["identity"],"readonly",function(a){return a.stores.identity.readAll()},"debug-get-identities")});return i.apply(this,arguments)}function j(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["contacts"],"readonly",function(a){return a.stores.contacts.readAll()},"debug-get-contacts")});return k.apply(this,arguments)}function l(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["session"],"readonly",function(a){return a.stores.session.readAll()},"debug-get-sessions")});return m.apply(this,arguments)}function n(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["senderKeySessions"],"readonly",function(a){return a.stores.senderKeySessions.readAll()},"debug-get-sender-key-sessions")});return o.apply(this,arguments)}function a(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["prekey"],"readonly",function(a){return a.stores.prekey.readAll()},"debug-get-prekeys")});return p.apply(this,arguments)}function c(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["prekeyGeneration"],"readonly",function(a){return a.stores.prekeyGeneration.readAll()},"debug-get-prekey-generations")});return q.apply(this,arguments)}function e(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["signedPrekey"],"readonly",function(a){return a.stores.signedPrekey.readAll()},"debug-get-signed-prekeys")});return r.apply(this,arguments)}function f(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["meta"],"readonly",function(a){return a.stores.meta.readAll()},"debug-get-meta-rows")});return s.apply(this,arguments)}function t(a){return h().then(function(b){return b.filter(function(b){return b.userJid===a})})}function u(a){return j().then(function(b){return b.find(function(b){return b.contactJid===a})})}function v(a){return l().then(function(b){return b.filter(function(b){return d("WAJids").extractUserJid(b.id)===a})})}function w(a){return n().then(function(b){return b.filter(function(b){return b.userJid===a})})}g.getIdentities=h;g.getContacts=j;g.getSessions=l;g.getSenderKeySessions=n;g.getPrekeys=a;g.getPrekeyGenerations=c;g.getSignedPrekeys=e;g.getMetaRows=f;g.getIdentitiesForUser=t;g.getContact=u;g.getSessionsForUser=v;g.getSenderKeySessionsForUser=w}),98);
__d("MAWDebug",["EBMinosQplFlow","EBUploadSentMessageFakeData","EBUploadSentMessageForReceipients","EBWorkerEBSMStateUtils","ExecutionEnvironment","FBLogger","LSMEBTaskCreationSource","MAWAdminWriteCutoverThreadMsgTxn","MAWArmadilloPollTableSchema.pb","MAWBackend","MAWBridge","MAWBulkHandleIncomingMsgApi","MAWConfig","MAWCurrentUser","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppDataTxns","MAWDbChunkTxns","MAWDbDeviceChangeAlerts","MAWDbEditMsgHistoryTxns","MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWDbGetDeviceChangeAlertsTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbGroupInfoTxns","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbObjDecode","MAWDbObjEncode","MAWDbParticipantTxns","MAWDbPendingReceiptTxns","MAWDbPoll","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWDbVersion","MAWDbXMATxns","MAWDebugSendMultipleMsgs","MAWDexieTable","MAWEncryptedBackupCacheManager","MAWEphemeralCleaner","MAWEphemeralSettingsTxns","MAWExternalId","MAWGroupSetMemberAddMode","MAWHandleEchoMsgsRestoreApiV2","MAWJids","MAWJobDefinitions","MAWJobManager","MAWKeychainNaClCrypto","MAWLoadMsgsApi","MAWLoggerUtils","MAWMediaUtils","MAWMpsGating","MAWRotateDTSG","MAWSendEphemeralSettingMsg","MAWSendNoteReplyMsg","MAWSendSenderKeyDistributionMsg","MAWTransactionMode","MAWTransactor","MAWUnsafeCoerce","MAWVault","OfflineThreadingId","Promise","WAAPI","WAAbPropsInit","WABuildMpsPayload","WADbPersonalSenderKeyStatusTxns","WADbTransactor","WADevicesState","WAExceededStorageQuota","WAGatherMediaInfo","WAGetPlatformFromStanzaId","WAGlobals","WAGzip","WAHandleFailureUtils","WAJids","WAJobOrchestratorTypes","WALogger","WAMPSFlushable","WAMediaUtils","WAPREList","WAPREMetrics","WAProtocolQueue","WARotateSignedPreKey","WARunStorageBenchmark","WASignalDB","WASignalOther","WATimeUtils","WebStorageEstimator","WormDbDebuggingUtils","asyncToGeneratorRuntime","emptyFunction","err","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}var k={addBadProtocolQueueInstruction:function(){var a={instruction:"bad",type:"instruction"};return d("WAProtocolQueue").protocolQueue().addAndCommit([a])},addDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},addGroupParticipants:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.addGroupParticipants(a,b,c))},addICDCAlert:function(a){return d("WAGlobals").getWaOneQueue().enqueue(function(){d("MAWMpsGating").isMpsM3()===!1&&d("MAWMpsGating").isFullMpsEnabled()===!1&&d("WAProtocolQueue").pqFlushable.enqueue({instruction:"icdcError",jid:a,notificationTs:d("WATimeUtils").unixTime(),priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,type:"instruction"});d("WAMPSFlushable").mpsFlushable.enqueue(d("WABuildMpsPayload").buildMpsIcdcAdminMessage(a,d("WATimeUtils").unixTime(),d("WAGlobals").getDependencies().generateExternalId()),function(){},"maw_debug");return(i||(i=b("Promise"))).resolve()},{flush:!0,operationType:"debug_operation"}).then(c("emptyFunction"))},benchmarkStorage:function(a,b,c,e){a===void 0&&(a=!1),b===void 0&&(b=1),c===void 0&&(c=50),e===void 0&&(e=500),void d("WARunStorageBenchmark").runStorageBenchmark(function(a){return!1},a,b,c,e)},checkStorageQuota:function(){return d("WAExceededStorageQuota").checkStorageQuota()},createGroup:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("createGroup",{extras:{clientThreadKey:c,platform:"msgr"},key:c,s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey(),subject:a,users:b}))},createTestPoll:function(a){void m({poll:d("MAWTransactionMode").READWRITE})(function(b){return b.poll.put({chatJid:a,encKey:new ArrayBuffer(0),latestSenderTimestampsMs:new Map([["@me",d("WATimeUtils").millisTime()]]),pollAuthor:"@me",pollOptions:new Map([[d("MAWDbPoll").convertStringToOptionHash("option1Hash"),{optionText:"option1",voteAuthors:new Set(["@me"])}]]),pollParticipantCount:2,pollStanzaId:d("MAWExternalId").generateExternalId(),pollState:d("MAWArmadilloPollTableSchema.pb").POLL_STATE.OPEN,selectableOptionsCount:0,title:"Test Poll"})})(a)},createThread:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","createThread",{contactFbid:a,description:"MAWDebug",threadKey:d("OfflineThreadingId").createOfflineThreadingID()})},decodeEAR:function(a,b){return d("MAWDbObjDecode").decodeDbObj(a,b)},deflate:function(a){var b=d("WAGzip").createDeflate();b.push(a,!0);return b.result()},deleteGroupInvitesByThreadAndInvitedParticipant:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant)(a,b))},demoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.demoteGroupParticipants(a,b))},deregisterPhone:function(){c("promiseDone")(d("WAHandleFailureUtils").deregisterPhone())},dropExpiredMessagesFromDB:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.backend.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},dropExpiredMessagesFromUI:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.ui.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},encodeEAR:function(a,b){return d("MAWDbObjEncode").encodeDbObj(a,b)},encryptEARTweetNaCl:function(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,b,c)},estimateStorage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WebStorageEstimator").estimateStorage());return a});function c(){return a.apply(this,arguments)}return c}(),executeQuery:function(a){var b=Object.keys(d("MAWDbVersion").CURRENT_MAW_STORES).filter(function(a){return d("MAWDbVersion").CURRENT_MAW_STORES[a]!=null}).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b+""]=d("MAWTransactionMode").READWRITE,a))},{});return m(b)(a)()},forwardMsg:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","forwardMsg",{args:{args:{},chatJid:a,externalId:d("MAWExternalId").generateExternalId(),protocolMsgId:b},qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},fromUnixTime:function(a){return d("WATimeUtils").toDate(a)},gatherMediaInfo:function(){c("promiseDone")(d("WAGatherMediaInfo").gatherMediaInfo())},generateAndUploadPreKeys:function(){return c("WAAPI").generateAndUploadPreKeys({reason:"test"})},generateAndUploadPreKeysMultipleCalls:function(){return(i||(i=b("Promise"))).all([c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"})])},generateDuplicateMessagesForChat:function(a,b){return k.generateMessagesForChat(a,b).then(function(a){var b=a.msgResults.values().map(function(a){return(a=a.value)==null?void 0:a.protocolMsgId.externalId}).filter(Boolean),e=b[0];return m({messages:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.get({externalId:b}).then(function(b){if(b!=null)return a.messages.put(babelHelpers["extends"]({},b,{externalId:e,protocolMsgId:void 0}))})})).then(c("emptyFunction"))})(b)})},generateMessagesForChat:function(a,b){return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(Array.from({length:b}).map(function(b,c){b=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now());var e=d("MAWExternalId").generateExternalId();c={ack:2,altIndex:void 0,author:"@me",externalId:e,msgContent:{content:"Stub message #"+c},serverTs:b,ts:b,type:"Text"};return{msgData:{folder:null,id:{author:"@me",chat:a,externalId:e},msg:{encoded:new Uint8Array(0),version:"v2"},recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"},receiveFlow:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,{}),stanzaSource:"wa",unstoredContent:{unstoredDbMedia:null,unstoredDbMsg:c,unstoredDbReaction:null,unstoredDbReceiverFetchInfo:null}}}),c("LSMEBTaskCreationSource").TEST_ONLY)},getAbProp:function(a){return d("WAAbPropsInit").getAbProp(a)},getAbProps:function(){return d("WAAbPropsInit").getAbProps()},getAppDatas:function(a){return l(m({appData:d("MAWTransactionMode").READONLY})(d("MAWDbAppDataTxns").bulkGetAppData)(a))},getAppMetaByKey:function(a){return l(m({appMeta:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTypeVersionTxns").getAppMetaValue)(a))},getChunksByChunkId:function(a){return l(m({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").bulkGetChunks)(a))},getConfig:function(){return Object.fromEntries(Object.entries(d("MAWConfig").getConfig()).map(function(a){var b=a[0];a=a[1];var c;a;try{c=a()}catch(b){c=a}return[b,c]}))},getCurrentUserDeviceList:function(){return c("WAAPI").getCurrentUserDeviceList()},getDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsTxn").getDeviceChangeAlertsTxn)(a))},getDeviceChangeAlertsByOptions:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn)(a))},getDeviceChangeAlertsByOptionsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getDeviceChangeAlertsByOptions",{options:a})},getDevices:function(a,b){return c("WAAPI").getDevices({ignoreDhash:b,reason:"debug",users:new Set(a)})},getDevicesState:function(){return d("WADevicesState").getDevicesState()},getEBRestoreCache:function(){return d("MAWEncryptedBackupCacheManager").restoredCache},getEBSMWorkerState:function(){return(h||(h=c("ExecutionEnvironment"))).isInWorker?d("EBWorkerEBSMStateUtils").getEBSMWorkerState():d("MAWBridge").getBridge().sendAndReceive("backend","getEBSMWorkerState")},getEditMsgHistoryByEditMsgHistoryId:function(a){return l(m({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").bulkGetEditMsgHistorys)(a))},getEditMsgHistoryByProtocolMsgId:function(a){return l(m({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId)(a))},getGroupInfosByGroupJid:function(a){return l(m({groupInfo:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInfoTxns").getGroupInfos)(a))},getGroupInvite:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").maybeGetGroupInvite)(a,b))},getGroupInvitesByThreadAndInvitedParticipant:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant)(a,b))},getHmacKeyFromGlobals:function(){return d("WAGlobals").getHMACKey()},getMediaBackupForObjectId:function(a){return l(m({mediaBackup:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId)(a))},getMediaByIdWithDecodedMediaEntries:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a));a.forEach(function(a){if(!(a==null?void 0:a.mediaEntries))return;a.mediaEntries=new Map(Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return[b,d("WAMediaUtils").decodeMediaEntryData(a)]}))});return l((i||(i=b("Promise"))).resolve(a))});function c(b){return a.apply(this,arguments)}return c}(),getMediaByMediaId:function(a){return l(m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a))},getMediaByPlaintextHash:function(a){return l(m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash)(a))},getMessagesByMsgIds:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return a.filter(Boolean)})})(a))},getMsgsByChat:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("threadJid").equals(a).toArray()})())},getMsgsByMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByMsgIds)(a))},getMsgsByProtocolMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByProtocolMsgId)(a))},getNewDTSG:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield d("MAWRotateDTSG").getNewDTSG()).token});function c(){return a.apply(this,arguments)}return c}(),getParticipantsByParticipantKeys:function(a){return l(m({participants:d("MAWTransactionMode").READONLY})(d("MAWDbParticipantTxns").bulkGetParticipants)(a))},getPendingReceipts:function(a){return l(m({pendingReceipts:d("MAWTransactionMode").READONLY})(d("MAWDbPendingReceiptTxns").getPendingReceipts)(a))},getPersonalSenderKeyStatusesByGroupJid:function(a){return l(n({personalSenderKeyStatuses:d("MAWTransactionMode").READONLY})(d("WADbPersonalSenderKeyStatusTxns").bulkGetPersonalSenderKeyStatuses)(a))},getPlatform:function(a){return d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a)},getProtocolMsgId:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:a})},getReactionByReactToExternalId:function(a){return l(m({reactions:d("MAWTransactionMode").READONLY})(function(b){return b.reactions.where("reactToExternalId").anyOf(a).toArray()})(a))},getReactionByReactToMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return d("MAWDbReactionsTxns").getReactionsFromMessages(b,a)})})(a))},getReceiptByWAMsgId:function(a){return l(n({receipts:d("MAWTransactionMode").READONLY})(function(a,b){return a.receipts.get({waMsgId:b})})(a))},getThreadsByChatJids:function(a){return l(m({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThreads)(a))},getUnArchivedDeviceChangeAlertsCount:function(){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn)())},getUnrenderedMsgsByMsgId:function(a){return l(m({unrenderedMessages:d("MAWTransactionMode").READONLY})(d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByMsgIds)(a))},getXMAByXMAId:function(a){return l(m({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").bulkGetXMAs)(a))},handleEchoMsgsBulkRestore:function(a,b,c,e,f,g,h,i){return l(d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(a,b,c,e,f,g,h,i,void 0,void 0,void 0,void 0,void 0,!1))},hmacPlaintextHash:function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)},inflate:function(a){return d("WAGzip").inflate(a)},leaveGroups:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.leaveGroups(a))},loadMsgs:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(yield d("MAWLoadMsgsApi").loadMsgsFromTs(a.chatJid,(b=a.numMsgs)!=null?b:10,a.direction,a.sortOrderMs,a.loadOriginalMsg,a.msgId,{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0}));return babelHelpers["extends"]({},b,{msgs:b.msgs.map(function(a){return babelHelpers["extends"]({},a,{content:a.content!=null?d("MAWVault").unvault(a.content):""})})})});function c(b){return a.apply(this,arguments)}return c}(),makeError:function(a){throw c("FBLogger")("messenger_web_devx").mustfixThrow(a)},makeWAError:function(a){d("WALogger").ERROR(j(),a)},markThreadAsRead:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(a,null,!1,!1,b,c,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}))},maybeGetChunksByPlaintextHash:function(a){return l(m({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").maybeGetChunkByPlaintextHash)(a))},maybeGetXMAFromProtocolMsgId:function(a){return l(m({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId)(a))},minosUploadTest:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("EBUploadSentMessageForReceipients").uploadSentMessageForReceipients({qplFlow:d("EBMinosQplFlow").startMinosMessageUploadQpl({threadId:d("EBUploadSentMessageFakeData").FAKE_UPLOAD_ENTITY.threadId}),uploadEntity:d("EBUploadSentMessageFakeData").FAKE_UPLOAD_ENTITY})});function c(){return a.apply(this,arguments)}return c}(),notifyDeviceChange:function(a){return c("WAAPI").notifyDeviceChange({users:a})},overrideAbProp:function(a,b){d("WAAbPropsInit").overrideAbProp(a,b)},promoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.promoteGroupParticipants(a,b))},protocolQueue:function(){return d("WAProtocolQueue").protocolQueue()},putGroupInvite:function(a){return l(m({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").putGroupInvite)(a))},putNewPersonalSenderKeyStatus:function(a){return n({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE})(d("WADbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus)(a)},queryAllGroups:function(){return c("WAAPI").queryGroups({type:"all"}).then(c("emptyFunction"))},readProtocolQueue:function(){return d("WAProtocolQueue").protocolQueue().read()},readWormStore:function(a){return d("WASignalDB").getDb().runInTransaction([a],"readonly",function(b){return b.stores[a].readAll()},"Debug - read "+a)},removeDevice:function(a,b){return c("WAAPI").removeDevice({deviceId:a,identity:b})},removeGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.removeGroupParticipants(a,b))},reportUserSpam:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.reportUserSpam(a,"frx",b,!1,["harassment"],"fake debug context"))},reregisterPhone:function(){return d("WAHandleFailureUtils").reregisterPhone()},restoreMessagesFromEncryptedBackups:function(a,b,c,e,f,g,h,i,j,k){return l(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,c,e,f,g,h,i,j,k)))},revokeMsg:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.revokeMsgs({msgIds:[a],s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()}))},rotateSignedPreKey:function(){return d("WARotateSignedPreKey").rotateSignedPreKey()},sendAppData:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a,deviceJids:b}))},sendBumpMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendBumpMsg(a,b))},sendEditMsg:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","sendEditMsg",{args:{editMsgContent:{content:a.editMsgContent.content,mentionedJids:[]},originalProtocolMsgId:a.originalProtocolMsgId},chatJid:a.originalProtocolMsgId.chat,externalId:b,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},sendEphemeralSettingMsg:function(a,b){return d("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:b,chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},sendInvisibleMsg:function(a){return d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a,d("MAWExternalId").generateExternalId(),d("MAWLoggerUtils").getInstanceKey())},sendInvisibleMsgToAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a.groupJid,d("MAWExternalId").generateExternalId(),d("MAWLoggerUtils").getInstanceKey()));return b});function c(){return a.apply(this,arguments)}return c}(),sendMessageTooAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(k.sendMsg(a.groupJid,{content:"message to "+a.groupJid+" at "+new Date().getTime(),s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()}));return b});function c(){return a.apply(this,arguments)}return c}(),sendMsg:function(a,b){var e=b.s2sInstanceKey;b.s2sUserFlowQPLEvent;b=babelHelpers.objectWithoutPropertiesLoose(b,["s2sInstanceKey","s2sUserFlowQPLEvent"]);return d("MAWBridge").getBridge().sendAndReceive("backend","sendMsg",{args:b,chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:e})},sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs.execute,sendNoteReplyMsg:function(a,b){return d("MAWSendNoteReplyMsg").sendNoteReplyMsgFn({args:{content:b.content,noteContent:b.noteContent,noteExpirationTs:b.noteExpirationTs},chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},sendReaction:function(a,b,e,f){return d("MAWBridge").getBridge().sendAndReceive("backend","sendReactionMsg",{args:{groupingKey:"",reaction:f,reactToAuthor:e,reactToProtocolMsgId:b},chatJid:a,externalId:b.externalId,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},setEphemeralSettingWithoutUpdate:function(a,b,c,e){c=c==null?d("WATimeUtils").unixTime():d("WATimeUtils").futureUnixTime(c);return l(m({ephemeralSettings:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange)(a,b,c,e))},setGroupSubject:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.setGroupSubject(a,b))},setMemberAddMode:function(a,b){return d("MAWGroupSetMemberAddMode").setMemberAddModeFn({groupJid:a,memberAddMode:b})},startComms:function(){var a;void ((a=d("MAWBackend").getWaComms())==null?void 0:a.startComms())},stopComms:function(){var a;(a=d("MAWBackend").getWaComms())==null?void 0:a.stopComms()},syncAbProps:function(a){a=a!==!0;return c("WAAPI").syncAbProps({sendHash:a})},triggerSecureStorageKeyChangeAlert:function(){var a={action:d("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:d("WAJids").toDeviceJid(d("MAWJids").toUserJid(d("MAWCurrentUser").getID()),d("WAGlobals").getMyDeviceJid()),identity:d("MAWUnsafeCoerce").unsafeCoerce(d("WASignalOther").makeBytes(33)),isArchived:!1,model:"secure_storage",platform:"Meta",ts:d("WATimeUtils").unixTime()};return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlertsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","updateDeviceChangeAlerts",{alert:a})},updateDeviceChangeAlertsLogInStatus:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn)(a))},uploadRetroactiveThreadsAndMessages:function(){return l(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveThreadsAndMessages()))},wormGetContact:function(a){return d("WormDbDebuggingUtils").getContact(a)},wormGetContacts:function(){return d("WormDbDebuggingUtils").getContacts()},wormGetIdentities:function(){return d("WormDbDebuggingUtils").getIdentities()},wormGetIdentitiesForUser:function(a){return d("WormDbDebuggingUtils").getIdentitiesForUser(a)},wormGetMetaRows:function(){return d("WormDbDebuggingUtils").getMetaRows()},wormGetPrekeyGenerations:function(){return d("WormDbDebuggingUtils").getPrekeyGenerations()},wormGetPrekeys:function(){return d("WormDbDebuggingUtils").getPrekeys()},wormGetSenderKeySessions:function(){return d("WormDbDebuggingUtils").getSenderKeySessions()},wormGetSenderKeySessionsForUser:function(a){return d("WormDbDebuggingUtils").getSenderKeySessionsForUser(a)},wormGetSessions:function(){return d("WormDbDebuggingUtils").getSessions()},wormGetSessionsForUser:function(a){return d("WormDbDebuggingUtils").getSessionsForUser(a)},wormGetSignedPrekeys:function(){return d("WormDbDebuggingUtils").getSignedPrekeys()},writeCutoverThreadAdminMsg:function(a,b){var c;return l(m({chunk:(c=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:c.READWRITE,groupInfo:c.READONLY,media:c.READONLY,messages:c.READWRITE,threads:c.READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg)(a,b))},writeRollbackCutoverThreadAdminMsg:function(a){a=m({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThread)(a);return a.then(function(a){if(!a.success)return(i||(i=b("Promise"))).resolve();a=a.value;return l(m({chunk:d("MAWTransactionMode").READONLY,ftsBackloggedMessages:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg)(a))})}};function l(a){return a.then(function(a){return a})}c("gkx")("23903")&&(self.Debug=k,self.WAAPI=c("WAAPI"));function m(a){return function(b){return d("MAWTransactor").makeMsgrTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}function n(a){return function(b){return d("WADbTransactor").makeSignalTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}g.MAWDebugFuncs=k}),98);
__d("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/api/v1/direct_v2/restoration_cdn_url/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("endpoints",["CSRFGuard","PolarisConfig","Promise","XHRRequest","XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder","getAsyncParams"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return new(h||(h=b("Promise")))(function(b,e){var f=c("getAsyncParams")("POST"),g=new(c("XHRRequest"))(c("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder").buildURL({}));g.setMethod("POST").setRequestHeader("X-IG-App-ID",d("PolarisConfig").getIGAppID()).setData(babelHelpers["extends"]({},f,{payload:a})).setResponseHandler(function(a){try{a=a.trim();d("CSRFGuard").exists(a)&&(a=d("CSRFGuard").clean(a));a=JSON.parse(a);b(a.payload.restoration_cdn_url)}catch(a){e(a)}}).setErrorHandler(function(a){e(a)}).send()})}g.fetchEBRestoreCDNUrl=a}),98);
__d("IGDAWDebug",["I64","IGDAWProtocolQueueInstructions","MAWDebug","MAWReStoreDb","MAWUnsafeCoerce","WAJids","WAProtocolQueue","WASignalKeys","asyncToGeneratorRuntime","cr:7711","endpoints"],(function(a,b,c,d,e,f,g){"use strict";var h;a={UNSAFE_triggerICDCErrorForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAJids").toMsgrUserJid(a);var b=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),c=d("MAWUnsafeCoerce").unsafeCoerce(42);a={instruction:"icdcError",jid:a,notificationTs:b,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:c,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([a])});function c(b){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityAddedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityAdded",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityChangedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityChanged",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityRemovedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,instruction:"identityRemoved",jid:a,notificationTs:c,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),fetchEBRestoreCDNUrl:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("endpoints").fetchEBRestoreCDNUrl(a))}catch(a){}});function c(b){return a.apply(this,arguments)}return c}(),fetchInstamadilloMessage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){try{var g=(yield d("MAWReStoreDb").getDB(f.id+":144"));yield b("cr:7711")==null?void 0:b("cr:7711")(g,(h||(h=d("I64"))).of_float(a),c,e)}catch(a){}});function c(b,c,d){return a.apply(this,arguments)}return c}()};Object.assign(d("MAWDebug").MAWDebugFuncs,a)}),34);
__d("MAWParseXMAIGConfig",["WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";b=new Set([(a=d("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION]);g.IGD_SUPPORTED_TARGET_TYPES=b}),98);
__d("IGDAWMainWebWorkerConfig",["MAWGK","MAWParseXMAIGConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1;a={S508658PreventOldSessionLookupAndPromote:function(){return!0},armadilloWebProcessFutureproof:function(){return c("MAWGK").armadillo_web_process_futureproof},batchSize:function(){return 500},dynamicPullMode:function(){return c("gkx")("12141")},getDevicesV2:function(){return c("gkx")("4551")},getSignalFutureMessagesMax:function(){return c("justknobx")._("847")},handshakeRecovering:function(){return!1},icdcAlertTriggerFailureCounter:function(){return c("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return 1e4},icdcIntervalInMinutes:function(){return c("justknobx")._("1972")},ignoreReadReceipts:function(){return c("qex")._("3109")===!1},isDocumentReceiveEnabled:function(){return!1},isEphemeralMessagesEnabled:function(){return!0},isFrankingDropOnInvalid:function(){return c("gkx")("23973")},isFrankingDropOnMissing:function(){return c("gkx")("23974")},isFrankingEnabled:function(){return c("justknobx")._("1347")},isGifEnabled:function(){return c("justknobx")._("1147")},isICDCErrorEnabled:function(){return c("gkx")("23975")},isImageHDSupportedEnabled:function(){return!1},isMediaFallbackToAlternativeHmacSaltsEnabled:function(){return c("gkx")("23976")},isMetaAiInvocationMessageRenderEnabled:function(){return!1},isOctetStreamAttachmentMimeTypeEnabled:function(){return c("gkx")("4644")},isPollsEnabled:function(){return!1},isProgressiveJpegSendEnabled:function(){return c("justknobx")._("2412")},isSenderKeyPredistributionEnabled:function(){return c("gkx")("23981")},isSharedWorkerContext:function(){return(h||(h=d("WorkerUtils"))).isSharedWorkerContext()},isStickerEnabled:function(){return c("justknobx")._("2619")},isStickerReceiverFetchEnabled:function(){return!1},isStoryMentionXMAEnabled:function(){return!1},jpegThumbnailTargetByteSizeKB:function(){return c("justknobx")._("2338")},limitPullMode:function(){return c("gkx")("10270")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return d("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},offlineQueueStuckTimeoutMs:function(){return c("justknobx")._("3264")},oneQueueTimeoutMs:function(){return c("justknobx")._("2583")},orchestratorVersion:function(){return c("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return c("justknobx")._("67")},sendMsgWithoutJob:function(){return c("gkx")("7854")},sessionDropIfTooOld:function(){return c("justknobx")._("2240")},shouldDeviceStateTimesout:function(){return!0},simplifyPQ:function(){return!1},skipDownloadablePreviewForProgressiveJpeg:function(){return c("justknobx")._("2371")},skipProcessingGroupInvite:function(){return c("justknobx")._("3899")},useLongSessionDrop:function(){return c("gkx")("1244")},waDanglingQueue:function(){return c("justknobx")._("1921")}};b={productTypeForEBAttachments:"igd",shouldFallbackToPreviewForFailedProgressiveJpeg:function(){return c("gkx")("2909")},supportedTypesVersion:function(){return c("MAWGK").armadillo_web_process_futureproof?i+1:i},supportedXMATargetTypes:function(){return d("MAWParseXMAIGConfig").IGD_SUPPORTED_TARGET_TYPES}};g.waConfig=a;g.mawConfig=b}),98);
__d("IGDBridgedAPIHandler",["JSResourceForInteraction","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["igdapi: unsupported api call ",""]);h=function(){return a};return a}function a(a){var b=a.args;a=a.type;switch(a){case"46":return c("JSResourceForInteraction")("IGDSendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"33":return c("JSResourceForInteraction")("IGDUnsendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendEditMessage":return c("JSResourceForInteraction")("IGDEditMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendMediaMessage":return c("JSResourceForInteraction")("IGDSendMediaMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendOrRemoveReaction":return c("JSResourceForInteraction")("IGDSendRemoveReactionTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendXmaReceiverFetch":return c("JSResourceForInteraction")("IGDSendXmaReceiverFetchTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});default:d("WALogger").DEV(h(),a).devConsole(b);return}}g.igdapi=a}),98);
__d("MAWEncryptedBackupsClearRecoveryCode",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=b("Promise"))).all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_recovery_code_data)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_recovery_code_status))]).then(function(c){var d=c[0],e=c[1];if(d!=null||e!=null)return a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([(d==null?void 0:d.taskId)!=null?a.secure_recovery_code_data["delete"](d.taskId):(h||(h=b("Promise"))).resolve(),(e==null?void 0:e.pk)!=null?a.secure_encrypted_backups_recovery_code_status["delete"](e.pk):(h||(h=b("Promise"))).resolve()])},"readwrite",void 0,void 0,f.id+":27")})}g.encryptedBackupsClearRecoveryCode=a}),98);
__d("LSOptOutOfBackup",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] Beginning execution."),c("justknobx")._("1099")?d.sequence([function(a){return d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,1469]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[11]=a[0],a})},function(a){return e[11]?e[12]=!0:e[12]=!1,e[12]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[14]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[14]].join("")),e[13]=d.createArray(),void 0!==void 0?e[15]=(e[13].push(void 0),e[13]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[14],e[13],d.i64.cast([0,3]))):d.resolve()}])},function(c){return e[8]=new d.Map(),e[8].set("backup_id",a[0]),e[8].set("trace_id",void 0),e[9]=d.toJSON(e[8]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_opt_out",d.i64.cast([0,50019]),e[9],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[10]=a[0],a})},function(a){return e[1]=d.i64.cast([0,0])}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] backup opt out flow is not enabled"),e[1]=d.i64.cast([0,1])))},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsOptOutOfBackupStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[1]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsOptOutOfBackupStoredProcedure";a.__tables__=[];d=a;g["default"]=d}),98);
__d("LSOptOutOfBackupStoredProcedure",["LSOptOutOfBackup","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptOutOfBackup"),e.backupId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("encryptedBackupsOptOutOfBackup",["LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSOptOutOfBackupStoredProcedure","LSResult","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)).then(function(b){if(b==null)return c("LSResult")((h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE));var e=b.backupId;return e!=null?a.runInTransaction(function(a){return c("LSOptOutOfBackupStoredProcedure")(c("LSFactory")(a),{backupId:e})},"readwrite",void 0,void 0,f.id+":31"):c("LSResult")((h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE))}).then(function(){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state).take(1))})}g.optOutOfBackupStoredProcedure=a}),98);
__d("MessengerInfraReport",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h={};a=function(){for(var a of Object.keys(h))delete h[Number(a)]};b=function(){return c("gkx")("23390")};var i=20;d=function(a,b,c){var d=h[a];if(!d){h[a]=new Map([[c,babelHelpers["extends"]({},b,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()})]]);return}var e=d.get(c);if(e!=null){d.set(c,babelHelpers["extends"]({},e,b,{latestTimestampMs:Date.now()}));return}if(d.size>=i){h[a]=new Map([[c,babelHelpers["extends"]({},b,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()})]]);return}d.set(c,babelHelpers["extends"]({},b,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()}))};e=function(a,b){return(a=h[a])==null?void 0:a.get(b)};f=function(a,b){(a=h[a])==null?void 0:a["delete"](b)};g.reportedEvents=h;g.clearReportedEvents=a;g.isEPD=b;g.MAX_SIZE=i;g.storeEventData=d;g.getEventData=e;g.deleteEventData=f}),98);
__d("MAWCacheServiceDB",["FBLogger","MAWCurrentUser","MAWIndexedDbMetadata","MAWWormOdsLogger","MessengerWebInitData","Promise","WAHex","Worm","WormEAR","WormIDbDriver","asyncToGeneratorRuntime","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;f={autoIncrement:!0,indexes:{key:{fields:["key"],unique:!0}},primaryKey:"id",secure:!0};var i={snippets:f},j=null,k=function(a,b,e){b=new(d("WormEAR").WormEAR)(e,b);a=new(d("WormIDbDriver").WormIDbDriver)(a,"maw_cache_service",e,b,d("MAWWormOdsLogger").wormOdsWorkerLogger,{onTransactionError:m});return new(d("Worm").WormDatabase)(a,c("qpl")._(1056840657,"2716"))};function l(){if(j!==null)return j;j=new(h||(h=b("Promise")))(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=k(d("MAWIndexedDbMetadata").MAWcacheServiceDbName(d("MAWCurrentUser").getID()),d("WAHex").parseHex(c("MessengerWebInitData").accountKeyV2),i);yield e.init();a(e)}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("Failed to create cache service DB"),j=null,b(a)}});return function(b,c){return a.apply(this,arguments)}}());return j}function m(a){if(a instanceof d("WormEAR").DecryptionError){var b=a;c("FBLogger")("MAWCacheService").mustfix("EAR decryption error in store: %s. Attempting to delete the store:",b.store);c("promiseDone")(l().then(function(a){return a.runInTransaction([b.store],"readwrite",function(a){return a.stores[b.store].clear()},"delete-corrupted-entity")}).then(function(){c("FBLogger")("MAWCacheService").info("Successfully deleted corrupted store %s",b.store)})["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to delete corrupted store %s, err: %s",b.store,a.message)}))}}function a(a){return a.map(function(a){a[0];a=a[1];return a})}function e(){var a=Object.keys(i);return l().then(function(d){return d.runInTransaction(a,"readonly",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var d={};yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c.stores[a].readAll());d[a]=b});return function(b){return a.apply(this,arguments)}}()));return d});return function(a){return c.apply(this,arguments)}}(),"MAW Cache DB - Dump")["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to create cache service DB");return{}})})}g.getOrSetupMAWCacheDB=l;g.convertCacheValueToDBRawValue=a;g.getDbDump=e}),98);
__d("MAWCacheServiceQPL",["ExecutionEnvironment","MAWCurrentUser","MAWQplProxy","QPLUserFlow","performanceAbsoluteNow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=new Set(),k=new Set(),l=3e3,m=c("qpl")._(1056836703,"2955");function a(a,b){var e=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(e){if(k.has(a))return;o(a);d("MAWQplProxy").startQplUserFlow(m,{},{callBridgeWithTimestamp:!0,providedInstanceKey:a})}else{if(j.has(a))return;n(a);c("QPLUserFlow").start(m,{annotations:{string:{service:b}},instanceKey:a})}}function n(a){j.add(a)}function o(a){k.add(a)}function b(a,b,e){var f=q(e),g=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(g){if(!k.has(a))return;d("MAWQplProxy").sendQplPointThroughBridge(m,"worker@"+f+b,{instanceKey:a},!0)}else{if(!j.has(a))return;var n=(i||(i=c("performanceAbsoluteNow")))();e==="realtime-update"?window.setTimeout(function(){c("QPLUserFlow").addPoint(m,"ui@"+b,{instanceKey:a,timestamp:n})},l):c("QPLUserFlow").addPoint(m,"ui@"+b,{instanceKey:a})}}function e(a,b){var e=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(e){if(!k.has(a))return;d("MAWQplProxy").sendQPLAnnotationsThroughBridge(m,b,a)}else{if(!j.has(a))return;c("QPLUserFlow").addAnnotations(m,b,{instanceKey:a})}}function f(a){var b=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(b){if(!k.has(a))return;k["delete"](a);d("MAWQplProxy").sendQPLSuccessThroughBridge(m,{},a,!0)}else{if(!j.has(a))return;var e=(i||(i=c("performanceAbsoluteNow")))();window.setTimeout(function(){j["delete"](a),c("QPLUserFlow").endSuccess(m,{instanceKey:a,timestamp:e})},l)}}function p(a,b,e){e=q(e);var f=(h||(h=c("ExecutionEnvironment"))).isInWorker||(h||(h=c("ExecutionEnvironment"))).isInSharedWorker;if(f){if(!k.has(a))return;d("MAWQplProxy").sendQPLFailThroughBridge(m,"worker@"+e+b,{},a,!0)}else{if(!j.has(a))return;var g=(i||(i=c("performanceAbsoluteNow")))();window.setTimeout(function(){j["delete"](a),c("QPLUserFlow").endFailure(m,"ui@"+b,{instanceKey:a,timestamp:g})},l);j["delete"](a)}}function q(a){return a?a.replaceAll("-","_")+"_":""}function r(a){return d("MAWCurrentUser").isEmployee()||d("MAWCurrentUser").isTestUser()?a:void 0}e={addAnnotationsQPL:e,addPointQPL:b,endFailureQPL:p,endSuccessQPL:f,redactKeysForNonEmployee:r,registerInstanceKeyInUI:n,registerInstanceKeyInWorker:o,startQPL:a};g["default"]=e}),98);
__d("MAWCacheServiceUtils",[],(function(a,b,c,d,e,f){"use strict";var g="maw_cache_service_broadcast",h=typeof window!=="undefined"?window:self;c=function(){return new h.BroadcastChannel(g)};d={concurrency:1,maxConcurrency:1,maxThrottleMs:500};function a(a){return"maw-cache-service-"+a}function b(a,b){var c=new Set(),d=[];a.forEach(function(a){var e=b(a);if(c.has(e)){d.push(a);return}c.add(e)});return d}f.MAW_CACHE_SERVICE_BROADCAST_CHANNEL=g;f.getMAWCacheServiceBroadcastChannel=c;f.SCHEDULER_CONFIG=d;f.getSchedulerName=a;f.findDuplicates=b}),66);
__d("MAWCacheServiceBase",["MAWCacheServiceDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=new Map(),this.namespace=a}var c=a.prototype;c.$2=function(a){return(a=this.$1.get(a))!=null?a:null};c.updateInMemoryCache=function(a,b){this.$1.set(a,b)};c.updateInMemoryCacheBulk=function(a){var b=this;a.forEach(function(a){var c=a[0];a=a[1];b.updateInMemoryCache(c,a)})};c.getValueFromCache=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,c=this.$2(a);if(c!=null)return c;c=(yield d("MAWCacheServiceDB").getOrSetupMAWCacheDB());c=(yield c.runInTransaction([this.namespace],"readonly",function(c){return c.stores[b.namespace].getByIndex("key",[a])},"read_from_persisted_"+this.namespace));c!=null&&this.updateInMemoryCache(a,c);return(c=c)!=null?c:null});function c(b){return a.apply(this,arguments)}return c}();return a}();g["default"]=a}),98);
__d("MAWSnippetsCacheServiceUtils",["I64","MAWDbMsgOrReaction","MAWUpdateThreadBumpTimestamp"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(a,{forMessage:function(a){return{msgAckLevel:a.ack,msgId:a.msgId,reactionId:void 0,timestamp:a.sortOrderMs!=null?a.sortOrderMs:(h||(h=d("I64"))).to_float(d("MAWUpdateThreadBumpTimestamp").getBumpTimestampMs(a))}},forNull:function(){return{msgAckLevel:void 0,msgId:void 0,reactionId:void 0,timestamp:Number.MIN_SAFE_INTEGER}},forReaction:function(a){return{msgAckLevel:void 0,msgId:void 0,reactionId:a.reactionId,timestamp:(h||(h=d("I64"))).to_float(d("MAWUpdateThreadBumpTimestamp").getBumpTimestampMs(a))}}})}g.getMsgOrReactionIdAndTimestamp=a}),98);
__d("MAWSnippetsCacheCalculateDelta",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateType","MAWSnippetsCacheServiceUtils","MAWUpdateThreadListItemUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="[SnippetsCacheService][Worker]";function a(a){var b=new Set(a.map(function(a){var b;b=(b=a.decryptedValues)!=null?b:[];a=(a=a.deletedValues)!=null?a:[];return[].concat(b,a)}).flat().map(function(a){return d("MAWUpdateThreadListItemUtils").isOptimisticMessage(a)?null:a.msgId}).filter(Boolean));return a.reduce(function(a,c){var d=c.type==="delete"?c.deletedValues:c.decryptedValues;d=l(d);d=m(b,d);if(d.length===0)return a;d.forEach(function(b){var d=b.threadJid,e=a.get(d);b=k({type:c.type,value:b},e);a.set(d,b)});return a},new Map())}function b(a){return a.some(function(a){a[0];a=a[1];return!i(a)||j(a.value)})}function i(a){if(a.type==="delete"||a.type==="deleteRange"||d("MAWUpdateThreadListItemUtils").isXMAThreadSnippet(a.value))return!1;a=p(a.value);return a?!1:!0}function j(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction!=null&&d("MAWGetThreadUpdateType").canReactionAffectBump(a)}})}function k(a,b){if(b==null)return a;var c=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a.value);c=c.timestamp;var e=a.value.externalId,f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.value);f=f.timestamp;var g=b.value.externalId;if(c===f){if(a.type==="delete"||a.type==="deleteRange")return a;else if(b.type==="delete"||b.type==="deleteRange")return b;return e.localeCompare(g)>0?a:b}if(c==null)return b;return f==null?a:c>f?a:b}function l(a){return a==null||a.length===0?[]:a.filter(function(a){return n(a)})}function m(a,b){return b.reduce(function(b,c){var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(c);e=e.msgId;return e!=null&&d("MAWUpdateThreadListItemUtils").isOptimisticMessage(c)&&a.has(e)?b:[].concat(b,[c])},[])}function n(a){var b=o(a)&&!d("MAWUpdateThreadListItemUtils").isSpamMessage(a);b||q(a);return b}function o(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(b){return d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)},forReaction:function(b){return d("MAWGetThreadUpdateType").canReactionAffectBump(b)&&p(b)||d("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(a)}})}function p(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return!1},forReaction:function(a){return a.reaction==null}})}function q(a){a=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a);var b=a.msgId;a=a.reactionId;c("FBLogger")("MAWCacheService").info(h+" msg or reaction is not eligible for snippet update, msgId: %s, reactionId: %s",b,a)}g.parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids=a;g.isDbTransactionRequiredForSnippetUpdate=b;g.canCalculateSnippetUpdateFromDelta=i;g.isNeededToCheckMessageExistence=j}),98);
__d("MAWSnippetsCacheService",["FBLogger","MAWAckLevel","MAWCacheServiceBase","MAWDbMsgOrReaction","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWSnippetsCacheCalculateDelta","MAWSnippetsCacheServiceUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTransactionMode","MAWUpdateThreadListItemUtils","MAWVault","Promise","WAJids","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=["messages","reactions"],j="[SnippetsCacheService][Worker]";a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.call(this,"snippets")||this}var f=e.prototype;f.$MAWSnippetsCacheService$p_1=function(a){a=a.filter(function(a){a=a[0];return i.includes(a)});a=d("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(a.map(function(a){a[0];a=a[1];return a}));return Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return[b,a]})};f.calculateDelta=function(a){var e=this;a=this.$MAWSnippetsCacheService$p_1(a);if(a.length===0)return(h||(h=b("Promise"))).resolve([]);a=c("gkx")("14458")?(h||(h=b("Promise"))).resolve(a):(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a=a[1];var c=(yield e.$MAWSnippetsCacheService$p_2(b,a));if(c!=null){l({dropReason:c,key:b,msgOrReaction:a.value,operation:a.type});return null}return[b,a]});return function(b){return a.apply(this,arguments)}}())).then(function(a){return a.filter(Boolean)});return a.then(function(a){if(d("MAWSnippetsCacheCalculateDelta").isDbTransactionRequiredForSnippetUpdate(a)){var c;return d("MAWIndexedDb").makeMsgrTransactor({messages:(c=d("MAWTransactionMode")).READONLY,reactions:c.READONLY,threads:c.READONLY,xma:c.READONLY},"MAWSnippetsCacheService:calculateDelta",function(a){return function(b){return e.$MAWSnippetsCacheService$p_3(a,b)}})(a)}else return(h||(h=b("Promise"))).resolve(e.$MAWSnippetsCacheService$p_4(a))})};f.computeCachePayloadFromScratch=function(a){var b=this,c;return d("MAWIndexedDb").makeMsgrTransactor({messages:(c=d("MAWTransactionMode")).READONLY,reactions:c.READONLY,threads:c.READONLY,xma:c.READONLY},"MAWSnippetsCacheService:computeCachePayloadFromScratch",function(a){return function(c){return d("MAWDexieTable").dexieAll(c.map(function(c){c=d("WAJids").unsafeCoerceToChatJid(c);return b.$MAWSnippetsCacheService$p_5(a,c,"from-scratch")})).then(function(a){return a.filter(Boolean)})}})(a)};f.$MAWSnippetsCacheService$p_2=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield this.getValueFromCache(a));if(a==null)return"no-value-calculated-from-scratch";if(d("MAWUpdateThreadListItemUtils").isOptimisticMessage(b.value))return null;b=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.value);var c=b.msgAckLevel,e=b.msgId,f=b.reactionId;b=b.timestamp;if(b==null)return"missing-timestamp";if(e!=null&&e===a.value.snippetMsgId)return null;if(f!=null&&f===a.value.snippetReactionId)return null;return e!=null&&c!==d("MAWAckLevel").ACK.received&&a.value.snippetMsgAckLevel===d("MAWAckLevel").ACK.clock?"optimistic-snippet-in-cache":b<a.timestamp?"older-than-last-snippet-value":null});function c(b,c){return a.apply(this,arguments)}return c}();f.shouldDropDelta=function(a){var c=this;a=this.$MAWSnippetsCacheService$p_1(a);return a.length===0?(h||(h=b("Promise"))).resolve(!0):(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a=a[1];var d=(yield c.$MAWSnippetsCacheService$p_2(b,a));if(d!=null){l({dropReason:d,key:b,msgOrReaction:a.value,operation:a.type});return!0}return!1});return function(b){return a.apply(this,arguments)}}())).then(function(a){if(a.every(function(a){return a===!0}))return!0;else return!1})};f.$MAWSnippetsCacheService$p_5=function(a,b,c){var e=this;return d("MAWThreadSnippetUtils").getThreadSnippetFromScratch(a,b).then(function(a){a=e.$MAWSnippetsCacheService$p_6(b,a,c);return a==null?void 0:d("MAWDexieTable").dexieResolve([b,a])})};f.$MAWSnippetsCacheService$p_4=function(a){var b=this;return a.map(function(a){var c=a[0];a=a[1];a=b.$MAWSnippetsCacheService$p_7(c,a);return a==null?void 0:[c,a]}).filter(Boolean)};f.$MAWSnippetsCacheService$p_3=function(a,b){var c=this;return d("MAWDexieTable").dexieAll(b.map(function(b){var e=b[0],f=b[1];return!d("MAWSnippetsCacheCalculateDelta").canCalculateSnippetUpdateFromDelta(f)?c.$MAWSnippetsCacheService$p_5(a,e,"realtime-from-scratch"):c.$MAWSnippetsCacheService$p_8(a,f.value).then(function(a){if(a)return void 0;a=c.$MAWSnippetsCacheService$p_7(e,f);return a==null?void 0:d("MAWDexieTable").dexieResolve([e,a])})})).then(function(a){return a.filter(Boolean)})};f.$MAWSnippetsCacheService$p_7=function(a,b){var c=d("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(a,b.value);a=this.$MAWSnippetsCacheService$p_6(a,{snippet:c,snippetMsgOrReaction:b.value},"realtime-calculate-delta");return a};f.$MAWSnippetsCacheService$p_6=function(a,b,c){if(b==null){k({flow:c,key:a,threadSnippetResult:b});return void 0}var e=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(b.snippetMsgOrReaction),f=e.msgAckLevel,g=e.msgId,h=e.reactionId;e=e.timestamp;k({flow:c,key:a,msgAckLevel:f,msgId:g,reactionId:h,threadSnippetResult:b,timestamp:e});if(e==null)return void 0;c=babelHelpers["extends"]({},b.snippet.snippetParams,{strings:b.snippet.snippetParams.strings.map(function(a){return d("MAWVault").unvault(a)})});return{key:a,timestamp:e,value:{snippet:babelHelpers["extends"]({},b.snippet,{snippetParams:c}),snippetMsgAckLevel:f,snippetMsgId:g,snippetReactionId:h}}};f.$MAWSnippetsCacheService$p_8=function(a,b){if(!d("MAWSnippetsCacheCalculateDelta").isNeededToCheckMessageExistence(b))return d("MAWDexieTable").dexieResolve(!1);b=d("MAWDbMsgOrReaction").switchOnMsgOrReaction(b,{forMessage:function(a){return null},forReaction:function(a){return a.reactToMsgId}});return b==null?d("MAWDexieTable").dexieResolve(!0):d("MAWDbMsgTxns").getMsgsByMsgIds(a,[b]).then(function(a){return a.length===0})};return e}(c("MAWCacheServiceBase"));function k(a){var b=a.flow,d=a.key,e=a.msgAckLevel,f=a.msgId,g=a.reactionId,h=a.threadSnippetResult;a=a.timestamp;if(h==null){c("FBLogger")("MAWCacheService").warn(j+"["+b+"] Failed to calculate thread snippet, key: %s",d);return}if(a==null){c("FBLogger")("MAWCacheService").warn(j+"["+b+"] No timestamp found for the thread snippet, key: %s,\n      msgId: %s, reactionId: %s",d,f,g);return}c("FBLogger")("MAWCacheService").info(j+"["+b+"] Snippet successfully calculated, key: %s,\n    timestamp: %s, msgId: %s, reactionId: %s, ack level %s",d,a,f,g,e)}function l(a){var b=a.dropReason,e=a.key,f=a.msgOrReaction;a=a.operation;f=d("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(f);var g=f.msgAckLevel,h=f.msgId,i=f.reactionId;f=f.timestamp;c("FBLogger")("MAWCacheService").info(j+" Drop update for msg or reaction, reason: %s, key: %s, msgId: %s, reactionId: %s, timestamp: %s, ackLevel: %s, operation: %s",b,e,h,i,f,g,a)}var m=new a();e=function(){return m};g.getMAWSnippetsCacheService=e}),98);
__d("MAWWorkerCacheServiceRegistry",["MAWSnippetsCacheService"],(function(a,b,c,d,e,f,g){"use strict";var h={snippets:d("MAWSnippetsCacheService").getMAWSnippetsCacheService()};function a(){return h}g.getWorkerRegistry=a}),98);
__d("MAWWorkerCacheServices",["FBLogger","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWLoggerUtils","MAWWorkerCacheServiceRegistry","Promise","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){function a(){this.$1=d("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel();var a=d("MAWWorkerCacheServiceRegistry").getWorkerRegistry();this.registry=a;this.schedulerRegistry=Object.keys(a).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b]=d("WorkerScheduler").makeScheduler(d("MAWCacheServiceUtils").getSchedulerName(b),d("MAWCacheServiceUtils").SCHEDULER_CONFIG),a))},{})}var e=a.prototype;e.$2=function(a,b,c,d){b={cache:b,instanceKey:d,namespace:a,source:c};this.$1.postMessage(b)};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=d("MAWCacheServiceUtils").findDuplicates(b,function(a){var b=a[0];a[1];return b});g.length>0&&(c("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",g.map(function(a){var b=a[0];a[1];return b}).join(", "),b.map(function(a){var b=a[0];a[1];return b}).join(", "),a,e),f!=null&&c("MAWCacheServiceQPL").addAnnotationsQPL(f,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:c("MAWCacheServiceQPL").redactKeysForNonEmployee(g.map(function(a){var b=a[0];a[1];return b}))}}));if(b.length===0){f!=null&&(c("MAWCacheServiceQPL").addPointQPL(f,"nothing_to_update_in_cache",e),c("MAWCacheServiceQPL").endSuccessQPL(f));return}f!=null&&c("MAWCacheServiceQPL").addPointQPL(f,"updating_cache_in_persisted_start",e);g=this.registry[a];g.updateInMemoryCacheBulk(b);try{var h=d("MAWCacheServiceDB").convertCacheValueToDBRawValue(b);g=(yield d("MAWCacheServiceDB").getOrSetupMAWCacheDB());yield g.runInTransaction([a],"readwrite",function(b){var c=h.map(function(a){return{item:a,selector:[a.key]}});return b.stores[a].bulkUpsert("key",c)},"update_cache_"+a);f!=null&&c("MAWCacheServiceQPL").addPointQPL(f,"updating_cache_in_persisted_end",e)}catch(a){f!=null&&(c("MAWCacheServiceQPL").addAnnotationsQPL(f,{string:{error:a.message}}),c("MAWCacheServiceQPL").addPointQPL(f,"updating_cache_in_persisted_failed",e)),c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to update persisted cache")}f!=null&&c("MAWCacheServiceQPL").addPointQPL(f,"broadcasting_to_ui_start",e);this.$2(a,b,e,f)});function e(b,c,d,e){return a.apply(this,arguments)}return e}();e.calculateDelta=function(a){var e=this,f=Object.values(this.registry).map(function(f){var g=c("gkx")("14458")?f.shouldDropDelta(a):(h||(h=b("Promise"))).resolve(!1);return g.then(function(b){if(b)return;b=e.schedulerRegistry[f.namespace];return b.runTask({fn:function(){return f.calculateDelta(a).then(function(a){var b=a.map(function(a){var b=a[0];a[1];return b}),g=d("MAWLoggerUtils").getInstanceKey();a.length!==0&&(c("MAWCacheServiceQPL").startQPL(g,f.namespace),c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{isRealtimeUpdate:!0},"int":{instanceKey:g},string_array:{realtimeUpdatedKeys:b}}));return e.$3(f.namespace,a,"realtime-update",g)})["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).warn("Failed to calculate delta for: %s",f.namespace)})},name:"maw_calculate_delta",priority:d("WorkerScheduler").REGULAR_PRIORITY})})});(h||(h=b("Promise"))).all([].concat(f))["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to calculate delta for all services")})};e.computeCachePayloadFromScratch=function(a,b,e,f){var g=this;f!=null&&c("MAWCacheServiceQPL").registerInstanceKeyInWorker(f);c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_start",e);c("MAWCacheServiceQPL").addAnnotationsQPL(f,{string_array:{keysReceivedInWorker:c("MAWCacheServiceQPL").redactKeysForNonEmployee(b)}});var h=this.registry[a],i=this.schedulerRegistry[h.namespace];if(h==null)throw c("FBLogger")("messenger_web").mustfixThrow("No service found for namespace: "+a);return i.runTask({fn:function(){return h.computeCachePayloadFromScratch(b).then(function(b){c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_end",e);return g.$3(a,b,e,f)})["catch"](function(a){c("MAWCacheServiceQPL").endFailureQPL(f,"compute_from_scratch_failed",e),c("FBLogger")("MAWCacheService").catching(a).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_from_scratch",priority:d("WorkerScheduler").REGULAR_PRIORITY})};return a}(),j=null;a=function(){j==null&&(j=new i());return j};g.getMAWWorkerCacheServices=a}),98);
__d("WAGetRemotePublicIdentityV2",["WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=d("WAJids").toMsgrUserJid(c);e=d("WAJids").toDeviceJid(e,a);b=(yield b.stores.identity.get(e));return b==null?void 0:b.identity});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("getRemotePublicIdentityKey"))};g.getRemotePublicIdentity=a}),98);
__d("IGDLowLevelApiBridgeHandlers",["EncryptedBackupsUploadQueue","MAWBridgeHandlers","MAWEbUploadQueueWrapper","Promise","WALogger","asyncToGeneratorRuntime","cr:8399"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DYI] Instamadillo DYI is not enabled"]);i=function(){return a};return a}a=babelHelpers["extends"]({},d("MAWBridgeHandlers").bridgeHandlers,{backupWriteCompletionHook:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("EncryptedBackupsUploadQueue").ebUploadQueue();yield a.queueIds.map(function(a){return b.ack([a])});c("MAWEbUploadQueueWrapper").scheduleNextRun()});function e(b){return a.apply(this,arguments)}return e}(),handleInstamadilloDYIRangeQueryRestore:function(a){if(b("cr:8399")==null){d("WALogger").LOG(i());return(h||(h=b("Promise"))).resolve()}return b("cr:8399")(a.threadId,a.messages,a.hasMoreBefore,a.nextMessageTimestampMsBefore)}});g.igdBridgeHandlers=a}),98);
__d("IGDBackendBridgeHandlers",["EBBridgedAPIHandler","IGDBridgedAPIHandler","IGDLowLevelApiBridgeHandlers","MAWJobManager","Promise","WABridgedAPIHandler","WAMockServerShell","WAWaitForComms","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);j=function(){return a};return a}function a(a){return babelHelpers["extends"]({},d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers,{ebapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("EBBridgedAPIHandler").ebapi[b.type];c==null&&a.TAGS(["EBBridgedAPI"]).ERROR(j(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}(),igdapi:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("IGDBridgedAPIHandler").igdapi(a)});function c(b){return a.apply(this,arguments)}return c}(),initMockServer:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().init(a)},runJobFireAndForget:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().fireAndForget(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilCompleted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilCompleted(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilPersisted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilPersisted(a)});function c(b){return a.apply(this,arguments)}return c}(),runMock:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().runMock(a)},setMockVariables:function(a){if(d("WAMockServerShell").getMockServer==null)throw c("err")("Mock server is not available. Make sure you use worker v2");d("WAMockServerShell").getMockServer().setVariables(a.variables)},waapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("WABridgedAPIHandler").waapi[b.type];c==null&&a.TAGS(["WABridgedAPI"]).ERROR(i(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}()})}g.getIGDBridgeHandlers=a}),98);
__d("IGDCOP",["MAWSharedCOP","cr:10748","cr:5112"],(function(a,b,c,d,e,f,g){"use strict";c=(a=b("cr:5112"))!=null?a:b("cr:10748");e=d("MAWSharedCOP").makeCOP(c.processProtocolQueueEntries);g.cop=e}),98);
__d("IGDGetMediaKnownEntriesApi",["I64","MAWDbMsg","MAWJids","MAWMediaUtils","MAWReStoreDb","Promise","WAJids","WALogger","WAMsgMap","WAStanzaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for hashedPlaintextHash ",". Returning new MsgMap."]);j=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield d("MAWReStoreDb").getDB(f.id+":35")),e=d("MAWMediaUtils").genHMACPlaintextHash(a);a=(yield c.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield a.e2ee_media.index("hashedPlaintextHash").get(e));if(c==null){d("WALogger").ERROR(j(),e);return new(d("WAMsgMap").MsgMap)()}var f=Array.from(c.mediaEntries.keys());f=(yield (i||(i=b("Promise"))).all(f.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield a.messages.index("messageId").get(b));return b});return function(a){return c.apply(this,arguments)}}())));f=f.reduce(function(a,b){if(b!=null){var e=c.mediaEntries.get(d("MAWDbMsg").instamadilloMsgIdToMsgId(b.messageId)),f=d("WAJids").validateUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(b.threadKey))),g=d("WAStanzaUtils").toStanzaId(b.offlineThreadingId);if(e&&!b.isAdminMessage&&f!=null){b={author:d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b.senderId)),chat:f,externalId:g};a.set(b,e)}}return a},new(d("WAMsgMap").MsgMap)());return f});return function(b){return a.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":38"));return a});return function(b){return a.apply(this,arguments)}}();g.getMediaKnownEntries=a}),98);
__d("IGDGetMediaPlaintextApi",["MAWMediaUtils","MAWReStoreDb","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB(f.id+":25"));a=d("MAWMediaUtils").genHMACPlaintextHash(a);b=(yield b.tables.e2ee_chunk.index("hashedPlaintextHash").get(a));if(!b){d("WALogger").ERROR(h());return null}return new Blob([b.blobData],{type:b.mimetype})});return function(b){return a.apply(this,arguments)}}();g.getMediaPlaintext=a}),98);
__d("IGDUpdateMediaEntryForMsgApi",["FBLogger","MAWDbMsg","MAWMediaUtils","MAWReStoreDb","WALogger","WAMediaUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Nothing to update if updatedMediaEntry is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," msgId does not exist within media entries"]);i=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,j,k){var l=(yield d("MAWReStoreDb").getDB(f.id+":37"));if(!k){c("FBLogger")("igd_web","unsupported_media").mustfix("unsupported media type");throw c("err")("Media type unsupported: "+((k=k)!=null?k:""))}var m=d("MAWMediaUtils").genHMACPlaintextHash(a);return l.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.e2ee_media.index("hashedPlaintextHash").get(m)),f=(yield a.messages.index("messageId").get(e.externalId));if(!f)throw c("err")("Message does not exist for the given protocolMsgId");if(!b)throw c("err")("Media does not exist for the given hashedPlaintextHash");if(!b.msgIds.includes(f.messageId)){d("WALogger").LOG(i(),f.messageId);return}f=d("MAWDbMsg").stanzaIdToMsgId(e.externalId);var k=b.mediaEntries.get(f);k=g(k);if(k==null){d("WALogger").LOG(h());return}f=b.mediaEntries.set(f,k);k=babelHelpers["extends"]({},b,{mediaEntries:f});j!=null&&(k=babelHelpers["extends"]({},k,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(j)}));yield a.e2ee_media.put(k)});return function(b){return a.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":45")});return function(b,c,d,e,f){return a.apply(this,arguments)}}();g.updateMediaEntryForMsg=a}),98);
__d("InstamadilloMediaUpload",["FBLogger","IGDGetMediaKnownEntriesApi","IGDGetMediaPlaintextApi","IGDUpdateMediaEntryForMsgApi","LSIntEnum","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWMediaUtils","MAWOptimisticUploadMedia","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForOptimisticUploadApi","MessagingAttachmentType","WAAPI","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield d("MAWMediaUtils").hashBlob(b));f=d("WAHashUtils").toPlaintextHash(f);var g=e.type==="regular"?e.mediaType:"preview",h=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:a.chat,fileSize:b.size,serverMediaType:g,uploadEntry:"InstamadilloMediaUpload"}));return c("WAAPI").uploadMedia({chatJid:a.chat,filename:g==="document"?b.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("IGDGetMediaKnownEntriesApi").getMediaKnownEntries,getMediaPlaintext:d("IGDGetMediaPlaintextApi").getMediaPlaintext,hash:f,mediaTypeDetails:e,protocolMsgId:a,size:b.size,updateMediaEntryForMsg:d("IGDUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h})});return j.apply(this,arguments)}function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(e.playableUrlMimeType==null)throw c("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: mimeType is null");var f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.playableUrlMimeType);f=f.serverMediaType;var g=(yield i(a,b,{mediaType:f,type:"regular"}));if(g.success!==!0)throw c("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: Failed to upload media");var j=null,k=(h||(h=d("LSIntEnum"))).unwrapIntEnum(e.attachmentType);e=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloMediaUpload",url:e.previewUrl}));if(e!=null){e=(yield e.arrayBuffer());k=k===c("MessagingAttachmentType").IMAGE||k===c("MessagingAttachmentType").VIDEO?d("MAWMediaUtils").convertJpegThumbnailArrayBufferToFile(e):null;e=new Uint8Array(yield d("WABlobToArrayBuffer").blobToArrayBuffer(b));if(k&&d("MAWOptimisticUploadMedia").shouldUploadPreview(f,b.size,e)){b=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(b==null)throw c("FBLogger")("igd_web").mustfixThrow("unsupported preview media type %s",f);e=(yield i(a,k,{messageType:b,type:"preview"}));if(e.success!==!0)throw c("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: Failed to upload preview media");j=e.value}}return{mediaEntry:g.value,thumbnailMediaEntry:j}});return k.apply(this,arguments)}g.instamadilloUpload=a}),98);
__d("createInstamadilloMediaPayload",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.directPath,d=a.duration,e=a.fileEncSha256,f=a.fileLength,g=a.fileSha256,m=a.height,n=a.isAnimated,o=a.isSticker,p=a.mediaId,q=a.mediaKey,r=a.mediaKeyTimestamp,s=a.mediaType,t=a.mimetype,u=a.objectId,v=a.sidecar,w=a.thumbnail,x=a.waveforms,y=a.waveformSamplingFrequencyHz;a=a.width;b={directPath:b,fileEncSha256:e,fileLength:f,fileSha256:g,mediaId:p,mediaKey:q,mediaKeyTimestamp:r,mimetype:t,objectId:u,sidecar:v};switch(s){case"Image":return h(m,a,b,w);case"Video":return i(m,a,b,w);case"Ptt":if(x==null)throw c("FBLogger")("igd_web").mustfixThrow("createInstamadilloMedia: waveforms is null");return j(d,b,x,y);case"Gif":return k(m,a,b,o);case"Sticker":return l(b,n);default:throw c("FBLogger")("igd_web").mustfixThrow("createInstamadilloMedia: mediaType is unsupported")}}function h(a,b,c,d){return{staticPhoto:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function i(a,b,c,d){return{video:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function j(a,b,c,d){return{voice:{duration:a,mediaTransport:b,waveforms:c,waveformSamplingFrequencyHz:d}}}function k(a,b,c,d){return{gif:{height:a,isSticker:d,mediaTransport:c,width:b}}}function l(a,b){return{avatarSticker:{isAnimated:b,mediaTransport:a}}}g.createInstamadilloMediaEncode=a}),98);
__d("InstamadilloSendMediaMessageUtils",["FBLogger","I64","InstamadilloMediaUpload","LSIntEnum","MAWDbMsg","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWMediaUtils","MAWReStoreDb","MessagingAttachmentType","ReQL","WABase64","WABlobToArrayBuffer","WAMediaUtils","WASortedLists","WATimeUtils","asyncToGeneratorRuntime","createInstamadilloMediaPayload"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,c)));return a});return j.apply(this,arguments)}function k(a){return{validatedAudioInfo:l(a),validatedDocumentFileInfo:null,validatedImageInfo:m(a),validatedVideoInfo:n(a)}}function l(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO))?{duration:a.playableDurationMs!=null?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,mimetype:a.playableUrlMimeType}:null}function m(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))?{height:a.previewHeight!=null?(h||(h=d("I64"))).to_float(a.previewHeight):0,width:a.previewWidth!=null?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function n(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))?{duration:a.playableDurationMs!=null?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,height:a.previewHeight!=null?(h||(h=d("I64"))).to_float(a.previewHeight):0,mimetype:a.playableUrlMimeType,width:a.previewWidth!=null?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function o(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:(b=b)!=null?b:void 0,fileEncSha256:d("WABase64").encodeB64(e),fileSha256:d("WABase64").encodeB64(f),mediaId:(b=c)!=null?b:void 0,mediaKey:d("WABase64").encodeB64(g),mediaKeyTimestamp:String(h),objectId:(e=a)!=null?e:void 0}}function e(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g,i=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloSendMediaMessageUtils",url:e.playableUrl}));if(i==null)throw c("FBLogger")("igd_web").mustfixThrow("Blob is null");var j=e.playableUrlMimeType;if(j==null)throw c("FBLogger")("igd_web").mustfixThrow("IGDSendMessageTaskHandler: mimeType is null");var l=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(j),m=l.mediaType;l=l.serverMediaType;if(m==null)throw c("FBLogger")("igd_web").mustfixThrow("handleInstamadilloMediaSends: mediaType is null");var n=(yield d("MAWMediaUtils").genBlobHashes(i)),p=n[0],q=n[1];n=(yield d("MAWReStoreDb").getDB(f.id+":192"));var r=(yield n.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.e2ee_media.index("hashedPlaintextHash").get(q)),f=new Map(c==null?void 0:c.mediaEntries),g=k(e),h=d("MAWDbMsg").stanzaIdToMsgId(a.externalId);if(c!=null){var l=d("WASortedLists").addToSet(c.msgIds,h);c=babelHelpers["extends"]({},c,g,{mediaEntries:f,msgIds:l})}else c=babelHelpers["extends"]({hashedPlaintextHash:q,mediaEntries:f,mediaType:m,msgIds:d("WASortedLists").singleElement(h),plaintextHash:p,size:i.size,ts:d("WATimeUtils").unixTime()},g);yield b.e2ee_media.put(c);l=(yield d("WABlobToArrayBuffer").blobToArrayBuffer(i));f=(yield b.e2ee_chunk.index("hashedPlaintextHash").get(q));f==null&&(yield b.e2ee_chunk.put({blobData:l,hashedPlaintextHash:q,mimetype:j,plaintextHash:p}));return c});return function(a){return c.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":193"));g=new File([i],(g=e.filename)!=null?g:"",{type:j});var s=(yield d("InstamadilloMediaUpload").instamadilloUpload(a,g,e)),t=s.mediaEntry;s=s.thumbnailMediaEntry;var u=babelHelpers["extends"]({},r,{objectId:t.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(t.objectId):void 0});yield n.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.e2ee_media.put(u)});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":260");r=o(t);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);t=babelHelpers["extends"]({},n,{duration:e.playableDurationMs!=null?(h||(h=d("I64"))).to_int32(e.playableDurationMs):void 0,fileLength:g.size,height:e.previewHeight!=null?(h||(h=d("I64"))).to_int32(e.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:m,mimetype:j,sidecar:void 0,waveforms:e.waveformData!=null?e.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:e.samplingFrequencyHz!=null?(h||(h=d("I64"))).to_int32(e.samplingFrequencyHz):void 0,width:e.previewWidth!=null?(h||(h=d("I64"))).to_int32(e.previewWidth):void 0});if(s!=null){r=o(s);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);g={mediaTransport:n};t=babelHelpers["extends"]({},t,{thumbnail:g})}s=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(t);return{media:u,mediaEncode:s,serverMediaType:l}});return p.apply(this,arguments)}g.getMediaAttachment=a;g.generateValidatedMediaInfoFromAttachment=k;g.prepareMediaProtobuf=e}),98);
__d("MAWDbChunk",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.convertNumberToChunkId=a;f.convertToChunkId64=b}),66);
__d("IGDReportUserSpamJob",["FBLogger","I64","InstamadilloSendMediaMessageUtils","LSIntEnum","MAWDbChunk","MAWDbMedia","MAWDbMsg","MAWGetGroupInfoApi","MAWJids","MAWJobManager","MAWReStoreDb","MAWSpamReportUtils","Promise","WABase64","WADeprecatedSendIq","WAGlobals","WAJids","WAMediaUtils","WAResultOrError","WAWap","asyncToGeneratorRuntime","createInstamadilloMediaPayload","err","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,f=a.context,g=a.frxParams,h=a.frxTags,i=a.msgs,j=a.reportedMessageId,l=a.spamFlow,m=a.userJid;a=null;if(h!=null){if(h.length===0)throw c("err")("spam reasons should not be an empty array");a=d("WAWap").wap("tagset",null,h.map(function(a){return d("WAWap").wap("tag",{value:d("WAWap").CUSTOM_STRING(a)})}))}h=null;c("isStringNullOrEmpty")(g)||(h=d("WAWap").wap("parameters",null,g));g=null;f!=null&&(g=d("WAWap").wap("context",null,f));var n=null;(a!=null||g!=null||h!=null)&&(n=d("WAWap").wap("frx",null,a,g,h));var q=(yield k(i,e,m,j));f=(yield d("WAJids").switchOnMsgrChatJidType(e,{group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWap").DROP_ATTR,c=d("WAWap").DROP_ATTR,e=(yield d("MAWGetGroupInfoApi").getGroupInfo(a));e!=null&&e.subject!=null&&e.subject.content!=null&&(b=d("WAWap").CUSTOM_STRING(e.subject.content));e!=null&&e.inviter!=null&&(c=d("WAWap").USER_JID(e.inviter));return o(q,a,m,c,b,l,n)});function c(b){return a.apply(this,arguments)}return c}(),user:function(){return p(q,m,l,n)}}));d("WADeprecatedSendIq").deprecatedCastStanza(f);return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}()).end();function k(a,c,e,f){a=((a=a)!=null?a:[]).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("MAWJids").toUserJid((i||(i=d("I64"))).to_string(a.senderId)),g;a.transportKey==="Instamadillo"&&(i||(i=d("I64"))).equal(a.displayedContentTypes,(j||(j=d("LSIntEnum"))).ofNumber(2))&&(g=(yield l(a)));if(d("WAJids").interpretAsGroupJid(c)!=null)return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,null,d("WAJids").toGroupJid(c),b);else{var h=(i||(i=d("I64"))).equal(a.senderId,(i||(i=d("I64"))).of_string(d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())))?e:d("WAGlobals").getMyUserJid();return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,h,null,b,g,f===a.messageId)}});return function(b){return a.apply(this,arguments)}}());return(h||(h=b("Promise"))).all(a)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("MAWReStoreDb").getDB(f.id+":244"));e=(yield e.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(yield d("InstamadilloSendMediaMessageUtils").getMediaAttachment(b,a.threadKey,a.messageId));if(e==null)throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send a message with associated attachment");var f=d("MAWDbMedia").convertToMediaId64((i||(i=d("I64"))).of_string(e.attachmentFbid));f=(yield b.e2ee_media.get(f));if(f==null)throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_media");var g=d("MAWDbChunk").convertToChunkId64(i.of_string(e.attachmentFbid));b=(yield b.e2ee_chunk.get(g));if(b==null)throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_chunk");return{attachment:e,chunk:b,media:f}});return function(a){return e.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":245"));var g=e.attachment;e=e.media;var h=d("MAWDbMsg").instamadilloMsgIdToMsgId(a.messageId);if(!e.msgIds.includes(h))throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: media is not linked to this message");h=e.mediaEntries.get(h);if(h==null)throw c("FBLogger")("igd_web").warn("IGDreportUserSpam: media entry not found");h=d("WAMediaUtils").mediaEntryDataToRawData(e.plaintextHash,h);h=n(h);h.$$unknownFieldCount;h=babelHelpers.objectWithoutPropertiesLoose(h,["$$unknownFieldCount"]);h=babelHelpers["extends"]({},h,{duration:g.playableDurationMs!=null?(i||(i=d("I64"))).to_int32(g.playableDurationMs):void 0,fileLength:e.size!=null?e.size:void 0,height:g.previewHeight!=null?(i||(i=d("I64"))).to_int32(g.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:e.mediaType,mimetype:g.playableUrlMimeType,sidecar:void 0,waveforms:g.waveformData!=null?g.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:g.samplingFrequencyHz!=null?(i||(i=d("I64"))).to_int32(g.samplingFrequencyHz):void 0,width:g.previewWidth!=null?(i||(i=d("I64"))).to_int32(g.previewWidth):void 0});e=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(h);return e});return m.apply(this,arguments)}function n(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b!=null?b:void 0,fileEncSha256:e!=null?d("WABase64").encodeB64(e):void 0,fileSha256:f!=null?d("WABase64").encodeB64(f):void 0,mediaId:(b=c)!=null?b:void 0,mediaKey:g!=null?d("WABase64").encodeB64(g):void 0,mediaKeyTimestamp:String(h),objectId:(e=a)!=null?e:void 0}}function o(a,b,c,e,f,g,h){var i;return(i=d("WAWap")).wap("iq",{id:i.generateId(),to:i.S_WHATSAPP_NET,type:"set",xmlns:"spam"},i.wap("spam_list",{jid:i.GROUP_JID(b),reportee:i.USER_JID(c),source:e,spam_flow:i.CUSTOM_STRING(g),subject:f},a),h)}function p(a,b,c,e){var f;return(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.S_WHATSAPP_NET,type:"set",xmlns:"spam"},f.wap("spam_list",{jid:f.USER_JID(b),reportee:f.USER_JID(b),spam_flow:f.CUSTOM_STRING(c)},a),e)}g.igdReportUserSpam=a}),98);
__d("IGDStartInstamadilloDYIJob",["EncryptedBackupsDYISingleton","EncryptedBackupsDYITypes","MAWJobManager","MAWReStoreDb","asyncToGeneratorRuntime","cr:1288"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Instamadillo DYI not enabled"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Started job startInstamadilloDYI"]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("startInstamadilloDYI",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.qplInstanceKey;d("EncryptedBackupsDYISingleton").initSingleton(d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo,d("MAWReStoreDb").getDB,a);a=d("EncryptedBackupsDYISingleton").getSingleton();var c=a.getLogger();c.LOG(i());a.logDYIQPLPoint("instamadillo_dyi_job_start");b("cr:1288")!=null?(yield b("cr:1288").getInstance().startDYI(),a.logDYIQPLPoint("instamadillo_dyi_started")):c.ERROR(h())});return function(b){return a.apply(this,arguments)}}()).end();g.startInstamadilloDYI=a}),98);
__d("IGDJobHandlers",["IGDReportUserSpamJob","IGDStartInstamadilloDYIJob","MAWCreateJobNotImplemented"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return{acceptGroupInvite:(a=d("MAWCreateJobNotImplemented")).createNotImplementedJob("acceptGroupInvite"),addGroupParticipants:a.createNotImplementedJob("addGroupParticipants"),createGroup:a.createNotImplementedJob("createGroup"),deleteMsgsForMe:a.createNotImplementedJob("deleteMsgsForMe"),deleteThread:a.createNotImplementedJob("deleteThread"),demoteGroupParticipants:a.createNotImplementedJob("demoteGroupParticipants"),downloadAndHandleMedia:a.createNotImplementedJob("downloadAndHandleMedia"),downloadAndRestoreMedia:a.createNotImplementedJob("downloadAndRestoreMedia"),getSpams:a.createNotImplementedJob("getSpams"),handleFutureproofMsg:a.createNotImplementedJob("handleFutureproofMsg"),handleSpamMsg:a.createNotImplementedJob("handleSpamMsg"),igdReportUserSpam:d("IGDReportUserSpamJob").igdReportUserSpam,leaveGroups:a.createNotImplementedJob("leaveGroups"),markThreadAsRead:a.createNotImplementedJob("markThreadAsRead"),promoteGroupParticipants:a.createNotImplementedJob("promoteGroupParticipants"),removeGroupParticipants:a.createNotImplementedJob("removeGroupParticipants"),reportUserSpam:a.createNotImplementedJob("reportUserSpam"),requestReuploadMedia:a.createNotImplementedJob("requestReuploadMedia"),rerevokeMsgs:a.createNotImplementedJob("rerevokeMsgs"),resendWrittenAppData:a.createNotImplementedJob("resendWrittenAppData"),restoreMessagesFromEncryptedBackups:a.createNotImplementedJob("restoreMessagesFromEncryptedBackups"),restoreProtobufsFromEncryptedBackups:a.createNotImplementedJob("restoreProtobufsFromEncryptedBackups"),restoreThreadsFromEncryptedBackups:a.createNotImplementedJob("restoreThreadsFromEncryptedBackups"),reuploadMedia:a.createNotImplementedJob("reuploadMedia"),revokeMsgs:a.createNotImplementedJob("revokeMsgs"),sendAppData:a.createNotImplementedJob("sendAppData"),sendBumpMsg:a.createNotImplementedJob("sendBumpMsg"),sendGroupInviteMsg:a.createNotImplementedJob("sendGroupInviteMsg"),sendWrittenAppData:a.createNotImplementedJob("sendWrittenAppData"),setGroupSubject:a.createNotImplementedJob("setGroupSubject"),startInstamadilloDYI:d("IGDStartInstamadilloDYIJob").startInstamadilloDYI,updateBackupEntFbidForMedia:a.createNotImplementedJob("updateBackupEntFbidForMedia"),uploadRetroactiveThreadsAndMessages:a.createNotImplementedJob("uploadRetroactiveThreadsAndMessages")}}g.getJobHandlers=a}),98);
__d("IGDLoadRecentParticipantsApi",["I64","LSIntEnum","MAWReStoreDb","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWReStoreDb").getDB(f.id+":30"));c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(c.tables.threads.index("lastActivityTimestampMs")).filter(function(a){return(h||(h=d("I64"))).equal(a.threadType,(i||(i=d("LSIntEnum"))).ofNumber(1))}).take(a)));var e=[];c.forEach(function(a){a=d("WAJids").interpretAsUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(a.threadKey)));a!=null&&a!==b&&e.push(a)});return new Set(e)});return function(b,c){return a.apply(this,arguments)}}();g.loadRecentParticipants=a}),98);
__d("InstamadilloBackend",["cr:10745","cr:10746","cr:10747","cr:4772","cr:4849","cr:7098","cr:7691","cr:8224","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=(d=b("cr:7098"))!=null?d:b("cr:10746"),i=(e=b("cr:4849"))!=null?e:b("cr:10747");function a(a){i!=null&&c("promiseDone")(i.setDeviceJid(a.deviceJid)),b("cr:8224")==null?void 0:b("cr:8224").initEbUploadQueue(),b("cr:7691")==null?void 0:b("cr:7691").initIGDEbRestoreProcessor(),b("cr:4772")==null?void 0:b("cr:4772").listenForEbUploadQueueFlush(),h!=null&&(h.initPendingMessageStanzaQueue(),c("promiseDone")(h.processFutureproofPendingMessageStanzas())),b("cr:10745")==null?void 0:b("cr:10745").startIGDDisappearingMsgCleaner()}g.init=a}),98);
__d("MAWDebugDefineFunctions",["MAWDebug","MAWDebugSendMultipleMsgs"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return{desc:a,execute:b,name:a,serializedArgs:[]}}function a(){var a=Object.keys(d("MAWDebug").MAWDebugFuncs).reduce(function(a,b){return Object.assign(a,(a={},a[b]=h(b,d("MAWDebug").MAWDebugFuncs[b]),a))},{});return babelHelpers["extends"]({},a,{sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs})}g.getAllDebugFunctions=a}),98);
__d("MAWServerRPC",["MAWHandleAbPropsRefreshNotification","MAWHandleAppdataMessage","MAWHandleChatState","MAWHandleFailure","MAWHandleFbDeviceChangeNotification","MAWHandleFbMultiwayNotification","MAWHandleFbThreadNotification","MAWHandleGroupNotification","MAWHandleGroupReceipt","MAWHandleGroupRetryReceipt","MAWHandleIndividualRetryReceipt","MAWHandleLoginSuccess","MAWHandlePeerAppdataReceipt","MAWHandlePeerAppdataRetryReceipt","MAWHandleRtcE2eeCallEventNotification","MAWHandleSpam","MAWHandleThreadMetadata","Promise","WAHandleErrorStanza","WAHandleIncomingMsg","WAHandleInfoBulletin","WAHandlePrekeyContactIDChangedNotification","WAHandlePrekeyDigestNotification","WAHandlePrekeyLowCountNotification","WAHandleReceipt","WAHandleServerPing","WAHandleStreamError","WALogger","WAServerRPC"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Peer messages are not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Broadcast messages are not supported"]);j=function(){return a};return a}function a(){var a;return d("WAServerRPC").makeServerRPC({abprops:{handleAbPropsRefreshNotification:d("MAWHandleAbPropsRefreshNotification").handleAbPropsRefreshNotification},accountSync:null,appdataMessage:{handleAppdataMessage:d("MAWHandleAppdataMessage").handleAppdataMessage,handlePeerAppdataReceipt:d("MAWHandlePeerAppdataReceipt").handlePeerAppdataReceipt,handlePeerAppdataRetryReceipt:d("MAWHandlePeerAppdataRetryReceipt").handlePeerAppdataRetryReceipt},broadcast:{handleBroadcastMessage:function(a){a=a.makeAck;d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve(a())}},call:{handleRtcE2eeCallEvent:d("MAWHandleRtcE2eeCallEventNotification").handleRtcE2eeCallEventNotification},clientLog:null,comms:{handleEdgeRoutingInfo:d("WAHandleInfoBulletin").handleEdgeRoutingInfo,handleServerPing:d("WAHandleServerPing").handleServerPing},error:{handleErrorStanza:d("WAHandleErrorStanza").handleErrorStanza,handleSmaxErrorStanza:d("WAHandleErrorStanza").handleSmaxErrorStanza},fb:{handleFbDeviceChangeNotification:d("MAWHandleFbDeviceChangeNotification").handleFbDeviceChangeNotification,handleFbMultiwayNotification:d("MAWHandleFbMultiwayNotification").handleFbMultiwayNotification,handleFbThreadNotification:d("MAWHandleFbThreadNotification").handleFbThreadNotification},groupMessage:{handleGroupChatState:d("MAWHandleChatState").handleGroupChatState,handleGroupDirtyBit:null,handleGroupMessage:d("WAHandleIncomingMsg").handleGroupMessage,handleGroupNotification:d("MAWHandleGroupNotification").handleGroupNotification,handleGroupReceipt:d("MAWHandleGroupReceipt").handleGroupReceipt,handleGroupRetryReceipt:d("MAWHandleGroupRetryReceipt").handleGroupRetryReceipt},individualMessage:{handleIndividualChatState:d("MAWHandleChatState").handleIndividualChatState,handleIndividualMessage:d("WAHandleIncomingMsg").handleIncomingIndividualMsg,handleIndividualReceipt:d("WAHandleReceipt").handleIndividualReceipt,handleIndividualRetryReceipt:d("MAWHandleIndividualRetryReceipt").handleIndividualRetryReceipt},login:{handleLoginFailure:d("MAWHandleFailure").handleLoginFailure,handleLoginSuccess:d("MAWHandleLoginSuccess").handleLoginSuccess},md:null,newsletter:null,offline:{handleOfflineEnd:d("WAHandleInfoBulletin").handleOfflineEnd,handleOfflineStart:d("WAHandleInfoBulletin").handleOfflineStart,handleThreadMetadata:d("MAWHandleThreadMetadata").handleThreadMetadata},peerMessage:{handlePeerMessage:function(a){a=a.makeAck;d("WALogger").ERROR(i());return(h||(h=b("Promise"))).resolve(a())}},prekey:{handlePrekeyContactIDChangedNotification:d("WAHandlePrekeyContactIDChangedNotification").handlePrekeyContactIDChangedNotification,handlePrekeyDigestNotification:d("WAHandlePrekeyDigestNotification").handlePrekeyDigestNotification,handlePrekeyLowCountNotification:d("WAHandlePrekeyLowCountNotification").handlePrekeyLowCountNotification},presence:null,serverProps:null,spam:{handleSpam:d("MAWHandleSpam").handleSpam},status:null,streamError:{handleAckKick:(a=d("WAHandleStreamError")).handleAckKick,handleBadMac:a.handleBadMac,handleConflict:a.handleConflict,handlePingKick:a.handlePingKick,handleStreamErrorCode:a.handleStreamErrorCode,handleXmlNotWellFormed:a.handleXmlNotWellFormed},syncd:null,usync:null})}g.makeServerRPC=a}),98);
__d("WADebugTools",["WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";function a(a){self.Debug==null&&(self.Debug={});var b=function(b){var c=a[b];self.Debug[c.name]=function(){return c.execute.apply(c,arguments)}};for(var c in a)b(c);d("WADevToolsDebugFns").registerDebugFnsToDevTool(a)}g.initDebugFunctions=a}),98);
__d("IGDBackend",["IGDAWDebug","IGDAWMainWebWorkerConfig","IGDBackendBridgeHandlers","IGDCOP","IGDJobHandlers","IGDLoadRecentParticipantsApi","InstamadilloBackend","MAWClearSignalAndTempStores","MAWCommsConfig","MAWConfig","MAWCreateGroupApi","MAWCurrentUser","MAWDebugDefineFunctions","MAWDefinePersistedJob","MAWEphemeralConsts","MAWExternalId","MAWExtractMsFromExternalId","MAWFbCat","MAWHandleReachabilityErrorAdminMsgApi","MAWMpsBridgeHandlers","MAWPREListeners","MAWQplProxy","MAWReStoreDb","MAWServerRPC","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWTaskDefinitions","Promise","WAArrayBufferUtils","WADebugTools","WAMessageLoggingPublisher","WAMockServerShell","WAPassiveMode","WAService","WATagsLogger","WAWaitForComms","WAWaitForUserUnblocked","asyncToGeneratorRuntime","isUseridAnnotationEnabled","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Worker inited"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to init worker (post-startup): ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deviceJid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["initWAInfra"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["backend"]);function a(a,b,c,d,e){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,n){m.LOG(l());m.LOG(k(),a.deviceJid);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_start");d("MAWFbCat").setFbCat(d("WAArrayBufferUtils").stringToArrayBuffer(a.fbCat));g=d("MAWServerRPC").makeServerRPC();n=(yield d("WAService").makeWAService({config:n,dependencies:{clearSignalAndTempStores:d("MAWClearSignalAndTempStores").clearSignalAndTempStores,createGroups:d("MAWCreateGroupApi").createGroups,ephemeralMaxDeletionWindowForUnseenMessage:function(){return d("MAWEphemeralConsts").ephemeralMaxDelectionWindowForUnseenMessage},extractMsFromStanzaId:d("MAWExtractMsFromExternalId").extractMsFromStanzaId,generateExternalId:d("MAWExternalId").generateExternalId,handleReachabilityErrorAdminMsg:d("MAWHandleReachabilityErrorAdminMsgApi").handleReachabilityErrorAdminMsg,isEmployee:d("MAWCurrentUser").isEmployee,isUseridAnnotationEnabled:c("isUseridAnnotationEnabled"),loadRecentParticipants:d("MAWReStoreDb").shouldUseReStoreDb()?d("IGDLoadRecentParticipantsApi").loadRecentParticipants:function(){return(h||(h=b("Promise"))).resolve(new Set())},mediaUploadRoot:function(){return"/wa-igd/mms"},waMessageReceiveReliabilityQplEvent:function(){return c("qpl")._(25306682,"11176")}},getCommsConfig:d("MAWCommsConfig").getCommsConfig,hmacKey:e,regData:a,serverRPC:g})["catch"](function(a){m.ERROR(j(),a);throw a}));d("MAWSharedOfflineQueueMetric").makeOfflineQueueMetric(n.oneQueue,d("WAPassiveMode").passiveModeNotifier,d("IGDCOP").cop,d("WAMessageLoggingPublisher").messageLoggingPublisher);d("MAWConfig").setConfig(d("IGDAWMainWebWorkerConfig").mawConfig);d("IGDCOP").cop.subscribeToOfflineQueue(n.oneQueue,n.protocolQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToWAEvents(n.oneQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToMawEvents(d("IGDCOP").cop);d("WAMockServerShell").isMockServerMode||c("promiseDone")(d("WAWaitForComms").waitForComms().then(function(){return d("MAWTaskDefinitions").registerTasks(d("WAWaitForUserUnblocked").waitForUserUnblocked())}));f.setHandlers("backend",d("IGDBackendBridgeHandlers").getIGDBridgeHandlers(m));d("MAWPREListeners").initializeWAPREMetrics();f.setHandlers("mps",d("MAWMpsBridgeHandlers").mpsBridgeHandlers);d("InstamadilloBackend").init(a);d("MAWDefinePersistedJob").setMsgrJobImplementations(d("IGDJobHandlers").getJobHandlers());yield n.startComms();m.LOG(i());d("WAWaitForComms").unblockComms();d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_end")});return n.apply(this,arguments)}g.startIGDBackend=a}),98);
__d("IGDLowLevelApiImpl",["IGDLowLevelApiBridgeHandlers"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{bridgeHandlers:d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers}}g.makeLowLevelApi=a}),98);
__d("WAPreRegistrationCrypto",["WACryptoManager","WASignalSignatures","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WACryptoManager").generateRegistrationInfo()),b=a.regId,c=a.staticKeyPair;a=a.authKeyPair;var e=Date.now();e=(yield d("WASignalSignatures").generateSignedPreKey(1,e,c));var f=e.plainObject;e=e.record;return{regId:b,identityKeyPair:c,authKeyPair:a,signedPreKey:{keyId:f.id,encoded:e}}});return h.apply(this,arguments)}function e(a){var b=d("WASignalSignatures").deserializeSignedPreKey(a.signedPreKey.encoded);if(b==null||b.id!==a.signedPreKey.keyId)throw c("err")("Badly formatted signed prekey");return{regId:a.regId,identityPubKeyType:5,identityPubKey:a.identityKeyPair.publicKey,signedPreKey:b}}g.makeRegistrationData=a;g.serializeRegistrationData=e}),98);
__d("MAWDeviceRegistrationUtilWorker",["FBLogger","MAWConstants","MAWCurrentUser","URI","WABase64","WADbDeviceRegistration","WAPreRegistrationCrypto","WATimeUtils","WAWorkerGlobalScope","asyncToGeneratorRuntime","gkx","qex","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c=new Uint8Array(b);a=a;for(b=b-1|0;b>=0;--b)c[b]=a&255,a=a>>>8;return c}function j(a,b,c,e,f,g,h,j,k){var l;f=(l=d("WABase64")).encodeB64(i(f,4));g=l.encodeB64(i(g,1));h=l.encodeB64(h);var m=l.encodeB64(i(j.id,3)),n=l.encodeB64(j.keyPair.publicKey);l=l.encodeB64(j.signature);j=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",e).set("e_regid",f).set("e_keytype",g).set("e_ident",h).set("e_skey_id",m).set("e_skey_val",n).set("e_skey_sig",l);if(k){a=d("WABase64").encodeB64(k.signedICDCIdentityList);b=d("WABase64").encodeB64(k.ihash);j.set("icdc_list",a).set("icdc_ts",k.ts).set("icdc_seq",k.seq).set("ihash",b)}return j}function k(a){var b=[];a.forEach(function(a,c,d){b.push(encodeURIComponent(c)+("="+encodeURIComponent(a.toString())))});return b.join("&")}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",priority:c("qex")._("4183")?"high":"auto"}));return yield b.json()});return m.apply(this,arguments)}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",priority:c("qex")._("4183")?"high":"auto",signal:e}));return b.json()});return o.apply(this,arguments)}function p(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").ICDC_ENDPOINT);return a.toString()}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=p();a=(yield l(a,b));if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(a.status!==200)throw c("FBLogger")("messenger_web").mustfixThrow("WA Server returned status code "+a.status+" while attempting device registration");return a});return r.apply(this,arguments)}function s(){var a=Number(d("MAWCurrentUser").getAppID()),b=d("WADbDeviceRegistration").REG_FB_DOMAIN;switch(a){case 1217981644879628:case 936619743392459:case 487152425211411:case 1035956773910536:b=d("WADbDeviceRegistration").REG_IGD_DOMAIN;break;case 772021112871879:b=d("WADbDeviceRegistration").REG_MSGR_DOMAIN;break;default:b=d("WADbDeviceRegistration").REG_FB_DOMAIN}return b}function t(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").REGISTRATION_ENDPOINT);return a.toString()}var u=new Set(["www.facebook.com","intern.facebook.com","web.facebook.com","www.instagram.com","www.messenger.com"]);function v(){if(c("gkx")("2456")){var a=d("WAWorkerGlobalScope").workerGlobalScope.location.hostname;u.has(a)||c("FBLogger")("bt","device_registration").warn("Invalid subdomain for device registration: %s",a)}}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=t();v();var e;try{e=(yield n(a,b))}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow("Post request failed: "+(a==null?void 0:a.message)+" url:"+b)}if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(e.status!==200){c("FBLogger")("messenger_web").warn("WA Server returned status code %s %s while attempting device registration",e.status,(a=e.message)!=null?a:"");return{message:(b=e.message)!=null?b:"Empty message",status:e.status,success:!1}}if(typeof e.wa_device_id!=="number")throw c("FBLogger")("messenger_web").mustfixThrow("Device ID from WA Server was not a number");if(typeof e.product!=="string")throw c("FBLogger")("messenger_web").mustfixThrow("Product info from WA Server was not a string");return{edge_routing_info:e.edge_routing_info,icdc_success:e.icdc_success,product:e.product,status:200,success:!0,type:e.type,wa_device_id:e.wa_device_id}});return x.apply(this,arguments)}function a(a,b,c,d){a=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",d);b=k(a);return q(b)}function e(a,b,c,d,e,f,g,h,i){a=j(a,b,c,d,e,f,g,h,i);b=k(a);return w(b)}function f(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAPreRegistrationCrypto").makeRegistrationData());return{deviceUUID:c("uuidv4")(),lastSignedPrekeyId:a.signedPreKey.keyId,registrationUnixTime:d("WATimeUtils").unixTime(),registrationVersion:d("MAWConstants").CURRENT_REGISTRATION_VERSION,signalRegInfo:a}});return y.apply(this,arguments)}g.getRegistrationEndpoint=t;g.fetchICDC=a;g.register=e;g.createNewRegistrationMeta=f}),98);
__d("MAWDBKeychain",["BrowserLockManager","EARInitType","ExecutionEnvironment","FBLogger","MAWCurrentUser","MAWDexie","MAWIndexedDbMetadata","MWEARKeychainV3","MWSetupDBEncryption","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="encryptionMetaV3",k=function(a){a===void 0&&(a=d("MWEARKeychainV3").logMawInitPoint);a("maw_ear_check_mawdb_start");var b=d("MAWCurrentUser").getID();b=d("MAWIndexedDbMetadata").dbName(b);b=new(c("MAWDexie"))(b,{addons:[]});return b.open().then(function(b){a("maw_ear_check_mawdb_end");return b})["catch"]("NoSuchDatabaseError",function(){a("maw_ear_check_mawdb_no_db");return null})["catch"](function(b){a("maw_ear_check_mawdb_error");throw b})};e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=d("MWEARKeychainV3").logMawInitPoint);var e=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b;try{b=(yield k(a));if(!b){c("FBLogger")("messenger_web").info("MAWDB is missing for MAW EAR worker init.");a("maw_ear_new_user");return{isNewUser:!0,reinitEAR:!0,useMawEAR:!0}}if(!b.backendDB().objectStoreNames.contains(j)){b.close();c("FBLogger")("messenger_web").info("MAW EAR is missing for MAW EAR worker init.");a("maw_ear_missing_ear_table");return{reinitEAR:!0,useMawEAR:!0}}var e=(yield m(b.backendDB()));e.length===0&&(c("FBLogger")("messenger_web").info("Migrating global EAR to MAW EAR"),a("maw_ear_migrating"),yield l(b.backendDB()));d("MWEARKeychainV3").setNamespaceSourceDbWithoutMarkingDbReady("maw_ear",b.backendDB());a("maw_ear_init_keychain");e=(yield d("MWEARKeychainV3").init("maw_ear",c("EARInitType").MAW_INIT,a));if(e.success===!1){if(e.payload!=null)throw e.payload;throw c("FBLogger")("messenger_web").mustfixThrow("Failed to init MAW EAR Keychain.")}a("maw_ear_success");c("FBLogger")("messenger_web").info("MAW EAR worker successfully initialised.");return{useMawEAR:!0}}finally{d("MWEARKeychainV3").setNamespaceSourceDbWithoutMarkingDbReady("maw_ear",null);(e=b)==null?void 0:e.close()}});return function(){return e.apply(this,arguments)}}();return new(i||(i=b("Promise")))(function(a,b){if(c("BrowserLockManager")!=null)return c("BrowserLockManager").request("mawdb_keychain_init_ear",function(){return e().then(a)["catch"](b)});else return e().then(a)["catch"](b)})["catch"](function(b){a("maw_ear_failure");throw c("FBLogger")("messenger_web").catching(b).mustfixThrow("Failed to init MAW EAR Worker.")})});return function(b){return a.apply(this,arguments)}}();var l=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("MWSetupDBEncryption").init(c("EARInitType").MAW_INIT));if(!e.success){if(e.payload!=null)throw e.payload;throw c("FBLogger")("messenger_web").mustfixThrow("Failed to init global EAR.")}e=d("MWEARKeychainV3").getKeychain("global_ear");if(e.databaseEncryptionKeys.size===0)throw c("FBLogger")("messenger_web").mustfixThrow("Global EAR data is missing.");var f=Array.from(e.databaseEncryptionKeys.entries()).map(function(a){a[0];a=a[1].dbEntry;a.id;a=babelHelpers.objectWithoutPropertiesLoose(a,["id"]);return a});return new(i||(i=b("Promise")))(function(b,c){var d=a.transaction(j,"readwrite");f.forEach(function(a){d.objectStore(j).add(a)});d.onerror=function(){return c(d.error)};d.oncomplete=function(){return b()}})});return function(b){return a.apply(this,arguments)}}();function m(a){return new(i||(i=b("Promise")))(function(b,c){var d=a.transaction(j,"readonly"),e=d.objectStore(j).getAll();e.onsuccess=function(){return b(e.result)};e.onerror=function(){return c(e.error)}})}function a(a,b){if(a.encryptionMetaV3!=null){var e=d("MWEARKeychainV3").getKeychainInitStatus("maw_ear");if(e==="none"&&b!=null){d("MWEARKeychainV3").logMawInitPoint("maw_ear_populate_unstored_key");a.encryptionMetaV3.add(b);return}e=d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear";var f=Array.from(d("MWEARKeychainV3").getKeychain(e).databaseEncryptionKeys).map(function(a){a[0];a=a[1].dbEntry;return a});if(f.length>0)c("FBLogger")("messenger_web").info("DB re-populated after external DB deletion. Namespace: %s. isWorker: %s",e,(h||(h=c("ExecutionEnvironment"))).isInWorker),a.encryptionMetaV3.bulkPut(f),d("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("maw_ear",a.db.backendDB());else throw c("FBLogger")("messenger_web").mustfixThrow("No encryption keys to populate MAWDB. Namespace: %s. HasUnstoredKey: %s. isWorker: %s",e,Boolean(b),(h||(h=c("ExecutionEnvironment"))).isInWorker)}}g.STORENAME=j;g.checkMawDbExists=k;g.initEAR=e;g.getEncryptionKeys=m;g.onDbPopulateMAWKeychain=a}),98);
__d("MAWDbInitIndexedDb",["MAWIndexedDb","MWEARKeychainV3","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.onDbPopulate;return d("MAWIndexedDb").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,enableMutationValidator:c("gkx")("1627"),onDbPopulate:a})}g.dbInit=a}),98);
__d("MessengerInfraReportUtils",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a===2};b=function(a){switch(a){case 1:return"START";case 2:return"SUCCESS";case 3:return"FAIL";case 4:return"CANCEL";case 113:return"TIMEOUT";case 706:return"CANCEL_UNLOAD";case 4158:return"INVALID";case 87:return"ERROR";case 5947:return"SUCCESS_PAST_TIMEOUT";case 160:return"OFFLINE";default:return String(a)}};f.isQplActionSuccessful=a;f.qplStatusStr=b}),66);
__d("MessengerInfraQplReport",["FBLogger","MAWCurrentUser","MWBroadcastChannel","MessengerInfraReport","MessengerInfraReportUtils","QPLEvent","QuickPerformanceLogger","memoizeOneWithArgs"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(a={},a[1056839232]={annotations:{string:["errorDescription","failReason","backendAckState"]},name:"MAW_TTRC",single:!0},a[25310776]={annotations:{string:["errorDescription","failReason"]},name:"MAW_INIT",single:!0},a[25305590]={annotations:{string:["uncaught_error"]},name:"LS_INIT",single:!0},a[25313175]={annotations:{"int":["errorCode","applicationError"],string:["errorDescription","thread_type"],string_array:["worker_restart_msgs","worker_restart_reasons"]},name:"MESSAGE_SEND_TO_SENT",single:!1},a[30605380]={annotations:{string:["thread_type"]},name:"CHAT_TAB_OPEN",single:!1},a[25303796]={annotations:{string:["eb_failure_reason","range_extension_error","cancel_reason"]},name:"LOAD_MORE_MESSAGES",single:!1},a[1056843758]={annotations:{string:["range_extension_error"],string_array:["message_ranges_source"]},name:"MAW_MLV2_RANGE_EXTENSION",single:!1},a[30605361]={annotations:{string:["cancelType"]},name:"POPOVER_SHOW",single:!1},a[398998698]={annotations:{bool:["isE2eeMandated"],string:["errorDescription"]},name:"E2EE_COMPONENTS_CREATION",single:!1},a[398997251]={annotations:{string:["endCallReason"]},name:"CALL_JOIN",single:!1},a[398989351]={name:"ZENON_SDK",single:!1},a[521476165]={annotations:{string:["type","taskSource","triggerType","querySource","error","exception","thread_state_by_jid"]},name:"RESTORE_END_TO_END",single:!1},a[521471755]={annotations:{string:["error_description","exception","source","restoreType"]},name:"EB_API_MESSAGE_RANGE_QUERY",single:!1},a[25302828]={annotations:{string:["fail_reason"]},name:"MEDIA_RENDER",single:!1},a[1056846543]={annotations:{bool:["is_otid","is_thread_requested"],string:["threadState","description"]},name:"MAW_ON_ACT_THREAD_READY_USAGE",single:!1},a[25302828]={annotations:{string:["fail_reason"]},name:"MEDIA_RENDER",single:!1},a[521474469]={name:"EB_API_MESSAGE_POINT_QUERY",single:!1},a[521473213]={name:"EB_API_MEDIA_RESTORE_PROBE",single:!1},a[521476367]={name:"EB_API_MESSAGE_RANGE_QUERY_SEARCH",single:!1},a[521477507]={name:"EBLSDB_INIT",single:!0},a[1056836502]={annotations:{bool:["isMawThreadCreated","hasMappingRowAlready","hasPlaceholderRowInserted","isResultVerified"],string:["flushReason","trigger"]},name:"THREAD_MAPPING",single:!1},a[521471024]={annotations:{string:["backup_id"]},name:"FETCH_BACKUP_IDS",single:!1},a[25307273]={annotations:{string:["errorMsg"]},name:"MAW_DEVICE_REGISTRATION_ALL",single:!0},a),k=c("memoizeOneWithArgs")(function(a){return d("MWBroadcastChannel").MWBroadcastChannel("msgr_qpl_logger_"+a)}),l="not_started";b=function(){return l};e=function(){try{if(d("MessengerInfraReport").isEPD()){l="epd_blocked";return function(){}}var a=k(d("MAWCurrentUser").getID()),b=function(a){if(e[a.data[0]]==null)return c("FBLogger")("msgr_web_flytrap").warn("Handler %s is not set for QPL listener",a.data[0]);switch(a.data[0]){case"onMarkerEnd":e.onMarkerEnd==null?void 0:e.onMarkerEnd.apply(e,a.data[1]);break;case"onAnnotation":e.onAnnotation==null?void 0:e.onAnnotation.apply(e,a.data[1]);break;case"onMarkerStart":e.onMarkerStart==null?void 0:e.onMarkerStart.apply(e,a.data[1]);break;case"onMarkerPoint":e.onMarkerPoint==null?void 0:e.onMarkerPoint.apply(e,a.data[1]);break;default:c("FBLogger")("maw_init").mustfix("Must implement QPL forwarding for event name: %s",a.data[0])}};a.addEventListener("message",b);var e={onAnnotation:function(a,b,c,d,e){n(a,b,c,d,e)},onMarkerEnd:function(a,b,c){o(a,b,c)},onMarkerPoint:function(a,b,c,d){p(a,b,c,d)},onMarkerStart:function(a,b){q(a,b)}},f=(i||(i=c("QuickPerformanceLogger"))).addListener(e);l="started";return function(){f.dispose(),a.removeEventListener("message",b)}}catch(a){l="error";c("FBLogger")("msgr_web_flytrap").catching(a).mustfix("Failed to initialize QPL logger");return function(){}}};f=function(a){return(a=(a=j[a])==null?void 0:a.name)!=null?a:"UNKNOWN_QPL_NAME"};a=function(a){a=(h||(h=d("QPLEvent"))).getMarkerId(a);return j[a]};var m=function(a,b){a=d("MessengerInfraReport").getEventData(a,b);return a};function n(a,b,c,d,e){a=a.i;var f=j[a];if(!f)return;if(!((f=f.annotations)==null?void 0:(f=f[e])==null?void 0:f.includes(c)))return;e=m(a,b);if(!e)return;if(e.status!==1)return;e.annotations[c]=d}function o(a,b,c){b=b.i;var e=j[b];if(!e)return;var f=m(b,c);if(!f)return;if(f.status!==1)return;e.single&&(f.status=a);e.single||(d("MessengerInfraReportUtils").isQplActionSuccessful(a)?d("MessengerInfraReport").deleteEventData(b,c):f.status=a)}function p(a,b,c,d){a=a.i;var e=j[a];if(!e)return;var f=m(a,b);if(!f)return;if(f.status!==1)return;f.lastPoints.push(c);if(d!=null&&e.annotations!=null){a=function(a){var b;if(d[a]==null)return"continue";(b=e.annotations)==null?void 0:b[a].forEach(function(b){var c;c=(c=d[a])==null?void 0:c[b];c!=null&&(f.annotations[b]=c)})};for(b of Object.keys(e.annotations)){c=a(b);if(c==="continue")continue}}}function q(a,b){a=a.i;var c=j[a];if(!c)return;var e=m(a,b);if(e!=null&&e.status!==1)return;d("MessengerInfraReport").storeEventData(a,{annotations:{},lastPoints:[],single:c.single,status:1},b)}g.ReportedQPLEvents=j;g.getLoggerTabCommunication=k;g.getQplLoggerInitStatus=b;g.initializeLogger=e;g.getQplName=f;g.getReportedEvent=a;g.getCurrentEventData=m;g.onAnnotationHandler=n;g.onMarkerEndHandler=o;g.onMarkerPointHandler=p;g.onMarkerStartHandler=q}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MWBroadcastChannel").MWBroadcastChannel(d("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(a))}g["default"]=a}),98);
__d("loadTaskHandlerResource",["asyncToGeneratorRuntime","cr:3760"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=b("cr:3760").TASK_HANDLERS_RESOURCES[a];return a==null?null:a.getModuleIfRequired()||a.load()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","asyncToGeneratorRuntime","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=a.context,e=a.name,f=a.payload;try{var g=(yield c("loadTaskHandlerResource")(e));if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("No task handler found in context %s",e);e=(yield g.handleTask(f,d));g={context:d,result:e,type:"task_success"};b.postMessage(g)}catch(g){c("FBLogger")("messenger_web").catching(g).mustfix("%s executionContext: Failed to execute task %s",String(a.context.executionContext),a.name);e={context:d,reason:(f=g.message)!=null?f:"",type:"task_failure"};b.postMessage(e)}return});return i.apply(this,arguments)}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b)["finally"](function(){e["delete"](d)}));break;default:}});return function(){return b.close()}}g["default"]=a}),98);
__d("WorkerBanzaiLazyQueueChannelWorker",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WorkerFuncChannel").importChannel({queuePost:null},a,"banzai_lazyqueue_channel");c("BanzaiLazyQueue").onQueue.add(function(){h(b)});h(b)}function h(a){c("BanzaiLazyQueue").flushQueue().forEach(function(b){a.queuePost.apply(a,b)})}g.init=a}),98);
__d("WorkerSelf",["WorkerBanzaiLazyQueueChannelWorker","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"worker","client"),d("WorkerBanzaiLazyQueueChannelWorker").init(a),d("WorkerQPLChannel").setMessagePort(a)}g.init=a}),98);
__d("IGDAWMainWebWorker",["CurrentWorkerMessagePort","FalcoLoggerTransports","IGDAWMainWebWorkerConfig","IGDBackend","IGDLowLevelApiImpl","MAWCommonMainWebWorker","WorkerBridgeAdaptor"],(function(a,b,c,d,e,f,g){"use strict";function a(){self.Env=self.Env||{};var a=new(c("WorkerBridgeAdaptor"))(d("CurrentWorkerMessagePort").getMessagePort(),"IGDAWMainWebWorker");d("MAWCommonMainWebWorker").initWorker({config:d("IGDAWMainWebWorkerConfig").waConfig,currentWorker:a,initBackend:d("IGDBackend").startIGDBackend,makeLowLevelApi:d("IGDLowLevelApiImpl").makeLowLevelApi});d("FalcoLoggerTransports").attach()}g["default"]=a}),98);
__d("SharedWorkerBootstrap",["CurrentSharedWorker","CurrentSharedWorkerAdapter"],(function(a,b,c,d,e,f,g){"use strict";function a(a){h(function(){return b.call(null,a)})}function c(a){h(function(){return a})}function h(a){d("CurrentSharedWorker").onInitComplete(function(){var b=a();if(typeof b==="function"||b!==null)try{b(new(d("CurrentSharedWorkerAdapter").CurrentSharedWorkerAdapter)())}catch(a){}})}g.start=a;g.startServerJS=c}),98);
__d("SharedOrWebWorkerBootstrapInit",["SharedWorkerBootstrap","WorkerBootstrap"],(function(a,b,c,d,e,f){"use strict";function a(a){"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope?b("SharedWorkerBootstrap").startServerJS(a):b("WorkerBootstrap").startServerJS(a)}f.startServerJS=a}),66);